import{d as B,H as K,I as F,M as I,A as b,b as u,e as M,B as U,f as O,g as $,o as q,w as G,a as e,t as g,q as H,j as S,m as p,k as C,v as T}from"./admin-kALM_0gO.js";import{_ as J}from"./AdminLayout.vue_vue_type_script_setup_true_lang-Cuj5t4tU.js";import{S as N}from"./SearchableSelect-CbWDSjOg.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const L={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},X={class:"mb-6 flex items-center justify-between"},A={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},Y={class:"grid grid-cols-1 gap-x-6 gap-y-5 lg:grid-cols-2"},z={class:"lg:col-span-1"},Q={class:"lg:col-span-1"},W={class:"lg:col-span-1"},Z=["max"],aa={class:"lg:col-span-1"},ea={class:"mt-8 rounded-lg border border-gray-200 bg-white p-6 dark:border-gray-800 dark:bg-white/[0.03]"},ta={class:"grid grid-cols-1 gap-x-6 gap-y-5 lg:grid-cols-2"},ra={class:"lg:col-span-1"},na={class:"dark:bg-dark-900 h-11 w-full flex items-center rounded-lg border border-gray-300 bg-gray-50 px-4 py-2.5 text-sm text-gray-800 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90"},oa={class:"font-medium"},sa={class:"mt-8 rounded-lg border border-gray-200 bg-gray-50 p-6 dark:border-gray-800 dark:bg-gray-900/50"},ia={class:"flex items-center justify-between"},da={class:"text-xl font-bold text-brand-500 dark:text-brand-400"},la={class:"flex items-center gap-3 mt-6 lg:justify-end"},ua={type:"submit",class:"flex w-full justify-center rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600 sm:w-auto"},ya=B({__name:"RemunerasiForm",setup(ga){const i=K(),y=F(),d=I(),l=b(()=>i.params.id!==void 0&&i.params.id!=="new"),D=b(()=>l.value?"Edit Remunerasi":"Tambah Remunerasi"),k=u([]),x=u([]),h=u(""),f=u(""),P=async()=>{try{const o=await fetch("/admin/api/karyawan?per_page=1000",{credentials:"same-origin"});if(o.ok){const r=await o.json();k.value=(r.data||[]).map(n=>({value:String(n.id),label:n.name||n.nama||"-"}))}const a=await fetch("/admin/api/kantor-cabang?per_page=1000",{credentials:"same-origin"});if(a.ok){const r=await a.json();x.value=(r.data||[]).map(n=>({value:String(n.id),label:n.nama||n.name||"-"}))}}catch(o){console.error("Error loading options:",o)}},t=M({karyawan_id:"",bulan:null,tahun:null,kantorCabang:"",namaKaryawan:""}),s=u(0),R=()=>{w()},w=async()=>{if(s.value=0,!!t.karyawan_id)try{const o=await fetch(`/admin/api/gaji?karyawan_id=${t.karyawan_id}&per_page=1`,{credentials:"same-origin"});if(!o.ok)return;const r=(await o.json()).data||[];if(r.length>0){const n=r[0];s.value=n.nominal||n.gaji_pokok||0}}catch(o){console.error("Error loading gaji pokok:",o)}},_=b(()=>s.value),v=o=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(o),V=async()=>{if(await P(),l.value&&i.params.id){const o=i.params.id;try{const a=await fetch(`/admin/api/operasional/remunerasi/${o}`,{credentials:"same-origin"});if(!a.ok)throw new Error("Failed to load remunerasi");const r=await a.json();if(r&&r.data){const n=r.data;t.namaKaryawan="",t.karyawan_id=n.karyawan_id?String(n.karyawan_id):"",t.bulan=n.bulan_remunerasi||null,t.tahun=n.tahun_remunerasi||null,t.kantorCabang=n.kantor_cabang_id?String(n.kantor_cabang_id):"",s.value=n.gaji_pokok||0}}catch(a){console.error("Error loading data for edit:",a)}}},j=()=>{y.push("/operasional/remunerasi")},E=async()=>{if(!t.karyawan_id){d.error("Nama Karyawan wajib diisi");return}if(!t.bulan||t.bulan<1||t.bulan>12){d.error("Bulan harus antara 1-12");return}if(!t.tahun){d.error("Tahun wajib diisi");return}try{const a=await(await fetch("/admin/api/csrf-token",{credentials:"same-origin"})).json(),r={karyawan_id:t.karyawan_id?Number(t.karyawan_id):null,bulan_remunerasi:t.bulan,tahun_remunerasi:t.tahun,gaji_pokok:s.value||null,take_home_pay:_.value||0,tanggal:null,kantor_cabang_id:t.kantorCabang||null};t.tahun&&(r.tanggal=`${t.tahun}-${String(t.bulan).padStart(2,"0")}-15`);let n;if(l.value){const c=i.params.id;n=await fetch(`/admin/api/operasional/remunerasi/${c}`,{method:"PUT",credentials:"same-origin",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":a.csrf_token},body:JSON.stringify(r)})}else n=await fetch("/admin/api/operasional/remunerasi",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":a.csrf_token},body:JSON.stringify(r)});const m=await n.json().catch(()=>({}));if(!n.ok){const c=m&&m.message||"Request gagal";throw new Error(c)}d.success(m.message||(l.value?"Remunerasi berhasil diupdate":"Remunerasi berhasil ditambahkan")),y.push("/operasional/remunerasi")}catch(o){console.error("Error saving:",o),d.error("Terjadi kesalahan saat menyimpan data")}};return U(()=>t.karyawan_id,()=>{w()}),O(()=>{V()}),(o,a)=>(q(),$(J,null,{default:G(()=>[e("div",L,[e("div",X,[e("h3",A,g(D.value),1),e("button",{onClick:j,class:"flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03]"}," Batal ")]),e("form",{onSubmit:H(E,["prevent"]),class:"flex flex-col"},[e("div",Y,[e("div",z,[a[6]||(a[6]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[p(" Nama Karyawan "),e("span",{class:"text-red-500"},"*")],-1)),S(N,{modelValue:t.karyawan_id,"onUpdate:modelValue":[a[0]||(a[0]=r=>t.karyawan_id=r),R],options:k.value,placeholder:"Pilih atau cari nama karyawan","search-input":h.value,"onUpdate:searchInput":a[1]||(a[1]=r=>h.value=r)},null,8,["modelValue","options","search-input"])]),e("div",Q,[a[7]||(a[7]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[p(" Bulan "),e("span",{class:"text-red-500"},"*")],-1)),C(e("input",{type:"number","onUpdate:modelValue":a[2]||(a[2]=r=>t.bulan=r),placeholder:"Masukkan bulan (1-12)",min:"1",max:"12",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[T,t.bulan,void 0,{number:!0}]])]),e("div",W,[a[8]||(a[8]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[p(" Tahun "),e("span",{class:"text-red-500"},"*")],-1)),C(e("input",{type:"number","onUpdate:modelValue":a[3]||(a[3]=r=>t.tahun=r),placeholder:"Masukkan tahun",min:"2000",max:new Date().getFullYear()+1,required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,8,Z),[[T,t.tahun,void 0,{number:!0}]])]),e("div",aa,[a[9]||(a[9]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kantor Cabang ",-1)),S(N,{modelValue:t.kantorCabang,"onUpdate:modelValue":a[4]||(a[4]=r=>t.kantorCabang=r),options:x.value,placeholder:"Pilih atau cari kantor cabang","search-input":f.value,"onUpdate:searchInput":a[5]||(a[5]=r=>f.value=r)},null,8,["modelValue","options","search-input"])])]),e("div",ea,[a[12]||(a[12]=e("h4",{class:"mb-6 text-lg font-semibold text-gray-800 dark:text-white/90"}," Bagian Kalkulasi Gaji ",-1)),e("div",ta,[e("div",ra,[a[10]||(a[10]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Gaji Pokok - Nominal ",-1)),e("div",na,[e("span",oa,g(v(s.value)),1)]),a[11]||(a[11]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," Display only (readonly) ",-1))])])]),e("div",sa,[e("div",ia,[a[13]||(a[13]=e("label",{class:"text-lg font-semibold text-gray-800 dark:text-white/90"}," Take Home Pay ",-1)),e("span",da,g(v(_.value)),1)]),a[14]||(a[14]=e("p",{class:"mt-2 text-sm text-gray-500 dark:text-gray-400"}," Display only ",-1))]),e("div",la,[e("button",{onClick:j,type:"button",class:"flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] sm:w-auto"}," Batal "),e("button",ua,g(l.value?"Simpan Perubahan":"Simpan"),1)])],32)])]),_:1}))}});export{ya as default};
