import{d as G,H as W,I as $,b as j,A as w,M as I,Q as K,e as V,f as Q,g as Y,o as i,w as Z,a,t as u,q as J,k as ee,c as p,i as c,m as T,v as ae,j as te,u as re}from"./admin-1eYuKHfE.js";import{C as oe}from"./component-CPtQfrF7.js";import{_ as se}from"./AdminLayout.vue_vue_type_script_setup_true_lang-DiBPl_J-.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const le={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},ne={class:"mb-6 flex items-center justify-between"},ie={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},de={class:"grid grid-cols-1 gap-x-6 gap-y-5 lg:grid-cols-2"},ue={class:"lg:col-span-2"},pe=["disabled"],ce={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},ge={key:0,class:"mt-1 text-xs text-red-500"},me={class:"lg:col-span-1"},fe={key:0,class:"mt-1 text-xs text-red-500"},he={class:"lg:col-span-2"},xe={class:"space-y-4"},be=["disabled"],ke={key:0,class:"space-y-2"},ye={key:0,class:"flex items-center gap-3 rounded-lg border border-gray-300 bg-gray-50 p-4 dark:border-gray-700 dark:bg-gray-800"},ve={class:"flex-1 min-w-0"},we={class:"text-sm font-medium text-gray-800 dark:text-white/90 truncate"},_e={class:"text-xs text-gray-500 dark:text-gray-400"},Me={key:0,class:"flex items-center gap-2"},Ce=["href"],je={key:1,class:"flex items-center gap-3 rounded-lg border border-gray-300 bg-gray-50 p-4 dark:border-gray-700 dark:bg-gray-800"},Te={class:"flex-1 min-w-0"},Fe={class:"text-sm font-medium text-gray-800 dark:text-white/90 truncate"},Pe={class:"text-xs text-gray-500 dark:text-gray-400"},Be={key:0,class:"mt-1 text-xs text-red-500"},ze={class:"flex items-center gap-3 mt-6 lg:justify-end"},De=["disabled"],Ne=G({__name:"LandingProposalForm",setup(Se){const b=W(),_=$(),g=j(null),v=w(()=>String(b.query.view||"")==="1"),f=w(()=>b.params.id!==void 0&&b.params.id!=="new"),A=w(()=>f.value?"Edit Landing Proposal":"Tambah Landing Proposal"),k=j(!1),h=I(),{fetchUser:R,hasPermission:P,isAdmin:B}=K();R();const z=w(()=>B()||P("create landing proposal")),M=w(()=>B()||P("update landing proposal")),N={dateFormat:"Y-m-d",locale:{firstDayOfWeek:1}},s=V({name:"",proposal_date:""}),r=V({name:"",proposal_date:"",file:""}),d=j(null),n=j(null),D=o=>{if(o===0)return"0 Bytes";const e=1024,l=["Bytes","KB","MB","GB"],t=Math.floor(Math.log(o)/Math.log(e));return Math.round(o/Math.pow(e,t)*100)/100+" "+l[t]},O=o=>{var l;const e=o.target;if(e.files&&e.files.length>0){const t=e.files[0],F=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],C=[".pdf",".doc",".docx"],E="."+((l=t.name.split(".").pop())==null?void 0:l.toLowerCase());if(!F.includes(t.type)&&!C.includes(E)){r.file="Format file tidak didukung. Hanya PDF, DOC, dan DOCX yang diizinkan.",g.value&&(g.value.value="");return}const m=20*1024*1024;if(t.size>m){r.file="Ukuran file melebihi 20MB. Mohon pilih file yang lebih kecil.",g.value&&(g.value.value="");return}r.file="",d.value=t,n.value=null,g.value&&(g.value.value="")}},L=()=>{d.value=null,g.value&&(g.value.value=""),r.file=""},q=()=>{n.value=null,r.file=""},H=()=>{let o=!0;if(Object.keys(r).forEach(e=>{r[e]=""}),!s.name||s.name.trim()===""?(r.name="Nama proposal wajib diisi",o=!1):s.name.length>100&&(r.name="Nama proposal maksimal 100 karakter",o=!1),!s.proposal_date)r.proposal_date="Tanggal proposal wajib diisi",o=!1;else{const e=new Date(s.proposal_date);isNaN(e.getTime())&&(r.proposal_date="Format tanggal tidak valid",o=!1)}return!d.value&&!n.value&&(r.file="File proposal wajib diupload",o=!1),o},X=async()=>{if(f.value&&b.params.id){const o=b.params.id;k.value=!0;try{const l=await(await fetch(`/admin/api/landing-proposal/${o}`,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin"})).json();if(l.success&&l.data){const t=l.data;s.name=t.name||"",s.proposal_date=t.proposal_date||"",t.file&&(n.value={name:t.file_name||"File Proposal",url:t.file_url||(String(t.file).startsWith("http")?t.file:`/storage/${t.file}`),size:t.file_size||void 0})}else h.error(l.message||"Gagal memuat data"),_.push("/company/landing-proposal")}catch(e){console.error("Error loading data:",e),h.error("Terjadi kesalahan saat memuat data"),_.push("/company/landing-proposal")}finally{k.value=!1}}},S=()=>{_.push("/company/landing-proposal")},U=async()=>{var o;if(H()){if(v.value){h.error("Hanya tampilan. Tidak dapat menyimpan.");return}if(f.value?!M.value:!z.value){h.error("Anda tidak memiliki izin untuk melakukan tindakan ini");return}k.value=!0;try{const e=new FormData;e.append("name",s.name),e.append("proposal_date",s.proposal_date),d.value&&e.append("file",d.value);let t=((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||"";if(!t)try{const y=await(await fetch("/admin/api/csrf-token")).json();t=(y==null?void 0:y.csrf_token)||(y==null?void 0:y.token)||""}catch{}t&&e.append("_token",t);const F=f.value?`/admin/api/landing-proposal/${b.params.id}`:"/admin/api/landing-proposal";f.value&&e.append("_method","PUT");const C={"X-Requested-With":"XMLHttpRequest",Accept:"application/json"};t&&(C["X-CSRF-TOKEN"]=t);const m=await(await fetch(F,{method:"POST",headers:C,credentials:"same-origin",body:e})).json();m.success?(h.success(f.value?"Proposal berhasil diupdate":"Proposal berhasil ditambahkan"),_.push("/company/landing-proposal")):(m.errors&&Object.keys(m.errors).forEach(x=>{r.hasOwnProperty(x)&&(r[x]=Array.isArray(m.errors[x])?m.errors[x][0]:m.errors[x])}),h.error(m.message||"Gagal menyimpan data"))}catch(e){console.error("Error saving:",e),h.error("Terjadi kesalahan saat menyimpan data")}finally{k.value=!1}}};return Q(()=>{X()}),(o,e)=>(i(),Y(se,null,{default:Z(()=>[a("div",le,[a("div",ne,[a("h3",ie,u(A.value),1),a("button",{onClick:S,class:"flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03]"}," Batal ")]),a("form",{onSubmit:J(U,["prevent"]),class:"flex flex-col"},[a("div",de,[a("div",ue,[e[2]||(e[2]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[T(" Nama Proposal "),a("span",{class:"text-red-500"},"*")],-1)),ee(a("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=l=>s.name=l),disabled:v.value,placeholder:"Masukkan nama proposal",maxlength:"100",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,8,pe),[[ae,s.name]]),a("p",ce,u(s.name.length)+"/100 karakter ",1),r.name?(i(),p("p",ge,u(r.name),1)):c("",!0)]),a("div",me,[e[3]||(e[3]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[T(" Tanggal Proposal "),a("span",{class:"text-red-500"},"*")],-1)),te(re(oe),{modelValue:s.proposal_date,"onUpdate:modelValue":e[1]||(e[1]=l=>s.proposal_date=l),config:N,class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",placeholder:"Pilih tanggal proposal"},null,8,["modelValue"]),r.proposal_date?(i(),p("p",fe,u(r.proposal_date),1)):c("",!0)]),a("div",he,[e[10]||(e[10]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[T(" File Proposal "),a("span",{class:"text-red-500"},"*")],-1)),a("div",xe,[a("div",null,[a("input",{ref_key:"fileInputRef",ref:g,type:"file",disabled:v.value,accept:".pdf,.doc,.docx",onChange:O,class:"dark:bg-dark-900 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus:border-brand-800"},null,40,be),e[4]||(e[4]=a("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," Format: PDF, DOC, DOCX. Maksimal 20MB. Hanya 1 file per proposal. ",-1))]),d.value||n.value?(i(),p("div",ke,[n.value&&!d.value?(i(),p("div",ye,[e[7]||(e[7]=a("div",{class:"flex-shrink-0"},[a("svg",{class:"h-10 w-10 text-brand-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})])],-1)),a("div",ve,[a("p",we,u(n.value.name||"File Proposal"),1),a("p",_e,u(n.value.size?D(n.value.size):""),1)]),M.value&&!v.value?(i(),p("div",Me,[n.value.url?(i(),p("a",{key:0,href:n.value.url,target:"_blank",class:"flex items-center gap-1 rounded-lg bg-brand-500 px-3 py-1.5 text-xs font-medium text-white hover:bg-brand-600"},[...e[5]||(e[5]=[a("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1),T(" Lihat ",-1)])],8,Ce)):c("",!0),a("button",{type:"button",onClick:q,class:"flex items-center justify-center w-8 h-8 rounded-lg text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 transition-colors"},[...e[6]||(e[6]=[a("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[a("path",{d:"M18 6L6 18M6 6l12 12"})],-1)])])])):c("",!0)])):c("",!0),d.value?(i(),p("div",je,[e[9]||(e[9]=a("div",{class:"flex-shrink-0"},[a("svg",{class:"h-10 w-10 text-brand-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})])],-1)),a("div",Te,[a("p",Fe,u(d.value.name),1),a("p",Pe,u(D(d.value.size)),1)]),M.value?(i(),p("button",{key:0,type:"button",onClick:L,class:"flex items-center justify-center w-8 h-8 rounded-lg text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 transition-colors"},[...e[8]||(e[8]=[a("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[a("path",{d:"M18 6L6 18M6 6l12 12"})],-1)])])):c("",!0)])):c("",!0)])):c("",!0)]),r.file?(i(),p("p",Be,u(r.file),1)):c("",!0)])]),a("div",ze,[a("button",{onClick:S,type:"button",class:"flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] sm:w-auto"}," Batal "),(f.value?M.value:z.value)&&!v.value?(i(),p("button",{key:0,type:"submit",disabled:k.value,class:"flex w-full justify-center rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600 disabled:opacity-50 disabled:cursor-not-allowed sm:w-auto"},u(k.value?"Menyimpan...":f.value?"Simpan Perubahan":"Simpan"),9,De)):c("",!0)])],32)])]),_:1}))}});export{Ne as default};
