import{d as q,A as _,Q as G,b as u,f as J,y as W,B as X,c as d,o as c,a as f,j as Y,i as k,n as V,t as T,w as Z,k as ee,v as ae,q as te,F as le,l as re,z as ne,V as se}from"./admin-CV1dLeYC.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ie={key:0,class:"ml-2 text-sm text-gray-500"},ue={key:0,class:"absolute z-50 w-full mt-1 bg-white rounded-lg shadow-lg border border-gray-200 dark:bg-gray-900 dark:border-gray-700 max-h-60 overflow-hidden"},de={class:"p-2 border-b border-gray-200 dark:border-gray-700"},ce={key:0,class:"px-2 border-b bg-gray-50 dark:bg-gray-800"},fe=["onClick"],ve={key:0,class:"px-4 py-2 text-sm text-gray-500 dark:text-gray-400"},ge={key:1,class:"px-4 py-2 text-sm text-gray-500 dark:text-gray-400"},pe={key:2,class:"px-4 py-2 text-xs text-gray-400"},he=q({__name:"AsyncSearchableSelect",props:{modelValue:{},fetchUrl:{},perPage:{default:20},placeholder:{default:"Pilih..."},disabled:{type:Boolean,default:!1},includeAll:{type:Boolean,default:!1},allLabel:{default:"Semua"},allValue:{default:""},params:{default:()=>({})},labelKey:{default:"nama"},valueKey:{default:"id"},allowClear:{type:Boolean,default:!1}},emits:["update:modelValue","update:search-input","fetched"],setup(y,{emit:I}){function z(e,t=300){let a=null;const n=(...r)=>{a&&clearTimeout(a),a=setTimeout(()=>{e(...r)},t)};return n.cancel=()=>{a&&(clearTimeout(a),a=null)},n}const l=y,v=I,{isAdmin:M,fetchUser:$,user:p}=G(),O=_(()=>{const e=p.value&&p.value.role||null,t=e?e.name&&String(e.name)||String(e):"",a=String(t||"").trim().toLowerCase();return a==="fundrising"||a==="fundraising"||a==="fundraiser"}),R=_(()=>{const e=p.value&&p.value.role||null,t=e?e.name&&String(e.name)||String(e):"",a=String(t||"").trim().toLowerCase();return a.includes("direktur")&&(a.includes("fund")||a.includes("fundr"))}),s=u(!1),m=u(!1),o=u([]),w=u(1),b=u(null),i=u(""),P=u(null),C=u(null),A=u(null),j=_(()=>b.value===null?!0:w.value<(b.value||0)),B=_(()=>{if(l.includeAll&&String(l.modelValue)===String(l.allValue))return l.allLabel||"";const e=o.value.find(t=>t.value===l.modelValue);return e?e.label:""}),L=async(e="",t=1)=>{if(l.fetchUrl){m.value=!0;try{const a=new URLSearchParams;e&&a.append("search",e),a.append("per_page",String(l.perPage)),a.append("page",String(t)),l.params&&Object.entries(l.params).forEach(([x,g])=>{g!=null&&g!==""&&a.append(x,String(g))}),l.fetchUrl&&l.fetchUrl.includes("/admin/api/donatur")&&!M()&&!R.value&&(a.append("only_assigned","1"),O.value&&p.value&&p.value.id&&a.append("pic",String(p.value.id)));const n=await fetch(`${l.fetchUrl}?${a.toString()}`,{credentials:"same-origin"});if(!n.ok)throw new Error("Failed to fetch");const r=await n.json();if(r.success){const g=(Array.isArray(r.data)?r.data:r.data&&r.data.data||[]).map(h=>({value:h[l.valueKey||"id"],label:h[l.labelKey||"nama"]||h.name||h.kode||h.label||""}));if(t===1)o.value=g;else{const h=new Set(o.value.map(S=>S.value));g.forEach(S=>{h.has(S.value)||o.value.push(S)})}r.pagination?b.value=r.pagination.last_page:r.data&&r.data.last_page?b.value=r.data.last_page:b.value=g.length<l.perPage?t:null,w.value=t}}catch(a){console.error("AsyncSelect fetch error:",a)}finally{m.value=!1}}},E=async e=>{if(!(!l.fetchUrl||!e))try{const t=await fetch(`${l.fetchUrl}/${e}`,{credentials:"same-origin"});if(!t.ok)throw new Error("Failed to fetch by id");const a=await t.json();if(a.success&&a.data){const n=a.data,r={value:n.id,label:n.nama||n.name||n.kode||""};o.value.find(x=>x.value===r.value)||o.value.unshift(r);try{v("fetched",n)}catch{}}}catch{}},U=z(async e=>{w.value=1,b.value=null,await L(e,1)},300),D=e=>{const t=e.target;i.value=t.value,v("update:search-input",t.value),U(t.value)},K=()=>{s.value=!s.value,s.value?se(()=>{var e;(e=P.value)==null||e.focus(),L(i.value||"",1)}):(i.value="",v("update:search-input",""))},N=e=>{v("update:modelValue",e.value),i.value="",v("update:search-input",""),s.value=!1},H=()=>{v("update:modelValue",l.allValue||""),i.value="",v("update:search-input",""),s.value=!1},Q=()=>{if(!A.value||m.value||!j.value)return;const e=A.value;e.scrollTop+e.clientHeight>=e.scrollHeight-30&&L(i.value||"",w.value+1)},F=e=>{C.value&&!C.value.contains(e.target)&&(s.value=!1,i.value="",v("update:search-input",""))};return J(()=>{document.addEventListener("click",F),l.modelValue&&E(l.modelValue),(async()=>{try{await $()}catch{}})()}),W(()=>{document.removeEventListener("click",F),U.cancel&&U.cancel()}),X(()=>l.modelValue,e=>{e&&E(e)}),(e,t)=>(c(),d("div",{ref_key:"selectRef",ref:C,class:V(["relative bg-transparent",s.value?"z-50":"z-10"])},[f("div",{onClick:t[0]||(t[0]=a=>!y.disabled&&K()),class:V(["dark:bg-dark-900 h-11 w-full flex items-center rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 pr-11 text-sm text-gray-800 shadow-theme-xs focus-within:border-brand-300 focus-within:outline-hidden focus-within:ring-3 focus-within:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus-within:border-brand-800",{"border-brand-300":s.value,"cursor-pointer hover:border-brand-300":!y.disabled,"cursor-not-allowed bg-gray-100 dark:bg-gray-800 opacity-75":y.disabled}])},[f("span",{class:V({"text-gray-800 dark:text-white/90":B.value,"text-gray-400":!B.value})},T(B.value||y.placeholder),3),m.value&&!s.value?(c(),d("span",ie," (memuat...) ")):k("",!0)],2),t[3]||(t[3]=f("span",{class:"absolute z-30 text-gray-500 -translate-y-1/2 pointer-events-none right-4 top-1/2 dark:text-gray-400"},[f("svg",{class:"stroke-current",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[f("path",{d:"M4.79175 7.396L10.0001 12.6043L15.2084 7.396",stroke:"","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),Y(ne,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:Z(()=>[s.value?(c(),d("div",ue,[f("div",de,[ee(f("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=a=>i.value=a),onInput:D,placeholder:"Cari...",class:"w-full h-9 rounded-lg border border-gray-300 bg-transparent px-3 py-1.5 text-sm text-gray-800 dark:border-gray-700 dark:bg-gray-800 dark:text-white/90",onClick:t[2]||(t[2]=te(()=>{},["stop"])),ref_key:"searchInputRef",ref:P},null,544),[[ae,i.value]])]),l.includeAll?(c(),d("div",ce,[f("button",{type:"button",onClick:H,class:"w-full text-left text-sm px-4 py-2 text-gray-700 hover:bg-gray-100 dark:text-white/90 dark:hover:bg-gray-800"},T(l.allLabel),1)])):k("",!0),f("div",{ref_key:"listContainer",ref:A,class:"overflow-y-auto max-h-48 custom-scrollbar",onScrollPassive:Q},[(c(!0),d(le,null,re(o.value,a=>(c(),d("button",{key:a.value,type:"button",onClick:n=>N(a),class:V(["w-full px-4 py-2 text-left text-sm text-gray-800 hover:bg-gray-100 dark:text-white/90 dark:hover:bg-gray-800 transition-colors",{"bg-gray-100 dark:bg-gray-800":y.modelValue===a.value}])},T(a.label),11,fe))),128)),o.value.length===0&&!m.value?(c(),d("div",ve," Tidak ada data ditemukan ")):k("",!0),m.value?(c(),d("div",ge,"Memuat...")):k("",!0),!j.value&&o.value.length>0?(c(),d("div",pe,"Tidak ada lagi")):k("",!0)],544)])):k("",!0)]),_:1})],2))}}),be=oe(he,[["__scopeId","data-v-f9f803a6"]]);export{be as A};
