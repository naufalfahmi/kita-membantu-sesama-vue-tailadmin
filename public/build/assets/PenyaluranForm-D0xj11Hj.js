import{d as G,H as X,I as $,A as C,b as c,e as z,L as H,f as O,B as W,g as F,o as y,w as J,a as r,t as h,q as Q,m as p,k as l,v as i,O as Y,c as w,u as v,F as P,i as Z,l as aa}from"./admin-BxxhZ4af.js";import{_ as ea}from"./AdminLayout.vue_vue_type_script_setup_true_lang-DRw1DB75.js";import{S as ra}from"./SearchableSelect-BgAGHaiG.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ta={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},na={class:"mb-6 flex items-center justify-between"},oa={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},sa={class:"grid grid-cols-1 gap-x-6 gap-y-5 lg:grid-cols-2"},da={class:"lg:col-span-1"},la={class:"relative"},ia={class:"lg:col-span-1"},ua={class:"lg:col-span-1"},pa={class:"mt-2 text-sm text-gray-600"},ga={class:"font-medium"},ca={class:"font-medium"},ma={class:"lg:col-span-1"},ba={class:"lg:col-span-1"},ya={class:"lg:col-span-1"},ka={class:"lg:col-span-1"},xa={class:"lg:col-span-1"},fa={class:"lg:col-span-1"},ha={class:"lg:col-span-2"},va={class:"lg:col-span-2"},wa={class:"lg:col-span-1"},ja=["value"],Ma={class:"lg:col-span-2"},Ca={class:"space-y-4"},Ia={class:"relative"},_a={key:0,class:"space-y-2"},Sa={class:"flex items-center gap-3"},Ta={class:"text-sm font-medium text-gray-800 dark:text-white/90"},Fa={class:"text-xs text-gray-500 dark:text-gray-400"},Pa=["onClick"],Ea=G({__name:"PenyaluranForm",setup(Va){const m=X(),j=$(),k=C(()=>m.params.id!==void 0&&m.params.id!=="new"),V=C(()=>k.value?"Edit Penyaluran":"Buat Penyaluran"),I=c([]),U=async()=>{try{const o=await fetch("/admin/api/kantor-cabang?per_page=1000",{credentials:"same-origin"});if(!o.ok)return;const a=await o.json(),s=a.success&&a.data?Array.isArray(a.data)?a.data:a.data.data||[]:[];I.value=s.map(n=>({value:n.id,label:n.nama}))}catch(o){console.error("Failed to fetch kantor cabang options",o)}};c("");const _=c(""),b=c(null),B=async()=>{var o,a,s;try{const n=await fetch("/admin/api/user",{credentials:"same-origin"});if(n.ok){const d=await n.json();d.success&&d.user&&(b.value=d.user,(a=(o=b.value)==null?void 0:o.kantor_cabang)!=null&&a.id&&(e.branchId=String(b.value.kantor_cabang.id)),(s=b.value)!=null&&s.is_admin&&await U())}}catch(n){console.error("Failed to fetch current user",n)}},M=c(null),x=c([]),e=z({amount:"",program:"",submissionType:"program",pic:"",village:"",district:"",city:"",province:"",postalCode:"",address:"",report:"",branchId:"",pengajuanId:""}),f=c(0),K=C(()=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(f.value||0)),S=async o=>{try{if(!o){f.value=0;return}const s=await(await fetch(`/admin/api/penyaluran/my-credit?type=${encodeURIComponent(o)}`,{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest"}})).json();s&&s.success&&s.data&&typeof s.data.remaining<"u"?f.value=Number(s.data.remaining)||0:f.value=0}catch(a){console.error("Failed to load credit total for type",o,a),f.value=0}},R=o=>{let s=o.target.value.replace(/[^\d.,]/g,"");s=s.replace(/,/g,".");const n=s.split(".");n.length>2&&(s=n[0]+"."+n.slice(1).join("")),e.amount=s},E=o=>{const a=o.target;if(a.files){const s=Array.from(a.files),n=20*1024*1024,d=[],t=[];s.forEach(u=>{u.size>n?t.push(u.name):d.push(u)}),t.length>0&&alert(`File berikut melebihi 20MB: ${t.join(", ")}`),x.value.push(...d),M.value&&(M.value.value="")}},q=o=>{x.value.splice(o,1)},L=o=>{if(o===0)return"0 Bytes";const a=1024,s=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(o)/Math.log(a));return Math.round(o/Math.pow(a,n)*100)/100+" "+s[n]},A=async()=>{var o,a;if(k.value&&m.params.id){const s=m.params.id;try{const n=await fetch(`/admin/api/penyaluran/${s}`,{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest"}});if(!n.ok)throw new Error("Failed to fetch penyaluran");const d=await n.json();if(!d.success||!d.data){console.error("Penyaluran tidak ditemukan");return}const t=d.data;e.amount=t.amount!=null?String(t.amount):e.amount,e.program=t.program_name||t.pengajuan&&(((o=t.pengajuan.program)==null?void 0:o.nama_program)||((a=t.pengajuan.program)==null?void 0:a.nama))||e.program,e.pic=t.pic||(t.pengajuan&&t.pengajuan.fundraiser?t.pengajuan.fundraiser.name:e.pic),e.village=t.village||t.kelurahan||e.village,e.district=t.district||t.kecamatan||e.district,e.city=t.city||t.kota||e.city,e.province=t.province||e.province,e.postalCode=t.postal_code||e.postalCode,e.address=t.address||e.address,e.report=t.report||e.report,e.branchId=t.kantor_cabang_id||t.kantor_cabang&&t.kantor_cabang.id||e.branchId,e.pengajuanId=t.pengajuan_dana_id||e.pengajuanId}catch(n){console.error("Error loading penyaluran",n)}}},T=()=>{j.push("/keuangan/penyaluran")},g=H(),D=async()=>{var o;if(!e.amount){g.error("Nominal wajib diisi");return}if(!e.program){g.error("Program wajib diisi");return}if(!e.pic){g.error("PIC wajib diisi");return}if(!e.branchId){g.error("Kantor Cabang wajib diisi");return}try{const a=new FormData;a.append("amount",String(e.amount||"0")),e.pengajuanId&&a.append("pengajuan_dana_id",String(e.pengajuanId)),e.submissionType&&a.append("submission_type",String(e.submissionType)),a.append("program_name",e.program||""),a.append("pic",e.pic||""),a.append("village",e.village||""),a.append("district",e.district||""),a.append("city",e.city||""),a.append("province",e.province||""),a.append("postal_code",e.postalCode||""),a.append("address",e.address||""),a.append("report",e.report||""),a.append("kantor_cabang_id",e.branchId||""),x.value.forEach(u=>{a.append("images[]",u)});const s=((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||"",n=k.value?`/admin/api/penyaluran/${m.params.id}`:"/admin/api/penyaluran";k.value&&a.append("_method","PUT");const t=await(await fetch(n,{method:"POST",body:a,credentials:"same-origin",headers:{"X-CSRF-TOKEN":s}})).json();if(!t.success)g.error(t.message||"Gagal menyimpan penyaluran");else{g.success(k.value?"Penyaluran berhasil diupdate":"Penyaluran berhasil dibuat");try{await j.push("/keuangan/penyaluran"),window.dispatchEvent(new CustomEvent("penyaluran:changed"));return}catch{j.push("/keuangan/penyaluran");try{window.dispatchEvent(new CustomEvent("penyaluran:changed"))}catch{}}}}catch(a){console.error("Error saving:",a),g.error("Terjadi kesalahan saat menyimpan data")}};return O(async()=>{await B();const o=m.query.pengajuan_id;if(o)try{const s=await(await fetch(`/admin/api/pengajuan-dana/${o}`,{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest"}})).json();if(s.success&&s.data){const n=s.data;e.pengajuanId=String(o),e.submissionType=n.submission_type||e.submissionType,e.program=n.program&&(n.program.nama||n.program.nama_program)||e.program,e.pic=n.fundraiser?n.fundraiser.name:e.pic,e.amount=n.amount||e.amount,e.report=n.purpose||e.report}}catch(a){console.error("Failed to load pengajuan",a)}A(),S(e.submissionType)}),W(()=>e.submissionType,o=>{S(String(o||""))}),(o,a)=>(y(),F(ea,null,{default:J(()=>{var s,n,d;return[r("div",ta,[r("div",na,[r("h3",oa,h(V.value),1),r("button",{onClick:T,class:"flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03]"}," Kembali ")]),r("form",{onSubmit:Q(D,["prevent"]),class:"flex flex-col"},[r("div",sa,[r("div",da,[a[15]||(a[15]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[p(" Nominal "),r("span",{class:"text-red-500"},"*")],-1)),r("div",la,[a[14]||(a[14]=r("span",{class:"absolute left-4 top-1/2 -translate-y-1/2 text-sm text-gray-500 dark:text-gray-400"}," Rp ",-1)),l(r("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=t=>e.amount=t),onInput:R,placeholder:"Masukkan nominal penyaluran",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 pl-12 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,544),[[i,e.amount]])])]),r("div",ia,[a[16]||(a[16]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[p(" Nama Penyaluran "),r("span",{class:"text-red-500"},"*")],-1)),l(r("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=t=>e.program=t),placeholder:"Masukkan nama program atau tahapannya",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[i,e.program]])]),r("div",ua,[a[20]||(a[20]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[p("Tipe Penyaluran "),r("span",{class:"text-red-500"},"*")],-1)),l(r("select",{"onUpdate:modelValue":a[2]||(a[2]=t=>e.submissionType=t),class:"h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800"},[...a[17]||(a[17]=[r("option",{value:"program"},"Program",-1),r("option",{value:"operasional"},"Operasional",-1),r("option",{value:"gaji karyawan"},"Gaji Karyawan",-1)])],512),[[Y,e.submissionType]]),r("p",pa,[a[18]||(a[18]=p("Sisa kredit untuk ",-1)),r("span",ga,h(e.submissionType),1),a[19]||(a[19]=p(": ",-1)),r("span",ca,h(K.value),1)])]),r("div",ma,[a[21]||(a[21]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[p(" PIC "),r("span",{class:"text-red-500"},"*")],-1)),l(r("input",{type:"text","onUpdate:modelValue":a[3]||(a[3]=t=>e.pic=t),placeholder:"Masukkan penanggung jawab penyaluran",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[i,e.pic]])]),r("div",ba,[a[22]||(a[22]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kelurahan ",-1)),l(r("input",{type:"text","onUpdate:modelValue":a[4]||(a[4]=t=>e.village=t),placeholder:"Masukkan kelurahan",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[i,e.village]])]),r("div",ya,[a[23]||(a[23]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kecamatan ",-1)),l(r("input",{type:"text","onUpdate:modelValue":a[5]||(a[5]=t=>e.district=t),placeholder:"Masukkan kecamatan",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[i,e.district]])]),r("div",ka,[a[24]||(a[24]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kota ",-1)),l(r("input",{type:"text","onUpdate:modelValue":a[6]||(a[6]=t=>e.city=t),placeholder:"Masukkan kota",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[i,e.city]])]),r("div",xa,[a[25]||(a[25]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Provinsi ",-1)),l(r("input",{type:"text","onUpdate:modelValue":a[7]||(a[7]=t=>e.province=t),placeholder:"Masukkan provinsi",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[i,e.province]])]),r("div",fa,[a[26]||(a[26]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kode Pos ",-1)),l(r("input",{type:"text","onUpdate:modelValue":a[8]||(a[8]=t=>e.postalCode=t),placeholder:"Masukkan kode pos",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[i,e.postalCode]])]),r("div",ha,[a[27]||(a[27]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Alamat ",-1)),l(r("textarea",{"onUpdate:modelValue":a[9]||(a[9]=t=>e.address=t),placeholder:"Masukkan detail alamat lengkap",rows:"3",class:"dark:bg-dark-900 h-auto w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[i,e.address]])]),r("div",va,[a[28]||(a[28]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Laporan ",-1)),l(r("textarea",{"onUpdate:modelValue":a[10]||(a[10]=t=>e.report=t),placeholder:"Masukkan catatan laporan hasil penyaluran",rows:"4",class:"dark:bg-dark-900 h-auto w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[i,e.report]])]),r("div",wa,[a[29]||(a[29]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[p(" Kantor Cabang "),r("span",{class:"text-red-500"},"*")],-1)),(s=v(b))!=null&&s.is_admin?(y(),F(ra,{key:0,modelValue:e.branchId,"onUpdate:modelValue":a[11]||(a[11]=t=>e.branchId=t),options:I.value,placeholder:"Pilih atau cari kantor cabang","search-input":v(_),"onUpdate:searchInput":a[12]||(a[12]=t=>_.value=t)},null,8,["modelValue","options","search-input"])):(y(),w(P,{key:1},[r("input",{type:"text",value:((d=(n=v(b))==null?void 0:n.kantor_cabang)==null?void 0:d.nama)||"",placeholder:"Kantor cabang Anda",readonly:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:outline-none dark:border-gray-700 dark:bg-gray-900/50 dark:text-white/90"},null,8,ja),l(r("input",{type:"hidden","onUpdate:modelValue":a[13]||(a[13]=t=>e.branchId=t)},null,512),[[i,e.branchId]])],64))]),r("div",Ma,[a[33]||(a[33]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Gambar Dokumentasi ",-1)),r("div",Ca,[r("div",Ia,[r("input",{type:"file",ref_key:"fileInputRef",ref:M,onChange:E,multiple:"",accept:"image/*",class:"hidden",id:"image-upload"},null,544),a[30]||(a[30]=r("label",{for:"image-upload",class:"flex cursor-pointer items-center justify-center rounded-lg border-2 border-dashed border-gray-300 bg-gray-50 px-6 py-8 text-center transition-colors hover:border-brand-300 hover:bg-gray-100 dark:border-gray-700 dark:bg-gray-900/50 dark:hover:border-brand-500"},[r("div",{class:"text-center"},[r("svg",{class:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})]),r("p",{class:"mt-2 text-sm text-gray-600 dark:text-gray-400"},[r("span",{class:"font-medium text-brand-500"},"Klik untuk upload"),p(" atau drag and drop ")]),r("p",{class:"text-xs text-gray-500 dark:text-gray-500"}," PNG, JPG, GIF hingga 20MB (Multiple files) ")])],-1))]),v(x).length>0?(y(),w("div",_a,[(y(!0),w(P,null,aa(v(x),(t,u)=>(y(),w("div",{key:u,class:"flex items-center justify-between rounded-lg border border-gray-200 bg-white p-3 dark:border-gray-700 dark:bg-gray-900/50"},[r("div",Sa,[a[31]||(a[31]=r("div",{class:"flex h-10 w-10 items-center justify-center rounded bg-gray-100 dark:bg-gray-800"},[r("svg",{class:"h-6 w-6 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1)),r("div",null,[r("p",Ta,h(t.name),1),r("p",Fa,h(L(t.size)),1)])]),r("button",{type:"button",onClick:N=>q(u),class:"rounded-lg p-1 text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10"},[...a[32]||(a[32]=[r("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Pa)]))),128))])):Z("",!0)])])]),r("div",{class:"flex items-center gap-3 mt-6 lg:justify-end"},[r("button",{onClick:T,type:"button",class:"flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] sm:w-auto"}," Kembali "),a[34]||(a[34]=r("button",{type:"submit",class:"flex w-full justify-center rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600 sm:w-auto"}," Buat ",-1))])],32)])]}),_:1}))}});export{Ea as default};
