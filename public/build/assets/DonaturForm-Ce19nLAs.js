import{d as ra,H as na,I as oa,M as la,b as m,A as h,e as sa,f as ia,g as da,o as H,w as ua,a as t,t as P,q as N,k as g,v as c,j as v,m as R,c as L,i as B,u as pa}from"./admin-BW3DTPqb.js";import{C as ma}from"./component-DA1TgN-D.js";import{_ as ga}from"./AdminLayout.vue_vue_type_script_setup_true_lang-B9qnOXpI.js";import{S as _}from"./SearchableSelect-CTbMN1jJ.js";import{S as ca}from"./SearchableMultiSelect-Bj3uLFJh.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ba={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},ka={class:"mb-6 flex items-center justify-between"},ya={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},fa={class:"grid grid-cols-1 gap-x-6 gap-y-5 lg:grid-cols-2"},xa={class:"flex items-center gap-3"},ha={class:"flex-1"},va={class:"flex items-center gap-3"},wa={class:"flex-1"},Va={class:"relative"},Ca={class:"lg:col-span-2"},ja={class:"mt-6 flex items-center gap-3 lg:justify-end"},_a=["disabled"],Na=ra({__name:"DonaturForm",setup(Sa){const f=na(),C=oa(),b=la(),u=m(null),S=h(()=>{var a,r,l;const n=(l=(r=(a=u.value)==null?void 0:a.role)==null?void 0:r.name)==null?void 0:l.toLowerCase();return n==="fundrising"||n==="fundraising"}),x=h(()=>f.params.id!==void 0&&f.params.id!=="new"),q=h(()=>x.value?"Edit Donatur":"Tambah Donatur"),G={dateFormat:"Y-m-d",altInput:!0,altFormat:"d F Y",locale:"id",wrap:!1,clickOpens:!0,allowInput:!1},Z=[{value:"komunitas",label:"Komunitas"},{value:"kotak_infaq",label:"Kotak Infaq"},{value:"retail",label:"Retail"}],$=[{value:"aktif",label:"Aktif"},{value:"tidak_aktif",label:"Tidak Aktif"},{value:"pending",label:"Pending"}],O=m([]),w=m([]),D=m([]),E=m(""),A=m(""),U=m(""),F=m(""),K=m(!1),J=h(()=>O.value.map(n=>({value:String(n.id),label:n.nama||n.name||"-"}))),Y=h(()=>w.value.map(n=>({value:String(n.id),label:n.nama||n.name||"-"}))),X=h(()=>D.value.map(n=>({value:String(n.id),label:n.nama||n.name||"-"}))),e=sa({kode:"",nama:"",jenis_donatur:[],pic:"",mitra_id:"",provinsi:"",kota_kab:"",kecamatan:"",kelurahan:"",alamat:"",no_handphone:"",email:"",tanggal_lahir:"",kantor_cabang_id:"",status:"aktif"}),z=async()=>{try{const n=await fetch("/admin/api/user",{credentials:"same-origin"});if(n.ok){const a=await n.json();a.success&&a.user&&(u.value=a.user)}}catch(n){console.error("Error fetching current user:",n)}},Q=()=>{e.mitra_id=null,U.value=""},W=()=>{e.pic=null,A.value=""},aa=async()=>{var n,a,r,l;try{const d=[],j=(()=>{if(!u.value)return!1;if(u.value.is_admin)return!0;const s=u.value.roles||u.value.role?u.value.roles||[u.value.role]:[];return Array.isArray(s)&&s.some(i=>{const V=typeof i=="string"?i:i==null?void 0:i.name;return typeof V=="string"&&V.trim().toLowerCase()==="admin cabang"})})()?"/admin/api/kantor-cabang?per_page=1000":"/admin/api/kantor-cabang?per_page=1000&only_assigned=1";d.push(fetch(j,{credentials:"same-origin"})),d.push(fetch("/admin/api/karyawan?per_page=1000&role_name=fundrising",{credentials:"same-origin"})),x.value||d.push(fetch("/admin/api/donatur-next-kode",{credentials:"same-origin"}));const p=await Promise.all(d),[k,y,T]=p;if(k.ok){const s=await k.json();if(s.success){const i=Array.isArray(s.data)?s.data:(n=s.data)==null?void 0:n.data;O.value=Array.isArray(i)?i:[]}}if(y.ok){const s=await y.json();if(s.success){const i=Array.isArray(s.data)?s.data:(a=s.data)==null?void 0:a.data;w.value=Array.isArray(i)?i:[]}}try{const s=await fetch("/admin/api/mitra?per_page=1000",{credentials:"same-origin"});if(s.ok){const i=await s.json();if(i.success){const V=Array.isArray(i.data)?i.data:(r=i.data)==null?void 0:r.data;D.value=Array.isArray(V)?V:[]}}}catch{}if(Array.isArray(w.value)&&w.value.length===0&&u.value&&(w.value=[u.value]),T&&T.ok){const s=await T.json();s.success&&((l=s.data)!=null&&l.kode)&&(e.kode=s.data.kode)}}catch{b.error("Gagal memuat data referensi")}},ea=async n=>{var a,r;try{const l=await fetch(`/admin/api/donatur/${n}`,{credentials:"same-origin"});if(!l.ok)throw new Error("Failed to fetch donatur");const d=await l.json();if(d.success&&d.data){const o=d.data;e.kode=o.kode||"",e.nama=o.nama||"",e.jenis_donatur=Array.isArray(o.jenis_donatur)?o.jenis_donatur:[],e.pic=(a=o.pic_user)!=null&&a.id?String(o.pic_user.id):o.pic||"",e.mitra_id=(r=o.mitra)!=null&&r.id?String(o.mitra.id):o.mitra_id||"",e.alamat=o.alamat||"",e.provinsi=o.provinsi||"",e.kota_kab=o.kota_kab||"",e.kecamatan=o.kecamatan||"",e.kelurahan=o.kelurahan||"",e.no_handphone=o.no_handphone||"",e.email=o.email||"",e.tanggal_lahir=o.tanggal_lahir||"",e.kantor_cabang_id=o.kantor_cabang_id?String(o.kantor_cabang_id):"",e.status=o.status||"aktif"}else b.error(d.message||"Donatur tidak ditemukan"),C.push("/user-kepegawaian/donatur")}catch{b.error("Gagal memuat data donatur"),C.push("/user-kepegawaian/donatur")}},I=()=>{C.push("/user-kepegawaian/donatur")},ta=async()=>{var n;if(!e.nama.trim()){b.error("Nama wajib diisi");return}if(!e.jenis_donatur.length){b.error("Minimal satu tipe donor harus dipilih");return}K.value=!0;try{const a=await fetch("/admin/api/csrf-token",{credentials:"same-origin"});if(!a.ok)throw new Error("Failed to fetch CSRF token");const r=await a.json(),l=k=>{if(k==null)return null;const y=String(k).trim();return y!==""?y:null},d={nama:e.nama.trim(),jenis_donatur:e.jenis_donatur,pic:l(e.pic),mitra_id:l(e.mitra_id),alamat:l(e.alamat),provinsi:l(e.provinsi),kota_kab:l(e.kota_kab),kecamatan:l(e.kecamatan),kelurahan:l(e.kelurahan),no_handphone:l(e.no_handphone),email:l(e.email),tanggal_lahir:e.tanggal_lahir||null,kantor_cabang_id:l(e.kantor_cabang_id),status:l(e.status)||"aktif"};d.no_handphone&&(d.no_handphone=String(d.no_handphone).replace(/\D+/g,""));let o="/admin/api/donatur",j="POST";x.value&&f.params.id&&(o=`/admin/api/donatur/${f.params.id}`,j="PUT");const M=await fetch(o,{method:j,headers:{"Content-Type":"application/json","X-CSRF-TOKEN":r.csrf_token},credentials:"same-origin",body:JSON.stringify(d)}),p=await M.json().catch(()=>({}));if(!M.ok){const y=(p!=null&&p.errors?(n=Object.values(p.errors)[0])==null?void 0:n[0]:void 0)||p.message||"Request gagal";throw new Error(y)}p.success?(b.success(p.message||"Donatur berhasil disimpan"),C.push("/user-kepegawaian/donatur")):b.error(p.message||"Gagal menyimpan donatur")}catch(a){b.error((a==null?void 0:a.message)||"Gagal menyimpan donatur")}finally{K.value=!1}};return ia(async()=>{var n,a,r;await z(),await aa(),x.value&&f.params.id&&await ea(f.params.id),S.value&&!x.value&&((n=u.value)!=null&&n.id&&(e.pic=String(u.value.id)),(r=(a=u.value)==null?void 0:a.kantor_cabang)!=null&&r.id&&(e.kantor_cabang_id=String(u.value.kantor_cabang.id)))}),(n,a)=>(H(),da(ga,null,{default:ua(()=>[t("div",ba,[t("div",ka,[t("h3",ya,P(q.value),1),t("button",{onClick:I,type:"button",class:"flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03]"}," Batal ")]),t("form",{onSubmit:N(ta,["prevent"]),class:"flex flex-col"},[t("div",fa,[t("div",null,[a[19]||(a[19]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kode ",-1)),g(t("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=r=>e.kode=r),placeholder:"Kode donatur",readonly:"",class:"h-11 w-full rounded-lg border border-gray-300 bg-gray-100 px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-800 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800 cursor-not-allowed"},null,512),[[c,e.kode]])]),t("div",null,[a[20]||(a[20]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[R(" Tipe Donor "),t("span",{class:"text-red-500"},"*")],-1)),v(ca,{modelValue:e.jenis_donatur,"onUpdate:modelValue":a[1]||(a[1]=r=>e.jenis_donatur=r),options:Z,placeholder:"Pilih tipe donor"},null,8,["modelValue"])]),t("div",null,[a[22]||(a[22]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Fundraiser ",-1)),t("div",xa,[t("div",ha,[v(_,{modelValue:e.pic,"onUpdate:modelValue":a[2]||(a[2]=r=>e.pic=r),options:Y.value,placeholder:"Pilih Fundraiser","search-input":A.value,"onUpdate:searchInput":a[3]||(a[3]=r=>A.value=r),disabled:S.value},null,8,["modelValue","options","search-input","disabled"])]),e.pic?(H(),L("button",{key:0,type:"button",title:"Hapus Fundraiser",onClick:N(W,["stop"]),class:"h-10 w-10 flex items-center justify-center rounded-lg border border-gray-300 bg-white text-sm text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300"},[...a[21]||(a[21]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M18 6L6 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("path",{d:"M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])):B("",!0)])]),t("div",null,[a[24]||(a[24]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Mitra ",-1)),t("div",va,[t("div",wa,[v(_,{modelValue:e.mitra_id,"onUpdate:modelValue":a[4]||(a[4]=r=>e.mitra_id=r),options:X.value,placeholder:"Pilih Mitra (opsional)","search-input":U.value,"onUpdate:searchInput":a[5]||(a[5]=r=>U.value=r)},null,8,["modelValue","options","search-input"])]),e.mitra_id?(H(),L("button",{key:0,type:"button",title:"Hapus Mitra",onClick:N(Q,["stop"]),class:"h-10 w-10 flex items-center justify-center rounded-lg border border-gray-300 bg-white text-sm text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300"},[...a[23]||(a[23]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M18 6L6 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("path",{d:"M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])):B("",!0)])]),t("div",null,[a[25]||(a[25]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[R(" Nama "),t("span",{class:"text-red-500"},"*")],-1)),g(t("input",{type:"text","onUpdate:modelValue":a[6]||(a[6]=r=>e.nama=r),placeholder:"Nama donatur",required:"",class:"h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[c,e.nama]])]),t("div",null,[a[26]||(a[26]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," No. Handphone ",-1)),g(t("input",{type:"text",inputmode:"numeric",pattern:"[0-9]*","onUpdate:modelValue":a[7]||(a[7]=r=>e.no_handphone=r),placeholder:"No. Handphone",class:"h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[c,e.no_handphone]])]),t("div",null,[a[27]||(a[27]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Email ",-1)),g(t("input",{type:"email","onUpdate:modelValue":a[8]||(a[8]=r=>e.email=r),placeholder:"Email",class:"h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[c,e.email]])]),t("div",null,[a[29]||(a[29]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Tanggal Lahir ",-1)),t("div",Va,[v(pa(ma),{modelValue:e.tanggal_lahir,"onUpdate:modelValue":a[9]||(a[9]=r=>e.tanggal_lahir=r),config:G,class:"h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 pr-11 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",placeholder:"Tanggal lahir"},null,8,["modelValue"]),a[28]||(a[28]=t("span",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400"},[t("svg",{class:"fill-current",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M6.66659 1.5415C7.0808 1.5415 7.41658 1.87729 7.41658 2.2915V2.99984H12.5833V2.2915C12.5833 1.87729 12.919 1.5415 13.3333 1.5415C13.7475 1.5415 14.0833 1.87729 14.0833 2.2915V2.99984L15.4166 2.99984C16.5212 2.99984 17.4166 3.89527 17.4166 4.99984V7.49984V15.8332C17.4166 16.9377 16.5212 17.8332 15.4166 17.8332H4.58325C3.47868 17.8332 2.58325 16.9377 2.58325 15.8332V7.49984V4.99984C2.58325 3.89527 3.47868 2.99984 4.58325 2.99984L5.91659 2.99984V2.2915C5.91659 1.87729 6.25237 1.5415 6.66659 1.5415ZM6.66659 4.49984H4.58325C4.30711 4.49984 4.08325 4.7237 4.08325 4.99984V6.74984H15.9166V4.99984C15.9166 4.7237 15.6927 4.49984 15.4166 4.49984H13.3333H6.66659ZM15.9166 8.24984H4.08325V15.8332C4.08325 16.1093 4.30711 16.3332 4.58325 16.3332H15.4166C15.6927 16.3332 15.9166 16.1093 15.9166 15.8332V8.24984Z",fill:"currentColor"})])],-1))])]),t("div",null,[a[30]||(a[30]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kantor Cabang ",-1)),v(_,{modelValue:e.kantor_cabang_id,"onUpdate:modelValue":a[10]||(a[10]=r=>e.kantor_cabang_id=r),options:J.value,placeholder:"Kantor Cabang","search-input":E.value,"onUpdate:searchInput":a[11]||(a[11]=r=>E.value=r),disabled:S.value},null,8,["modelValue","options","search-input","disabled"])]),t("div",null,[a[31]||(a[31]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Status ",-1)),v(_,{modelValue:e.status,"onUpdate:modelValue":a[12]||(a[12]=r=>e.status=r),options:$,placeholder:"Status","search-input":F.value,"onUpdate:searchInput":a[13]||(a[13]=r=>F.value=r)},null,8,["modelValue","search-input"])]),t("div",Ca,[a[32]||(a[32]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Alamat ",-1)),g(t("textarea",{"onUpdate:modelValue":a[14]||(a[14]=r=>e.alamat=r),placeholder:"Alamat lengkap",rows:"3",class:"w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[c,e.alamat]])]),t("div",null,[a[33]||(a[33]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"Provinsi",-1)),g(t("input",{type:"text","onUpdate:modelValue":a[15]||(a[15]=r=>e.provinsi=r),placeholder:"Provinsi",class:"h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800"},null,512),[[c,e.provinsi]])]),t("div",null,[a[34]||(a[34]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"Kota / Kabupaten",-1)),g(t("input",{type:"text","onUpdate:modelValue":a[16]||(a[16]=r=>e.kota_kab=r),placeholder:"Kota / Kabupaten",class:"h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800"},null,512),[[c,e.kota_kab]])]),t("div",null,[a[35]||(a[35]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"Kecamatan",-1)),g(t("input",{type:"text","onUpdate:modelValue":a[17]||(a[17]=r=>e.kecamatan=r),placeholder:"Kecamatan",class:"h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800"},null,512),[[c,e.kecamatan]])]),t("div",null,[a[36]||(a[36]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"Kelurahan",-1)),g(t("input",{type:"text","onUpdate:modelValue":a[18]||(a[18]=r=>e.kelurahan=r),placeholder:"Kelurahan",class:"h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800"},null,512),[[c,e.kelurahan]])])]),t("div",ja,[t("button",{onClick:I,type:"button",class:"flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] sm:w-auto"}," Batal "),t("button",{type:"submit",disabled:K.value,class:"flex w-full justify-center rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600 disabled:cursor-not-allowed disabled:bg-brand-300 sm:w-auto"},P(x.value?"Simpan Perubahan":"Simpan"),9,_a)])],32)])]),_:1}))}});export{Na as default};
