import{g as B,H as F,I,V as K,A as b,r as u,i as U,B as $,o as M,c as O,a as q,w as G,f as p,b as e,t as g,p as H,l as y,j as T,v as N}from"./admin-J6zbw5zU.js";import{_ as J}from"./AdminLayout.vue_vue_type_script_setup_true_lang-DOj0C-fv.js";import{_ as L}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-elyHDbT4.js";import{S as V}from"./SearchableSelect-eYal2mgo.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const X={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},A={class:"mb-6 flex items-center justify-between"},Y={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},z={class:"grid grid-cols-1 gap-x-6 gap-y-5 lg:grid-cols-2"},Q={class:"lg:col-span-1"},W={class:"lg:col-span-1"},Z={class:"lg:col-span-1"},aa=["max"],ea={class:"lg:col-span-1"},ta={class:"mt-8 rounded-lg border border-gray-200 bg-white p-6 dark:border-gray-800 dark:bg-white/[0.03]"},ra={class:"grid grid-cols-1 gap-x-6 gap-y-5 lg:grid-cols-2"},na={class:"lg:col-span-1"},oa={class:"dark:bg-dark-900 h-11 w-full flex items-center rounded-lg border border-gray-300 bg-gray-50 px-4 py-2.5 text-sm text-gray-800 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90"},sa={class:"font-medium"},ia={class:"mt-8 rounded-lg border border-gray-200 bg-gray-50 p-6 dark:border-gray-800 dark:bg-gray-900/50"},la={class:"flex items-center justify-between"},da={class:"text-xl font-bold text-brand-500 dark:text-brand-400"},ua={class:"flex items-center gap-3 mt-6 lg:justify-end"},ga={type:"submit",class:"flex w-full justify-center rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600 sm:w-auto"},xa=B({__name:"RemunerasiForm",setup(ma){const i=F(),k=I(),l=K(),d=b(()=>i.params.id!==void 0&&i.params.id!=="new"),x=b(()=>d.value?"Edit Remunerasi":"Tambah Remunerasi"),h=u([]),f=u([]),w=u(""),_=u(""),D=async()=>{try{const o=await fetch("/admin/api/karyawan?per_page=1000",{credentials:"same-origin"});if(o.ok){const r=await o.json();h.value=(r.data||[]).map(n=>({value:String(n.id),label:n.name||n.nama||"-"}))}const a=await fetch("/admin/api/kantor-cabang?per_page=1000",{credentials:"same-origin"});if(a.ok){const r=await a.json();f.value=(r.data||[]).map(n=>({value:String(n.id),label:n.nama||n.name||"-"}))}}catch(o){console.error("Error loading options:",o)}},t=U({karyawan_id:"",bulan:null,tahun:null,kantorCabang:""}),s=u(0),P=()=>{v()},v=async()=>{if(s.value=0,!!t.karyawan_id)try{const o=await fetch(`/admin/api/gaji?karyawan_id=${t.karyawan_id}&per_page=1`,{credentials:"same-origin"});if(!o.ok)return;const r=(await o.json()).data||[];if(r.length>0){const n=r[0];s.value=n.nominal||n.gaji_pokok||0}}catch(o){console.error("Error loading gaji pokok:",o)}},j=b(()=>s.value),S=o=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(o),R=async()=>{if(await D(),d.value&&i.params.id){const o=i.params.id;try{const a=await fetch(`/admin/api/operasional/remunerasi/${o}`,{credentials:"same-origin"});if(!a.ok)throw new Error("Failed to load remunerasi");const r=await a.json();if(r&&r.data){const n=r.data;t.namaKaryawan="",t.karyawan_id=n.karyawan_id?String(n.karyawan_id):"",t.bulan=n.bulan_remunerasi||null,t.tahun=n.tahun_remunerasi||null,t.kantorCabang=n.kantor_cabang_id?String(n.kantor_cabang_id):"",s.value=n.gaji_pokok||0}}catch(a){console.error("Error loading data for edit:",a)}}},C=()=>{k.push("/operasional/remunerasi")},E=async()=>{if(!t.karyawan_id){l.error("Nama Karyawan wajib diisi");return}if(!t.bulan||t.bulan<1||t.bulan>12){l.error("Bulan harus antara 1-12");return}if(!t.tahun){l.error("Tahun wajib diisi");return}try{const a=await(await fetch("/admin/api/csrf-token",{credentials:"same-origin"})).json(),r={karyawan_id:t.karyawan_id?Number(t.karyawan_id):null,bulan_remunerasi:t.bulan,tahun_remunerasi:t.tahun,gaji_pokok:s.value||null,take_home_pay:j.value||0,tanggal:null,kantor_cabang_id:t.kantorCabang||null};t.tahun&&(r.tanggal=`${t.tahun}-${String(t.bulan).padStart(2,"0")}-15`);let n;if(d.value){const c=i.params.id;n=await fetch(`/admin/api/operasional/remunerasi/${c}`,{method:"PUT",credentials:"same-origin",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":a.csrf_token},body:JSON.stringify(r)})}else n=await fetch("/admin/api/operasional/remunerasi",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":a.csrf_token},body:JSON.stringify(r)});const m=await n.json().catch(()=>({}));if(!n.ok){const c=m&&m.message||"Request gagal";throw new Error(c)}l.success(m.message||(d.value?"Remunerasi berhasil diupdate":"Remunerasi berhasil ditambahkan")),k.push("/operasional/remunerasi")}catch(o){console.error("Error saving:",o),l.error("Terjadi kesalahan saat menyimpan data")}};return $(()=>t.karyawan_id,()=>{v()}),M(()=>{R()}),(o,a)=>(q(),O(J,null,{default:G(()=>[p(L,{pageTitle:x.value},null,8,["pageTitle"]),e("div",X,[e("div",A,[e("h3",Y,g(x.value),1),e("button",{onClick:C,class:"flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03]"}," Batal ")]),e("form",{onSubmit:H(E,["prevent"]),class:"flex flex-col"},[e("div",z,[e("div",Q,[a[6]||(a[6]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[y(" Nama Karyawan "),e("span",{class:"text-red-500"},"*")],-1)),p(V,{modelValue:t.karyawan_id,"onUpdate:modelValue":[a[0]||(a[0]=r=>t.karyawan_id=r),P],options:h.value,placeholder:"Pilih atau cari nama karyawan","search-input":w.value,"onUpdate:searchInput":a[1]||(a[1]=r=>w.value=r)},null,8,["modelValue","options","search-input"])]),e("div",W,[a[7]||(a[7]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[y(" Bulan "),e("span",{class:"text-red-500"},"*")],-1)),T(e("input",{type:"number","onUpdate:modelValue":a[2]||(a[2]=r=>t.bulan=r),placeholder:"Masukkan bulan (1-12)",min:"1",max:"12",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[N,t.bulan,void 0,{number:!0}]])]),e("div",Z,[a[8]||(a[8]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[y(" Tahun "),e("span",{class:"text-red-500"},"*")],-1)),T(e("input",{type:"number","onUpdate:modelValue":a[3]||(a[3]=r=>t.tahun=r),placeholder:"Masukkan tahun",min:"2000",max:new Date().getFullYear()+1,required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,8,aa),[[N,t.tahun,void 0,{number:!0}]])]),e("div",ea,[a[9]||(a[9]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kantor Cabang ",-1)),p(V,{modelValue:t.kantorCabang,"onUpdate:modelValue":a[4]||(a[4]=r=>t.kantorCabang=r),options:f.value,placeholder:"Pilih atau cari kantor cabang","search-input":_.value,"onUpdate:searchInput":a[5]||(a[5]=r=>_.value=r)},null,8,["modelValue","options","search-input"])])]),e("div",ta,[a[12]||(a[12]=e("h4",{class:"mb-6 text-lg font-semibold text-gray-800 dark:text-white/90"}," Bagian Kalkulasi Gaji ",-1)),e("div",ra,[e("div",na,[a[10]||(a[10]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Gaji Pokok - Nominal ",-1)),e("div",oa,[e("span",sa,g(S(s.value)),1)]),a[11]||(a[11]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," Display only (readonly) ",-1))])])]),e("div",ia,[e("div",la,[a[13]||(a[13]=e("label",{class:"text-lg font-semibold text-gray-800 dark:text-white/90"}," Take Home Pay ",-1)),e("span",da,g(S(j.value)),1)]),a[14]||(a[14]=e("p",{class:"mt-2 text-sm text-gray-500 dark:text-gray-400"}," Display only ",-1))]),e("div",ua,[e("button",{onClick:C,type:"button",class:"flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] sm:w-auto"}," Batal "),e("button",ga,g(d.value?"Simpan Perubahan":"Simpan"),1)])],32)])]),_:1}))}});export{xa as default};
