import{d as D,b as i,A as j,f as N,y as H,B as q,c,o as d,a as v,j as G,i as b,n as x,t as B,w as J,k as K,v as Q,q as W,F as X,l as Y,z as Z,U as ee}from"./admin-DS2Lv109.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";const te={key:0,class:"ml-2 text-sm text-gray-500"},le={key:0,class:"absolute z-50 w-full mt-1 bg-white rounded-lg shadow-lg border border-gray-200 dark:bg-gray-900 dark:border-gray-700 max-h-60 overflow-hidden"},re={class:"p-2 border-b border-gray-200 dark:border-gray-700"},se={key:0,class:"px-2 border-b bg-gray-50 dark:bg-gray-800"},ne=["onClick"],oe={key:0,class:"px-4 py-2 text-sm text-gray-500 dark:text-gray-400"},ue={key:1,class:"px-4 py-2 text-sm text-gray-500 dark:text-gray-400"},ie={key:2,class:"px-4 py-2 text-xs text-gray-400"},ce=D({__name:"AsyncSearchableSelect",props:{modelValue:{},fetchUrl:{},perPage:{default:20},placeholder:{default:"Pilih..."},disabled:{type:Boolean,default:!1},includeAll:{type:Boolean,default:!1},allLabel:{default:"Semua"},allValue:{default:""}},emits:["update:modelValue","update:search-input"],setup(p,{emit:z}){function E(e,a=300){let t=null;const s=(...r)=>{t&&clearTimeout(t),t=setTimeout(()=>{e(...r)},a)};return s.cancel=()=>{t&&(clearTimeout(t),t=null)},s}const l=p,f=z,n=i(!1),h=i(!1),o=i([]),m=i(1),y=i(null),u=i(""),L=i(null),w=i(null),S=i(null),T=j(()=>y.value===null?!0:m.value<(y.value||0)),_=j(()=>{if(l.includeAll&&String(l.modelValue)===String(l.allValue))return l.allLabel||"";const e=o.value.find(a=>a.value===l.modelValue);return e?e.label:""}),V=async(e="",a=1)=>{if(l.fetchUrl){h.value=!0;try{const t=new URLSearchParams;e&&t.append("search",e),t.append("per_page",String(l.perPage)),t.append("page",String(a));const s=await fetch(`${l.fetchUrl}?${t.toString()}`,{credentials:"same-origin"});if(!s.ok)throw new Error("Failed to fetch");const r=await s.json();if(r.success){const C=(Array.isArray(r.data)?r.data:r.data&&r.data.data||[]).map(g=>({value:g.id,label:g.nama||g.name||g.kode||g.label||""}));if(a===1)o.value=C;else{const g=new Set(o.value.map(k=>k.value));C.forEach(k=>{g.has(k.value)||o.value.push(k)})}r.pagination?y.value=r.pagination.last_page:r.data&&r.data.last_page?y.value=r.data.last_page:y.value=C.length<l.perPage?a:null,m.value=a}}catch(t){console.error("AsyncSelect fetch error:",t)}finally{h.value=!1}}},U=async e=>{if(!(!l.fetchUrl||!e))try{const a=await fetch(`${l.fetchUrl}/${e}`,{credentials:"same-origin"});if(!a.ok)throw new Error("Failed to fetch by id");const t=await a.json();if(t.success&&t.data){const s=t.data,r={value:s.id,label:s.nama||s.name||s.kode||""};o.value.find(I=>I.value===r.value)||o.value.unshift(r)}}catch{}},A=E(async e=>{m.value=1,y.value=null,await V(e,1)},300),M=e=>{const a=e.target;u.value=a.value,f("update:search-input",a.value),A(a.value)},$=()=>{n.value=!n.value,n.value?ee(()=>{var e;(e=L.value)==null||e.focus(),V(u.value||"",1)}):(u.value="",f("update:search-input",""))},F=e=>{f("update:modelValue",e.value),u.value="",f("update:search-input",""),n.value=!1},R=()=>{f("update:modelValue",l.allValue||""),u.value="",f("update:search-input",""),n.value=!1},O=()=>{if(!S.value||h.value||!T.value)return;const e=S.value;e.scrollTop+e.clientHeight>=e.scrollHeight-30&&V(u.value||"",m.value+1)},P=e=>{w.value&&!w.value.contains(e.target)&&(n.value=!1,u.value="",f("update:search-input",""))};return N(()=>{document.addEventListener("click",P),l.modelValue&&U(l.modelValue)}),H(()=>{document.removeEventListener("click",P),A.cancel&&A.cancel()}),q(()=>l.modelValue,e=>{e&&U(e)}),(e,a)=>(d(),c("div",{ref_key:"selectRef",ref:w,class:x(["relative bg-transparent",n.value?"z-50":"z-10"])},[v("div",{onClick:a[0]||(a[0]=t=>!p.disabled&&$()),class:x(["dark:bg-dark-900 h-11 w-full flex items-center rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 pr-11 text-sm text-gray-800 shadow-theme-xs focus-within:border-brand-300 focus-within:outline-hidden focus-within:ring-3 focus-within:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus-within:border-brand-800",{"border-brand-300":n.value,"cursor-pointer hover:border-brand-300":!p.disabled,"cursor-not-allowed bg-gray-100 dark:bg-gray-800 opacity-75":p.disabled}])},[v("span",{class:x({"text-gray-800 dark:text-white/90":_.value,"text-gray-400":!_.value})},B(_.value||p.placeholder),3),h.value&&!n.value?(d(),c("span",te," (memuat...) ")):b("",!0)],2),a[3]||(a[3]=v("span",{class:"absolute z-30 text-gray-500 -translate-y-1/2 pointer-events-none right-4 top-1/2 dark:text-gray-400"},[v("svg",{class:"stroke-current",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[v("path",{d:"M4.79175 7.396L10.0001 12.6043L15.2084 7.396",stroke:"","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),G(Z,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:J(()=>[n.value?(d(),c("div",le,[v("div",re,[K(v("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=t=>u.value=t),onInput:M,placeholder:"Cari...",class:"w-full h-9 rounded-lg border border-gray-300 bg-transparent px-3 py-1.5 text-sm text-gray-800 dark:border-gray-700 dark:bg-gray-800 dark:text-white/90",onClick:a[2]||(a[2]=W(()=>{},["stop"])),ref_key:"searchInputRef",ref:L},null,544),[[Q,u.value]])]),l.includeAll?(d(),c("div",se,[v("button",{type:"button",onClick:R,class:"w-full text-left text-sm px-4 py-2 text-gray-700 hover:bg-gray-100 dark:text-white/90 dark:hover:bg-gray-800"},B(l.allLabel),1)])):b("",!0),v("div",{ref_key:"listContainer",ref:S,class:"overflow-y-auto max-h-48 custom-scrollbar",onScrollPassive:O},[(d(!0),c(X,null,Y(o.value,t=>(d(),c("button",{key:t.value,type:"button",onClick:s=>F(t),class:x(["w-full px-4 py-2 text-left text-sm text-gray-800 hover:bg-gray-100 dark:text-white/90 dark:hover:bg-gray-800 transition-colors",{"bg-gray-100 dark:bg-gray-800":p.modelValue===t.value}])},B(t.label),11,ne))),128)),o.value.length===0&&!h.value?(d(),c("div",oe," Tidak ada data ditemukan ")):b("",!0),h.value?(d(),c("div",ue,"Memuat...")):b("",!0),!T.value&&o.value.length>0?(d(),c("div",ie,"Tidak ada lagi")):b("",!0)],544)])):b("",!0)]),_:1})],2))}}),fe=ae(ce,[["__scopeId","data-v-ff3dc840"]]);export{fe as A};
