import{g as z,H,I as W,r as k,B as P,i as S,o as X,c as J,a as i,w as Y,f as V,b as t,t as l,z as Q,j as p,d as g,e as u,l as f,v as b,u as Z,q as ee,F as B,k as F}from"./admin-CLxYwY0g.js";import{C as te}from"./component-BgD9IQUg.js";import{_ as ae}from"./AdminLayout.vue_vue_type_script_setup_true_lang-B648_P3o.js";import{_ as re}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-Z11cfszT.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const se={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},oe={class:"mb-6 flex items-center justify-between"},de={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},ne={class:"grid grid-cols-1 gap-x-6 gap-y-5 lg:grid-cols-2"},ie={class:"lg:col-span-2"},le={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},ge={key:0,class:"mt-1 text-xs text-red-500"},ce={class:"lg:col-span-1"},ue={key:0,class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},pe={key:1,class:"mt-1 text-xs text-red-500"},be={class:"lg:col-span-1"},me={key:0,class:"mt-1 text-xs text-red-500"},xe={class:"lg:col-span-1"},ye={class:"lg:col-span-1"},ke={class:"lg:col-span-1"},fe={class:"lg:col-span-1"},he={class:"lg:col-span-1"},ve={key:0,class:"mt-1 text-xs text-red-500"},_e={class:"lg:col-span-2"},we={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},Me={key:0,class:"mt-1 text-xs text-red-500"},je={class:"lg:col-span-1"},Te={key:0,class:"mt-1 text-xs text-red-500"},Ce={class:"lg:col-span-2"},Pe={class:"space-y-4"},Se={key:0,class:"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4"},Ve=["src","alt"],Be=["onClick"],Fe=["src","alt"],$e=["onClick"],Ie={class:"mt-1 text-xs text-gray-500 dark:text-gray-400 truncate"},Ke={class:"text-xs text-gray-400 dark:text-gray-500"},Le={key:0,class:"mt-1 text-xs text-red-500"},Ue={class:"lg:col-span-2"},De={class:"relative"},Ee=["innerHTML"],Ne={key:0,class:"absolute top-2.5 left-4 text-sm text-gray-400 pointer-events-none"},Re={key:0,class:"mt-1 text-xs text-red-500"},Ae={class:"flex items-center gap-3 mt-6 lg:justify-end"},qe=["disabled"],Ye=z({__name:"LandingKegiatanForm",setup(Oe){const h=H(),w=W(),M=k(null),$=k(null),x=P(()=>h.params.id!==void 0&&h.params.id!=="new"),T=P(()=>x.value?"Edit Landing Kegiatan":"Tambah Landing Kegiatan"),y=k(!1),I={dateFormat:"Y-m-d",locale:{firstDayOfWeek:1}},a=S({title:"",number_of_recipients:0,village:"",district:"",city:"",province:"",postal_code:"",address:"",activity_date:"",status:"",description:""}),o=S({title:"",number_of_recipients:"",postal_code:"",address:"",activity_date:"",status:"",description:"",images:""}),v=k([]),_=k([]),j=k([]),K=r=>new Intl.NumberFormat("id-ID").format(r),L=r=>{const e=r.target;a.postal_code=e.value.replace(/[^0-9]/g,"")},U=r=>{const e=r.target;if(e.files){const s=Array.from(e.files),d=20*1024*1024,n=[],c=[];s.forEach(m=>{if(!["image/jpeg","image/jpg","image/png","image/webp"].includes(m.type)){c.push(`${m.name} (format tidak didukung)`);return}m.size>d?c.push(`${m.name} (melebihi 20MB)`):n.push(m)}),c.length>0&&alert(`File berikut tidak valid:
${c.join(`
`)}`),v.value.push(...n),M.value&&(M.value.value="")}},D=r=>{v.value.splice(r,1)},E=r=>{const e=_.value[r];j.value.push(e),_.value.splice(r,1)},N=r=>URL.createObjectURL(r),R=r=>{if(r===0)return"0 Bytes";const e=1024,s=["Bytes","KB","MB","GB"],d=Math.floor(Math.log(r)/Math.log(e));return Math.round(r/Math.pow(e,d)*100)/100+" "+s[d]},A=r=>{const e=r.target;a.description=e.innerHTML||""},q=()=>{let r=!0;return Object.keys(o).forEach(e=>{o[e]=""}),!a.title||a.title.trim()===""?(o.title="Nama kegiatan wajib diisi",r=!1):a.title.length>100&&(o.title="Nama kegiatan maksimal 100 karakter",r=!1),(!a.number_of_recipients||a.number_of_recipients<=0)&&(o.number_of_recipients="Total penerima manfaat wajib diisi dan harus lebih dari 0",r=!1),a.postal_code&&!/^[0-9]+$/.test(a.postal_code)&&(o.postal_code="Kode pos harus berupa angka",r=!1),!a.address||a.address.trim()===""?(o.address="Alamat wajib diisi",r=!1):a.address.length>1e3&&(o.address="Alamat maksimal 1000 karakter",r=!1),a.activity_date||(o.activity_date="Tanggal kegiatan wajib diisi",r=!1),a.status||(o.status="Status wajib diisi",r=!1),(!a.description||a.description.trim()==="")&&(o.description="Deskripsi wajib diisi",r=!1),r},O=async()=>{if(x.value&&h.params.id){const r=h.params.id;y.value=!0;try{const s=await(await fetch(`/admin/api/landing-kegiatan/${r}`,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin"})).json();if(s.success&&s.data){const d=s.data;if(a.title=d.title||"",a.number_of_recipients=d.number_of_recipients||0,a.village=d.village||"",a.district=d.district||"",a.city=d.city||"",a.province=d.province||"",a.postal_code=d.postal_code||"",a.address=d.address||"",a.activity_date=d.activity_date||"",a.status=d.status||"",a.description=d.description||"",d.images)try{const n=JSON.parse(d.images);Array.isArray(n)&&(_.value=n)}catch(n){console.error("Error parsing images:",n)}}else alert(s.message||"Gagal memuat data"),w.push("/company/landing-kegiatan")}catch(e){console.error("Error loading data:",e),alert("Terjadi kesalahan saat memuat data"),w.push("/company/landing-kegiatan")}finally{y.value=!1}}},C=()=>{w.push("/company/landing-kegiatan")},G=async()=>{if(q()){y.value=!0;try{const r=new FormData;r.append("title",a.title),r.append("number_of_recipients",a.number_of_recipients.toString()),r.append("village",a.village||""),r.append("district",a.district||""),r.append("city",a.city||""),r.append("province",a.province||""),r.append("postal_code",a.postal_code||""),r.append("address",a.address),r.append("activity_date",a.activity_date),r.append("status",a.status),r.append("description",a.description),v.value.forEach((c,m)=>{r.append(`images[${m}]`,c)}),j.value.length>0&&r.append("images_to_delete",JSON.stringify(j.value));const e=x.value?`/admin/api/landing-kegiatan/${h.params.id}`:"/admin/api/landing-kegiatan",s=x.value?"PUT":"POST",n=await(await fetch(e,{method:s,headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin",body:r})).json();n.success?(alert(x.value?"Kegiatan berhasil diupdate":"Kegiatan berhasil ditambahkan"),w.push("/company/landing-kegiatan")):(n.errors&&Object.keys(n.errors).forEach(c=>{o.hasOwnProperty(c)&&(o[c]=Array.isArray(n.errors[c])?n.errors[c][0]:n.errors[c])}),alert(n.message||"Gagal menyimpan data"))}catch(r){console.error("Error saving:",r),alert("Terjadi kesalahan saat menyimpan data")}finally{y.value=!1}}};return X(()=>{O()}),(r,e)=>(i(),J(ae,null,{default:Y(()=>[V(re,{pageTitle:T.value},null,8,["pageTitle"]),t("div",se,[t("div",oe,[t("h3",de,l(T.value),1),t("button",{onClick:C,class:"flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03]"}," Batal ")]),t("form",{onSubmit:Q(G,["prevent"]),class:"flex flex-col"},[t("div",ne,[t("div",ie,[e[10]||(e[10]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[f(" Nama Kegiatan "),t("span",{class:"text-red-500"},"*")],-1)),p(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>a.title=s),placeholder:"Masukkan nama kegiatan",maxlength:"100",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[b,a.title]]),t("p",le,l(a.title.length)+"/100 karakter ",1),o.title?(i(),g("p",ge,l(o.title),1)):u("",!0)]),t("div",ce,[e[11]||(e[11]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[f(" Total Penerima Manfaat "),t("span",{class:"text-red-500"},"*")],-1)),p(t("input",{type:"number","onUpdate:modelValue":e[1]||(e[1]=s=>a.number_of_recipients=s),placeholder:"Masukkan total penerima manfaat",min:"1",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[b,a.number_of_recipients,void 0,{number:!0}]]),a.number_of_recipients?(i(),g("p",ue,l(K(a.number_of_recipients))+" penerima ",1)):u("",!0),o.number_of_recipients?(i(),g("p",pe,l(o.number_of_recipients),1)):u("",!0)]),t("div",be,[e[12]||(e[12]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[f(" Tanggal Kegiatan "),t("span",{class:"text-red-500"},"*")],-1)),V(Z(te),{modelValue:a.activity_date,"onUpdate:modelValue":e[2]||(e[2]=s=>a.activity_date=s),config:I,class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",placeholder:"Pilih tanggal kegiatan"},null,8,["modelValue"]),o.activity_date?(i(),g("p",me,l(o.activity_date),1)):u("",!0)]),t("div",xe,[e[13]||(e[13]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Provinsi ",-1)),p(t("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=s=>a.province=s),placeholder:"Masukkan provinsi",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[b,a.province]])]),t("div",ye,[e[14]||(e[14]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kota ",-1)),p(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=s=>a.city=s),placeholder:"Masukkan kota",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[b,a.city]])]),t("div",ke,[e[15]||(e[15]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kecamatan ",-1)),p(t("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=s=>a.district=s),placeholder:"Masukkan kecamatan",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[b,a.district]])]),t("div",fe,[e[16]||(e[16]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kelurahan ",-1)),p(t("input",{type:"text","onUpdate:modelValue":e[6]||(e[6]=s=>a.village=s),placeholder:"Masukkan kelurahan",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[b,a.village]])]),t("div",he,[e[17]||(e[17]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kode Pos ",-1)),p(t("input",{type:"text","onUpdate:modelValue":e[7]||(e[7]=s=>a.postal_code=s),placeholder:"Masukkan kode pos",pattern:"[0-9]*",onInput:L,class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,544),[[b,a.postal_code]]),o.postal_code?(i(),g("p",ve,l(o.postal_code),1)):u("",!0)]),t("div",_e,[e[18]||(e[18]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[f(" Alamat "),t("span",{class:"text-red-500"},"*")],-1)),p(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=s=>a.address=s),placeholder:"Masukkan alamat lengkap",maxlength:"1000",rows:"3",required:"",class:"dark:bg-dark-900 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[b,a.address]]),t("p",we,l(a.address.length)+"/1000 karakter ",1),o.address?(i(),g("p",Me,l(o.address),1)):u("",!0)]),t("div",je,[e[20]||(e[20]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[f(" Status "),t("span",{class:"text-red-500"},"*")],-1)),p(t("select",{"onUpdate:modelValue":e[9]||(e[9]=s=>a.status=s),required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus:border-brand-800"},[...e[19]||(e[19]=[t("option",{value:""},"Pilih Status",-1),t("option",{value:"active"},"Active",-1),t("option",{value:"inactive"},"Inactive",-1)])],512),[[ee,a.status]]),o.status?(i(),g("p",Te,l(o.status),1)):u("",!0)]),t("div",Ce,[e[24]||(e[24]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Gambar Program ",-1)),t("div",Pe,[t("div",null,[t("input",{ref_key:"fileInputRef",ref:M,type:"file",multiple:"",accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:U,class:"dark:bg-dark-900 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus:border-brand-800"},null,544),e[21]||(e[21]=t("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," Format: JPG, PNG, WebP. Maksimal 20MB per file. ",-1))]),v.value.length>0||_.value.length>0?(i(),g("div",Se,[(i(!0),g(B,null,F(_.value,(s,d)=>(i(),g("div",{key:`existing-${d}`,class:"relative group"},[t("img",{src:`/storage/${s}`,alt:`Image ${d+1}`,class:"h-32 w-full rounded-lg object-cover border border-gray-300 dark:border-gray-700"},null,8,Ve),t("button",{type:"button",onClick:n=>E(d),class:"absolute top-2 right-2 flex items-center justify-center w-6 h-6 rounded-full bg-red-500 text-white opacity-0 group-hover:opacity-100 transition-opacity"},[...e[22]||(e[22]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M18 6L6 18M6 6l12 12"})],-1)])],8,Be)]))),128)),(i(!0),g(B,null,F(v.value,(s,d)=>(i(),g("div",{key:`new-${d}`,class:"relative group"},[t("img",{src:N(s),alt:s.name,class:"h-32 w-full rounded-lg object-cover border border-gray-300 dark:border-gray-700"},null,8,Fe),t("button",{type:"button",onClick:n=>D(d),class:"absolute top-2 right-2 flex items-center justify-center w-6 h-6 rounded-full bg-red-500 text-white opacity-0 group-hover:opacity-100 transition-opacity"},[...e[23]||(e[23]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M18 6L6 18M6 6l12 12"})],-1)])],8,$e),t("p",Ie,l(s.name),1),t("p",Ke,l(R(s.size)),1)]))),128))])):u("",!0)]),o.images?(i(),g("p",Le,l(o.images),1)):u("",!0)]),t("div",Ue,[e[25]||(e[25]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[f(" Deskripsi "),t("span",{class:"text-red-500"},"*")],-1)),t("div",De,[t("div",{ref_key:"editorRef",ref:$,contenteditable:"true",innerHTML:a.description,onInput:A,class:"dark:bg-dark-900 min-h-[200px] w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",style:{"white-space":"pre-wrap"}},null,40,Ee),a.description?u("",!0):(i(),g("p",Ne," Masukkan deskripsi kegiatan... "))]),o.description?(i(),g("p",Re,l(o.description),1)):u("",!0)])]),t("div",Ae,[t("button",{onClick:C,type:"button",class:"flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] sm:w-auto"}," Batal "),t("button",{type:"submit",disabled:y.value,class:"flex w-full justify-center rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600 disabled:opacity-50 disabled:cursor-not-allowed sm:w-auto"},l(y.value?"Menyimpan...":x.value?"Simpan Perubahan":"Simpan"),9,qe)])],32)])]),_:1}))}});export{Ye as default};
