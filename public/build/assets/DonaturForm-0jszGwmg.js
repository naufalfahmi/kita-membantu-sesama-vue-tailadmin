import{d as Y,r as m,A as _,B as G,o as X,y as re,j as y,b as f,f as a,e as w,F as Z,k as J,l as K,t as A,p as q,n as M,w as Q,g as F,i as j,v as S,z as oe,L as ne,H as se,I as le,V as de,a as ie,c as ue,u as ce}from"./admin-BqmSYxD2.js";import{C as ge}from"./component-BKgerWGF.js";import{_ as pe}from"./AdminLayout.vue_vue_type_script_setup_true_lang-DF73wGF7.js";import{_ as me}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-BEIGw4gJ.js";import{S as P}from"./SearchableSelect-BD5hugcr.js";import{_ as be}from"./_plugin-vue_export-helper-DlAUqK2U.js";const fe=["onClick"],ke={key:1,class:"text-gray-400"},ye={key:0,class:"absolute z-50 w-full mt-1 rounded-lg border border-gray-200 bg-white shadow-lg dark:border-gray-700 dark:bg-gray-900"},he={class:"p-2 border-b border-gray-200 dark:border-gray-700"},xe={class:"custom-scrollbar max-h-48 overflow-y-auto"},ve=["onClick"],we={key:0,class:"h-4 w-4 text-brand-500",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},_e={key:0,class:"px-4 py-2 text-sm text-gray-500 dark:text-gray-400"},Ve=Y({__name:"SearchableMultiSelect",props:{modelValue:{default:()=>[]},options:{default:()=>[]},placeholder:{default:"Pilih..."},searchInput:{default:""}},emits:["update:modelValue","update:search-input"],setup(B,{emit:h}){const d=B,p=h,c=m(!1),V=m(null),b=m(null),k=m(d.searchInput||""),R=_(()=>d.options.filter(o=>d.modelValue.includes(o.value))),$=_(()=>{const o=k.value.trim().toLowerCase();return o?d.options.filter(l=>l.label.toLowerCase().includes(o)):d.options}),H=()=>{c.value=!c.value,c.value?ne(()=>{var o;return(o=V.value)==null?void 0:o.focus()}):I()},E=o=>{const l=d.modelValue.includes(o)?d.modelValue.filter(u=>u!==o):[...d.modelValue,o];p("update:modelValue",l)},L=o=>{d.modelValue.includes(o)&&p("update:modelValue",d.modelValue.filter(l=>l!==o))},T=o=>d.modelValue.includes(o),I=()=>{k.value="",p("update:search-input","")},U=o=>{b.value&&!b.value.contains(o.target)&&(c.value=!1,I())};return G(()=>d.searchInput,o=>{o!==void 0&&(k.value=o)}),G(k,o=>{p("update:search-input",o)}),X(()=>{document.addEventListener("click",U)}),re(()=>{document.removeEventListener("click",U)}),(o,l)=>(f(),y("div",{ref_key:"selectRef",ref:b,class:M(["relative bg-transparent",c.value?"z-50":"z-10"])},[a("div",{onClick:H,class:M(["dark:bg-dark-900 min-h-[44px] w-full flex flex-wrap items-center gap-2 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 pr-11 text-sm text-gray-800 shadow-theme-xs cursor-pointer hover:border-brand-300 focus-within:border-brand-300 focus-within:outline-hidden focus-within:ring-3 focus-within:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus-within:border-brand-800",{"border-brand-300":c.value}])},[R.value.length?(f(!0),y(Z,{key:0},J(R.value,u=>(f(),y("span",{key:u.value,class:"group flex items-center gap-1 rounded-full bg-gray-100 px-2 py-1 text-xs text-gray-800 dark:bg-gray-800 dark:text-white/90"},[K(A(u.label)+" ",1),a("button",{type:"button",class:"text-gray-500 transition-colors hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",onClick:q(t=>L(u.value),["stop"]),"aria-label":"Hapus pilihan"},[...l[2]||(l[2]=[a("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[a("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),a("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])],8,fe)]))),128)):(f(),y("span",ke,A(B.placeholder),1))],2),l[4]||(l[4]=a("span",{class:"absolute text-gray-500 -translate-y-1/2 pointer-events-none right-4 top-1/2 dark:text-gray-400"},[a("svg",{class:"stroke-current",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[a("path",{d:"M4.79175 7.396L10.0001 12.6043L15.2084 7.396",stroke:"","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),w(oe,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:Q(()=>[c.value?(f(),y("div",ye,[a("div",he,[j(a("input",{type:"text","onUpdate:modelValue":l[0]||(l[0]=u=>k.value=u),placeholder:"Cari...",class:"w-full h-9 rounded-lg border border-gray-300 bg-transparent px-3 py-1.5 text-sm text-gray-800 dark:border-gray-700 dark:bg-gray-800 dark:text-white/90",onClick:l[1]||(l[1]=q(()=>{},["stop"])),ref_key:"searchInputRef",ref:V},null,512),[[S,k.value]])]),a("div",xe,[(f(!0),y(Z,null,J($.value,u=>(f(),y("button",{key:u.value,type:"button",class:M(["flex w-full items-center justify-between px-4 py-2 text-left text-sm text-gray-800 hover:bg-gray-100 dark:text-white/90 dark:hover:bg-gray-800",{"bg-gray-100 dark:bg-gray-800":T(u.value)}]),onClick:t=>E(u.value)},[a("span",null,A(u.label),1),T(u.value)?(f(),y("svg",we,[...l[3]||(l[3]=[a("path",{d:"M5 13l4 4L19 7"},null,-1)])])):F("",!0)],10,ve))),128)),$.value.length?F("",!0):(f(),y("div",_e," Tidak ada data ditemukan "))])])):F("",!0)]),_:1})],2))}}),Ce=be(Ve,[["__scopeId","data-v-b46f6acc"]]),je={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},Se={class:"mb-6 flex items-center justify-between"},Te={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},Ie={class:"grid grid-cols-1 gap-x-6 gap-y-5 lg:grid-cols-2"},Ue={class:"relative"},Oe={class:"lg:col-span-2"},Ae={class:"mt-6 flex items-center gap-3 lg:justify-end"},Re=["disabled"],He=Y({__name:"DonaturForm",setup(B){const h=se(),d=le(),p=de(),c=m(null),V=_(()=>{var e,r,s;const n=(s=(r=(e=c.value)==null?void 0:e.role)==null?void 0:r.name)==null?void 0:s.toLowerCase();return n==="fundrising"||n==="fundraising"}),b=_(()=>h.params.id!==void 0&&h.params.id!=="new"),k=_(()=>b.value?"Edit Donatur":"Tambah Donatur"),R={dateFormat:"Y-m-d",altInput:!0,altFormat:"d F Y",locale:"id",wrap:!1,clickOpens:!0,allowInput:!1},$=[{value:"komunitas",label:"Komunitas"},{value:"kotak_infaq",label:"Kotak Infaq"},{value:"retail",label:"Retail"}],H=[{value:"aktif",label:"Aktif"},{value:"tidak_aktif",label:"Tidak Aktif"},{value:"pending",label:"Pending"}],E=m([]),L=m([]),T=m(""),I=m(""),U=m(""),o=m(!1),l=_(()=>E.value.map(n=>({value:String(n.id),label:n.nama||n.name||"-"}))),u=_(()=>L.value.map(n=>({value:n.nama||n.name||"",label:n.nama||n.name||"-"}))),t=ie({kode:"",nama:"",jenis_donatur:[],pic:"",alamat:"",no_handphone:"",email:"",tanggal_lahir:"",kantor_cabang_id:"",status:"aktif"}),W=async()=>{try{const n=await fetch("/admin/api/user",{credentials:"same-origin"});if(n.ok){const e=await n.json();e.success&&e.user&&(c.value=e.user)}}catch(n){console.error("Error fetching current user:",n)}},ee=async()=>{var n,e,r;try{const s=[fetch("/admin/api/kantor-cabang?per_page=1000",{credentials:"same-origin"}),fetch("/admin/api/karyawan?per_page=1000",{credentials:"same-origin"})];b.value||s.push(fetch("/admin/api/donatur-next-kode",{credentials:"same-origin"}));const x=await Promise.all(s),[v,O,C]=x;if(v.ok){const i=await v.json();if(i.success){const g=Array.isArray(i.data)?i.data:(n=i.data)==null?void 0:n.data;E.value=Array.isArray(g)?g:[]}}if(O.ok){const i=await O.json();if(i.success){const g=Array.isArray(i.data)?i.data:(e=i.data)==null?void 0:e.data;L.value=Array.isArray(g)?g:[]}}if(C&&C.ok){const i=await C.json();i.success&&((r=i.data)!=null&&r.kode)&&(t.kode=i.data.kode)}}catch{p.error("Gagal memuat data referensi")}},ae=async n=>{try{const e=await fetch(`/admin/api/donatur/${n}`,{credentials:"same-origin"});if(!e.ok)throw new Error("Failed to fetch donatur");const r=await e.json();if(r.success&&r.data){const s=r.data;t.kode=s.kode||"",t.nama=s.nama||"",t.jenis_donatur=Array.isArray(s.jenis_donatur)?s.jenis_donatur:[],t.pic=s.pic||"",t.alamat=s.alamat||"",t.no_handphone=s.no_handphone||"",t.email=s.email||"",t.tanggal_lahir=s.tanggal_lahir||"",t.kantor_cabang_id=s.kantor_cabang_id?String(s.kantor_cabang_id):"",t.status=s.status||"aktif"}else p.error(r.message||"Donatur tidak ditemukan"),d.push("/user-kepegawaian/donatur")}catch{p.error("Gagal memuat data donatur"),d.push("/user-kepegawaian/donatur")}},z=()=>{d.push("/user-kepegawaian/donatur")},te=async()=>{var n,e;if(!t.nama.trim()){p.error("Nama wajib diisi");return}if(!t.jenis_donatur.length){p.error("Minimal satu tipe donor harus dipilih");return}o.value=!0;try{const r=await fetch("/admin/api/csrf-token",{credentials:"same-origin"});if(!r.ok)throw new Error("Failed to fetch CSRF token");const s=await r.json(),x=D=>{if(D==null)return null;const N=String(D).trim();return N!==""?N:null},v={nama:t.nama.trim(),jenis_donatur:t.jenis_donatur,pic:x(t.pic),alamat:x(t.alamat),no_handphone:x(t.no_handphone),email:x(t.email),tanggal_lahir:t.tanggal_lahir||null,kantor_cabang_id:x(t.kantor_cabang_id),status:x(t.status)||"aktif"};v.no_handphone&&(v.no_handphone=String(v.no_handphone).replace(/\D+/g,""));let O="/admin/api/donatur",C="POST";b.value&&h.params.id&&(O=`/admin/api/donatur/${h.params.id}`,C="PUT");const i=await fetch(O,{method:C,headers:{"Content-Type":"application/json","X-CSRF-TOKEN":s.csrf_token},credentials:"same-origin",body:JSON.stringify(v)}),g=await i.json().catch(()=>({}));if(!i.ok){const N=(g!=null&&g.errors?(e=(n=Object.values(g.errors))==null?void 0:n[0])==null?void 0:e[0]:void 0)||g.message||"Request gagal";throw new Error(N)}g.success?(p.success(g.message||"Donatur berhasil disimpan"),d.push("/user-kepegawaian/donatur")):p.error(g.message||"Gagal menyimpan donatur")}catch(r){p.error((r==null?void 0:r.message)||"Gagal menyimpan donatur")}finally{o.value=!1}};return X(async()=>{var n,e,r;await W(),await ee(),b.value&&h.params.id&&await ae(h.params.id),V.value&&!b.value&&((n=c.value)!=null&&n.name&&(t.pic=c.value.name),(r=(e=c.value)==null?void 0:e.kantor_cabang)!=null&&r.id&&(t.kantor_cabang_id=String(c.value.kantor_cabang.id)))}),(n,e)=>(f(),ue(pe,null,{default:Q(()=>[w(me,{pageTitle:k.value},null,8,["pageTitle"]),a("div",je,[a("div",Se,[a("h3",Te,A(k.value),1),a("button",{onClick:z,type:"button",class:"flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03]"}," Batal ")]),a("form",{onSubmit:q(te,["prevent"]),class:"flex flex-col"},[a("div",Ie,[a("div",null,[e[13]||(e[13]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kode ",-1)),j(a("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=r=>t.kode=r),placeholder:"Kode donatur",readonly:"",class:"h-11 w-full rounded-lg border border-gray-300 bg-gray-100 px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-800 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800 cursor-not-allowed"},null,512),[[S,t.kode]])]),a("div",null,[e[14]||(e[14]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[K(" Tipe Donor "),a("span",{class:"text-red-500"},"*")],-1)),w(Ce,{modelValue:t.jenis_donatur,"onUpdate:modelValue":e[1]||(e[1]=r=>t.jenis_donatur=r),options:$,placeholder:"Pilih tipe donor"},null,8,["modelValue"])]),a("div",null,[e[15]||(e[15]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," PIC ",-1)),w(P,{modelValue:t.pic,"onUpdate:modelValue":e[2]||(e[2]=r=>t.pic=r),options:u.value,placeholder:"Pilih PIC","search-input":I.value,"onUpdate:searchInput":e[3]||(e[3]=r=>I.value=r),disabled:V.value},null,8,["modelValue","options","search-input","disabled"])]),a("div",null,[e[16]||(e[16]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[K(" Nama "),a("span",{class:"text-red-500"},"*")],-1)),j(a("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=r=>t.nama=r),placeholder:"Nama donatur",required:"",class:"h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[S,t.nama]])]),a("div",null,[e[17]||(e[17]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," No. Handphone ",-1)),j(a("input",{type:"text",inputmode:"numeric",pattern:"[0-9]*","onUpdate:modelValue":e[5]||(e[5]=r=>t.no_handphone=r),placeholder:"No. Handphone",class:"h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[S,t.no_handphone]])]),a("div",null,[e[18]||(e[18]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Email ",-1)),j(a("input",{type:"email","onUpdate:modelValue":e[6]||(e[6]=r=>t.email=r),placeholder:"Email",class:"h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[S,t.email]])]),a("div",null,[e[20]||(e[20]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Tanggal Lahir ",-1)),a("div",Ue,[w(ce(ge),{modelValue:t.tanggal_lahir,"onUpdate:modelValue":e[7]||(e[7]=r=>t.tanggal_lahir=r),config:R,class:"h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 pr-11 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",placeholder:"Tanggal lahir"},null,8,["modelValue"]),e[19]||(e[19]=a("span",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400"},[a("svg",{class:"fill-current",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[a("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M6.66659 1.5415C7.0808 1.5415 7.41658 1.87729 7.41658 2.2915V2.99984H12.5833V2.2915C12.5833 1.87729 12.919 1.5415 13.3333 1.5415C13.7475 1.5415 14.0833 1.87729 14.0833 2.2915V2.99984L15.4166 2.99984C16.5212 2.99984 17.4166 3.89527 17.4166 4.99984V7.49984V15.8332C17.4166 16.9377 16.5212 17.8332 15.4166 17.8332H4.58325C3.47868 17.8332 2.58325 16.9377 2.58325 15.8332V7.49984V4.99984C2.58325 3.89527 3.47868 2.99984 4.58325 2.99984L5.91659 2.99984V2.2915C5.91659 1.87729 6.25237 1.5415 6.66659 1.5415ZM6.66659 4.49984H4.58325C4.30711 4.49984 4.08325 4.7237 4.08325 4.99984V6.74984H15.9166V4.99984C15.9166 4.7237 15.6927 4.49984 15.4166 4.49984H13.3333H6.66659ZM15.9166 8.24984H4.08325V15.8332C4.08325 16.1093 4.30711 16.3332 4.58325 16.3332H15.4166C15.6927 16.3332 15.9166 16.1093 15.9166 15.8332V8.24984Z",fill:"currentColor"})])],-1))])]),a("div",null,[e[21]||(e[21]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kantor Cabang ",-1)),w(P,{modelValue:t.kantor_cabang_id,"onUpdate:modelValue":e[8]||(e[8]=r=>t.kantor_cabang_id=r),options:l.value,placeholder:"Kantor Cabang","search-input":T.value,"onUpdate:searchInput":e[9]||(e[9]=r=>T.value=r),disabled:V.value},null,8,["modelValue","options","search-input","disabled"])]),a("div",null,[e[22]||(e[22]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Status ",-1)),w(P,{modelValue:t.status,"onUpdate:modelValue":e[10]||(e[10]=r=>t.status=r),options:H,placeholder:"Status","search-input":U.value,"onUpdate:searchInput":e[11]||(e[11]=r=>U.value=r)},null,8,["modelValue","search-input"])]),a("div",Oe,[e[23]||(e[23]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Alamat ",-1)),j(a("textarea",{"onUpdate:modelValue":e[12]||(e[12]=r=>t.alamat=r),placeholder:"Alamat lengkap",rows:"3",class:"w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[S,t.alamat]])])]),a("div",Ae,[a("button",{onClick:z,type:"button",class:"flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] sm:w-auto"}," Batal "),a("button",{type:"submit",disabled:o.value,class:"flex w-full justify-center rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600 disabled:cursor-not-allowed disabled:bg-brand-300 sm:w-auto"},A(b.value?"Simpan Perubahan":"Simpan"),9,Re)])],32)])]),_:1}))}});export{He as default};
