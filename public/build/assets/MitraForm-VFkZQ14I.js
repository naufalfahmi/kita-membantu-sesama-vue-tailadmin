import{d as O,H as P,I as D,V as I,r as k,A as h,a as L,o as G,c as $,b as K,w as Z,e as y,f as e,t as T,p as q,i as u,l as J,v as g,u as Y}from"./admin-BLQt5dm6.js";import{C as A}from"./component-Baz6Fi63.js";import{_ as X}from"./AdminLayout.vue_vue_type_script_setup_true_lang-DVoyHdtI.js";import{_ as z}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-DjRlBqWI.js";import{S as Q}from"./SearchableSelect-DIA02P8e.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const W={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},aa={class:"mb-6 flex items-center justify-between"},ea={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},ra={class:"grid grid-cols-1 gap-x-6 gap-y-5 lg:grid-cols-2"},ta={class:"relative"},na={class:"mt-6 flex items-center gap-3 lg:justify-end"},oa=["disabled"],ba=O({__name:"MitraForm",setup(da){const l=P(),b=D(),s=I(),p=k(null),w=h(()=>{var a,t,o;const n=(o=(t=(a=p.value)==null?void 0:a.role)==null?void 0:t.name)==null?void 0:o.toLowerCase();return n==="fundrising"||n==="fundraising"}),m=h(()=>l.params.id!==void 0&&l.params.id!=="new"),v=h(()=>m.value?"Edit Mitra":"Tambah Mitra"),E={dateFormat:"Y-m-d",altInput:!0,altFormat:"d F Y",locale:"id",wrap:!1,clickOpens:!0,allowInput:!1},_=k([]),C=k(""),x=k(!1),M=h(()=>_.value.map(n=>({value:String(n.id),label:n.nama||n.name||"-"}))),r=L({nama:"",email:"",no_handphone:"",nama_bank:"",no_rekening:"",tanggal_lahir:"",pendidikan:"",kantor_cabang_id:""}),U=async()=>{try{const n=await fetch("/admin/api/user",{credentials:"same-origin"});if(n.ok){const a=await n.json();a.success&&a.user&&(p.value=a.user)}}catch(n){console.error("Error fetching current user:",n)}},H=async()=>{try{const n=await fetch("/admin/api/kantor-cabang?per_page=1000",{credentials:"same-origin"});if(!n.ok)throw new Error("Failed to load kantor cabang");const a=await n.json();a.success&&(_.value=a.data||[])}catch{s.error("Gagal memuat data kantor cabang")}},F=async n=>{try{const a=await fetch(`/admin/api/mitra/${n}`,{credentials:"same-origin"});if(!a.ok)throw new Error("Failed to fetch mitra");const t=await a.json();if(t.success&&t.data){const o=t.data;r.nama=o.nama||"",r.email=o.email||"",r.no_handphone=o.no_handphone||"",r.nama_bank=o.nama_bank||"",r.no_rekening=o.no_rekening||"",r.tanggal_lahir=o.tanggal_lahir||"",r.pendidikan=o.pendidikan||"",r.kantor_cabang_id=o.kantor_cabang_id?String(o.kantor_cabang_id):""}else s.error(t.message||"Mitra tidak ditemukan"),b.push("/user-kepegawaian/mitra")}catch{s.error("Gagal memuat data mitra"),b.push("/user-kepegawaian/mitra")}},V=()=>{b.push("/user-kepegawaian/mitra")},R=async()=>{var n,a;if(!r.nama.trim()){s.error("Nama wajib diisi");return}x.value=!0;try{const t=await fetch("/admin/api/csrf-token",{credentials:"same-origin"});if(!t.ok)throw new Error("Failed to fetch CSRF token");const o=await t.json(),i=c=>{if(c==null)return null;const f=String(c).trim();return f!==""?f:null},B={nama:r.nama.trim(),email:i(r.email),no_handphone:i(r.no_handphone),nama_bank:i(r.nama_bank),no_rekening:i(r.no_rekening),tanggal_lahir:r.tanggal_lahir||null,pendidikan:i(r.pendidikan),kantor_cabang_id:i(r.kantor_cabang_id)};let S="/admin/api/mitra",N="POST";m.value&&l.params.id&&(S=`/admin/api/mitra/${l.params.id}`,N="PUT");const j=await fetch(S,{method:N,headers:{"Content-Type":"application/json","X-CSRF-TOKEN":o.csrf_token},credentials:"same-origin",body:JSON.stringify(B)}),d=await j.json().catch(()=>({}));if(!j.ok){const f=(d!=null&&d.errors?(a=(n=Object.values(d.errors))==null?void 0:n[0])==null?void 0:a[0]:void 0)||d.message||"Request gagal";throw new Error(f)}d.success?(s.success(d.message||"Mitra berhasil disimpan"),b.push("/user-kepegawaian/mitra")):s.error(d.message||"Gagal menyimpan mitra")}catch(t){s.error((t==null?void 0:t.message)||"Gagal menyimpan mitra")}finally{x.value=!1}};return G(async()=>{var n,a;await U(),await H(),m.value&&l.params.id&&await F(l.params.id),w.value&&!m.value&&(a=(n=p.value)==null?void 0:n.kantor_cabang)!=null&&a.id&&(r.kantor_cabang_id=String(p.value.kantor_cabang.id))}),(n,a)=>(K(),$(X,null,{default:Z(()=>[y(z,{pageTitle:v.value},null,8,["pageTitle"]),e("div",W,[e("div",aa,[e("h3",ea,T(v.value),1),e("button",{onClick:V,type:"button",class:"flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03]"}," Batal ")]),e("form",{onSubmit:q(R,["prevent"]),class:"flex flex-col"},[e("div",ra,[e("div",null,[a[9]||(a[9]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[J(" Nama "),e("span",{class:"text-red-500"},"*")],-1)),u(e("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=t=>r.nama=t),placeholder:"Nama",required:"",class:"h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[g,r.nama]])]),e("div",null,[a[10]||(a[10]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," No. Handphone ",-1)),u(e("input",{type:"text",inputmode:"numeric",pattern:"[0-9]*","onUpdate:modelValue":a[1]||(a[1]=t=>r.no_handphone=t),placeholder:"No. Handphone",class:"h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[g,r.no_handphone]])]),e("div",null,[a[11]||(a[11]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Email ",-1)),u(e("input",{type:"email","onUpdate:modelValue":a[2]||(a[2]=t=>r.email=t),placeholder:"Email",class:"h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[g,r.email]])]),e("div",null,[a[12]||(a[12]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Nama Bank ",-1)),u(e("input",{type:"text","onUpdate:modelValue":a[3]||(a[3]=t=>r.nama_bank=t),placeholder:"Nama Bank",class:"h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[g,r.nama_bank]])]),e("div",null,[a[13]||(a[13]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," No. Rekening ",-1)),u(e("input",{type:"number","onUpdate:modelValue":a[4]||(a[4]=t=>r.no_rekening=t),placeholder:"No. Rekening",class:"h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[g,r.no_rekening]])]),e("div",null,[a[15]||(a[15]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Tanggal Lahir ",-1)),e("div",ta,[y(Y(A),{modelValue:r.tanggal_lahir,"onUpdate:modelValue":a[5]||(a[5]=t=>r.tanggal_lahir=t),config:E,class:"h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 pl-4 pr-11 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",placeholder:"Tanggal Lahir",readonly:""},null,8,["modelValue"]),a[14]||(a[14]=e("span",{class:"pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400"},[e("svg",{class:"fill-current",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M6.66659 1.5415C7.0808 1.5415 7.41658 1.87729 7.41658 2.2915V2.99984H12.5833V2.2915C12.5833 1.87729 12.919 1.5415 13.3333 1.5415C13.7475 1.5415 14.0833 1.87729 14.0833 2.2915V2.99984L15.4166 2.99984C16.5212 2.99984 17.4166 3.89527 17.4166 4.99984V7.49984V15.8332C17.4166 16.9377 16.5212 17.8332 15.4166 17.8332H4.58325C3.47868 17.8332 2.58325 16.9377 2.58325 15.8332V7.49984V4.99984C2.58325 3.89527 3.47868 2.99984 4.58325 2.99984L5.91659 2.99984V2.2915C5.91659 1.87729 6.25237 1.5415 6.66659 1.5415ZM6.66659 4.49984H4.58325C4.30711 4.49984 4.08325 4.7237 4.08325 4.99984V6.74984H15.9166V4.99984C15.9166 4.7237 15.6927 4.49984 15.4166 4.49984H13.3333H6.66659ZM15.9166 8.24984H4.08325V15.8332C4.08325 16.1093 4.30711 16.3332 4.58325 16.3332H15.4166C15.6927 16.3332 15.9166 16.1093 15.9166 15.8332V8.24984Z",fill:""})])],-1))])]),e("div",null,[a[16]||(a[16]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Pendidikan ",-1)),u(e("input",{type:"text","onUpdate:modelValue":a[6]||(a[6]=t=>r.pendidikan=t),placeholder:"Pendidikan",class:"h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[g,r.pendidikan]])]),e("div",null,[a[17]||(a[17]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kantor Cabang ",-1)),y(Q,{modelValue:r.kantor_cabang_id,"onUpdate:modelValue":a[7]||(a[7]=t=>r.kantor_cabang_id=t),options:M.value,placeholder:"Kantor Cabang","search-input":C.value,"onUpdate:searchInput":a[8]||(a[8]=t=>C.value=t),disabled:w.value},null,8,["modelValue","options","search-input","disabled"])])]),e("div",na,[e("button",{onClick:V,type:"button",class:"flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] sm:w-auto"}," Batal "),e("button",{type:"submit",disabled:x.value,class:"flex w-full justify-center rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600 disabled:cursor-not-allowed disabled:bg-brand-300 sm:w-auto"},T(m.value?"Simpan Perubahan":"Simpan"),9,oa)])],32)])]),_:1}))}});export{ba as default};
