import{d as V,H as $,I as C,L as R,z as M,r as u,a as y,o as H,c as I,b as l,w as U,e as k,f as r,t as d,p as q,j as n,g as B,l as g,i as v,n as _,v as w}from"./admin-DwTHc9qP.js";import{_ as N,a as D}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-D9-SYEKw.js";import{S as L}from"./SearchableSelect-CsOdwqiG.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const F={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},G={class:"mb-6 flex items-center justify-between"},W={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},X={class:"grid grid-cols-1 gap-x-6 gap-y-5 lg:grid-cols-2"},z={class:"lg:col-span-1"},A={key:0,class:"mt-1 text-xs text-red-500"},O={class:"lg:col-span-1"},J={key:0,class:"mt-1 text-xs text-red-500"},K={key:1,class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},Y={class:"lg:col-span-2"},Z={key:0,class:"mt-1 text-xs text-red-500"},Q={key:1,class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},ee={class:"flex items-center gap-3 mt-6 lg:justify-end"},te=["disabled"],ae={key:0},se={key:1},de=V({__name:"FormPesan",setup(re){const j=$();C();const p=R(),b=M(()=>j.meta.title||"Form Pesan"),c=u([]),x=u(""),m=u(!1),a=y({receiver_id:"",title:"",message:""}),s=y({receiver_id:"",title:"",message:""}),h=t=>{s[t]=""},S=t=>{x.value=t},P=async(t="")=>{try{const e=await fetch(`/admin/api/users${t?`?search=${encodeURIComponent(t)}`:""}`,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin"});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const i=await e.json();i.success&&i.data&&(c.value=i.data.map(o=>({value:String(o.id),label:o.name||`${o.first_name} ${o.last_name}`||o.email||`User #${o.id}`})))}catch(e){console.error("Error fetching users:",e),c.value.length===0&&(c.value=[{value:"1",label:"Ahmad Hidayat"},{value:"2",label:"Siti Nurhaliza"},{value:"3",label:"Budi Santoso"},{value:"4",label:"Dewi Lestari"},{value:"5",label:"Eko Prasetyo"},{value:"6",label:"Fitri Handayani"},{value:"7",label:"Guntur Wibowo"},{value:"8",label:"Hesti Rahayu"},{value:"9",label:"Indra Wijaya"},{value:"10",label:"Joko Susilo"}])}},T=()=>{let t=!0;return s.receiver_id="",s.title="",s.message="",a.receiver_id||(s.receiver_id="Penerima pesan wajib diisi",t=!1),!a.title||a.title.trim()===""?(s.title="Subjek wajib diisi",t=!1):a.title.length>100&&(s.title="Subjek tidak boleh lebih dari 100 karakter",t=!1),!a.message||a.message.trim()===""?(s.message="Pesan wajib diisi",t=!1):a.message.length>1e3&&(s.message="Pesan tidak boleh lebih dari 1000 karakter",t=!1),t},f=()=>{a.receiver_id="",a.title="",a.message="",Object.keys(s).forEach(t=>{s[t]=""})},E=async()=>{if(T()){m.value=!0;try{const t={receiver_id:a.receiver_id,title:a.title.trim(),message:a.message.trim()},e=await fetch("/admin/api/messages",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin",body:JSON.stringify(t)});if(!e.ok){const o=await e.json();throw new Error(o.message||"Gagal mengirim pesan")}const i=await e.json();if(i.success)p.success("Pesan berhasil dikirim"),f();else throw new Error(i.message||"Gagal mengirim pesan")}catch(t){console.error("Error sending message:",t),p.error(t instanceof Error?t.message:"Terjadi kesalahan saat mengirim pesan")}finally{m.value=!1}}};return H(()=>{P()}),(t,e)=>(l(),I(D,null,{default:U(()=>[k(N,{pageTitle:b.value},null,8,["pageTitle"]),r("div",F,[r("div",G,[r("h3",W,d(b.value),1)]),r("form",{onSubmit:q(E,["prevent"]),class:"flex flex-col"},[r("div",X,[r("div",z,[e[5]||(e[5]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[g(" Penerima Pesan "),r("span",{class:"text-red-500"},"*")],-1)),k(L,{modelValue:a.receiver_id,"onUpdate:modelValue":e[0]||(e[0]=i=>a.receiver_id=i),options:c.value,placeholder:"Pilih atau cari penerima pesan","search-input":x.value,"onUpdate:searchInput":S},null,8,["modelValue","options","search-input"]),s.receiver_id?(l(),n("p",A,d(s.receiver_id),1)):B("",!0)]),r("div",O,[e[6]||(e[6]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[g(" Subjek "),r("span",{class:"text-red-500"},"*")],-1)),v(r("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=i=>a.title=i),placeholder:"Masukkan subjek pesan",maxlength:"100",required:"",class:_(["dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",{"border-red-500":s.title}]),onInput:e[2]||(e[2]=i=>h("title"))},null,34),[[w,a.title]]),s.title?(l(),n("p",J,d(s.title),1)):(l(),n("p",K,d(a.title.length)+"/100 karakter ",1))]),r("div",Y,[e[7]||(e[7]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[g(" Pesan "),r("span",{class:"text-red-500"},"*")],-1)),v(r("textarea",{"onUpdate:modelValue":e[3]||(e[3]=i=>a.message=i),placeholder:"Masukkan isi pesan",maxlength:"1000",rows:"6",required:"",class:_(["dark:bg-dark-900 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",{"border-red-500":s.message}]),onInput:e[4]||(e[4]=i=>h("message"))},null,34),[[w,a.message]]),s.message?(l(),n("p",Z,d(s.message),1)):(l(),n("p",Q,d(a.message.length)+"/1000 karakter ",1))])]),r("div",ee,[r("button",{onClick:f,type:"button",class:"flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] sm:w-auto"}," Batal "),r("button",{type:"submit",disabled:m.value,class:"flex w-full justify-center rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600 disabled:opacity-50 disabled:cursor-not-allowed sm:w-auto"},[m.value?(l(),n("span",ae,"Mengirim...")):(l(),n("span",se,"Kirim Pesan"))],8,te)])],32)])]),_:1}))}});export{de as default};
