import{d as O,A,P as I,H as G,I as U,L as X,b as m,f as q,g as z,o as W,w as Q,a as s,k as J,v as Y,j as C,u as Z,Q as ee}from"./admin-tlO3s9ed.js";import{_ as te}from"./AdminLayout.vue_vue_type_script_setup_true_lang-bqsSe-JG.js";import{S as D}from"./SearchableSelect-CKa0t9mK.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ae={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},re={class:"mb-6 grid grid-cols-1 md:grid-cols-4 gap-3 items-end"},ne={class:"ag-theme-alpine dark:ag-theme-alpine-dark",style:{width:"100%","min-height":"400px"}},ce=O({__name:"PayrollDetail",setup(oe){const{hasPermission:M,isAdmin:R}=I(),v=A(()=>R()||M("update remunerasi")),N=G(),_=U(),l=X(),S=m([]),B=m([]),h=m(""),y=m(""),w=m(""),b=m([]),L=[{value:"",label:"Semua"},{value:"pending",label:"Pending"},{value:"locked",label:"Locked"},{value:"transferred",label:"Ditransfer"}];let k=null;const P=()=>{k&&clearTimeout(k),k=setTimeout(()=>{f()},300)},E=()=>{h.value="",y.value="",w.value="",f()},$=async()=>{var a;try{const t=await fetch("/admin/api/kantor-cabang?per_page=1000",{credentials:"same-origin"}),r=await t.json();if(t.ok&&r.success){const n=Array.isArray(r.data)?r.data:((a=r.data)==null?void 0:a.data)||[];b.value=[{value:"",label:"Semua"},...n.map(e=>({value:e.id,label:e.nama||e.name||"-"}))]}else b.value=[{value:"",label:"Semua"}]}catch{b.value=[{value:"",label:"Semua"}]}},f=()=>{const a=h.value.trim().toLowerCase(),t=y.value,r=w.value,n=B.value.filter(e=>!(a&&!(e.employee&&e.employee.name?String(e.employee.name).toLowerCase():"").includes(a)||t&&(e.status||"")!==t||r&&(e.employee&&e.employee.kantor_cabang_id?String(e.employee.kantor_cabang_id):"")!==r));S.value=n.map(e=>({record_id:e.id,name:e.employee?e.employee.name:"",total:e.total_amount||0,status:e.status,transfer_proof:e.transfer_proof||null,has_transfer_proof:!!e.transfer_proof}))},H=[{headerName:"Nama Karyawan",field:"name",flex:1},{headerName:"Total",field:"total",width:200,cellRenderer:a=>{const t=document.createElement("span");t.className="text-sm font-medium text-gray-800";const r=a.value||0,n=F(r);return t.textContent=n,t}},{headerName:"Status",field:"status",width:150,cellRenderer:a=>{const t={pending:"Pending",locked:"Selesai",transferred:"Ditransfer"},r={pending:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",locked:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",transferred:"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400"},n=document.createElement("span"),e=a.value||"";return n.className=`inline-block rounded-full px-3 py-1 text-xs font-medium ${r[e]||"bg-gray-100 text-gray-800"}`,n.textContent=t[e]||e,n}},{headerName:"Actions",field:"actions",width:160,cellRenderer:a=>{const t=document.createElement("div");t.className="flex items-center gap-2 justify-end";const r=N.params.id;if(v.value){const e=document.createElement("button");e.type="button",e.title="Edit",e.className="flex items-center justify-center w-8 h-8 rounded-lg text-brand-500 hover:bg-brand-50",e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"/></svg>',e.onclick=o=>{o.stopPropagation(),_.push(`/operasional/payroll/${r}/records/${a.data.record_id}/edit`)},t.appendChild(e)}const n=document.createElement("button");if(n.type="button",n.title="Cetak Slip Gaji",n.className="flex items-center justify-center w-8 h-8 rounded-lg text-gray-700 hover:bg-gray-100",n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="9" width="12" height="8" rx="2" ry="2"/><path d="M6 13H4a2 2 0 0 0-2 2v4h20v-4a2 2 0 0 0-2-2h-2"/><path d="M6 9V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v4"/></svg>',n.onclick=async e=>{e.stopPropagation();try{(await(await fetch("/admin/api/debug-auth",{credentials:"same-origin"})).json()).authenticated?window.open(`/admin/operasional/payroll/periods/${r}/records/${a.data.record_id}/slip?format=pdf`,"_blank"):(l.error("Sesi kadaluarsa, silakan masuk kembali"),_.push("/signin"))}catch{l.error("Gagal memeriksa status autentikasi")}},t.appendChild(n),a.data&&a.data.transfer_proof){const e=document.createElement("button");if(e.type="button",e.title="Lihat Bukti Transfer",e.className="flex items-center justify-center w-8 h-8 rounded-lg text-gray-700 hover:bg-gray-100",e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>',e.onclick=o=>{o.stopPropagation(),window.open(`/storage/${a.data.transfer_proof}`,"_blank")},t.appendChild(e),v.value){const o=document.createElement("button");o.type="button",o.title="Ubah Bukti",o.className="flex items-center justify-center w-8 h-8 rounded-lg text-brand-500 hover:bg-brand-50",o.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><path d="M20.49 15a8.93 8.93 0 1 1-2.1-9.1"></path></svg>';const i=document.createElement("input");i.type="file",i.accept=".pdf,.jpg,.jpeg,.png",i.style.display="none",i.onchange=async c=>{const p=c.target.files&&c.target.files[0];if(!p)return;const g=new FormData;g.append("transfer_proof",p);try{const j=await T(),d=await(await fetch(`/admin/api/operasional/payroll/periods/${r}/records/${a.data.record_id}/transfer-proof`,{method:"POST",headers:{"X-CSRF-TOKEN":j,"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin",body:g})).json();if(!d.success){if(d.errors){const K=Object.keys(d.errors)[0];l.error(d.errors[K][0])}else d.message?l.error(d.message):l.error("Gagal upload bukti");return}l.success("Bukti transfer berhasil diubah"),x()}catch{l.error("Gagal upload bukti")}},o.onclick=c=>{c.stopPropagation(),i.click()},t.appendChild(o),t.appendChild(i)}}else if(v.value){const e=document.createElement("button");e.type="button",e.title="Upload Bukti",e.className="flex items-center justify-center w-8 h-8 rounded-lg text-brand-500 hover:bg-brand-50",e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/></svg>';const o=document.createElement("input");o.type="file",o.accept=".pdf,.jpg,.jpeg,.png",o.style.display="none",o.onchange=async i=>{const c=i.target.files&&i.target.files[0];if(!c)return;const p=new FormData;p.append("transfer_proof",c),p.append("status","transferred");try{const g=await T(),u=await(await fetch(`/admin/api/operasional/payroll/periods/${r}/records/${a.data.record_id}/transfer-proof`,{method:"POST",headers:{"X-CSRF-TOKEN":g,"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin",body:p})).json();if(!u.success){if(u.errors){const d=Object.keys(u.errors)[0];l.error(u.errors[d][0])}else u.message?l.error(u.message):l.error("Gagal upload bukti");return}l.success("Bukti transfer ter-upload"),x()}catch{l.error("Gagal upload bukti")}},e.onclick=i=>{i.stopPropagation(),o.click()},t.appendChild(e),t.appendChild(o)}return t}}],V={resizable:!0,sortable:!0},x=async()=>{const a=N.params.id,n=(await(await fetch(`/admin/api/operasional/payroll/periods/${a}`,{credentials:"same-origin"})).json()).data;n&&(B.value=n.records||[],f())},F=a=>{const t=Number(a||0);return`Rp. ${new Intl.NumberFormat("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t)}`};q(async()=>{await $(),await x()});const T=async()=>{var n;const a=(n=document.querySelector('meta[name="csrf-token"]'))==null?void 0:n.getAttribute("content");return a||(await(await fetch("/admin/api/csrf-token",{credentials:"same-origin"})).json()).csrf_token||""};return(a,t)=>(W(),z(te,null,{default:Q(()=>[s("div",ae,[t[7]||(t[7]=s("div",{class:"mb-6 flex items-center justify-between"},[s("h3",{class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},"Detail Periode")],-1)),s("div",re,[s("div",null,[t[3]||(t[3]=s("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-400"},"Nama Karyawan",-1)),J(s("input",{"onUpdate:modelValue":t[0]||(t[0]=r=>h.value=r),onInput:P,type:"text",placeholder:"Cari nama...",class:"w-full h-11 rounded-lg border border-gray-300 px-3 text-sm"},null,544),[[Y,h.value]])]),s("div",null,[t[4]||(t[4]=s("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-400"},"Status",-1)),C(D,{modelValue:y.value,options:L,placeholder:"Semua","onUpdate:modelValue":t[1]||(t[1]=r=>{y.value=r,f()})},null,8,["modelValue"])]),s("div",null,[t[5]||(t[5]=s("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-400"},"Kantor Cabang",-1)),C(D,{modelValue:w.value,options:b.value,placeholder:"Semua","onUpdate:modelValue":t[2]||(t[2]=r=>{w.value=r,f()})},null,8,["modelValue","options"])]),s("div",{class:"flex items-center gap-2"},[s("button",{type:"button",onClick:E,class:"h-11 rounded border px-4 py-2 text-sm"},"Reset"),t[6]||(t[6]=s("div",{class:"text-sm text-gray-500"},"Â ",-1))])]),s("div",ne,[C(Z(ee),{class:"ag-theme-alpine",style:{width:"100%"},columnDefs:H,rowData:S.value,defaultColDef:V,pagination:!0,paginationPageSize:20,animateRows:!0,domLayout:"autoHeight"},null,8,["rowData"])])])]),_:1}))}});export{ce as default};
