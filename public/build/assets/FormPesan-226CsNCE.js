import{d as E,H as V,I as $,A as C,r as u,a as f,o as R,c as M,b as o,w as H,e as y,f as r,t as d,p as I,j as n,g as U,l as g,i as k,n as v,v as _}from"./admin-CVIlm2oe.js";import{_ as q}from"./AdminLayout.vue_vue_type_script_setup_true_lang-CLdLN9wZ.js";import{_ as B}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-D97l8uaG.js";import{S as N}from"./SearchableSelect-D12Op9Qa.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const D={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},A={class:"mb-6 flex items-center justify-between"},F={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},G={class:"grid grid-cols-1 gap-x-6 gap-y-5 lg:grid-cols-2"},L={class:"lg:col-span-1"},W={key:0,class:"mt-1 text-xs text-red-500"},X={class:"lg:col-span-1"},O={key:0,class:"mt-1 text-xs text-red-500"},z={key:1,class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},J={class:"lg:col-span-2"},K={key:0,class:"mt-1 text-xs text-red-500"},Y={key:1,class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},Z={class:"flex items-center gap-3 mt-6 lg:justify-end"},Q=["disabled"],ee={key:0},te={key:1},ne=E({__name:"FormPesan",setup(ae){const w=V();$();const p=C(()=>w.meta.title||"Form Pesan"),c=u([]),b=u(""),m=u(!1),a=f({receiver_id:"",title:"",message:""}),s=f({receiver_id:"",title:"",message:""}),x=t=>{s[t]=""},j=t=>{b.value=t},S=async(t="")=>{try{const e=await fetch(`/admin/api/users${t?`?search=${encodeURIComponent(t)}`:""}`,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin"});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const i=await e.json();i.success&&i.data&&(c.value=i.data.map(l=>({value:String(l.id),label:l.name||`${l.first_name} ${l.last_name}`||l.email||`User #${l.id}`})))}catch(e){console.error("Error fetching users:",e),c.value.length===0&&(c.value=[{value:"1",label:"Ahmad Hidayat"},{value:"2",label:"Siti Nurhaliza"},{value:"3",label:"Budi Santoso"},{value:"4",label:"Dewi Lestari"},{value:"5",label:"Eko Prasetyo"},{value:"6",label:"Fitri Handayani"},{value:"7",label:"Guntur Wibowo"},{value:"8",label:"Hesti Rahayu"},{value:"9",label:"Indra Wijaya"},{value:"10",label:"Joko Susilo"}])}},P=()=>{let t=!0;return s.receiver_id="",s.title="",s.message="",a.receiver_id||(s.receiver_id="Penerima pesan wajib diisi",t=!1),!a.title||a.title.trim()===""?(s.title="Subjek wajib diisi",t=!1):a.title.length>100&&(s.title="Subjek tidak boleh lebih dari 100 karakter",t=!1),!a.message||a.message.trim()===""?(s.message="Pesan wajib diisi",t=!1):a.message.length>1e3&&(s.message="Pesan tidak boleh lebih dari 1000 karakter",t=!1),t},h=()=>{a.receiver_id="",a.title="",a.message="",Object.keys(s).forEach(t=>{s[t]=""})},T=async()=>{if(P()){m.value=!0;try{const t={receiver_id:a.receiver_id,title:a.title.trim(),message:a.message.trim()},e=await fetch("/admin/api/messages",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin",body:JSON.stringify(t)});if(!e.ok){const l=await e.json();throw new Error(l.message||"Gagal mengirim pesan")}const i=await e.json();if(i.success)alert("Pesan berhasil dikirim"),h();else throw new Error(i.message||"Gagal mengirim pesan")}catch(t){console.error("Error sending message:",t),alert(t instanceof Error?t.message:"Terjadi kesalahan saat mengirim pesan")}finally{m.value=!1}}};return R(()=>{S()}),(t,e)=>(o(),M(q,null,{default:H(()=>[y(B,{pageTitle:p.value},null,8,["pageTitle"]),r("div",D,[r("div",A,[r("h3",F,d(p.value),1)]),r("form",{onSubmit:I(T,["prevent"]),class:"flex flex-col"},[r("div",G,[r("div",L,[e[5]||(e[5]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[g(" Penerima Pesan "),r("span",{class:"text-red-500"},"*")],-1)),y(N,{modelValue:a.receiver_id,"onUpdate:modelValue":e[0]||(e[0]=i=>a.receiver_id=i),options:c.value,placeholder:"Pilih atau cari penerima pesan","search-input":b.value,"onUpdate:searchInput":j},null,8,["modelValue","options","search-input"]),s.receiver_id?(o(),n("p",W,d(s.receiver_id),1)):U("",!0)]),r("div",X,[e[6]||(e[6]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[g(" Subjek "),r("span",{class:"text-red-500"},"*")],-1)),k(r("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=i=>a.title=i),placeholder:"Masukkan subjek pesan",maxlength:"100",required:"",class:v(["dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",{"border-red-500":s.title}]),onInput:e[2]||(e[2]=i=>x("title"))},null,34),[[_,a.title]]),s.title?(o(),n("p",O,d(s.title),1)):(o(),n("p",z,d(a.title.length)+"/100 karakter ",1))]),r("div",J,[e[7]||(e[7]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[g(" Pesan "),r("span",{class:"text-red-500"},"*")],-1)),k(r("textarea",{"onUpdate:modelValue":e[3]||(e[3]=i=>a.message=i),placeholder:"Masukkan isi pesan",maxlength:"1000",rows:"6",required:"",class:v(["dark:bg-dark-900 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",{"border-red-500":s.message}]),onInput:e[4]||(e[4]=i=>x("message"))},null,34),[[_,a.message]]),s.message?(o(),n("p",K,d(s.message),1)):(o(),n("p",Y,d(a.message.length)+"/1000 karakter ",1))])]),r("div",Z,[r("button",{onClick:h,type:"button",class:"flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] sm:w-auto"}," Batal "),r("button",{type:"submit",disabled:m.value,class:"flex w-full justify-center rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600 disabled:opacity-50 disabled:cursor-not-allowed sm:w-auto"},[m.value?(o(),n("span",ee,"Mengirim...")):(o(),n("span",te,"Kirim Pesan"))],8,Q)])],32)])]),_:1}))}});export{ne as default};
