import{_ as B}from"./AdminLayout.vue_vue_type_script_setup_true_lang-CjyN9wNF.js";import{d as M,A as D,P as R,H as E,I as P,L as T,b as $,f as H,g as L,o as S,w as F,a as m,j as G,u as A,Q as I}from"./admin-BPBeAxOw.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const O={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},X={class:"ag-theme-alpine dark:ag-theme-alpine-dark",style:{width:"100%","min-height":"400px"}},U=M({__name:"PayrollDetail",setup(q){const{hasPermission:x,isAdmin:v}=R(),f=D(()=>v()||x("update remunerasi")),w=E(),y=P(),o=T(),k=$([]),j=[{headerName:"Nama Karyawan",field:"name",flex:1},{headerName:"Total",field:"total",width:200,cellRenderer:r=>{const t=document.createElement("span");t.className="text-sm font-medium text-gray-800";const i=r.value||0,n=C(i);return t.textContent=n,t}},{headerName:"Status",field:"status",width:150,cellRenderer:r=>{const t={pending:"Pending",locked:"Selesai",transferred:"Ditransfer"},i={pending:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",locked:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",transferred:"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400"},n=document.createElement("span"),e=r.value||"";return n.className=`inline-block rounded-full px-3 py-1 text-xs font-medium ${i[e]||"bg-gray-100 text-gray-800"}`,n.textContent=t[e]||e,n}},{headerName:"Actions",field:"actions",width:160,cellRenderer:r=>{const t=document.createElement("div");t.className="flex items-center gap-2 justify-end";const i=w.params.id;if(f.value){const e=document.createElement("button");e.type="button",e.title="Edit",e.className="flex items-center justify-center w-8 h-8 rounded-lg text-brand-500 hover:bg-brand-50",e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"/></svg>',e.onclick=a=>{a.stopPropagation(),y.push(`/operasional/payroll/${i}/records/${r.data.record_id}/edit`)},t.appendChild(e)}const n=document.createElement("button");if(n.type="button",n.title="Cetak Slip Gaji",n.className="flex items-center justify-center w-8 h-8 rounded-lg text-gray-700 hover:bg-gray-100",n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="9" width="12" height="8" rx="2" ry="2"/><path d="M6 13H4a2 2 0 0 0-2 2v4h20v-4a2 2 0 0 0-2-2h-2"/><path d="M6 9V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v4"/></svg>',n.onclick=async e=>{e.stopPropagation();try{(await(await fetch("/admin/api/debug-auth",{credentials:"same-origin"})).json()).authenticated?window.open(`/admin/operasional/payroll/periods/${i}/records/${r.data.record_id}/slip?format=pdf`,"_blank"):(o.error("Sesi kadaluarsa, silakan masuk kembali"),y.push("/signin"))}catch{o.error("Gagal memeriksa status autentikasi")}},t.appendChild(n),r.data&&r.data.transfer_proof){const e=document.createElement("button");if(e.type="button",e.title="Lihat Bukti Transfer",e.className="flex items-center justify-center w-8 h-8 rounded-lg text-gray-700 hover:bg-gray-100",e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>',e.onclick=a=>{a.stopPropagation(),window.open(`/storage/${r.data.transfer_proof}`,"_blank")},t.appendChild(e),f.value){const a=document.createElement("button");a.type="button",a.title="Ubah Bukti",a.className="flex items-center justify-center w-8 h-8 rounded-lg text-brand-500 hover:bg-brand-50",a.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><path d="M20.49 15a8.93 8.93 0 1 1-2.1-9.1"></path></svg>';const s=document.createElement("input");s.type="file",s.accept=".pdf,.jpg,.jpeg,.png",s.style.display="none",s.onchange=async d=>{const p=d.target.files&&d.target.files[0];if(!p)return;const u=new FormData;u.append("transfer_proof",p);try{const h=await b(),l=await(await fetch(`/admin/api/operasional/payroll/periods/${i}/records/${r.data.record_id}/transfer-proof`,{method:"POST",headers:{"X-CSRF-TOKEN":h,"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin",body:u})).json();if(!l.success){if(l.errors){const N=Object.keys(l.errors)[0];o.error(l.errors[N][0])}else l.message?o.error(l.message):o.error("Gagal upload bukti");return}o.success("Bukti transfer berhasil diubah"),g()}catch{o.error("Gagal upload bukti")}},a.onclick=d=>{d.stopPropagation(),s.click()},t.appendChild(a),t.appendChild(s)}}else if(f.value){const e=document.createElement("button");e.type="button",e.title="Upload Bukti",e.className="flex items-center justify-center w-8 h-8 rounded-lg text-brand-500 hover:bg-brand-50",e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/></svg>';const a=document.createElement("input");a.type="file",a.accept=".pdf,.jpg,.jpeg,.png",a.style.display="none",a.onchange=async s=>{const d=s.target.files&&s.target.files[0];if(!d)return;const p=new FormData;p.append("transfer_proof",d),p.append("status","transferred");try{const u=await b(),c=await(await fetch(`/admin/api/operasional/payroll/periods/${i}/records/${r.data.record_id}/transfer-proof`,{method:"POST",headers:{"X-CSRF-TOKEN":u,"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin",body:p})).json();if(!c.success){if(c.errors){const l=Object.keys(c.errors)[0];o.error(c.errors[l][0])}else c.message?o.error(c.message):o.error("Gagal upload bukti");return}o.success("Bukti transfer ter-upload"),g()}catch{o.error("Gagal upload bukti")}},e.onclick=s=>{s.stopPropagation(),a.click()},t.appendChild(e),t.appendChild(a)}return t}}],_={resizable:!0,sortable:!0},g=async()=>{const r=w.params.id,n=(await(await fetch(`/admin/api/operasional/payroll/periods/${r}`,{credentials:"same-origin"})).json()).data;n&&(k.value=(n.records||[]).map(e=>({record_id:e.id,name:e.employee?e.employee.name:"",total:e.total_amount||0,status:e.status,transfer_proof:e.transfer_proof||null,has_transfer_proof:!!e.transfer_proof})))},C=r=>{const t=Number(r||0);return`Rp. ${new Intl.NumberFormat("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t)}`};H(g);const b=async()=>{var n;const r=(n=document.querySelector('meta[name="csrf-token"]'))==null?void 0:n.getAttribute("content");return r||(await(await fetch("/admin/api/csrf-token",{credentials:"same-origin"})).json()).csrf_token||""};return(r,t)=>(S(),L(B,null,{default:F(()=>[m("div",O,[t[0]||(t[0]=m("div",{class:"mb-6 flex items-center justify-between"},[m("h3",{class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},"Detail Periode")],-1)),m("div",X,[G(A(I),{class:"ag-theme-alpine",style:{width:"100%"},columnDefs:j,rowData:k.value,defaultColDef:_,pagination:!0,paginationPageSize:20,animateRows:!0,domLayout:"autoHeight"},null,8,["rowData"])])])]),_:1}))}});export{U as default};
