import{d as L,H as A,I as H,r as w,A as P,a as B,o as X,c as q,b as u,w as $,e as z,f as e,t as d,p as G,i as U,j as m,g as f,l as _,v as W,u as I}from"./admin-BLQt5dm6.js";import{C as K}from"./component-Baz6Fi63.js";import{_ as Y}from"./AdminLayout.vue_vue_type_script_setup_true_lang-DVoyHdtI.js";import{_ as Q}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-DjRlBqWI.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Z={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},J={class:"mb-6 flex items-center justify-between"},ee={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},ae={class:"grid grid-cols-1 gap-x-6 gap-y-5 lg:grid-cols-2"},te={class:"lg:col-span-2"},re={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},oe={key:0,class:"mt-1 text-xs text-red-500"},se={class:"lg:col-span-1"},le={key:0,class:"mt-1 text-xs text-red-500"},ne={class:"lg:col-span-2"},ie={class:"space-y-4"},de={key:0,class:"space-y-2"},pe={key:0,class:"flex items-center gap-3 rounded-lg border border-gray-300 bg-gray-50 p-4 dark:border-gray-700 dark:bg-gray-800"},ce={class:"flex-1 min-w-0"},ue={class:"text-sm font-medium text-gray-800 dark:text-white/90 truncate"},ge={class:"text-xs text-gray-500 dark:text-gray-400"},me={class:"flex items-center gap-2"},fe=["href"],he={key:1,class:"flex items-center gap-3 rounded-lg border border-gray-300 bg-gray-50 p-4 dark:border-gray-700 dark:bg-gray-800"},xe={class:"flex-1 min-w-0"},be={class:"text-sm font-medium text-gray-800 dark:text-white/90 truncate"},ye={class:"text-xs text-gray-500 dark:text-gray-400"},ke={key:0,class:"mt-1 text-xs text-red-500"},ve={class:"flex items-center gap-3 mt-6 lg:justify-end"},we=["disabled"],Pe=L({__name:"LandingProposalForm",setup(_e){const y=A(),k=H(),p=w(null),h=P(()=>y.params.id!==void 0&&y.params.id!=="new"),C=P(()=>h.value?"Edit Landing Proposal":"Tambah Landing Proposal"),x=w(!1),D={dateFormat:"Y-m-d",locale:{firstDayOfWeek:1}},s=B({name:"",proposal_date:""}),r=B({name:"",proposal_date:"",file:""}),i=w(null),n=w(null),j=o=>{if(o===0)return"0 Bytes";const a=1024,l=["Bytes","KB","MB","GB"],t=Math.floor(Math.log(o)/Math.log(a));return Math.round(o/Math.pow(a,t)*100)/100+" "+l[t]},S=o=>{var l;const a=o.target;if(a.files&&a.files.length>0){const t=a.files[0],M=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],v=[".pdf",".doc",".docx"],F="."+((l=t.name.split(".").pop())==null?void 0:l.toLowerCase());if(!M.includes(t.type)&&!v.includes(F)){r.file="Format file tidak didukung. Hanya PDF, DOC, dan DOCX yang diizinkan.",p.value&&(p.value.value="");return}const c=20*1024*1024;if(t.size>c){r.file="Ukuran file melebihi 20MB. Mohon pilih file yang lebih kecil.",p.value&&(p.value.value="");return}r.file="",i.value=t,n.value=null,p.value&&(p.value.value="")}},E=()=>{i.value=null,p.value&&(p.value.value=""),r.file=""},R=()=>{n.value=null,r.file=""},V=()=>{let o=!0;if(Object.keys(r).forEach(a=>{r[a]=""}),!s.name||s.name.trim()===""?(r.name="Nama proposal wajib diisi",o=!1):s.name.length>100&&(r.name="Nama proposal maksimal 100 karakter",o=!1),!s.proposal_date)r.proposal_date="Tanggal proposal wajib diisi",o=!1;else{const a=new Date(s.proposal_date);isNaN(a.getTime())&&(r.proposal_date="Format tanggal tidak valid",o=!1)}return!i.value&&!n.value&&(r.file="File proposal wajib diupload",o=!1),o},N=async()=>{if(h.value&&y.params.id){const o=y.params.id;x.value=!0;try{const l=await(await fetch(`/admin/api/landing-proposal/${o}`,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin"})).json();if(l.success&&l.data){const t=l.data;s.name=t.name||"",s.proposal_date=t.proposal_date||"",t.file&&(n.value={name:t.file_name||"File Proposal",url:t.file_url||(String(t.file).startsWith("http")?t.file:`/storage/${t.file}`),size:t.file_size||void 0})}else alert(l.message||"Gagal memuat data"),k.push("/company/landing-proposal")}catch(a){console.error("Error loading data:",a),alert("Terjadi kesalahan saat memuat data"),k.push("/company/landing-proposal")}finally{x.value=!1}}},T=()=>{k.push("/company/landing-proposal")},O=async()=>{var o;if(V()){x.value=!0;try{const a=new FormData;a.append("name",s.name),a.append("proposal_date",s.proposal_date),i.value&&a.append("file",i.value);let t=((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||"";if(!t)try{const b=await(await fetch("/admin/api/csrf-token")).json();t=(b==null?void 0:b.csrf_token)||(b==null?void 0:b.token)||""}catch{}t&&a.append("_token",t);const M=h.value?`/admin/api/landing-proposal/${y.params.id}`:"/admin/api/landing-proposal";h.value&&a.append("_method","PUT");const v={"X-Requested-With":"XMLHttpRequest",Accept:"application/json"};t&&(v["X-CSRF-TOKEN"]=t);const c=await(await fetch(M,{method:"POST",headers:v,credentials:"same-origin",body:a})).json();c.success?(alert(h.value?"Proposal berhasil diupdate":"Proposal berhasil ditambahkan"),k.push("/company/landing-proposal")):(c.errors&&Object.keys(c.errors).forEach(g=>{r.hasOwnProperty(g)&&(r[g]=Array.isArray(c.errors[g])?c.errors[g][0]:c.errors[g])}),alert(c.message||"Gagal menyimpan data"))}catch(a){console.error("Error saving:",a),alert("Terjadi kesalahan saat menyimpan data")}finally{x.value=!1}}};return X(()=>{N()}),(o,a)=>(u(),q(Y,null,{default:$(()=>[z(Q,{pageTitle:C.value},null,8,["pageTitle"]),e("div",Z,[e("div",J,[e("h3",ee,d(C.value),1),e("button",{onClick:T,class:"flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03]"}," Batal ")]),e("form",{onSubmit:G(O,["prevent"]),class:"flex flex-col"},[e("div",ae,[e("div",te,[a[2]||(a[2]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[_(" Nama Proposal "),e("span",{class:"text-red-500"},"*")],-1)),U(e("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=l=>s.name=l),placeholder:"Masukkan nama proposal",maxlength:"100",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[W,s.name]]),e("p",re,d(s.name.length)+"/100 karakter ",1),r.name?(u(),m("p",oe,d(r.name),1)):f("",!0)]),e("div",se,[a[3]||(a[3]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[_(" Tanggal Proposal "),e("span",{class:"text-red-500"},"*")],-1)),z(I(K),{modelValue:s.proposal_date,"onUpdate:modelValue":a[1]||(a[1]=l=>s.proposal_date=l),config:D,class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",placeholder:"Pilih tanggal proposal"},null,8,["modelValue"]),r.proposal_date?(u(),m("p",le,d(r.proposal_date),1)):f("",!0)]),e("div",ne,[a[10]||(a[10]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[_(" File Proposal "),e("span",{class:"text-red-500"},"*")],-1)),e("div",ie,[e("div",null,[e("input",{ref_key:"fileInputRef",ref:p,type:"file",accept:".pdf,.doc,.docx",onChange:S,class:"dark:bg-dark-900 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus:border-brand-800"},null,544),a[4]||(a[4]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," Format: PDF, DOC, DOCX. Maksimal 20MB. Hanya 1 file per proposal. ",-1))]),i.value||n.value?(u(),m("div",de,[n.value&&!i.value?(u(),m("div",pe,[a[7]||(a[7]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-10 w-10 text-brand-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})])],-1)),e("div",ce,[e("p",ue,d(n.value.name||"File Proposal"),1),e("p",ge,d(n.value.size?j(n.value.size):""),1)]),e("div",me,[n.value.url?(u(),m("a",{key:0,href:n.value.url,target:"_blank",class:"flex items-center gap-1 rounded-lg bg-brand-500 px-3 py-1.5 text-xs font-medium text-white hover:bg-brand-600"},[...a[5]||(a[5]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1),_(" Lihat ",-1)])],8,fe)):f("",!0),e("button",{type:"button",onClick:R,class:"flex items-center justify-center w-8 h-8 rounded-lg text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 transition-colors"},[...a[6]||(a[6]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M18 6L6 18M6 6l12 12"})],-1)])])])])):f("",!0),i.value?(u(),m("div",he,[a[9]||(a[9]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-10 w-10 text-brand-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})])],-1)),e("div",xe,[e("p",be,d(i.value.name),1),e("p",ye,d(j(i.value.size)),1)]),e("button",{type:"button",onClick:E,class:"flex items-center justify-center w-8 h-8 rounded-lg text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 transition-colors"},[...a[8]||(a[8]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M18 6L6 18M6 6l12 12"})],-1)])])])):f("",!0)])):f("",!0)]),r.file?(u(),m("p",ke,d(r.file),1)):f("",!0)])]),e("div",ve,[e("button",{onClick:T,type:"button",class:"flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] sm:w-auto"}," Batal "),e("button",{type:"submit",disabled:x.value,class:"flex w-full justify-center rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600 disabled:opacity-50 disabled:cursor-not-allowed sm:w-auto"},d(x.value?"Menyimpan...":h.value?"Simpan Perubahan":"Simpan"),9,we)])],32)])]),_:1}))}});export{Pe as default};
