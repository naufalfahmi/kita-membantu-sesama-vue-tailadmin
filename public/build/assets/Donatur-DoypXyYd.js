import{d as se,H as ie,I as de,L as ue,A as d,P as ce,b as i,B as me,f as pe,g as ge,o as D,w as fe,a as n,j as y,c as V,i as ve,t as be,m as he,k as ye,v as ke,u as xe,Q as we}from"./admin-D7CuPv-V.js";import{_ as Ce}from"./AdminLayout.vue_vue_type_script_setup_true_lang-Cf7rTreP.js";import{_ as Se}from"./ConfirmModal.vue_vue_type_script_setup_true_lang-BTdubsxr.js";import{S as F}from"./SearchableSelect-DEx0cyJz.js";import{S as _e}from"./SearchableMultiSelect-B1Mc06tP.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const De={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},Ae={class:"mb-6 flex items-center justify-between"},je={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},Ne={class:"mb-6 rounded-lg border border-gray-200 bg-white p-4 dark:border-gray-800 dark:bg-white/[0.03]"},Ve={class:"grid gap-4 md:grid-cols-2 xl:grid-cols-4"},Fe={class:"md:col-span-2 xl:col-span-2"},Te={key:0,class:"flex items-center justify-center py-12"},Me={key:1,class:"ag-theme-alpine dark:ag-theme-alpine-dark",style:{width:"100%"}},P="__ALL_JENIS__",Be=se({__name:"Donatur",setup(Le){const B=ie(),T=de(),g=ue(),{fetchUser:U,hasPermission:S,isAdmin:f,user:u}=ce(),z=d(()=>{const t=u.value&&u.value.role||null,e=t?t.name&&String(t.name)||String(t):"",a=String(e||"").trim().toLowerCase();return a==="fundrising"||a==="fundraising"||a==="fundraiser"}),G=d(()=>B.meta.title||"Donatur"),M=d(()=>f()||S("create donatur")),A=d(()=>f()||S("update donatur")),L=d(()=>f()||S("delete donatur"));d(()=>f()||S("view donatur"));const j=i(!1),R=i([]),_=i(!1),k=i(null),x=i(""),m=i(""),c=i([]),v=i(""),b=i("");let N;const J=[{value:"komunitas",label:"Komunitas"},{value:"kotak_infaq",label:"Kotak Infaq"},{value:"retail",label:"Retail"}],K=d(()=>[{value:P,label:"Semua Jenis Donatur"},...J]),E=i([]),O=i([]),H=i([]),$=d(()=>[{value:"",label:"Semua Fundraiser"},...O.value.map(t=>({value:String(t.id),label:t.nama||t.name||"-"}))]),q=d(()=>[{value:"",label:"Semua Mitra"},...H.value.map(t=>({value:String(t.id),label:t.nama||t.name||"-"}))]),Q=d(()=>[{value:"",label:"Semua Kantor Cabang"},...E.value.map(t=>({value:String(t.id),label:t.nama||t.name||"-"}))]),X=d(()=>{const t=[{headerName:"No",field:"__no",width:80,sortable:!1,valueGetter:e=>{try{const a=e.api;let r=0,l=0;a&&typeof a.paginationGetCurrentPage=="function"&&(r=a.paginationGetCurrentPage()||0,l=a.paginationGetPageSize?a.paginationGetPageSize():0);const p=e.node&&typeof e.node.rowIndex=="number"?e.node.rowIndex:0;return l?r*l+p+1:p+1}catch{return e.node&&typeof e.node.rowIndex=="number"?e.node.rowIndex+1:"-"}}},{headerName:"Kode",field:"kode",sortable:!0,width:120,valueFormatter:e=>e.value||"-"},{headerName:"Nama",field:"nama",sortable:!0,flex:1},{headerName:"Fundraiser",field:"pic",sortable:!0,flex:1,valueFormatter:e=>{var a,r;return((r=(a=e.data)==null?void 0:a.pic_user)==null?void 0:r.nama)||e.value||"-"}},{headerName:"Jenis Donatur",field:"jenis_donatur",sortable:!0,flex:1,valueFormatter:e=>{const a=e.value;return!a||a.length===0?"-":a.map(r=>r.replace("_"," ").replace(/\b\w/g,l=>l.toUpperCase())).join(", ")}},{headerName:"Kantor Cabang",field:"kantor_cabang",sortable:!0,flex:1,valueFormatter:e=>{var a;return((a=e.value)==null?void 0:a.nama)||"-"}},{headerName:"Mitra",field:"mitra",sortable:!0,flex:1,valueFormatter:e=>{var a;return((a=e.value)==null?void 0:a.nama)||"-"}},{headerName:"Status",field:"status",sortable:!0,width:120,cellRenderer:e=>{const a=e.value||"aktif",l={aktif:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",tidak_aktif:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400",pending:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400"}[a]||"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400",p=a.replace("_"," ").replace(/\b\w/g,C=>C.toUpperCase()),h=document.createElement("span");return h.className=`px-2 py-1 rounded-full text-xs font-medium ${l}`,h.textContent=p,h}},{headerName:"Tanggal",field:"tanggal_dibuat",sortable:!0,width:150,valueFormatter:e=>e.value?new Date(e.value).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric"}):"-"}];return(A.value||L.value)&&t.push({headerName:"Actions",field:"actions",sortable:!1,filter:!1,width:120,cellRenderer:e=>{const a=document.createElement("div");a.className="flex items-center gap-3";const r=document.createElement("button");r.className="flex items-center justify-center w-8 h-8 rounded-lg text-brand-500 hover:bg-brand-50 dark:hover:bg-brand-500/10 transition-colors",r.innerHTML=`
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
          </svg>
        `,r.onclick=()=>ee(e.data.id);const l=document.createElement("button");return l.className="flex items-center justify-center w-8 h-8 rounded-lg text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 transition-colors",l.innerHTML=`
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 6h18"></path>
            <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
            <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
            <line x1="10" y1="11" x2="10" y2="17"></line>
            <line x1="14" y1="11" x2="14" y2="17"></line>
          </svg>
        `,l.onclick=()=>ae(e.data.id),A.value&&a.appendChild(r),L.value&&a.appendChild(l),a}}),t}),Z={resizable:!0,sortable:!0,filter:!1},w=async()=>{j.value=!0;try{const t=new URLSearchParams;if(t.append("per_page","100"),x.value&&t.append("search",x.value),!f()&&z.value&&u.value&&u.value.id){const r=String(u.value.id);t.append("pic",r),m.value||(m.value=r)}else m.value&&t.append("pic",m.value);c.value&&c.value.length&&t.append("jenis_donatur",c.value.join(",")),b.value&&t.append("kantor_cabang_id",b.value),v.value&&t.append("mitra_id",v.value);const e=await fetch(`/admin/api/donatur?${t.toString()}`,{credentials:"same-origin"});if(!e.ok)throw new Error("Failed to fetch donatur");const a=await e.json();a.success&&(R.value=a.data||[])}catch{g.error("Gagal memuat data donatur")}finally{j.value=!1}},W=()=>{N&&clearTimeout(N),N=setTimeout(()=>{w()},300)},Y=()=>{if(!M.value){g.error("Anda tidak memiliki izin untuk membuat donatur");return}T.push("/user-kepegawaian/donatur/new")},ee=t=>{if(!A.value){g.error("Anda tidak memiliki izin untuk mengubah donatur");return}T.push(`/user-kepegawaian/donatur/${t}/edit`)},ae=t=>{k.value=t,_.value=!0},te=async()=>{if(k.value)try{const t=await fetch("/admin/api/csrf-token",{credentials:"same-origin"});if(!t.ok)throw new Error("Failed to fetch CSRF token");const e=await t.json(),r=await(await fetch(`/admin/api/donatur/${k.value}`,{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":e.csrf_token},credentials:"same-origin"})).json();r.success?(g.success(r.message||"Donatur berhasil dihapus"),w()):g.error(r.message||"Gagal menghapus donatur")}catch{g.error("Gagal menghapus donatur")}finally{_.value=!1,k.value=null}},re=()=>{_.value=!1,k.value=null},ne=()=>{x.value="",m.value="",c.value=[],b.value="",v.value="",w()},oe=t=>{if(t.includes(P)){c.value=[];return}c.value=t};me([m,c,b,v],()=>{w()},{deep:!0});const le=async()=>{var t,e,a;try{const r=(()=>{if(!u.value)return!1;const o=u.value.roles||(u.value.role?[u.value.role]:[]);return Array.isArray(o)&&o.some(s=>{const I=typeof s=="string"?s:s==null?void 0:s.name;return typeof I=="string"&&["admin","admin cabang"].includes(I.trim().toLowerCase())})})(),l=f()||r?"/admin/api/kantor-cabang?per_page=1000":"/admin/api/kantor-cabang?per_page=1000&only_assigned=1",[p,h,C]=await Promise.all([fetch(l,{credentials:"same-origin"}),fetch("/admin/api/karyawan?per_page=1000",{credentials:"same-origin"}),fetch("/admin/api/mitra?per_page=1000",{credentials:"same-origin"})]);if(p.ok){const o=await p.json();if(o.success){const s=Array.isArray(o.data)?o.data:(t=o.data)==null?void 0:t.data;E.value=Array.isArray(s)?s:[]}}if(h.ok){const o=await h.json();if(o.success){const s=Array.isArray(o.data)?o.data:(e=o.data)==null?void 0:e.data;O.value=Array.isArray(s)?s:[]}}if(C&&C.ok){const o=await C.json();if(o.success){const s=Array.isArray(o.data)?o.data:(a=o.data)==null?void 0:a.data;H.value=Array.isArray(s)?s:[]}}}catch{}};return pe(async()=>{await U(),await le(),await w()}),(t,e)=>(D(),ge(Ce,null,{default:fe(()=>[n("div",De,[n("div",Ae,[n("h3",je,be(G.value),1),M.value?(D(),V("button",{key:0,onClick:Y,class:"flex items-center gap-2 rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600"},[...e[5]||(e[5]=[n("svg",{class:"fill-current",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[n("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M10 3.33333C10.4602 3.33333 10.8333 3.70643 10.8333 4.16667V9.16667H15.8333C16.2936 9.16667 16.6667 9.53976 16.6667 10C16.6667 10.4602 16.2936 10.8333 15.8333 10.8333H10.8333V15.8333C10.8333 16.2936 10.4602 16.6667 10 16.6667C9.53976 16.6667 9.16667 16.2936 9.16667 15.8333V10.8333H4.16667C3.70643 10.8333 3.33333 10.4602 3.33333 10C3.33333 9.53976 3.70643 9.16667 4.16667 9.16667H9.16667V4.16667C9.16667 3.70643 9.53976 3.33333 10 3.33333Z",fill:"currentColor"})],-1),he(" Tambah Donatur ",-1)])])):ve("",!0)]),n("div",Ne,[n("div",Ve,[n("div",Fe,[e[6]||(e[6]=n("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Cari ",-1)),ye(n("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=a=>x.value=a),placeholder:"Cari nama, kode, email, no hp...",onInput:W,class:"h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,544),[[ke,x.value]])]),n("div",null,[e[7]||(e[7]=n("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"Fundraiser",-1)),y(F,{modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=a=>m.value=a),options:$.value,placeholder:"Semua Fundraiser"},null,8,["modelValue","options"])]),n("div",null,[e[8]||(e[8]=n("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"Mitra",-1)),y(F,{modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=a=>v.value=a),options:q.value,placeholder:"Semua Mitra"},null,8,["modelValue","options"])]),n("div",null,[e[9]||(e[9]=n("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"Jenis Donatur",-1)),y(_e,{modelValue:c.value,"onUpdate:modelValue":[e[3]||(e[3]=a=>c.value=a),oe],options:K.value,placeholder:"Semua Tipe"},null,8,["modelValue","options"])]),n("div",null,[e[10]||(e[10]=n("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"Kantor Cabang",-1)),y(F,{modelValue:b.value,"onUpdate:modelValue":e[4]||(e[4]=a=>b.value=a),options:Q.value,placeholder:"Semua Kantor"},null,8,["modelValue","options"])]),n("div",{class:"flex items-end md:col-span-2 xl:col-span-1"},[n("button",{onClick:ne,class:"h-11 rounded-lg border border-gray-300 bg-white px-6 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03]"}," Reset Filter ")])])]),j.value?(D(),V("div",Te,[...e[11]||(e[11]=[n("div",{class:"h-8 w-8 animate-spin rounded-full border-4 border-brand-500 border-t-transparent"},null,-1),n("span",{class:"ml-3 text-gray-600 dark:text-gray-400"},"Memuat data...",-1)])])):(D(),V("div",Me,[y(xe(we),{class:"ag-theme-alpine",style:{width:"100%"},columnDefs:X.value,rowData:R.value,defaultColDef:Z,pagination:!0,paginationPageSize:20,theme:"legacy",animateRows:!0,suppressHorizontalScroll:!0,domLayout:"autoHeight"},null,8,["columnDefs","rowData"])]))]),y(Se,{isOpen:_.value,title:"Hapus Donatur",message:"Apakah Anda yakin ingin menghapus donatur ini? Tindakan ini tidak dapat dibatalkan.",confirmText:"Hapus",confirmButtonClass:"bg-red-500 hover:bg-red-600",onConfirm:te,onCancel:re},null,8,["isOpen"])]),_:1}))}});export{Be as default};
