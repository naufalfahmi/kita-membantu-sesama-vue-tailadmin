import{d as R,I as F,M as S,b as d,A as u,Q as I,f as V,g as G,o as h,w as H,a as n,c as w,j as _,i as $,k as z,v as U,u as O,S as J}from"./admin-DFL5RsDl.js";import{_ as K}from"./AdminLayout.vue_vue_type_script_setup_true_lang-B5TcZt00.js";import{_ as Q}from"./ConfirmModal.vue_vue_type_script_setup_true_lang-DCzdNKUf.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";const q={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},W={class:"mb-6 flex items-center justify-between"},Y={class:"mb-6 rounded-lg border border-gray-200 bg-white p-4 dark:border-gray-800 dark:bg-white/[0.03]"},Z={class:"flex gap-4"},ee={class:"flex-1"},ae={key:0,class:"flex items-center justify-center py-12"},te={key:1,class:"ag-theme-alpine dark:ag-theme-alpine-dark w-full"},re=R({__name:"PayrollMitra",setup(ne){const y=F(),o=S(),{fetchUser:D,hasPermission:f,isAdmin:g}=I(),p=d(!1),l=d([]),s=d(""),c=d(!1),i=d(null);let v;const x=u(()=>g()||f("create payroll mitra")),b=u(()=>g()||f("update payroll mitra")),k=u(()=>g()||f("delete payroll mitra")),N=u(()=>{const r=[{headerName:"Nama Mitra",field:"nama_mitra",sortable:!0,flex:1},{headerName:"Program",valueGetter:e=>{var a,t;return((t=(a=e.data)==null?void 0:a.program)==null?void 0:t.nama_program)||"-"}},{headerName:"Tanggal Payroll",field:"payroll_date",width:150,valueFormatter:e=>{if(e.node&&e.node.rowPinned==="bottom")return"";if(!e.value)return"-";const a=new Date(e.value);return isNaN(a.getTime())?"-":a.toLocaleDateString("id-ID")}},{headerName:"Jumlah",field:"jumlah",width:140,valueFormatter:e=>e.value?Number(e.value).toLocaleString("id-ID"):"0"},{headerName:"Persentase",field:"persentase",width:120,valueFormatter:e=>e.node&&e.node.rowPinned==="bottom"?"":`${(Number(e.value)||0).toFixed(0)}%`},{headerName:"Total",field:"total",width:160,valueFormatter:e=>e.value?Number(e.value).toLocaleString("id-ID"):"0"}];return(b.value||k.value)&&r.push({headerName:"Actions",field:"actions",width:140,sortable:!1,filter:!1,pinned:"right",cellRenderer:e=>{if(e.node&&e.node.rowPinned==="bottom")return document.createElement("div");const a=document.createElement("div");if(a.className="flex items-center gap-3 h-full",b.value){const t=document.createElement("button");t.className="flex items-center justify-center w-8 h-8 rounded-lg text-brand-500 hover:bg-brand-50",t.innerHTML='<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></svg>',t.onclick=()=>B(e.data.id),a.appendChild(t)}if(k.value){const t=document.createElement("button");t.className="flex items-center justify-center w-8 h-8 rounded-lg text-red-500 hover:bg-red-50",t.innerHTML='<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>',t.onclick=()=>A(e.data.id),a.appendChild(t)}return a}}),r}),C={resizable:!0,sortable:!0,filter:!0},M=u(()=>{if(!l.value||l.value.length===0)return[];const r=l.value.reduce((a,t)=>a+(Number(t.jumlah)||0),0),e=l.value.reduce((a,t)=>a+(Number(t.total)||0),0);return[{nama_mitra:"Total",jumlah:r,total:e}]}),m=async()=>{p.value=!0;try{const r=new URLSearchParams({per_page:"1000"});s.value.trim()&&r.set("search",s.value.trim());const a=await(await fetch(`/admin/api/mitra-payroll?${r.toString()}`,{credentials:"same-origin"})).json();a.success?l.value=a.data:o.error(a.message||"Gagal memuat data")}catch{o.error("Gagal memuat data")}finally{p.value=!1}},T=()=>{v&&clearTimeout(v),v=setTimeout(m,300)},P=()=>{s.value="",m()},j=()=>{if(!x.value){o.error("Anda tidak memiliki izin untuk menambah data");return}y.push("/user-kepegawaian/payroll-mitra/new")},B=r=>{if(!b.value){o.error("Anda tidak memiliki izin untuk mengubah data");return}y.push(`/user-kepegawaian/payroll-mitra/${r}/edit`)},A=r=>{i.value=r,c.value=!0},E=async()=>{if(i.value)try{const r=await fetch("/admin/api/csrf-token",{credentials:"same-origin"}),{csrf_token:e}=await r.json(),t=await(await fetch(`/admin/api/mitra-payroll/${i.value}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":e},credentials:"same-origin"})).json();t.success?(o.success("Data berhasil dihapus"),m()):o.error(t.message||"Gagal menghapus data")}catch{o.error("Gagal menghapus data")}finally{c.value=!1,i.value=null}},L=()=>{c.value=!1,i.value=null};return V(()=>{D(),m()}),(r,e)=>(h(),G(K,null,{default:H(()=>[n("div",q,[n("div",W,[e[1]||(e[1]=n("h3",{class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},"Payroll Mitra",-1)),x.value?(h(),w("button",{key:0,onClick:j,class:"flex items-center gap-2 rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600"}," Tambah Payroll Mitra ")):$("",!0)]),n("div",Y,[n("div",Z,[n("div",ee,[e[2]||(e[2]=n("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"Cari",-1)),z(n("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>s.value=a),onInput:T,placeholder:"Cari nama mitra atau program...",class:"h-11 w-full rounded-lg border px-4 focus:outline-none focus:ring-2 focus:ring-brand-500 dark:bg-gray-900 dark:border-gray-700"},null,544),[[U,s.value]])]),n("div",{class:"flex items-end"},[n("button",{onClick:P,class:"h-11 rounded-lg border px-6 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors"}," Reset Filter ")])])]),p.value?(h(),w("div",ae,[...e[3]||(e[3]=[n("div",{class:"h-8 w-8 animate-spin rounded-full border-4 border-brand-500 border-t-transparent"},null,-1),n("span",{class:"ml-3 text-gray-600 dark:text-gray-400"},"Memuat data...",-1)])])):(h(),w("div",te,[_(O(J),{style:{width:"100%"},columnDefs:N.value,rowData:l.value,pinnedBottomRowData:M.value,defaultColDef:C,pagination:!0,paginationPageSize:20,animateRows:!0,domLayout:"autoHeight",class:"ag-theme-alpine"},null,8,["columnDefs","rowData","pinnedBottomRowData"])])),_(Q,{isOpen:c.value,title:"Hapus Payroll Mitra",message:"Apakah Anda yakin ingin menghapus data payroll mitra ini?",confirmText:"Hapus",confirmButtonClass:"bg-red-500 hover:bg-red-600",onConfirm:E,onCancel:L},null,8,["isOpen"])])]),_:1}))}}),de=X(re,[["__scopeId","data-v-8dfe5bc9"]]);export{de as default};
