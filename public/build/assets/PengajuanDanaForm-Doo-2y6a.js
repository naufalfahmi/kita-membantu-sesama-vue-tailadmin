import{d as _e,H as Se,I as je,M as Ie,A as D,b,e as ee,B as te,f as Te,V as Ce,g as ae,o as l,w as De,a as t,t as g,q as Ae,c as d,i as j,j as N,m as T,k as B,v as O,u as re,F as se,l as ne,n as Ne,Q as Re}from"./admin-BLTAyufb.js";import{C as oe}from"./component-z5TK2YpB.js";import{_ as Ve,g as Pe}from"./AdminLayout.vue_vue_type_script_setup_true_lang-l5AJ9B2_.js";import{S as P}from"./SearchableSelect-Pv4OVfU2.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Fe={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},Me={class:"mb-6 flex items-center justify-between"},$e={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},Ue={class:"grid grid-cols-1 gap-x-6 gap-y-5 lg:grid-cols-2"},Le={class:"lg:col-span-1"},Ee={class:"lg:col-span-1"},qe={key:0,class:"mt-1 text-xs text-blue-600 dark:text-blue-400 font-medium"},Be={class:"lg:col-span-1"},Oe={class:"flex items-center gap-2"},Xe={class:"flex-1"},He={key:0,class:"h-11 flex items-center rounded-lg border border-gray-300 bg-gray-50 px-4 text-sm text-gray-500 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400"},Ye={class:"lg:col-span-1"},Ke={class:"lg:col-span-1"},We={key:0,class:"h-11 flex items-center rounded-lg border border-gray-300 bg-transparent px-4 text-sm text-gray-700 dark:border-gray-700 dark:text-gray-400"},ze={key:1,class:"space-y-2"},Ge={class:"flex items-center gap-3"},Je={key:2},Qe={class:"lg:col-span-1"},Ze={class:"relative"},et={class:"absolute text-gray-500 -translate-y-1/2 pointer-events-none right-4 top-1/2 dark:text-gray-400 text-sm"},tt={key:0,class:"mt-1 text-xs text-red-500"},at={key:1,class:"mt-1 text-xs text-red-500"},rt={class:"lg:col-span-1"},st={class:"relative"},nt={class:"lg:col-span-1"},ot={class:"flex items-center gap-2"},it={key:0,class:"lg:col-span-2"},lt={key:0,class:"mt-3 rounded-lg border border-gray-200 bg-gray-50 p-3 text-sm text-gray-700 dark:border-gray-700 dark:bg-gray-900/40"},dt={key:1,class:"mt-3 rounded-lg border border-gray-200 bg-gray-50 p-3 text-sm text-gray-700 dark:border-gray-700 dark:bg-gray-900/40"},ut={class:"flex items-center justify-between"},mt={class:"text-lg font-medium"},gt={class:"text-right text-xs text-gray-500"},pt={key:0},ct={class:"flex flex-wrap justify-end gap-2"},yt={key:0},bt={key:1},ft={key:1,class:"text-xs"},xt={key:0,class:"mt-3 border-t pt-3"},vt={class:"flex items-center justify-between"},ht={class:"text-xs text-gray-500"},kt={key:0},wt={key:1},_t={class:"text-lg font-medium"},St={class:"text-right text-xs text-gray-500"},jt={class:"mt-3 flex items-center justify-between"},It={class:"flex items-center gap-3"},Tt={class:"mt-3 text-sm text-gray-700"},Ct={class:"font-medium"},Dt={key:0,class:"mt-1 text-xs text-red-500"},At={key:0,class:"mt-3 border-t pt-3"},Nt={class:"space-y-1 max-h-48 overflow-y-auto"},Rt={class:"font-medium"},Vt={class:"text-gray-600"},Pt={class:"lg:col-span-2"},Ft={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},Mt={class:"flex items-center gap-3 mt-6 lg:justify-end"},$t=["disabled"],Xt=_e({__name:"PengajuanDanaForm",setup(Ut){const F=Se(),X=je(),x=Ie(),{fetchUser:ie}=Re(),S=D(()=>F.params.id!==void 0&&F.params.id!=="new"),le=D(()=>S.value?"Edit Pengajuan Dana":"Tambah Pengajuan Dana"),de={dateFormat:"Y-m-d",altInput:!0,altFormat:"d F Y",locale:"id",wrap:!0,clickOpens:!0,allowInput:!1,minDate:"today"},ue={dateFormat:"Y-m-d",mode:"range",altInput:!0,altFormat:"d F Y",locale:"id",wrap:!0,clickOpens:!0,allowInput:!1},R=b([]),C=b([]),M=b([]),$=b([]),H=b(""),Y=b(""),K=b(""),L=b(!1),f=b([]),V=b(""),r=ee({applicant:"",submissionType:"",status:"Draft",programId:"",amount:null,usedAt:"",purpose:"",branchId:""}),W=ee({amount:""}),I=b(!1),U=D(()=>{if(!i||!i.value)return!1;const s=Number(i.value.remaining||0);return Number(r.amount||0)>s}),me=D(()=>!r.amount||r.amount<=0?"":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(r.amount)),i=b(null),v=b(null),A=b(!1);let E=null;const h=s=>!s||s<=0?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(s),z=b([]),ge=async()=>{try{const e=await(await fetch("/admin/api/program-share-types/submission-types",{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}})).json();e.success&&(z.value=e.data||[],C.value=(e.data||[]).map(n=>({value:n.value,label:n.label,share_key:n.share_key,name:n.name})))}catch(s){console.error("Failed to fetch submission types",s)}},pe=s=>{if(!s)return"";const e=s.toLowerCase(),n=z.value.find(a=>a.value.toLowerCase()===e);return n&&n.name?n.name:"Program"},ce=s=>{if(!s)return"";try{const e=String(s).split("-");if(e.length<2)return s;const n=Number(e[0]),a=Number(e[1])-1,o=new Date(Date.UTC(n,a,1));return new Intl.DateTimeFormat("id-ID",{month:"long",year:"numeric"}).format(o)}catch{return s}},G=s=>{if(!s)return"";try{const e=String(s).split("-");if(e.length<3)return s;const n=Number(e[0]),a=Number(e[1])-1,o=Number(e[2]),u=new Date(Date.UTC(n,a,o));return new Intl.DateTimeFormat("id-ID",{day:"numeric",month:"long",year:"numeric"}).format(u)}catch{return s}},ye=()=>{f.value=[],q()},be=D(()=>{if(!v.value||!Array.isArray(v.value.shares))return[];const s=C.value.find(u=>u.value===r.submissionType),e=(s==null?void 0:s.share_key)||"program",n=v.value.shares.map(u=>{var p;return{...u,program_share_type_key:u.program_share_type_key??u.type_key??((p=u.type)==null?void 0:p.key)??null}}),a=n.filter(u=>String(u.program_share_type_key)===e);if(a.length>0)return a;const o=n.filter(u=>String(u.program_share_type_key)==="program");return o.length>0?o:n}),q=async()=>{A.value=!0;try{const s=C.value.find(m=>m.value===r.submissionType),e=(s==null?void 0:s.share_key)||"program",n=r.submissionType;let a="",o=null,u=null;const p=m=>{if(!m)return[null,null];if(Array.isArray(m)&&m.length>=2){const c=y=>{if(!y)return null;if(typeof y=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(y))return y;const _=new Date(y);return isNaN(_.getTime())?null:_.toISOString().split("T")[0]};return[c(m[0]),c(m[1])]}if(typeof m=="string"){const c=Array.from(m.matchAll(/(\d{4}-\d{2}-\d{2})/g)).map(_=>_[1]);if(c.length>=2)return[c[0],c[1]];const y=m.split(/[^0-9-]+/).filter(Boolean);if(y.length>=2&&/^\d{4}-\d{2}-\d{2}$/.test(y[0])&&/^\d{4}-\d{2}-\d{2}$/.test(y[1]))return[y[0],y[1]]}try{const c=new Date(m);if(!isNaN(c.getTime())){const y=c.toISOString().split("T")[0];return[y,y]}}catch{}return[null,null]};if(f){const[m,c]=p(f.value);o=m,u=c}if(r.programId)if(o&&u)a=`/admin/api/program/${r.programId}/balance?start_date=${encodeURIComponent(o)}&end_date=${encodeURIComponent(u)}&alias=${encodeURIComponent(n)}`;else{const m=new Date(r.usedAt);if(isNaN(m.getTime())){i.value=null,A.value=!1;return}const c=`${m.getFullYear()}-${String(m.getMonth()+1).padStart(2,"0")}`;a=`/admin/api/program/${r.programId}/balance?month=${c}&alias=${encodeURIComponent(n)}&lookback=1`}else if(o&&u)a=`/admin/api/programs/aggregate-balance?start_date=${encodeURIComponent(o)}&end_date=${encodeURIComponent(u)}&alias=${encodeURIComponent(n)}`;else{const m=new Date(r.usedAt);if(isNaN(m.getTime())){i.value=null,A.value=!1;return}a=`/admin/api/programs/aggregate-balance?month=${`${m.getFullYear()}-${String(m.getMonth()+1).padStart(2,"0")}`}&alias=${encodeURIComponent(n)}`}const k=await(await fetch(a,{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest"}})).json();if(!k.success)throw new Error(k.message||"Failed to load balance");o&&u&&(k.data||(k.data={}),k.data.start_date||(k.data.start_date=o),k.data.end_date||(k.data.end_date=u)),i.value=k.data}catch(s){console.error("Error loading program balance",s),x.error("Gagal memuat saldo program"),i.value=null}finally{A.value=!1}},J=async()=>{if(!r.programId){v.value={nama_program:"Semua Program",shares:[]};return}try{const e=await(await fetch(`/admin/api/program/${r.programId}`,{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest"}})).json();if(!e.success)throw new Error(e.message||"Failed to load program");v.value=e.data}catch(s){console.error("Error loading program detail",s),v.value=null}};te([()=>r.programId,()=>r.usedAt,()=>f.value],()=>{E&&window.clearTimeout(E),E=window.setTimeout(()=>{J(),q()},300)}),te(()=>r.submissionType,s=>{const e=String(s);S.value||(r.amount=null),C.value.some(n=>n.value===e)?(J(),q()):(v.value=null,i.value=null)});const fe=s=>{const e=s.target,n=parseFloat(e.value);isNaN(n)||n<0?r.amount=null:r.amount=Math.floor(n)},xe=async()=>{if(!S.value)return;const s=F.params.id;try{const n=await(await fetch(`/admin/api/pengajuan-dana/${s}`,{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest"}})).json();if(!n.success)throw new Error(n.message||"Failed to load");const a=n.data;if(r.applicant=a.fundraiser?String(a.fundraiser.id):"",r.status=a.status||"Draft",a.fundraiser&&!R.value.find(o=>o.value===String(a.fundraiser.id))&&R.value.unshift({value:String(a.fundraiser.id),label:a.fundraiser.name||a.fundraiser.nama||""}),r.submissionType=a.submission_type,a.submission_type&&!C.value.find(o=>o.value===a.submission_type)&&C.value.unshift({value:a.submission_type,label:a.submission_type,share_key:""}),r.amount=a.amount,a.used_at){const o=String(a.used_at).split(" ")[0];r.usedAt=o}if(r.purpose=a.purpose||"",r.branchId=a.kantor_cabang?a.kantor_cabang.id:"",r.programId=a.program?String(a.program.id):"",a.kantor_cabang&&!M.value.find(o=>o.value===String(a.kantor_cabang.id))&&M.value.unshift({value:String(a.kantor_cabang.id),label:a.kantor_cabang.nama||""}),a.program&&!$.value.find(o=>o.value===String(a.program.id))){const o=a.program.nama_program||a.program.nama||"";$.value.unshift({value:String(a.program.id),label:o})}}catch(e){console.error("Error loading data:",e),x.error("Gagal memuat data pengajuan dana")}},ve=async()=>{L.value=!0;try{const s=await ie();V.value=s!=null&&s.id?String(s.id):"";const n=await(await fetch("/admin/api/pengajuan-dana/options",{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest"}})).json();if(!n.success)throw new Error(n.message||"Failed to load options");const a=n.data.users||[];R.value=a.map(p=>({value:String(p.id),label:p.name}));const o=n.data.kantor_cabangs||[];M.value=o.map(p=>({value:String(p.id),label:p.nama}));const u=n.data.programs||[];$.value=u.map(p=>({value:String(p.id),label:p.nama})),V.value&&R.value.find(w=>w.value===String(V.value))&&!r.applicant&&(r.applicant=String(V.value)),S.value&&n.data&&n.data.current&&n.data.current.program&&(r.programId=String(n.data.current.program.id))}catch(s){console.error("Error loading options",s),x.error("Gagal memuat opsi form")}finally{L.value=!1}},he=[{value:"Draft",label:"Draft"},{value:"Pending",label:"Diajukan"}];D(()=>String(r.applicant)===String(V.value));const ke=D(()=>he),Q=()=>X.push("/keuangan/pengajuan-dana"),we=async()=>{var s;if(!r.applicant){x.error("Pengaju wajib diisi");return}if(!r.submissionType){x.error("Tipe Pengajuan wajib diisi");return}if(!r.amount||r.amount<=0){x.error("Nominal wajib diisi dan harus lebih dari 0");return}if(!r.usedAt){x.error("Tanggal Digunakan wajib diisi");return}if(!r.branchId){x.error("Kantor Cabang wajib diisi");return}if(!I.value){I.value=!0;try{if(U.value){const w=h(Number(((s=i.value)==null?void 0:s.remaining)||0));x.error(`nominal melebihi batas tidak dapat menyimpan — sisa alokasi: ${w}`),I.value=!1;return}const e={fundraiser_id:r.applicant,submission_type:r.submissionType,program_id:r.programId||null,status:r.status,amount:r.amount,used_at:r.usedAt,purpose:r.purpose,kantor_cabang_id:r.branchId};if(f&&Array.isArray(f.value)&&f.value.length>=2){const w=_=>{if(!_)return null;if(typeof _=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(_))return _;const Z=new Date(_);return isNaN(Z.getTime())?null:Z.toISOString().split("T")[0]},[k,m]=f.value,c=w(k),y=w(m);c&&y&&(e.start_date=c,e.end_date=y)}const n=await Pe(),a=S.value?`/admin/api/pengajuan-dana/${F.params.id}`:"/admin/api/pengajuan-dana",o=S.value?"PUT":"POST",p=await(await fetch(a,{method:o,credentials:"same-origin",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":n,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(e)})).json();if(!p.success){if(p.remaining!==void 0){x.error(`nominal melebihi batas tidak dapat menyimpan — sisa alokasi: ${h(Number(p.remaining))}`),I.value=!1;return}if(p.errors){const w=Object.values(p.errors)[0];x.error(w?String(w[0]):"Validation failed"),I.value=!1;return}throw new Error(p.message||"Failed to save")}x.success(S.value?"Pengajuan dana berhasil diupdate":"Pengajuan dana berhasil ditambahkan"),X.push("/keuangan/pengajuan-dana")}catch(e){console.error("Error saving:",e),x.error("Terjadi kesalahan saat menyimpan data")}finally{I.value=!1}}};return Te(async()=>{if(await ge(),await ve(),await Ce(),S.value)await xe();else{const s=new Date().toISOString().split("T")[0];(!r.usedAt||String(r.usedAt).trim()==="")&&(r.usedAt=s)}}),(s,e)=>(l(),ae(Ve,null,{default:De(()=>{var n;return[t("div",Fe,[t("div",Me,[t("h3",$e,g(le.value),1),t("button",{onClick:Q,class:"flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03]"},"Batal")]),t("form",{onSubmit:Ae(we,["prevent"]),class:"flex flex-col"},[t("div",Ue,[t("div",Le,[e[17]||(e[17]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[T("Pengaju "),t("span",{class:"text-red-500"},"*")],-1)),N(P,{modelValue:r.applicant,"onUpdate:modelValue":e[0]||(e[0]=a=>r.applicant=a),options:R.value,placeholder:"Pilih atau cari pengaju","search-input":H.value,"onUpdate:searchInput":e[1]||(e[1]=a=>H.value=a)},null,8,["modelValue","options","search-input"])]),t("div",Ee,[e[18]||(e[18]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[T("Tipe POS "),t("span",{class:"text-red-500"},"*")],-1)),N(P,{modelValue:r.submissionType,"onUpdate:modelValue":e[2]||(e[2]=a=>r.submissionType=a),options:C.value,placeholder:"Pilih tipe pos","search-input":Y.value,"onUpdate:searchInput":e[3]||(e[3]=a=>Y.value=a)},null,8,["modelValue","options","search-input"]),r.submissionType?(l(),d("p",qe,g(r.submissionType)+" = "+g(pe(r.submissionType)),1)):j("",!0)]),t("div",Be,[e[21]||(e[21]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"Dana Salur",-1)),t("div",Oe,[t("div",Xe,[L.value?(l(),d("div",He,[...e[19]||(e[19]=[t("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-gray-500 dark:text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),T(" Memuat data program... ",-1)])])):(l(),ae(P,{key:1,modelValue:r.programId,"onUpdate:modelValue":e[4]||(e[4]=a=>r.programId=a),options:$.value,placeholder:"Pilih program"},null,8,["modelValue","options"]))]),r.programId?(l(),d("button",{key:0,type:"button",title:"Hapus pilihan program",onClick:e[5]||(e[5]=a=>r.programId=""),class:"h-11 w-11 flex items-center justify-center rounded-lg border border-gray-300 bg-white text-sm text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700"},[...e[20]||(e[20]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M18 6L6 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("path",{d:"M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])):j("",!0)])]),t("div",Ye,[e[22]||(e[22]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[T("Kantor "),t("span",{class:"text-red-500"},"*")],-1)),N(P,{modelValue:r.branchId,"onUpdate:modelValue":e[6]||(e[6]=a=>r.branchId=a),options:M.value,placeholder:"Pilih atau cari kantor cabang","search-input":K.value,"onUpdate:searchInput":e[7]||(e[7]=a=>K.value=a)},null,8,["modelValue","options","search-input"])]),t("div",Ke,[e[25]||(e[25]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[T("Status "),t("span",{class:"text-red-500"},"*")],-1)),r.status==="Approved"?(l(),d("div",We,[e[23]||(e[23]=t("span",{class:"flex-1"},"Disetujui",-1)),B(t("input",{type:"hidden","onUpdate:modelValue":e[8]||(e[8]=a=>r.status=a)},null,512),[[O,r.status]])])):r.status==="Rejected"?(l(),d("div",ze,[e[24]||(e[24]=t("div",{class:"rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-700 dark:border-red-800 dark:bg-red-900/10 dark:text-red-300"},[t("div",{class:"font-medium"},"Pengajuan ditolak"),t("div",{class:"text-xs"},"Anda dapat mengajukan ulang jika diperlukan.")],-1)),t("div",Ge,[t("button",{type:"button",onClick:e[9]||(e[9]=()=>{r.status="Pending"}),class:"rounded bg-brand-500 px-3 py-1 text-sm text-white"},"Ajukan lagi"),t("button",{type:"button",onClick:e[10]||(e[10]=()=>{r.status="Draft"}),class:"rounded bg-gray-100 px-3 py-1 text-sm"},"Simpan sebagai Draft")])])):(l(),d("div",Je,[N(P,{modelValue:r.status,"onUpdate:modelValue":e[11]||(e[11]=a=>r.status=a),options:ke.value,placeholder:"Pilih status"},null,8,["modelValue","options"])]))]),t("div",Qe,[e[26]||(e[26]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[T("Nominal "),t("span",{class:"text-red-500"},"*")],-1)),t("div",Ze,[B(t("input",{type:"number","onUpdate:modelValue":e[12]||(e[12]=a=>r.amount=a),placeholder:"Masukkan nominal",min:"1",step:"1",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 pr-24 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",onInput:fe},null,544),[[O,r.amount,void 0,{number:!0}]]),t("span",et,g(me.value),1)]),e[27]||(e[27]=t("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},"Minimal nominal: Rp 1",-1)),U.value?(l(),d("p",tt,"Nominal melebihi sisa alokasi: "+g(h(((n=i.value)==null?void 0:n.remaining)||0)),1)):W.amount?(l(),d("p",at,g(W.amount),1)):j("",!0)]),t("div",rt,[e[28]||(e[28]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[T("Tanggal Digunakan "),t("span",{class:"text-red-500"},"*")],-1)),t("div",st,[N(re(oe),{modelValue:r.usedAt,"onUpdate:modelValue":e[13]||(e[13]=a=>r.usedAt=a),config:de,class:"dark:bg-dark-900 h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 pl-4 pr-11 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",placeholder:"Pilih tanggal digunakan",required:""},null,8,["modelValue"])])]),t("div",nt,[e[30]||(e[30]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"Rentang Tanggal Transaksi (opsional)",-1)),t("div",ot,[N(re(oe),{modelValue:f.value,"onUpdate:modelValue":e[14]||(e[14]=a=>f.value=a),config:ue,class:"dark:bg-dark-900 h-10 flex-1 appearance-none rounded-lg border border-gray-300 bg-transparent px-3 py-2 text-sm text-gray-800 placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90",placeholder:"Pilih rentang tanggal"},null,8,["modelValue"]),Array.isArray(f.value)&&f.value.length>0||f.value&&String(f.value).length>0?(l(),d("button",{key:0,type:"button",title:"Hapus Leader",onClick:ye,class:"h-10 w-10 flex items-center justify-center rounded-lg border border-gray-300 bg-white text-sm text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300"},[...e[29]||(e[29]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M18 6L6 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("path",{d:"M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])):j("",!0)])]),v.value||A.value?(l(),d("div",it,[A.value?(l(),d("div",lt,[...e[31]||(e[31]=[t("div",{class:"flex items-center justify-center py-8"},[t("svg",{class:"animate-spin h-8 w-8 text-brand-500 dark:text-brand-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),t("span",{class:"ml-3 text-gray-600 dark:text-gray-400"},"Memuat detail program...")],-1)])])):v.value?(l(),d("div",dt,[t("div",ut,[t("div",null,[e[32]||(e[32]=t("div",{class:"text-xs text-gray-500"},"Program",-1)),t("div",mt,g(v.value.nama_program||v.value.nama||""),1)]),t("div",gt,[v.value&&Array.isArray(v.value.shares)?(l(),d("div",pt,[t("div",ct,[(l(!0),d(se,null,ne(be.value,a=>(l(),d("span",{key:a.id||a.share_id||a.program_share_id,class:"inline-flex items-center rounded px-2 py-0.5 bg-gray-100 text-xs text-gray-700 dark:bg-gray-800/40 dark:text-gray-300"},[a.type==="percentage"||a.type_key&&String(a.type_key).toLowerCase().includes("percent")?(l(),d("span",yt,g(Number(a.value||0))+"% ",1)):(l(),d("span",bt,g(h(Number(a.value||0))),1))]))),128))])])):(l(),d("div",ft," "))])]),i.value?(l(),d("div",xt,[t("div",vt,[t("div",null,[t("div",ht,[i.value.start_date&&i.value.end_date?(l(),d("span",kt,"Sisa alokasi "+g(G(i.value.start_date))+" - "+g(G(i.value.end_date)),1)):(l(),d("span",wt,"Sisa alokasi bulan "+g(ce(i.value.month)),1))]),t("div",_t,g(h(i.value.remaining)),1)]),t("div",St,[t("div",null,"Inflow: "+g(h(i.value.inflow)),1),t("div",null,"Dialokasikan: "+g(h(i.value.allocated)),1),t("div",null,"Terpakai: "+g(h(i.value.outflow)),1)])]),t("div",jt,[e[33]||(e[33]=t("div",{class:"text-sm text-gray-600"},"Opsi:",-1)),t("div",It,[t("button",{type:"button",onClick:e[15]||(e[15]=()=>{r.amount=i.value.remaining}),class:"rounded bg-gray-100 px-3 py-1 text-sm"},"Gunakan Seluruh Alokasi")])]),t("div",Tt,[t("div",null,[e[34]||(e[34]=T("Estimasi sisa setelah pengajuan: ",-1)),t("span",Ct,g(h((i.value.remaining||0)-(r.amount||0))),1)]),(r.amount||0)>(i.value.remaining||0)?(l(),d("div",Dt,"Kekurangan: "+g(h((r.amount||0)-(i.value.remaining||0))),1)):j("",!0)]),i.value.program_breakdown&&i.value.program_breakdown.length>0?(l(),d("div",At,[e[35]||(e[35]=t("div",{class:"text-sm font-medium text-gray-700 mb-2"},"Detail Program:",-1)),t("div",Nt,[(l(!0),d(se,null,ne(i.value.program_breakdown,a=>(l(),d("div",{key:a.program_id,class:"flex items-center justify-between text-xs bg-gray-50 dark:bg-gray-800/20 rounded px-2 py-1"},[t("div",Rt,g(a.program_name),1),t("div",Vt,g(h(a.remaining)),1)]))),128))])])):j("",!0)])):j("",!0)])):j("",!0)])):j("",!0),t("div",Pt,[e[36]||(e[36]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"Tujuan Pengajuan",-1)),B(t("textarea",{"onUpdate:modelValue":e[16]||(e[16]=a=>r.purpose=a),placeholder:"Masukkan tujuan atau alasan pengajuan dana",maxlength:"1000",rows:"4",class:"dark:bg-dark-900 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[O,r.purpose]]),t("p",Ft,g(r.purpose.length)+"/1000 karakter",1)])]),t("div",Mt,[t("button",{onClick:Q,type:"button",class:"flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] sm:w-auto"},"Batal"),t("button",{disabled:I.value||U.value,type:"submit",class:Ne(["flex w-full justify-center rounded-lg px-4 py-2.5 text-sm font-medium sm:w-auto",I.value||U.value?"bg-gray-300 text-gray-600 cursor-not-allowed":"bg-brand-500 text-white hover:bg-brand-600"])},g(S.value?"Simpan Perubahan":"Simpan"),11,$t)])],32)])]}),_:1}))}});export{Xt as default};
