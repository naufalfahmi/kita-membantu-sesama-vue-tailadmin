import{d as G,H as X,I as $,A as w,b as c,e as z,L as H,f as O,B as W,g as S,o as y,w as J,a as r,t as k,q as Q,m as p,k as l,v as i,O as Y,c as j,u as v,F as P,i as Z,l as aa}from"./admin-tlO3s9ed.js";import{_ as ea}from"./AdminLayout.vue_vue_type_script_setup_true_lang-bqsSe-JG.js";import{S as ra}from"./SearchableSelect-CKa0t9mK.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ta={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},na={class:"mb-6 flex items-center justify-between"},oa={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},sa={class:"grid grid-cols-1 gap-x-6 gap-y-5 lg:grid-cols-2"},da={class:"lg:col-span-1"},la={class:"relative"},ia={class:"absolute text-gray-500 -translate-y-1/2 pointer-events-none right-4 top-1/2 dark:text-gray-400 text-sm"},ua={class:"lg:col-span-1"},pa={class:"lg:col-span-1"},ga={class:"mt-2 text-sm text-gray-600"},ca={class:"font-medium"},ma={class:"font-medium"},ba={class:"lg:col-span-1"},ya={class:"lg:col-span-1"},ka={class:"lg:col-span-1"},xa={class:"lg:col-span-1"},fa={class:"lg:col-span-1"},ha={class:"lg:col-span-1"},va={class:"lg:col-span-2"},wa={class:"lg:col-span-2"},ja={class:"lg:col-span-1"},Ma=["value"],Ca={class:"lg:col-span-2"},Ia={class:"space-y-4"},_a={class:"relative"},Fa={key:0,class:"space-y-2"},Ta={class:"flex items-center gap-3"},Sa={class:"text-sm font-medium text-gray-800 dark:text-white/90"},Pa={class:"text-xs text-gray-500 dark:text-gray-400"},Va=["onClick"],Ra=G({__name:"PenyaluranForm",setup(Ua){const m=X(),M=$(),x=w(()=>m.params.id!==void 0&&m.params.id!=="new"),V=w(()=>x.value?"Edit Penyaluran":"Buat Penyaluran"),I=c([]),U=async()=>{try{const n=await fetch("/admin/api/kantor-cabang?per_page=1000",{credentials:"same-origin"});if(!n.ok)return;const a=await n.json(),s=a.success&&a.data?Array.isArray(a.data)?a.data:a.data.data||[]:[];I.value=s.map(o=>({value:o.id,label:o.nama}))}catch(n){console.error("Failed to fetch kantor cabang options",n)}};c("");const _=c(""),b=c(null),B=async()=>{var n,a,s;try{const o=await fetch("/admin/api/user",{credentials:"same-origin"});if(o.ok){const d=await o.json();d.success&&d.user&&(b.value=d.user,(a=(n=b.value)==null?void 0:n.kantor_cabang)!=null&&a.id&&(e.branchId=String(b.value.kantor_cabang.id)),(s=b.value)!=null&&s.is_admin&&await U())}}catch(o){console.error("Failed to fetch current user",o)}},C=c(null),f=c([]),e=z({amount:null,program:"",submissionType:"program",pic:"",village:"",district:"",city:"",province:"",postalCode:"",address:"",report:"",branchId:"",pengajuanId:""}),h=c(0),D=w(()=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(h.value||0)),K=w(()=>{const n=Number(e.amount||0);return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(n)}),F=async n=>{try{if(!n){h.value=0;return}const s=await(await fetch(`/admin/api/penyaluran/my-credit?type=${encodeURIComponent(n)}`,{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest"}})).json();s&&s.success&&s.data&&typeof s.data.remaining<"u"?h.value=Number(s.data.remaining)||0:h.value=0}catch(a){console.error("Failed to load credit total for type",n,a),h.value=0}},N=n=>{const a=n.target;if(a.files){const s=Array.from(a.files),o=20*1024*1024,d=[],t=[];s.forEach(u=>{u.size>o?t.push(u.name):d.push(u)}),t.length>0&&alert(`File berikut melebihi 20MB: ${t.join(", ")}`),f.value.push(...d),C.value&&(C.value.value="")}},R=n=>{f.value.splice(n,1)},E=n=>{if(n===0)return"0 Bytes";const a=1024,s=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(n)/Math.log(a));return Math.round(n/Math.pow(a,o)*100)/100+" "+s[o]},q=async()=>{var n,a;if(x.value&&m.params.id){const s=m.params.id;try{const o=await fetch(`/admin/api/penyaluran/${s}`,{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest"}});if(!o.ok)throw new Error("Failed to fetch penyaluran");const d=await o.json();if(!d.success||!d.data){console.error("Penyaluran tidak ditemukan");return}const t=d.data;e.amount=t.amount!=null?Number(t.amount):e.amount,e.program=t.program_name||t.pengajuan&&(((n=t.pengajuan.program)==null?void 0:n.nama_program)||((a=t.pengajuan.program)==null?void 0:a.nama))||e.program,e.pic=t.pic||(t.pengajuan&&t.pengajuan.fundraiser?t.pengajuan.fundraiser.name:e.pic),e.village=t.village||t.kelurahan||e.village,e.district=t.district||t.kecamatan||e.district,e.city=t.city||t.kota||e.city,e.province=t.province||e.province,e.postalCode=t.postal_code||e.postalCode,e.address=t.address||e.address,e.report=t.report||e.report,e.branchId=t.kantor_cabang_id||t.kantor_cabang&&t.kantor_cabang.id||e.branchId,e.pengajuanId=t.pengajuan_dana_id||e.pengajuanId}catch(o){console.error("Error loading penyaluran",o)}}},T=()=>{M.push("/keuangan/penyaluran")},g=H(),L=async()=>{var n;if(!e.amount){g.error("Nominal wajib diisi");return}if(!e.program){g.error("Program wajib diisi");return}if(!e.pic){g.error("PIC wajib diisi");return}if(!e.branchId){g.error("Kantor Cabang wajib diisi");return}try{const a=new FormData;a.append("amount",String(e.amount||"0")),e.pengajuanId&&a.append("pengajuan_dana_id",String(e.pengajuanId)),e.submissionType&&a.append("submission_type",String(e.submissionType)),a.append("program_name",e.program||""),a.append("pic",e.pic||""),a.append("village",e.village||""),a.append("district",e.district||""),a.append("city",e.city||""),a.append("province",e.province||""),a.append("postal_code",e.postalCode||""),a.append("address",e.address||""),a.append("report",e.report||""),a.append("kantor_cabang_id",e.branchId||""),f.value.forEach(u=>{a.append("images[]",u)});const s=((n=document.querySelector('meta[name="csrf-token"]'))==null?void 0:n.getAttribute("content"))||"",o=x.value?`/admin/api/penyaluran/${m.params.id}`:"/admin/api/penyaluran";x.value&&a.append("_method","PUT");const t=await(await fetch(o,{method:"POST",body:a,credentials:"same-origin",headers:{"X-CSRF-TOKEN":s}})).json();if(!t.success)g.error(t.message||"Gagal menyimpan penyaluran");else{g.success(x.value?"Penyaluran berhasil diupdate":"Penyaluran berhasil dibuat");try{await M.push("/keuangan/penyaluran"),window.dispatchEvent(new CustomEvent("penyaluran:changed"));return}catch{M.push("/keuangan/penyaluran");try{window.dispatchEvent(new CustomEvent("penyaluran:changed"))}catch{}}}}catch(a){console.error("Error saving:",a),g.error("Terjadi kesalahan saat menyimpan data")}};return O(async()=>{await B();const n=m.query.pengajuan_id;if(n)try{const s=await(await fetch(`/admin/api/pengajuan-dana/${n}`,{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest"}})).json();if(s.success&&s.data){const o=s.data;e.pengajuanId=String(n),e.submissionType=o.submission_type||e.submissionType,e.program=o.program&&(o.program.nama||o.program.nama_program)||e.program,e.pic=o.fundraiser?o.fundraiser.name:e.pic,e.amount=typeof o.amount<"u"&&o.amount!==null?Number(o.amount):e.amount,e.report=o.purpose||e.report}}catch(a){console.error("Failed to load pengajuan",a)}q(),F(e.submissionType)}),W(()=>e.submissionType,n=>{F(String(n||""))}),(n,a)=>(y(),S(ea,null,{default:J(()=>{var s,o,d;return[r("div",ta,[r("div",na,[r("h3",oa,k(V.value),1),r("button",{onClick:T,class:"flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03]"}," Kembali ")]),r("form",{onSubmit:Q(L,["prevent"]),class:"flex flex-col"},[r("div",sa,[r("div",da,[a[14]||(a[14]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[p(" Nominal "),r("span",{class:"text-red-500"},"*")],-1)),r("div",la,[l(r("input",{type:"number","onUpdate:modelValue":a[0]||(a[0]=t=>e.amount=t),placeholder:"Masukkan nominal",min:"1",step:"1",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 pr-24 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[i,e.amount,void 0,{number:!0}]]),r("span",ia,k(K.value),1)])]),r("div",ua,[a[15]||(a[15]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[p(" Nama Penyaluran "),r("span",{class:"text-red-500"},"*")],-1)),l(r("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=t=>e.program=t),placeholder:"Masukkan nama program atau tahapannya",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[i,e.program]])]),r("div",pa,[a[19]||(a[19]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[p("Tipe Penyaluran "),r("span",{class:"text-red-500"},"*")],-1)),l(r("select",{"onUpdate:modelValue":a[2]||(a[2]=t=>e.submissionType=t),class:"h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800"},[...a[16]||(a[16]=[r("option",{value:"program"},"Program",-1),r("option",{value:"operasional"},"Operasional",-1),r("option",{value:"gaji karyawan"},"Gaji Karyawan",-1)])],512),[[Y,e.submissionType]]),r("p",ga,[a[17]||(a[17]=p("Sisa kredit untuk ",-1)),r("span",ca,k(e.submissionType),1),a[18]||(a[18]=p(": ",-1)),r("span",ma,k(D.value),1)])]),r("div",ba,[a[20]||(a[20]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[p(" PIC "),r("span",{class:"text-red-500"},"*")],-1)),l(r("input",{type:"text","onUpdate:modelValue":a[3]||(a[3]=t=>e.pic=t),placeholder:"Masukkan penanggung jawab penyaluran",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[i,e.pic]])]),r("div",ya,[a[21]||(a[21]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kelurahan ",-1)),l(r("input",{type:"text","onUpdate:modelValue":a[4]||(a[4]=t=>e.village=t),placeholder:"Masukkan kelurahan",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[i,e.village]])]),r("div",ka,[a[22]||(a[22]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kecamatan ",-1)),l(r("input",{type:"text","onUpdate:modelValue":a[5]||(a[5]=t=>e.district=t),placeholder:"Masukkan kecamatan",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[i,e.district]])]),r("div",xa,[a[23]||(a[23]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kota ",-1)),l(r("input",{type:"text","onUpdate:modelValue":a[6]||(a[6]=t=>e.city=t),placeholder:"Masukkan kota",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[i,e.city]])]),r("div",fa,[a[24]||(a[24]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Provinsi ",-1)),l(r("input",{type:"text","onUpdate:modelValue":a[7]||(a[7]=t=>e.province=t),placeholder:"Masukkan provinsi",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[i,e.province]])]),r("div",ha,[a[25]||(a[25]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kode Pos ",-1)),l(r("input",{type:"text","onUpdate:modelValue":a[8]||(a[8]=t=>e.postalCode=t),placeholder:"Masukkan kode pos",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[i,e.postalCode]])]),r("div",va,[a[26]||(a[26]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Alamat ",-1)),l(r("textarea",{"onUpdate:modelValue":a[9]||(a[9]=t=>e.address=t),placeholder:"Masukkan detail alamat lengkap",rows:"3",class:"dark:bg-dark-900 h-auto w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[i,e.address]])]),r("div",wa,[a[27]||(a[27]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Laporan ",-1)),l(r("textarea",{"onUpdate:modelValue":a[10]||(a[10]=t=>e.report=t),placeholder:"Masukkan catatan laporan hasil penyaluran",rows:"4",class:"dark:bg-dark-900 h-auto w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[i,e.report]])]),r("div",ja,[a[28]||(a[28]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[p(" Kantor Cabang "),r("span",{class:"text-red-500"},"*")],-1)),(s=v(b))!=null&&s.is_admin?(y(),S(ra,{key:0,modelValue:e.branchId,"onUpdate:modelValue":a[11]||(a[11]=t=>e.branchId=t),options:I.value,placeholder:"Pilih atau cari kantor cabang","search-input":v(_),"onUpdate:searchInput":a[12]||(a[12]=t=>_.value=t)},null,8,["modelValue","options","search-input"])):(y(),j(P,{key:1},[r("input",{type:"text",value:((d=(o=v(b))==null?void 0:o.kantor_cabang)==null?void 0:d.nama)||"",placeholder:"Kantor cabang Anda",readonly:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:outline-none dark:border-gray-700 dark:bg-gray-900/50 dark:text-white/90"},null,8,Ma),l(r("input",{type:"hidden","onUpdate:modelValue":a[13]||(a[13]=t=>e.branchId=t)},null,512),[[i,e.branchId]])],64))]),r("div",Ca,[a[32]||(a[32]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Gambar Dokumentasi ",-1)),r("div",Ia,[r("div",_a,[r("input",{type:"file",ref_key:"fileInputRef",ref:C,onChange:N,multiple:"",accept:"image/*",class:"hidden",id:"image-upload"},null,544),a[29]||(a[29]=r("label",{for:"image-upload",class:"flex cursor-pointer items-center justify-center rounded-lg border-2 border-dashed border-gray-300 bg-gray-50 px-6 py-8 text-center transition-colors hover:border-brand-300 hover:bg-gray-100 dark:border-gray-700 dark:bg-gray-900/50 dark:hover:border-brand-500"},[r("div",{class:"text-center"},[r("svg",{class:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})]),r("p",{class:"mt-2 text-sm text-gray-600 dark:text-gray-400"},[r("span",{class:"font-medium text-brand-500"},"Klik untuk upload"),p(" atau drag and drop ")]),r("p",{class:"text-xs text-gray-500 dark:text-gray-500"}," PNG, JPG, GIF hingga 20MB (Multiple files) ")])],-1))]),v(f).length>0?(y(),j("div",Fa,[(y(!0),j(P,null,aa(v(f),(t,u)=>(y(),j("div",{key:u,class:"flex items-center justify-between rounded-lg border border-gray-200 bg-white p-3 dark:border-gray-700 dark:bg-gray-900/50"},[r("div",Ta,[a[30]||(a[30]=r("div",{class:"flex h-10 w-10 items-center justify-center rounded bg-gray-100 dark:bg-gray-800"},[r("svg",{class:"h-6 w-6 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1)),r("div",null,[r("p",Sa,k(t.name),1),r("p",Pa,k(E(t.size)),1)])]),r("button",{type:"button",onClick:A=>R(u),class:"rounded-lg p-1 text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10"},[...a[31]||(a[31]=[r("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Va)]))),128))])):Z("",!0)])])]),r("div",{class:"flex items-center gap-3 mt-6 lg:justify-end"},[r("button",{onClick:T,type:"button",class:"flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] sm:w-auto"}," Kembali "),a[33]||(a[33]=r("button",{type:"submit",class:"flex w-full justify-center rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600 sm:w-auto"}," Buat ",-1))])],32)])]}),_:1}))}});export{Ra as default};
