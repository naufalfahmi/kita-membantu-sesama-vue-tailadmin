import{g as J,H as Y,I as X,A as B,r as b,i as q,o as Z,L as M,y as ee,c as te,a as c,w as ae,f as L,b as t,t as p,p as re,j as se,l as y,n as j,v as oe,d as g,e as v,F as H,k as U}from"./admin-DnBK--6g.js";import{_ as ne}from"./AdminLayout.vue_vue_type_script_setup_true_lang-CCnFo6di.js";import{_ as ie}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-BLF3_Tpt.js";import{S as F}from"./SearchableSelect-CKOHhdMO.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const le={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},de={class:"mb-6 flex items-center justify-between"},ce={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},ue={class:"grid grid-cols-1 gap-x-6 gap-y-5 lg:grid-cols-2"},ge={class:"lg:col-span-2"},me={class:"mt-1 flex items-center justify-between"},pe={key:0,class:"text-xs text-red-500"},he={key:1,class:"text-xs text-gray-500 dark:text-gray-400"},be={class:"text-xs text-gray-500 dark:text-gray-400"},ke={class:"lg:col-span-1"},fe={key:0,class:"mt-1 block text-xs text-red-500"},xe={class:"lg:col-span-1"},ye={class:"lg:col-span-2"},ve={class:"space-y-4"},we={class:"relative"},_e=["disabled"],Me={class:"text-center"},Le={key:0,class:"mt-1 text-xs text-red-500"},je={key:0,class:"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5"},Ee=["src","alt"],Te=["onClick"],Ie=["src","alt"],Se=["onClick"],Ce={class:"absolute bottom-0 left-0 right-0 bg-black/50 px-2 py-1"},Be={class:"truncate text-xs text-white"},qe={class:"text-xs text-gray-300"},He={class:"lg:col-span-2"},Ue={key:0,class:"mt-1 block text-xs text-red-500"},Fe={class:"flex items-center gap-3 mt-6 lg:justify-end"},Re={type:"submit",class:"flex w-full justify-center rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600 sm:w-auto"},Ne=J({__name:"LandingProgramForm",setup(Pe){const f=Y(),E=X(),x=B(()=>f.params.id!==void 0&&f.params.id!=="new"),T=B(()=>x.value?"Edit Landing Program":"Tambah Landing Program"),R=[{value:"active",label:"Aktif"},{value:"inactive",label:"Tidak Aktif"}],P=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],I=b(""),S=b(""),w=b(null),i=b([]),k=b([]),_=b(null);let l=null;const s=q({name:"",status:"",highlight:"",description:""}),n=q({name:"",status:"",description:""}),$=async()=>{if(_.value)try{window.Quill||await new Promise((e,a)=>{if(document.querySelector('script[src*="quill"]')){const d=setInterval(()=>{window.Quill&&(clearInterval(d),e())},100);return}const o=document.createElement("script");o.src="https://cdn.quilljs.com/1.3.6/quill.js",o.onload=()=>e(),o.onerror=()=>a(new Error("Failed to load Quill")),document.head.appendChild(o);const u=document.createElement("link");u.rel="stylesheet",u.href="https://cdn.quilljs.com/1.3.6/quill.snow.css",document.head.appendChild(u)}),await M();const r=window.Quill;l=new r(_.value,{theme:"snow",modules:{toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline","strike"],[{list:"ordered"},{list:"bullet"}],[{align:[]}],["link","image"],["clean"]]},placeholder:"Masukkan deskripsi program..."}),s.description&&(l.root.innerHTML=s.description),l.on("text-change",()=>{s.description=l.root.innerHTML}),s.description=l.root.innerHTML}catch(r){console.error("Error initializing Quill:",r)}},V=r=>{if(!r)return"";try{const e=document.createElement("div");return e.innerHTML=r,e.querySelectorAll("script").forEach(d=>d.remove()),e.querySelectorAll("*").forEach(d=>{Array.from(d.attributes).forEach(m=>{(m.name.startsWith("on")||m.name==="javascript:")&&d.removeAttribute(m.name)})}),e.querySelectorAll("iframe").forEach(d=>d.remove()),e.innerHTML}catch(e){console.error("Error sanitizing HTML:",e);const a=document.createElement("div");return a.textContent=r,a.innerHTML}},A=()=>{s.name.length>100&&(s.name=s.name.substring(0,100)),s.name.trim()&&(n.name="")},D=r=>{const e=r.target;if(e.files){const a=Array.from(e.files),o=5-(i.value.length+k.value.length);a.length>o&&(alert(`Maksimal 5 gambar. Anda sudah memiliki ${i.value.length+k.value.length} gambar. Hanya ${o} gambar yang akan ditambahkan.`),a.splice(o));const u=20*1024*1024,d=[],m=[];a.forEach(h=>{if(!h.type.startsWith("image/")){m.push(`${h.name} (bukan file gambar)`);return}if(h.size>u){m.push(`${h.name} (melebihi 20MB)`);return}const W=URL.createObjectURL(h);d.push(Object.assign(h,{preview:W}))}),m.length>0&&alert(`File berikut tidak valid:
${m.join(`
`)}`),i.value.push(...d),w.value&&(w.value.value="")}},z=r=>{URL.revokeObjectURL(i.value[r].preview),i.value.splice(r,1)},N=r=>{k.value.splice(r,1)},O=r=>{if(r===0)return"0 Bytes";const e=1024,a=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(r)/Math.log(e));return Math.round(r/Math.pow(e,o)*100)/100+" "+a[o]},Q=()=>{var a;let r=!0;n.name="",n.status="",n.description="",!s.name||!s.name.trim()?(n.name="Nama program wajib diisi",r=!1):s.name.length>100&&(n.name="Nama program maksimal 100 karakter",r=!1),s.status||(n.status="Status wajib dipilih",r=!1);let e="";if(l)e=l.getText().trim();else{const o=document.createElement("div");o.innerHTML=s.description||"",e=((a=o.textContent)==null?void 0:a.trim())||""}return e||(n.description="Deskripsi wajib diisi",r=!1),r},G=async()=>{if(x.value&&f.params.id){const r=f.params.id;console.log("Loading data for ID:",r)}},C=()=>{i.value.forEach(r=>{URL.revokeObjectURL(r.preview)}),E.push("/company/landing-program")},K=async()=>{if(Q())try{let r=s.description;l&&(r=l.root.innerHTML,s.description=r);const e=V(r),a=new FormData;a.append("name",s.name.trim()),a.append("status",s.status),s.highlight&&a.append("highlight",s.highlight),a.append("description",e),i.value.forEach((o,u)=>{a.append(`images[${u}]`,o)}),x.value?(console.log("Updating landing program:",s),alert("Landing program berhasil diupdate")):(console.log("Creating landing program:",s),alert("Landing program berhasil dibuat")),E.push("/company/landing-program")}catch(r){console.error("Error saving:",r),alert("Terjadi kesalahan saat menyimpan data")}};return Z(async()=>{await G(),await M(),await $(),await M(),l&&s.description&&(l.root.innerHTML=s.description)}),ee(()=>{i.value.forEach(r=>{URL.revokeObjectURL(r.preview)}),l&&(l=null)}),(r,e)=>(c(),te(ne,null,{default:ae(()=>[L(ie,{pageTitle:T.value},null,8,["pageTitle"]),t("div",le,[t("div",de,[t("h3",ce,p(T.value),1),t("button",{onClick:C,class:"flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03]"}," Batal ")]),t("form",{onSubmit:re(K,["prevent"]),class:"flex flex-col"},[t("div",ue,[t("div",ge,[e[5]||(e[5]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[y(" Nama Program "),t("span",{class:"text-red-500"},"*")],-1)),se(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=a=>s.name=a),onInput:A,placeholder:"Masukkan nama program",required:"",maxlength:"100",class:j(["dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",{"border-red-300 dark:border-red-500":n.name}])},null,34),[[oe,s.name]]),t("div",me,[n.name?(c(),g("span",pe,p(n.name),1)):(c(),g("span",he)),t("span",be,p(s.name.length)+"/100 karakter ",1)])]),t("div",ke,[e[6]||(e[6]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[y(" Status "),t("span",{class:"text-red-500"},"*")],-1)),L(F,{modelValue:s.status,"onUpdate:modelValue":e[1]||(e[1]=a=>s.status=a),options:R,placeholder:"Pilih status",searchInput:I.value,"onUpdate:searchInput":e[2]||(e[2]=a=>I.value=a)},null,8,["modelValue","searchInput"]),n.status?(c(),g("span",fe,p(n.status),1)):v("",!0)]),t("div",xe,[e[7]||(e[7]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Highlight ",-1)),L(F,{modelValue:s.highlight,"onUpdate:modelValue":e[3]||(e[3]=a=>s.highlight=a),options:P,placeholder:"Pilih highlight",searchInput:S.value,"onUpdate:searchInput":e[4]||(e[4]=a=>S.value=a)},null,8,["modelValue","searchInput"])]),t("div",ye,[e[13]||(e[13]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Gambar Program ",-1)),t("div",ve,[t("div",we,[t("input",{type:"file",ref_key:"fileInputRef",ref:w,onChange:D,multiple:"",accept:"image/*",class:"hidden",id:"image-upload",disabled:i.value.length>=5},null,40,_e),t("label",{for:"image-upload",class:j(["flex cursor-pointer items-center justify-center rounded-lg border-2 border-dashed border-gray-300 bg-gray-50 px-6 py-8 text-center transition-colors hover:border-brand-300 hover:bg-gray-100 dark:border-gray-700 dark:bg-gray-900/50 dark:hover:border-brand-500",{"opacity-50 cursor-not-allowed":i.value.length>=5}])},[t("div",Me,[e[8]||(e[8]=t("svg",{class:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1)),e[9]||(e[9]=t("p",{class:"mt-2 text-sm text-gray-600 dark:text-gray-400"},[t("span",{class:"font-medium text-brand-500"},"Klik untuk upload"),y(" atau drag and drop ")],-1)),e[10]||(e[10]=t("p",{class:"text-xs text-gray-500 dark:text-gray-500"}," PNG, JPG, GIF, WEBP hingga 20MB (Maksimal 5 gambar) ",-1)),i.value.length>=5?(c(),g("p",Le," Maksimal 5 gambar sudah tercapai ")):v("",!0)])],2)]),i.value.length>0||k.value.length>0?(c(),g("div",je,[(c(!0),g(H,null,U(k.value,(a,o)=>(c(),g("div",{key:`existing-${o}`,class:"group relative aspect-square overflow-hidden rounded-lg border border-gray-200 bg-gray-100 dark:border-gray-700 dark:bg-gray-800"},[t("img",{src:a.url,alt:a.name||`Image ${o+1}`,class:"h-full w-full object-cover"},null,8,Ee),t("button",{type:"button",onClick:u=>N(o),class:"absolute right-2 top-2 rounded-lg bg-red-500 p-1.5 text-white opacity-0 transition-opacity hover:bg-red-600 group-hover:opacity-100"},[...e[11]||(e[11]=[t("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Te)]))),128)),(c(!0),g(H,null,U(i.value,(a,o)=>(c(),g("div",{key:`new-${o}`,class:"group relative aspect-square overflow-hidden rounded-lg border border-gray-200 bg-gray-100 dark:border-gray-700 dark:bg-gray-800"},[t("img",{src:a.preview,alt:a.name,class:"h-full w-full object-cover"},null,8,Ie),t("button",{type:"button",onClick:u=>z(o),class:"absolute right-2 top-2 rounded-lg bg-red-500 p-1.5 text-white opacity-0 transition-opacity hover:bg-red-600 group-hover:opacity-100"},[...e[12]||(e[12]=[t("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Se),t("div",Ce,[t("p",Be,p(a.name),1),t("p",qe,p(O(a.size)),1)])]))),128))])):v("",!0)])]),t("div",He,[e[14]||(e[14]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[y(" Deskripsi "),t("span",{class:"text-red-500"},"*")],-1)),t("div",{ref_key:"quillEditorRef",ref:_,class:j(["min-h-[300px] rounded-lg border border-gray-300 dark:border-gray-700",{"border-red-300 dark:border-red-500":n.description}])},null,2),n.description?(c(),g("span",Ue,p(n.description),1)):v("",!0),e[15]||(e[15]=t("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," Gunakan editor untuk memformat deskripsi program. Konten akan disanitasi untuk keamanan. ",-1))])]),t("div",Fe,[t("button",{onClick:C,type:"button",class:"flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] sm:w-auto"}," Batal "),t("button",Re,p(x.value?"Simpan Perubahan":"Simpan"),1)])],32)])]),_:1}))}});export{Ne as default};
