import{d as J,H as Q,I as Y,M as Z,A as j,b as i,e as ee,f as ae,B as te,g as q,o as g,w as re,a,t as k,q as se,m as c,k as u,v as p,j as ne,c as f,F,l as P}from"./admin-CF_-7hGV.js";import{_ as oe}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BqqeiGIx.js";import{S as B}from"./SearchableSelect-CjrBoHsr.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const de={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},le={class:"mb-6 flex items-center justify-between"},ie={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},ue={class:"grid grid-cols-1 gap-x-6 gap-y-5 lg:grid-cols-2"},pe={class:"lg:col-span-1"},ce={class:"relative"},ge={class:"absolute text-gray-500 -translate-y-1/2 pointer-events-none right-4 top-1/2 dark:text-gray-400 text-sm"},me={class:"lg:col-span-1"},be={class:"lg:col-span-1"},ye={class:"mt-2 text-sm text-gray-600"},xe={class:"font-medium"},ke={class:"font-medium"},fe={class:"lg:col-span-1"},he={class:"lg:col-span-1"},ve={class:"lg:col-span-1"},we={class:"lg:col-span-1"},je={class:"lg:col-span-1"},_e={class:"lg:col-span-1"},Ie={class:"lg:col-span-2"},Ce={class:"lg:col-span-2"},Me={class:"lg:col-span-1"},Te=["value"],Se={class:"lg:col-span-2"},Ue={class:"space-y-4"},Re={class:"relative"},Ve={class:"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5"},qe={class:"aspect-square overflow-hidden rounded-lg border border-gray-200 dark:border-gray-700"},Fe=["src"],Pe=["onClick"],Be={class:"aspect-square overflow-hidden rounded-lg border border-brand-200 bg-brand-50 dark:border-brand-900/30"},De=["src"],Le=["onClick"],Ne={class:"flex items-center gap-3 mt-6 lg:justify-end"},Ae={type:"submit",class:"flex w-full justify-center rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600 sm:w-auto"},We=J({__name:"PenyaluranForm",setup(Xe){const m=Q(),C=Y(),y=Z(),x=j(()=>m.params.id!==void 0&&m.params.id!=="new"),D=j(()=>x.value?"Edit Penyaluran":"Buat Penyaluran"),b=i(null),M=i([]),h=i([]),v=i(0),T=i(""),S=i(""),t=ee({amount:null,program:"",submissionType:"",pic:"",village:"",district:"",city:"",province:"",postalCode:"",address:"",report:"",branchId:"",pengajuanId:""}),_=i(null),w=i([]),I=i([]),U=i([]),L=j(()=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(v.value||0)),N=j(()=>{const n=Number(t.amount||0);return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(n)}),A=async()=>{try{const e=await(await fetch("/admin/api/program-share-types/submission-types",{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest"}})).json();e.success&&Array.isArray(e.data)&&(h.value=e.data.map(s=>({value:s.value,label:s.value})),!t.submissionType&&h.value.length>0&&(t.submissionType=h.value[0].value))}catch(n){console.error(n)}},X=async()=>{try{const e=await(await fetch("/admin/api/kantor-cabang?per_page=1000",{credentials:"same-origin"})).json(),s=e.success&&e.data?Array.isArray(e.data)?e.data:e.data.data||[]:[];M.value=s.map(o=>({value:o.id,label:o.nama}))}catch(n){console.error(n)}},E=async()=>{var n,e,s;try{const o=await fetch("/admin/api/user",{credentials:"same-origin"});if(o.ok){const l=await o.json();l.success&&l.user&&(b.value=l.user,(e=(n=b.value)==null?void 0:n.kantor_cabang)!=null&&e.id&&(t.branchId=String(b.value.kantor_cabang.id)),(s=b.value)!=null&&s.is_admin&&await X())}}catch(o){console.error(o)}},R=async n=>{var e;if(!n){v.value=0;return}try{const o=await(await fetch(`/admin/api/penyaluran/my-credit?type=${encodeURIComponent(n)}`,{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest"}})).json();v.value=((e=o==null?void 0:o.data)==null?void 0:e.remaining)||0}catch{v.value=0}},K=async()=>{if(x.value&&m.params.id)try{const e=await(await fetch(`/admin/api/penyaluran/${m.params.id}`,{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest"}})).json();if(e.success&&e.data){const s=e.data;t.amount=Number(s.amount),t.program=s.program_name,t.submissionType=s.submission_type,t.pic=s.pic,t.village=s.village,t.district=s.district,t.city=s.city,t.province=s.province,t.postalCode=s.postal_code,t.address=s.address,t.report=s.report,t.branchId=String(s.kantor_cabang_id),s.images&&(I.value=s.images.map(o=>({id:o.id,url:o.url})))}}catch(n){console.error(n)}},$=n=>{const e=n.target;if(e.files){const s=Array.from(e.files),o=20*1024*1024,l=s.filter(r=>r.size<=o);l.length<s.length&&y.warning("Beberapa file melebihi 20MB"),w.value.push(...l),_.value&&(_.value.value="")}},H=n=>URL.createObjectURL(n),W=n=>{w.value.splice(n,1)},G=(n,e)=>{I.value.splice(n,1),U.value.push(e)},O=async()=>{var n;if(!t.amount||!t.program||!t.pic||!t.branchId){y.error("Mohon lengkapi field wajib (*)");return}try{const e=new FormData;e.append("amount",String(t.amount)),e.append("submission_type",t.submissionType),e.append("program_name",t.program),e.append("pic",t.pic),e.append("village",t.village||""),e.append("district",t.district||""),e.append("city",t.city||""),e.append("province",t.province||""),e.append("postal_code",t.postalCode||""),e.append("address",t.address||""),e.append("report",t.report||""),e.append("kantor_cabang_id",t.branchId),t.pengajuanId&&e.append("pengajuan_dana_id",t.pengajuanId),w.value.forEach(d=>e.append("images[]",d)),U.value.forEach(d=>e.append("deleted_image_ids[]",String(d))),x.value&&e.append("_method","PUT");const s=((n=document.querySelector('meta[name="csrf-token"]'))==null?void 0:n.getAttribute("content"))||"",o=x.value?`/admin/api/penyaluran/${m.params.id}`:"/admin/api/penyaluran",r=await(await fetch(o,{method:"POST",body:e,credentials:"same-origin",headers:{"X-CSRF-TOKEN":s,"X-Requested-With":"XMLHttpRequest"}})).json();r.success?(y.success("Berhasil disimpan"),C.push("/keuangan/penyaluran").then(()=>{window.dispatchEvent(new CustomEvent("penyaluran:changed"))})):y.error(r.message||"Gagal menyimpan")}catch{y.error("Terjadi kesalahan sistem")}},V=()=>C.push("/keuangan/penyaluran");return ae(async()=>{var e,s,o;await A(),await E();const n=m.query.pengajuan_id;if(n)try{const r=await(await fetch(`/admin/api/pengajuan-dana/${n}`,{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest"}})).json();if(r.success&&r.data){const d=r.data;t.pengajuanId=String(n),t.submissionType=d.submission_type||t.submissionType,t.program=((e=d.program)==null?void 0:e.nama)||((s=d.program)==null?void 0:s.nama_program)||t.program,t.pic=((o=d.fundraiser)==null?void 0:o.name)||t.pic,t.amount=d.amount?Number(d.amount):null,t.report=d.purpose||t.report}}catch(l){console.error(l)}await K(),R(t.submissionType)}),te(()=>t.submissionType,n=>R(String(n||""))),(n,e)=>(g(),q(oe,null,{default:re(()=>{var s,o,l;return[a("div",de,[a("div",le,[a("h3",ie,k(D.value),1),a("button",{onClick:V,class:"flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03]"}," Kembali ")]),a("form",{onSubmit:se(O,["prevent"]),class:"flex flex-col"},[a("div",ue,[a("div",pe,[e[14]||(e[14]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[c(" Nominal "),a("span",{class:"text-red-500"},"*")],-1)),a("div",ce,[u(a("input",{type:"number","onUpdate:modelValue":e[0]||(e[0]=r=>t.amount=r),placeholder:"Masukkan nominal",min:"1",step:"1",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 pr-24 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[p,t.amount,void 0,{number:!0}]]),a("span",ge,k(N.value),1)])]),a("div",me,[e[15]||(e[15]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[c(" Nama Penyaluran "),a("span",{class:"text-red-500"},"*")],-1)),u(a("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=r=>t.program=r),placeholder:"Masukkan nama program atau tahapannya",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[p,t.program]])]),a("div",be,[e[18]||(e[18]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[c("Tipe Penyaluran "),a("span",{class:"text-red-500"},"*")],-1)),ne(B,{modelValue:t.submissionType,"onUpdate:modelValue":e[2]||(e[2]=r=>t.submissionType=r),options:h.value,placeholder:"Pilih tipe penyaluran","search-input":S.value,"onUpdate:searchInput":e[3]||(e[3]=r=>S.value=r)},null,8,["modelValue","options","search-input"]),a("p",ye,[e[16]||(e[16]=c("Sisa kredit untuk ",-1)),a("span",xe,k(t.submissionType),1),e[17]||(e[17]=c(": ",-1)),a("span",ke,k(L.value),1)])]),a("div",fe,[e[19]||(e[19]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[c(" PIC "),a("span",{class:"text-red-500"},"*")],-1)),u(a("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=r=>t.pic=r),placeholder:"Masukkan penanggung jawab penyaluran",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[p,t.pic]])]),a("div",he,[e[20]||(e[20]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"Kelurahan",-1)),u(a("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=r=>t.village=r),placeholder:"Masukkan kelurahan",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 focus:border-brand-300 focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90"},null,512),[[p,t.village]])]),a("div",ve,[e[21]||(e[21]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"Kecamatan",-1)),u(a("input",{type:"text","onUpdate:modelValue":e[6]||(e[6]=r=>t.district=r),placeholder:"Masukkan kecamatan",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 focus:border-brand-300 focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90"},null,512),[[p,t.district]])]),a("div",we,[e[22]||(e[22]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"Kota",-1)),u(a("input",{type:"text","onUpdate:modelValue":e[7]||(e[7]=r=>t.city=r),placeholder:"Masukkan kota",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 focus:border-brand-300 focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90"},null,512),[[p,t.city]])]),a("div",je,[e[23]||(e[23]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"Provinsi",-1)),u(a("input",{type:"text","onUpdate:modelValue":e[8]||(e[8]=r=>t.province=r),placeholder:"Masukkan provinsi",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 focus:border-brand-300 focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90"},null,512),[[p,t.province]])]),a("div",_e,[e[24]||(e[24]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"Kode Pos",-1)),u(a("input",{type:"text","onUpdate:modelValue":e[9]||(e[9]=r=>t.postalCode=r),placeholder:"Masukkan kode pos",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 focus:border-brand-300 focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90"},null,512),[[p,t.postalCode]])]),a("div",Ie,[e[25]||(e[25]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"Alamat",-1)),u(a("textarea",{"onUpdate:modelValue":e[10]||(e[10]=r=>t.address=r),placeholder:"Masukkan detail alamat lengkap",rows:"3",class:"dark:bg-dark-900 h-auto w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 focus:border-brand-300 focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90"},null,512),[[p,t.address]])]),a("div",Ce,[e[26]||(e[26]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"Laporan",-1)),u(a("textarea",{"onUpdate:modelValue":e[11]||(e[11]=r=>t.report=r),placeholder:"Masukkan catatan laporan hasil penyaluran",rows:"4",class:"dark:bg-dark-900 h-auto w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 focus:border-brand-300 focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90"},null,512),[[p,t.report]])]),a("div",Me,[e[27]||(e[27]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[c(" Kantor Cabang "),a("span",{class:"text-red-500"},"*")],-1)),(s=b.value)!=null&&s.is_admin?(g(),q(B,{key:0,modelValue:t.branchId,"onUpdate:modelValue":e[12]||(e[12]=r=>t.branchId=r),options:M.value,placeholder:"Pilih atau cari kantor cabang","search-input":T.value,"onUpdate:searchInput":e[13]||(e[13]=r=>T.value=r)},null,8,["modelValue","options","search-input"])):(g(),f("input",{key:1,type:"text",value:((l=(o=b.value)==null?void 0:o.kantor_cabang)==null?void 0:l.nama)||"",readonly:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-2.5 text-sm text-gray-800 dark:border-gray-700 dark:bg-gray-900/50 dark:text-white/90"},null,8,Te))]),a("div",Se,[e[33]||(e[33]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Gambar Dokumentasi ",-1)),a("div",Ue,[a("div",Re,[a("input",{type:"file",ref_key:"fileInputRef",ref:_,onChange:$,multiple:"",accept:"image/*",class:"hidden",id:"image-upload"},null,544),e[28]||(e[28]=a("label",{for:"image-upload",class:"flex cursor-pointer items-center justify-center rounded-lg border-2 border-dashed border-gray-300 bg-gray-50 px-6 py-8 text-center transition-colors hover:border-brand-300 hover:bg-gray-100 dark:border-gray-700 dark:bg-gray-900/50"},[a("div",{class:"text-center"},[a("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})]),a("p",{class:"mt-2 text-sm text-gray-600 dark:text-gray-400"},[a("span",{class:"font-medium text-brand-500"},"Klik untuk upload"),c(" atau drag and drop")]),a("p",{class:"text-xs text-gray-500"},"PNG, JPG hingga 20MB")])],-1))]),a("div",Ve,[(g(!0),f(F,null,P(I.value,(r,d)=>(g(),f("div",{key:"old-"+r.id,class:"relative group"},[a("div",qe,[a("img",{src:r.url,class:"h-full w-full object-cover"},null,8,Fe)]),a("button",{type:"button",onClick:z=>G(d,r.id),class:"absolute -right-2 -top-2 flex h-6 w-6 items-center justify-center rounded-full bg-red-500 text-white shadow-sm hover:bg-red-600"},[...e[29]||(e[29]=[a("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Pe),e[30]||(e[30]=a("div",{class:"mt-1 text-[10px] text-gray-400 text-center"},"Existing",-1))]))),128)),(g(!0),f(F,null,P(w.value,(r,d)=>(g(),f("div",{key:"new-"+d,class:"relative group"},[a("div",Be,[a("img",{src:H(r),class:"h-full w-full object-cover"},null,8,De)]),a("button",{type:"button",onClick:z=>W(d),class:"absolute -right-2 -top-2 flex h-6 w-6 items-center justify-center rounded-full bg-gray-500 text-white shadow-sm hover:bg-gray-600"},[...e[31]||(e[31]=[a("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Le),e[32]||(e[32]=a("div",{class:"mt-1 text-[10px] text-brand-500 text-center truncate px-1"},"Baru",-1))]))),128))])])])]),a("div",Ne,[a("button",{onClick:V,type:"button",class:"flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 sm:w-auto"},"Kembali"),a("button",Ae,k(x.value?"Update":"Buat"),1)])],32)])]}),_:1}))}});export{We as default};
