import{g as T,H as _,I as C,V as M,A as y,i as S,o as R,c as E,a as f,w as K,f as N,b as a,t as x,p as V,j as m,d as A,e as F,n as X,v as p,l as q}from"./admin-DnBK--6g.js";import{_ as B}from"./AdminLayout.vue_vue_type_script_setup_true_lang-CCnFo6di.js";import{_ as G}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-BLF3_Tpt.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const O={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},$={class:"mb-6 flex items-center justify-between"},U={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},D={class:"grid grid-cols-1 gap-x-6 gap-y-5 lg:grid-cols-2"},H={class:"lg:col-span-1"},P=["readonly","disabled"],J={key:0,class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},L={class:"lg:col-span-1"},W={class:"lg:col-span-1"},z={class:"lg:col-span-1"},I={class:"flex items-center gap-3 mt-6 lg:justify-end"},Q={type:"submit",class:"flex w-full justify-center rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600 sm:w-auto"},re=T({__name:"TipeAbsensiForm",setup(Y){const l=_(),c=C(),n=M(),o=y(()=>l.params.id!==void 0&&l.params.id!=="new"),b=y(()=>o.value?"Edit Tipe Absensi":"Tambah Tipe Absensi"),t=S({kode:"",nama:"",jamMasuk:"",jamKeluar:""}),g=async()=>{var s;try{const e=(s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content");if(e)return e;const r=await fetch("/admin/api/csrf-token",{method:"GET",credentials:"same-origin"});if(!r.ok)throw new Error(`Failed to get CSRF token: ${r.status}`);return(await r.json()).csrf_token||""}catch(e){return console.error("Failed to get CSRF token:",e),""}},h=async()=>{if(!o.value)try{const s=await g(),r=await(await fetch("/admin/api/tipe-absensi-next-kode",{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Accept:"application/json","X-CSRF-TOKEN":s},credentials:"same-origin"})).json();r.success&&r.data&&(t.kode=r.data.kode||"")}catch(s){console.error("Error loading next kode:",s)}},w=async()=>{if(o.value&&l.params.id){const s=l.params.id;try{const e=await g(),i=await(await fetch(`/admin/api/tipe-absensi/${s}`,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Accept:"application/json","X-CSRF-TOKEN":e},credentials:"same-origin"})).json();if(i.success&&i.data){const d=i.data;t.kode=d.kode||"",t.nama=d.nama||"",d.jam_masuk&&(t.jamMasuk=d.jam_masuk.substring(0,5)),d.jam_keluar&&(t.jamKeluar=d.jam_keluar.substring(0,5))}else n.error("Gagal memuat data tipe absensi"),c.push("/administrasi/tipe-absensi")}catch(e){console.error("Error loading data:",e),n.error("Terjadi kesalahan saat memuat data"),c.push("/administrasi/tipe-absensi")}}},k=()=>{c.push("/administrasi/tipe-absensi")},v=async()=>{if(!t.nama){n.error("Nama wajib diisi");return}try{const s=await g();if(!s){n.error("Gagal mendapatkan CSRF token. Silakan refresh halaman.");return}const e={nama:t.nama,jam_masuk:t.jamMasuk||null,jam_keluar:t.jamKeluar||null};o.value&&t.kode&&(e.kode=t.kode);const r=o.value?`/admin/api/tipe-absensi/${l.params.id}`:"/admin/api/tipe-absensi",i=o.value?"PUT":"POST",u=await(await fetch(r,{method:i,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Accept:"application/json","X-CSRF-TOKEN":s},credentials:"same-origin",body:JSON.stringify(e)})).json();if(u.success)n.success(o.value?"Tipe absensi berhasil diupdate":"Tipe absensi berhasil ditambahkan"),c.push("/administrasi/tipe-absensi");else if(u.errors){const j=Object.values(u.errors).flat().join(", ");n.error(`Validasi gagal: ${j}`)}else n.error(u.message||"Gagal menyimpan data")}catch(s){console.error("Error saving:",s),n.error("Terjadi kesalahan saat menyimpan data")}};return R(async()=>{o.value?await w():await h()}),(s,e)=>(f(),E(B,null,{default:K(()=>[N(G,{pageTitle:b.value},null,8,["pageTitle"]),a("div",O,[a("div",$,[a("h3",U,x(b.value),1),a("button",{onClick:k,class:"flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03]"}," Batal ")]),a("form",{onSubmit:V(v,["prevent"]),class:"flex flex-col"},[a("div",D,[a("div",H,[e[4]||(e[4]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kode Tipe Absensi ",-1)),m(a("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=r=>t.kode=r),placeholder:"Kode akan di-generate otomatis",readonly:!o.value,disabled:!o.value,class:X(["dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-800 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",{"cursor-not-allowed opacity-60":!o.value}])},null,10,P),[[p,t.kode]]),o.value?F("",!0):(f(),A("p",J," Kode akan di-generate otomatis "))]),a("div",L,[e[5]||(e[5]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[q(" Nama "),a("span",{class:"text-red-500"},"*")],-1)),m(a("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=r=>t.nama=r),placeholder:"Masukkan nama tipe absensi",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[p,t.nama]])]),a("div",W,[e[6]||(e[6]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Jam Masuk ",-1)),m(a("input",{type:"time","onUpdate:modelValue":e[2]||(e[2]=r=>t.jamMasuk=r),class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[p,t.jamMasuk]])]),a("div",z,[e[7]||(e[7]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Jam Keluar ",-1)),m(a("input",{type:"time","onUpdate:modelValue":e[3]||(e[3]=r=>t.jamKeluar=r),class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[p,t.jamKeluar]])])]),a("div",I,[a("button",{onClick:k,type:"button",class:"flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] sm:w-auto"}," Batal "),a("button",Q,x(o.value?"Simpan Perubahan":"Simpan"),1)])],32)])]),_:1}))}});export{re as default};
