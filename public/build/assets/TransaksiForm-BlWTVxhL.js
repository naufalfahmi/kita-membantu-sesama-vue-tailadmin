import{d as P,H as K,I as O,L,r as d,z as k,a as $,o as z,c as G,b as _,w as J,e as b,f as e,t as D,p as H,l as m,i as N,v as U,u as X,j as Y,g as Z}from"./admin-DwTHc9qP.js";import{C as q}from"./component-DwhCH8jm.js";import{_ as Q,a as W}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-D9-SYEKw.js";import{S as y}from"./SearchableSelect-CsOdwqiG.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const aa={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},ea={class:"mb-6 flex items-center justify-between"},ra={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},ta={class:"grid grid-cols-1 gap-x-6 gap-y-5 lg:grid-cols-2"},na={class:"relative"},sa={class:"lg:col-span-2"},oa={class:"flex items-center gap-3 mt-6 lg:justify-end"},ia=["disabled"],la=["disabled"],da={key:0,class:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},fa=P({__name:"TransaksiForm",setup(ua){const p=K(),h=O(),i=L(),u=d(null),f=k(()=>{var a,n,t;const s=(t=(n=(a=u.value)==null?void 0:a.role)==null?void 0:n.name)==null?void 0:t.toLowerCase();return s==="fundrising"||s==="fundraising"}),c=k(()=>p.params.id!==void 0&&p.params.id!=="new"),x=k(()=>c.value?"Edit Transaksi":"Tambah Transaksi"),w=d(!1),g=d(!1),E={dateFormat:"Y-m-d",altInput:!0,altFormat:"d/m/Y",allowInput:!1},v=d([]),j=d([]),C=d([]),I=d(""),T=d(""),V=d(""),r=$({branchId:"",nominal:null,donorId:"",programId:"",transactionDate:"",notes:""}),A=async()=>{try{const s=await fetch("/admin/api/user",{credentials:"same-origin"});if(s.ok){const a=await s.json();a.success&&a.user&&(u.value=a.user)}}catch(s){console.error("Error fetching current user:",s)}},M=async()=>{try{const[s,a,n]=await Promise.all([fetch("/admin/api/kantor-cabang?per_page=100",{credentials:"same-origin"}),fetch("/admin/api/donatur?per_page=100",{credentials:"same-origin"}),fetch("/admin/api/program?per_page=100",{credentials:"same-origin"})]);if(s.ok){const t=await s.json(),l=t.success&&t.data?Array.isArray(t.data)?t.data:t.data.data||[]:[];v.value=l.map(o=>({value:o.id,label:o.nama}))}if(a.ok){const t=await a.json(),l=t.success&&t.data?Array.isArray(t.data)?t.data:t.data.data||[]:[];j.value=l.map(o=>({value:o.id,label:o.nama}))}if(n.ok){const t=await n.json(),l=t.success&&t.data?Array.isArray(t.data)?t.data:t.data.data||[]:[];C.value=l.map(o=>({value:o.id,label:o.nama_program}))}}catch(s){console.error("Error fetching options:",s),i.error("Gagal memuat data opsi")}},F=async()=>{if(c.value&&p.params.id){w.value=!0;try{const s=p.params.id,a=await fetch(`/admin/api/transaksi/${s}`,{credentials:"same-origin"});if(!a.ok)throw new Error("Failed to fetch transaksi");const n=await a.json();if(n.success&&n.data){const t=n.data;r.branchId=t.kantor_cabang_id||"",r.nominal=t.nominal,r.donorId=t.donatur_id||"",r.programId=t.program_id||"",r.transactionDate=t.tanggal_transaksi||"",r.notes=t.keterangan||""}}catch(s){console.error("Error loading transaksi:",s),i.error("Gagal memuat data transaksi")}finally{w.value=!1}}},S=()=>{h.push("/keuangan/transaksi")},R=async()=>{var s;if(!r.branchId){i.warning("Kantor Cabang wajib diisi");return}if(!r.nominal||r.nominal<=0){i.warning("Nominal wajib diisi");return}if(!r.donorId){i.warning("Donatur wajib diisi");return}if(!r.programId){i.warning("Program wajib diisi");return}if(!r.transactionDate){i.warning("Tanggal transaksi wajib diisi");return}g.value=!0;try{const a=await fetch("/admin/api/csrf-token",{credentials:"same-origin"});if(!a.ok)throw new Error("Failed to fetch CSRF token");const n=await a.json(),t={kantor_cabang_id:r.branchId,nominal:r.nominal,donatur_id:r.donorId,program_id:r.programId,tanggal_transaksi:r.transactionDate,keterangan:r.notes||null};f.value&&((s=u.value)!=null&&s.id)&&(t.fundraiser_id=u.value.id);let l;c.value?l=await fetch(`/admin/api/transaksi/${p.params.id}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":n.csrf_token},credentials:"same-origin",body:JSON.stringify(t)}):l=await fetch("/admin/api/transaksi",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":n.csrf_token},credentials:"same-origin",body:JSON.stringify(t)});const o=await l.json();if(o.success)i.success(o.message||(c.value?"Transaksi berhasil diupdate":"Transaksi berhasil ditambahkan")),h.push("/keuangan/transaksi");else if(o.errors){const B=Object.values(o.errors).flat().join(", ");i.error(B)}else i.error(o.message||"Gagal menyimpan transaksi")}catch(a){console.error("Error saving:",a),i.error("Terjadi kesalahan saat menyimpan data")}finally{g.value=!1}};return z(async()=>{var s,a;await A(),await M(),await F(),f.value&&!c.value&&(a=(s=u.value)==null?void 0:s.kantor_cabang)!=null&&a.id&&(r.branchId=String(u.value.kantor_cabang.id))}),(s,a)=>(_(),G(W,null,{default:J(()=>[b(Q,{pageTitle:x.value},null,8,["pageTitle"]),e("div",aa,[e("div",ea,[e("h3",ra,D(x.value),1),e("button",{onClick:S,class:"flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03]"}," Batal ")]),e("form",{onSubmit:H(R,["prevent"]),class:"flex flex-col"},[e("div",ta,[e("div",null,[a[9]||(a[9]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[m(" Kantor Cabang "),e("span",{class:"text-red-500"},"*")],-1)),b(y,{modelValue:r.branchId,"onUpdate:modelValue":a[0]||(a[0]=n=>r.branchId=n),options:v.value,placeholder:"Kantor Cabang","search-input":I.value,"onUpdate:searchInput":a[1]||(a[1]=n=>I.value=n),disabled:f.value},null,8,["modelValue","options","search-input","disabled"])]),e("div",null,[a[10]||(a[10]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[m(" Nominal "),e("span",{class:"text-red-500"},"*")],-1)),N(e("input",{type:"number","onUpdate:modelValue":a[2]||(a[2]=n=>r.nominal=n),placeholder:"Nominal",min:"0",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[U,r.nominal,void 0,{number:!0}]])]),e("div",null,[a[11]||(a[11]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[m(" Donatur "),e("span",{class:"text-red-500"},"*")],-1)),b(y,{modelValue:r.donorId,"onUpdate:modelValue":a[3]||(a[3]=n=>r.donorId=n),options:j.value,placeholder:"Donatur","search-input":T.value,"onUpdate:searchInput":a[4]||(a[4]=n=>T.value=n)},null,8,["modelValue","options","search-input"])]),e("div",null,[a[12]||(a[12]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[m(" Program "),e("span",{class:"text-red-500"},"*")],-1)),b(y,{modelValue:r.programId,"onUpdate:modelValue":a[5]||(a[5]=n=>r.programId=n),options:C.value,placeholder:"Program","search-input":V.value,"onUpdate:searchInput":a[6]||(a[6]=n=>V.value=n)},null,8,["modelValue","options","search-input"])]),e("div",null,[a[14]||(a[14]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[m(" Tanggal Transaksi "),e("span",{class:"text-red-500"},"*")],-1)),e("div",na,[b(X(q),{modelValue:r.transactionDate,"onUpdate:modelValue":a[7]||(a[7]=n=>r.transactionDate=n),config:E,class:"dark:bg-dark-900 h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 pr-11 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",placeholder:"Tanggal Transaksi"},null,8,["modelValue"]),a[13]||(a[13]=e("span",{class:"absolute text-gray-500 -translate-y-1/2 pointer-events-none right-3 top-1/2 dark:text-gray-400"},[e("svg",{class:"fill-current",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M10 18.3333C14.6024 18.3333 18.3333 14.6024 18.3333 9.99999C18.3333 5.39762 14.6024 1.66666 10 1.66666C5.39763 1.66666 1.66667 5.39762 1.66667 9.99999C1.66667 14.6024 5.39763 18.3333 10 18.3333Z",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M10 5V10L13.3333 11.6667",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})])],-1))])]),e("div",sa,[a[15]||(a[15]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Keterangan ",-1)),N(e("textarea",{"onUpdate:modelValue":a[8]||(a[8]=n=>r.notes=n),placeholder:"Keterangan",maxlength:"1000",rows:"4",class:"dark:bg-dark-900 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[U,r.notes]]),a[16]||(a[16]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," Maksimal 1000 karakter. ",-1))])]),e("div",oa,[e("button",{onClick:S,type:"button",disabled:g.value,class:"flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed"}," Batal ",8,ia),e("button",{type:"submit",disabled:g.value,class:"flex w-full justify-center items-center gap-2 rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed"},[g.value?(_(),Y("svg",da,[...a[17]||(a[17]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):Z("",!0),m(" "+D(g.value?"Menyimpan...":c.value?"Simpan Perubahan":"Simpan"),1)],8,la)])],32)])]),_:1}))}});export{fa as default};
