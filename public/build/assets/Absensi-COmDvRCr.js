import{g as J,H as O,I as U,r as b,B as R,o as Z,P as W,J as q,c as Q,a as p,w as X,f as v,b as o,t as C,l as ee,j as te,v as ae,u as _,d as y,e as re,M as oe}from"./admin-CLxYwY0g.js";import{A as ne}from"./ag-theme-alpine-MMwSH1g8.js";import{C as V}from"./component-BgD9IQUg.js";import{u as A,w as se}from"./xlsx-3SA47z_C.js";import{_ as le}from"./AdminLayout.vue_vue_type_script_setup_true_lang-B648_P3o.js";import{_ as ie}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-Z11cfszT.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ue={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},de={class:"mb-6 flex items-center justify-between"},ge={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},ce={class:"mb-6 rounded-lg border border-gray-200 bg-white p-4 dark:border-gray-800 dark:bg-white/[0.03]"},me={class:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4"},fe={class:"flex-1"},he={class:"flex-1"},ke={class:"relative"},be={class:"flex-1"},we={class:"relative"},pe={class:"relative",style:{width:"100%",height:"450px"}},xe={class:"ag-theme-alpine dark:ag-theme-alpine-dark",style:{width:"100%",height:"100%"}},ve={key:0,class:"absolute inset-0 flex flex-col items-center justify-center bg-white dark:bg-gray-900 rounded-lg z-50 pointer-events-none",style:{position:"absolute",top:"0",left:"0",right:"0",bottom:"0"}},ye={class:"w-16 h-16 text-gray-400 dark:text-gray-500 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},De={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"},Te={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"},Me={class:"text-gray-600 dark:text-gray-400 text-lg font-medium mb-1"},Ce={class:"text-gray-500 dark:text-gray-500 text-sm"},Ne=J({__name:"Absensi",setup(_e){const N=O(),B=U(),S=b(N.meta.title||"Absensi"),d=b(null),j={enableTime:!0,dateFormat:"Y-m-d H:i",altInput:!0,altFormat:"d/m/Y H:i",time_24hr:!0,minuteIncrement:1,wrap:!1},L=[{headerName:"Nama",field:"nama",sortable:!0,filter:!1,flex:1},{headerName:"No Induk",field:"noInduk",sortable:!0,filter:!1,width:120},{headerName:"Tanggal Absen Masuk",field:"tanggalAbsenMasuk",sortable:!0,filter:!1,flex:1,valueFormatter:t=>t.value?new Date(t.value).toLocaleString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):""},{headerName:"Tanggal Absen Keluar",field:"tanggalAbsenKeluar",sortable:!0,filter:!1,flex:1,valueFormatter:t=>t.value?new Date(t.value).toLocaleString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):""},{headerName:"Total Kerja",field:"totalKerja",sortable:!0,filter:!1,width:150,valueGetter:t=>{if(!t.data)return 0;if(t.data.tanggalAbsenMasuk&&t.data.tanggalAbsenKeluar){const e=new Date(t.data.tanggalAbsenMasuk).getTime();return(new Date(t.data.tanggalAbsenKeluar).getTime()-e)/(1e3*60*60)}return 0},valueFormatter:t=>{if(t.value){const e=Math.floor(t.value),a=Math.floor((t.value-e)*60);return a>0?`${e} jam ${a} menit`:`${e} jam`}return"0 jam"}},{headerName:"Actions",field:"actions",sortable:!1,filter:!1,width:100,cellRenderer:t=>{const e=document.createElement("div");e.className="flex items-center gap-3";const a=document.createElement("button");return a.className="flex items-center justify-center w-8 h-8 rounded-lg text-brand-500 hover:bg-brand-50 dark:hover:bg-brand-500/10 transition-colors",a.innerHTML=`
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
          <circle cx="12" cy="12" r="3"></circle>
        </svg>
      `,a.onclick=()=>P(t.data.id),e.appendChild(a),e}}],E={resizable:!0,sortable:!0,filter:!1},I=(()=>{const t=["Ahmad Hidayat","Siti Nurhaliza","Budi Santoso","Dewi Lestari","Eko Prasetyo","Fitri Handayani","Guntur Wibowo","Hesti Rahayu","Indra Wijaya","Joko Susilo","Kartika Putri","Lukman Hakim","Maya Sari","Nanda Pratama","Olivia Wijaya","Putra Ramadhan","Qori Anisa","Rizky Pratama","Salsabila Putri","Taufik Hidayat"],e=[],a=new Date("2024-01-01");a.setHours(0,0,0,0);for(let r=1;r<=200;r++){const l=(r-1)%t.length,n=new Date(a);n.setDate(n.getDate()+Math.floor((r-1)/20));const i=Math.floor(Math.random()*2)+7,g=Math.floor(Math.random()*60),s=new Date(n);s.setHours(i,g,0,0);const u=Math.floor(Math.random()*2)+16,k=Math.floor(Math.random()*60),h=new Date(n);h.setHours(u,k,0,0),h<=s&&h.setHours(i+8,g,0,0),e.push({id:r.toString(),nama:t[l],noInduk:`K${String(r).padStart(3,"0")}`,tanggalAbsenMasuk:s.toISOString(),tanggalAbsenKeluar:h.toISOString()})}return e})(),c=b(""),m=b(""),f=b(""),D=R(()=>{let t=[...I];if(c.value){const e=c.value.toLowerCase();t=t.filter(a=>a.nama.toLowerCase().includes(e)||a.noInduk.toLowerCase().includes(e))}return m.value&&(t=t.filter(e=>{const a=new Date(e.tanggalAbsenMasuk),r=new Date(m.value);return a.getFullYear()===r.getFullYear()&&a.getMonth()===r.getMonth()&&a.getDate()===r.getDate()?r.getHours()!==0||r.getMinutes()!==0?Math.abs(a.getTime()-r.getTime())<900*1e3:!0:!1})),f.value&&(t=t.filter(e=>{const a=new Date(e.tanggalAbsenKeluar),r=new Date(f.value);return a.getFullYear()===r.getFullYear()&&a.getMonth()===r.getMonth()&&a.getDate()===r.getDate()?r.getHours()!==0||r.getMinutes()!==0?Math.abs(a.getTime()-r.getTime())<900*1e3:!0:!1})),t}),F=R(()=>D.value.length===0),P=t=>{B.push(`/operasional/absensi/${t}`)},$=()=>{const t=D.value.map(n=>{const i=new Date(n.tanggalAbsenMasuk),g=new Date(n.tanggalAbsenKeluar);let s="0 jam";if(n.tanggalAbsenMasuk&&n.tanggalAbsenKeluar){const u=i.getTime(),K=(g.getTime()-u)/(1e3*60*60),M=Math.floor(K),H=Math.floor((K-M)*60);H>0?s=`${M} jam ${H} menit`:s=`${M} jam`}return{Nama:n.nama,"No Induk":n.noInduk,"Tanggal Absen Masuk":i.toLocaleString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),"Tanggal Absen Keluar":g.toLocaleString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),"Total Kerja":s}}),e=A.json_to_sheet(t),a=A.book_new();A.book_append_sheet(a,e,"Absensi");const l=`Absensi_${new Date().toISOString().split("T")[0]}.xlsx`;se(a,l)},z=(t,e)=>{if(!e||e.length===0)return t;const a=[...t];return e.forEach(r=>{const{colId:l,sort:n}=r;a.sort((i,g)=>{let s=i[l],u=g[l];if(l==="tanggalAbsenMasuk"||l==="tanggalAbsenKeluar")s=new Date(s).getTime(),u=new Date(u).getTime();else if(l==="totalKerja"){if(i.tanggalAbsenMasuk&&i.tanggalAbsenKeluar){const k=new Date(i.tanggalAbsenMasuk).getTime();s=(new Date(i.tanggalAbsenKeluar).getTime()-k)/(1e3*60*60)}else s=0;if(g.tanggalAbsenMasuk&&g.tanggalAbsenKeluar){const k=new Date(g.tanggalAbsenMasuk).getTime();u=(new Date(g.tanggalAbsenKeluar).getTime()-k)/(1e3*60*60)}else u=0}else typeof s=="string"&&(s=s.toLowerCase(),u=u.toLowerCase());return s<u?n==="asc"?-1:1:s>u?n==="asc"?1:-1:0})}),a},T=()=>({getRows:t=>{setTimeout(()=>{const e=t.startRow??0,a=t.endRow??e+10;let r=D.value;t.sortModel&&t.sortModel.length>0&&(r=z(r,t.sortModel));const l=r.slice(e,a);let n;r.length===0?n=0:r.length<=a?n=r.length:n=void 0,t.successCallback(l,n)},50)}}),x=b(T());Z(()=>{console.log("Component mounted, datasource:",x.value),console.log("Total data:",I.length)}),W(()=>{w&&clearTimeout(w)});const Y=()=>{if(d.value&&d.value.api){const t=T();x.value.getRows=t.getRows;try{d.value.api.refreshInfiniteCache()}catch(e){console.error("Error refreshing cache on sort:",e)}}};let w=null;q([c,m,f],()=>{w&&clearTimeout(w),w=setTimeout(()=>{const t=T();x.value.getRows=t.getRows,oe(()=>{if(d.value&&d.value.api)try{d.value.api.purgeInfiniteCache(),d.value.api.refreshInfiniteCache(),setTimeout(()=>{d.value&&d.value.api&&d.value.api.ensureIndexVisible(0,"top")},100)}catch(e){console.error("Error refreshing cache:",e)}})},300)});const G=()=>{c.value="",m.value="",f.value=""};return(t,e)=>(p(),Q(le,null,{default:X(()=>[v(ie,{pageTitle:S.value},null,8,["pageTitle"]),o("div",ue,[o("div",de,[o("h3",ge,C(S.value),1),o("button",{onClick:$,class:"flex items-center gap-2 rounded-lg bg-green-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-green-600"},[...e[3]||(e[3]=[o("svg",{class:"fill-current",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[o("path",{d:"M10.8333 3.33333V9.16667H16.6667L10.8333 3.33333ZM4.16667 2.5H11.6667L17.5 8.33333V15.8333C17.5 16.2754 17.3244 16.6993 17.0118 17.0118C16.6993 17.3244 16.2754 17.5 15.8333 17.5H4.16667C3.72464 17.5 3.30072 17.3244 2.98816 17.0118C2.67559 16.6993 2.5 16.2754 2.5 15.8333V4.16667C2.5 3.72464 2.67559 3.30072 2.98816 2.98816C3.30072 2.67559 3.72464 2.5 4.16667 2.5Z",fill:"currentColor"})],-1),ee(" Export Excel ",-1)])])]),o("div",ce,[o("div",me,[o("div",fe,[e[4]||(e[4]=o("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Nama / No Induk ",-1)),te(o("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=a=>c.value=a),placeholder:"Cari nama atau no induk...",class:"h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[ae,c.value]])]),o("div",he,[e[6]||(e[6]=o("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Tanggal & Jam Masuk ",-1)),o("div",ke,[v(_(V),{modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=a=>m.value=a),config:j,class:"dark:bg-dark-900 h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 pl-4 pr-11 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",placeholder:"Pilih tanggal & jam masuk"},null,8,["modelValue"]),e[5]||(e[5]=o("span",{class:"absolute text-gray-500 -translate-y-1/2 pointer-events-none right-3 top-1/2 dark:text-gray-400"},[o("svg",{class:"fill-current",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[o("path",{d:"M10 18.3333C14.6024 18.3333 18.3333 14.6024 18.3333 9.99999C18.3333 5.39762 14.6024 1.66666 10 1.66666C5.39763 1.66666 1.66667 5.39762 1.66667 9.99999C1.66667 14.6024 5.39763 18.3333 10 18.3333Z",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),o("path",{d:"M10 5V10L13.3333 11.6667",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})])],-1))])]),o("div",be,[e[8]||(e[8]=o("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Tanggal & Jam Keluar ",-1)),o("div",we,[v(_(V),{modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=a=>f.value=a),config:j,class:"dark:bg-dark-900 h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 pl-4 pr-11 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",placeholder:"Pilih tanggal & jam keluar"},null,8,["modelValue"]),e[7]||(e[7]=o("span",{class:"absolute text-gray-500 -translate-y-1/2 pointer-events-none right-3 top-1/2 dark:text-gray-400"},[o("svg",{class:"fill-current",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[o("path",{d:"M10 18.3333C14.6024 18.3333 18.3333 14.6024 18.3333 9.99999C18.3333 5.39762 14.6024 1.66666 10 1.66666C5.39763 1.66666 1.66667 5.39762 1.66667 9.99999C1.66667 14.6024 5.39763 18.3333 10 18.3333Z",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),o("path",{d:"M10 5V10L13.3333 11.6667",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})])],-1))])]),o("div",{class:"flex items-end"},[o("button",{onClick:G,class:"h-11 w-full rounded-lg border border-gray-300 bg-white px-6 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03]"}," Reset Filter ")])])]),o("div",pe,[o("div",xe,[v(_(ne),{ref_key:"agGridRef",ref:d,class:"ag-theme-alpine",style:{width:"100%",height:"100%"},columnDefs:L,defaultColDef:E,rowModelType:"infinite",datasource:x.value,rowBuffer:10,cacheBlockSize:10,maxBlocksInCache:5,maxConcurrentDatasourceRequests:2,infiniteInitialRowCount:10,suppressSorting:!1,theme:"legacy",animateRows:!0,suppressHorizontalScroll:!0,onSortChanged:Y},null,8,["datasource"])]),F.value?(p(),y("div",ve,[(p(),y("svg",ye,[c.value||m.value||f.value?(p(),y("path",De)):(p(),y("path",Te))])),o("p",Me,C(c.value||m.value||f.value?"Tidak ada data ditemukan":"Tidak ada data"),1),o("p",Ce,C(c.value||m.value||f.value?"Coba ubah filter pencarian Anda":"Belum ada data yang tersedia"),1)])):re("",!0)])])]),_:1}))}});export{Ne as default};
