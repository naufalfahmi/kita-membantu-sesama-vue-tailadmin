import{d as X,H as J,I as Y,A as B,r as k,a as H,o as Z,L as T,y as ee,c as te,b as g,w as ae,e as j,f as t,t as h,p as re,i as se,l as x,n as L,v as ne,j as p,g as w,F as R,k as F}from"./admin-BLQt5dm6.js";import{_ as oe}from"./AdminLayout.vue_vue_type_script_setup_true_lang-DVoyHdtI.js";import{_ as ie}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-DjRlBqWI.js";import{S as P}from"./SearchableSelect-DIA02P8e.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const le={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},de={class:"mb-6 flex items-center justify-between"},ce={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},ue={class:"grid grid-cols-1 gap-x-6 gap-y-5 lg:grid-cols-2"},me={class:"lg:col-span-2"},ge={class:"mt-1 flex items-center justify-between"},pe={key:0,class:"text-xs text-red-500"},he={key:1,class:"text-xs text-gray-500 dark:text-gray-400"},be={class:"text-xs text-gray-500 dark:text-gray-400"},fe={class:"lg:col-span-1"},ke={key:0,class:"mt-1 block text-xs text-red-500"},ye={class:"lg:col-span-1"},ve={class:"lg:col-span-2"},xe={class:"space-y-4"},we={class:"relative"},_e=["disabled"],Me={class:"text-center"},Te={key:0,class:"mt-1 text-xs text-red-500"},je={key:0,class:"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5"},Le=["src","alt"],Ee=["onClick"],Se=["src","alt"],Ie=["onClick"],Ce={class:"absolute bottom-0 left-0 right-0 bg-black/50 px-2 py-1"},qe={class:"truncate text-xs text-white"},Be={class:"text-xs text-gray-300"},He={class:"lg:col-span-2"},Re={key:0,class:"mt-1 block text-xs text-red-500"},Fe={class:"flex items-center gap-3 mt-6 lg:justify-end"},Pe={type:"submit",class:"flex w-full justify-center rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600 sm:w-auto"},Ne=X({__name:"LandingProgramForm",setup(Ue){const y=J(),E=Y(),v=B(()=>y.params.id!==void 0&&y.params.id!=="new"),S=B(()=>v.value?"Edit Landing Program":"Tambah Landing Program"),U=[{value:"active",label:"Aktif"},{value:"inactive",label:"Tidak Aktif"}],$=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],I=k(""),C=k(""),_=k(null),d=k([]),f=k([]),M=k(null);let c=null;const n=H({name:"",status:"",highlight:"",description:""}),l=H({name:"",status:"",description:""}),V=async()=>{if(M.value)try{window.Quill||await new Promise((e,r)=>{if(document.querySelector('script[src*="quill"]')){const i=setInterval(()=>{window.Quill&&(clearInterval(i),e())},100);return}const a=document.createElement("script");a.src="https://cdn.quilljs.com/1.3.6/quill.js",a.onload=()=>e(),a.onerror=()=>r(new Error("Failed to load Quill")),document.head.appendChild(a);const m=document.createElement("link");m.rel="stylesheet",m.href="https://cdn.quilljs.com/1.3.6/quill.snow.css",document.head.appendChild(m)}),await T();const s=window.Quill;c=new s(M.value,{theme:"snow",modules:{toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline","strike"],[{list:"ordered"},{list:"bullet"}],[{align:[]}],["link","image"],["clean"]]},placeholder:"Masukkan deskripsi program..."}),n.description&&(c.root.innerHTML=n.description),c.on("text-change",()=>{n.description=c.root.innerHTML}),n.description=c.root.innerHTML}catch(s){console.error("Error initializing Quill:",s)}},A=s=>{if(!s)return"";try{const e=document.createElement("div");return e.innerHTML=s,e.querySelectorAll("script").forEach(i=>i.remove()),e.querySelectorAll("*").forEach(i=>{Array.from(i.attributes).forEach(o=>{(o.name.startsWith("on")||o.name==="javascript:")&&i.removeAttribute(o.name)})}),e.querySelectorAll("iframe").forEach(i=>i.remove()),e.innerHTML}catch(e){console.error("Error sanitizing HTML:",e);const r=document.createElement("div");return r.textContent=s,r.innerHTML}},z=()=>{n.name.length>100&&(n.name=n.name.substring(0,100)),n.name.trim()&&(l.name="")},D=s=>{const e=s.target;if(e.files){const r=Array.from(e.files),a=5-(d.value.length+f.value.length);r.length>a&&(alert(`Maksimal 5 gambar. Anda sudah memiliki ${d.value.length+f.value.length} gambar. Hanya ${a} gambar yang akan ditambahkan.`),r.splice(a));const m=20*1024*1024,i=[],o=[];r.forEach(u=>{if(!u.type.startsWith("image/")){o.push(`${u.name} (bukan file gambar)`);return}if(u.size>m){o.push(`${u.name} (melebihi 20MB)`);return}const b=URL.createObjectURL(u);i.push(Object.assign(u,{preview:b}))}),o.length>0&&alert(`File berikut tidak valid:
${o.join(`
`)}`),d.value.push(...i),_.value&&(_.value.value="")}},N=s=>{URL.revokeObjectURL(d.value[s].preview),d.value.splice(s,1)},O=s=>{f.value.splice(s,1)},Q=s=>{if(s===0)return"0 Bytes";const e=1024,r=["Bytes","KB","MB","GB"],a=Math.floor(Math.log(s)/Math.log(e));return Math.round(s/Math.pow(e,a)*100)/100+" "+r[a]},G=()=>{var r;let s=!0;l.name="",l.status="",l.description="",!n.name||!n.name.trim()?(l.name="Nama program wajib diisi",s=!1):n.name.length>100&&(l.name="Nama program maksimal 100 karakter",s=!1),n.status||(l.status="Status wajib dipilih",s=!1);let e="";if(c)e=c.getText().trim();else{const a=document.createElement("div");a.innerHTML=n.description||"",e=((r=a.textContent)==null?void 0:r.trim())||""}return e||(l.description="Deskripsi wajib diisi",s=!1),s},W=async()=>{if(v.value&&y.params.id){const s=y.params.id;try{const r=await(await fetch(`/admin/api/landing-program/${s}`,{headers:{"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"})).json();if(r.success&&r.data){const a=r.data;if(n.name=a.name||"",n.status=a.is_active?"active":"inactive",n.highlight=a.is_highlight?"yes":"no",n.description=a.description||"",a.image_url){const m=a.image_url.startsWith("http")?a.image_url:`/storage/${a.image_url}`;f.value=[{url:m,name:a.name}]}}}catch(e){console.error("Failed to load landing program",e)}}},q=()=>{d.value.forEach(s=>{URL.revokeObjectURL(s.preview)}),E.push("/company/landing-program")},K=async()=>{var s;if(G())try{let e=n.description;c&&(e=c.root.innerHTML,n.description=e);const r=A(e),a=new FormData;if(a.append("name",n.name.trim()),a.append("status",n.status),n.highlight){const o=n.highlight==="yes"?"1":"0";a.append("is_highlight",o)}a.append("description",r),d.value.length>0&&a.append("image",d.value[0]);let i=((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"))||"";if(!i)try{const u=await(await fetch("/admin/api/csrf-token")).json();i=(u==null?void 0:u.token)||""}catch{}i&&a.append("_token",i);try{const o={};if(i&&(o["X-CSRF-TOKEN"]=i),v.value){a.append("_method","PUT");const b=await(await fetch(`/admin/api/landing-program/${y.params.id}`,{method:"POST",headers:o,body:a,credentials:"same-origin"})).json();if(b.success)alert("Landing program berhasil diupdate");else throw new Error(b.message||"Validation failed")}else{const b=await(await fetch("/admin/api/landing-program",{method:"POST",headers:o,body:a,credentials:"same-origin"})).json();if(b.success)alert("Landing program berhasil dibuat");else throw new Error(b.message||"Validation failed")}}catch(o){console.error("Save error:",o),alert("Terjadi kesalahan saat menyimpan data: "+(o.message||""));return}E.push("/company/landing-program")}catch(e){console.error("Error saving:",e),alert("Terjadi kesalahan saat menyimpan data")}};return Z(async()=>{await W(),await T(),await V(),await T(),c&&n.description&&(c.root.innerHTML=n.description)}),ee(()=>{d.value.forEach(s=>{URL.revokeObjectURL(s.preview)}),c&&(c=null)}),(s,e)=>(g(),te(oe,null,{default:ae(()=>[j(ie,{pageTitle:S.value},null,8,["pageTitle"]),t("div",le,[t("div",de,[t("h3",ce,h(S.value),1),t("button",{onClick:q,class:"flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03]"}," Batal ")]),t("form",{onSubmit:re(K,["prevent"]),class:"flex flex-col"},[t("div",ue,[t("div",me,[e[5]||(e[5]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[x(" Nama Program "),t("span",{class:"text-red-500"},"*")],-1)),se(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=r=>n.name=r),onInput:z,placeholder:"Masukkan nama program",required:"",maxlength:"100",class:L(["dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",{"border-red-300 dark:border-red-500":l.name}])},null,34),[[ne,n.name]]),t("div",ge,[l.name?(g(),p("span",pe,h(l.name),1)):(g(),p("span",he)),t("span",be,h(n.name.length)+"/100 karakter ",1)])]),t("div",fe,[e[6]||(e[6]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[x(" Status "),t("span",{class:"text-red-500"},"*")],-1)),j(P,{modelValue:n.status,"onUpdate:modelValue":e[1]||(e[1]=r=>n.status=r),options:U,placeholder:"Pilih status",searchInput:I.value,"onUpdate:searchInput":e[2]||(e[2]=r=>I.value=r)},null,8,["modelValue","searchInput"]),l.status?(g(),p("span",ke,h(l.status),1)):w("",!0)]),t("div",ye,[e[7]||(e[7]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Highlight ",-1)),j(P,{modelValue:n.highlight,"onUpdate:modelValue":e[3]||(e[3]=r=>n.highlight=r),options:$,placeholder:"Pilih highlight",searchInput:C.value,"onUpdate:searchInput":e[4]||(e[4]=r=>C.value=r)},null,8,["modelValue","searchInput"])]),t("div",ve,[e[13]||(e[13]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Gambar Program ",-1)),t("div",xe,[t("div",we,[t("input",{type:"file",ref_key:"fileInputRef",ref:_,onChange:D,multiple:"",accept:"image/*",class:"hidden",id:"image-upload",disabled:d.value.length>=5},null,40,_e),t("label",{for:"image-upload",class:L(["flex cursor-pointer items-center justify-center rounded-lg border-2 border-dashed border-gray-300 bg-gray-50 px-6 py-8 text-center transition-colors hover:border-brand-300 hover:bg-gray-100 dark:border-gray-700 dark:bg-gray-900/50 dark:hover:border-brand-500",{"opacity-50 cursor-not-allowed":d.value.length>=5}])},[t("div",Me,[e[8]||(e[8]=t("svg",{class:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1)),e[9]||(e[9]=t("p",{class:"mt-2 text-sm text-gray-600 dark:text-gray-400"},[t("span",{class:"font-medium text-brand-500"},"Klik untuk upload"),x(" atau drag and drop ")],-1)),e[10]||(e[10]=t("p",{class:"text-xs text-gray-500 dark:text-gray-500"}," PNG, JPG, GIF, WEBP hingga 20MB (Maksimal 5 gambar) ",-1)),d.value.length>=5?(g(),p("p",Te," Maksimal 5 gambar sudah tercapai ")):w("",!0)])],2)]),d.value.length>0||f.value.length>0?(g(),p("div",je,[(g(!0),p(R,null,F(f.value,(r,a)=>(g(),p("div",{key:`existing-${a}`,class:"group relative aspect-square overflow-hidden rounded-lg border border-gray-200 bg-gray-100 dark:border-gray-700 dark:bg-gray-800"},[t("img",{src:r.url,alt:r.name||`Image ${a+1}`,class:"h-full w-full object-cover"},null,8,Le),t("button",{type:"button",onClick:m=>O(a),class:"absolute right-2 top-2 rounded-lg bg-red-500 p-1.5 text-white opacity-0 transition-opacity hover:bg-red-600 group-hover:opacity-100"},[...e[11]||(e[11]=[t("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Ee)]))),128)),(g(!0),p(R,null,F(d.value,(r,a)=>(g(),p("div",{key:`new-${a}`,class:"group relative aspect-square overflow-hidden rounded-lg border border-gray-200 bg-gray-100 dark:border-gray-700 dark:bg-gray-800"},[t("img",{src:r.preview,alt:r.name,class:"h-full w-full object-cover"},null,8,Se),t("button",{type:"button",onClick:m=>N(a),class:"absolute right-2 top-2 rounded-lg bg-red-500 p-1.5 text-white opacity-0 transition-opacity hover:bg-red-600 group-hover:opacity-100"},[...e[12]||(e[12]=[t("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Ie),t("div",Ce,[t("p",qe,h(r.name),1),t("p",Be,h(Q(r.size)),1)])]))),128))])):w("",!0)])]),t("div",He,[e[14]||(e[14]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[x(" Deskripsi "),t("span",{class:"text-red-500"},"*")],-1)),t("div",{ref_key:"quillEditorRef",ref:M,class:L(["min-h-[180px] rounded-lg border border-gray-300 dark:border-gray-700",{"border-red-300 dark:border-red-500":l.description}])},null,2),l.description?(g(),p("span",Re,h(l.description),1)):w("",!0),e[15]||(e[15]=t("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," Gunakan editor untuk memformat deskripsi program. Konten akan disanitasi untuk keamanan. ",-1))])]),e[16]||(e[16]=t("div",{class:"mt-16 flex items-center gap-3 lg:justify-end"},null,-1)),t("div",Fe,[t("button",{onClick:q,type:"button",class:"flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] sm:w-auto"}," Batal "),t("button",Pe,h(v.value?"Simpan Perubahan":"Simpan"),1)])],32)])]),_:1}))}});export{Ne as default};
