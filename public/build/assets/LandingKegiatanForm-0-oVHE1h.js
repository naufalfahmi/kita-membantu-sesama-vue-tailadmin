import{d as Y,r as k,H as Q,I as Z,A as B,a as I,o as ee,c as te,b as n,w as ae,e as C,f as t,t as i,p as re,i as m,j as l,g as u,l as v,v as b,u as se,F as $,k as K}from"./admin-BLQt5dm6.js";import{C as oe}from"./component-Baz6Fi63.js";import{_ as de}from"./AdminLayout.vue_vue_type_script_setup_true_lang-DVoyHdtI.js";import{_ as ne}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-DjRlBqWI.js";import{S as ie}from"./SearchableSelect-DIA02P8e.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const le={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},ce={class:"mb-6 flex items-center justify-between"},ge={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},ue={class:"grid grid-cols-1 gap-x-6 gap-y-5 lg:grid-cols-2"},pe={class:"lg:col-span-2"},me={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},be={key:0,class:"mt-1 text-xs text-red-500"},ke={class:"lg:col-span-1"},xe={key:0,class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},fe={key:1,class:"mt-1 text-xs text-red-500"},ye={class:"lg:col-span-1"},he={key:0,class:"mt-1 text-xs text-red-500"},ve={class:"lg:col-span-1"},_e={class:"lg:col-span-1"},we={class:"lg:col-span-1"},Me={class:"lg:col-span-1"},je={class:"lg:col-span-1"},Te={key:0,class:"mt-1 text-xs text-red-500"},Se={class:"lg:col-span-2"},Ce={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},Pe={key:0,class:"mt-1 text-xs text-red-500"},Ve={class:"lg:col-span-1"},Fe={key:0,class:"mt-1 text-xs text-red-500"},Ue={class:"lg:col-span-2"},Be={class:"space-y-4"},Ie={key:0,class:"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4"},$e=["src","alt"],Ke=["onClick"],Re=["src","alt"],Ae=["onClick"],Ee={class:"mt-1 text-xs text-gray-500 dark:text-gray-400 truncate"},Le={class:"text-xs text-gray-400 dark:text-gray-500"},Ne={key:0,class:"mt-1 text-xs text-red-500"},De={class:"lg:col-span-2"},Oe={class:"relative"},qe=["innerHTML"],Ge={key:0,class:"absolute top-2.5 left-4 text-sm text-gray-400 pointer-events-none"},He={key:0,class:"mt-1 text-xs text-red-500"},ze={class:"flex items-center gap-3 mt-6 lg:justify-end"},Je=["disabled"],at=Y({__name:"LandingKegiatanForm",setup(Xe){const R=[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"}],P=k(""),_=Q(),j=Z(),T=k(null),A=k(null),x=B(()=>_.params.id!==void 0&&_.params.id!=="new"),V=B(()=>x.value?"Edit Landing Kegiatan":"Tambah Landing Kegiatan"),f=k(!1),E={dateFormat:"Y-m-d",locale:{firstDayOfWeek:1}},a=I({title:"",number_of_recipients:0,village:"",district:"",city:"",province:"",postal_code:"",address:"",activity_date:"",status:"",description:""}),o=I({title:"",number_of_recipients:"",postal_code:"",address:"",activity_date:"",status:"",description:"",images:""}),w=k([]),M=k([]),S=k([]),L=r=>new Intl.NumberFormat("id-ID").format(r),N=r=>{const e=r.target;a.postal_code=e.value.replace(/[^0-9]/g,"")},D=r=>{const e=r.target;if(e.files){const s=Array.from(e.files),d=20*1024*1024,g=[],y=[];s.forEach(h=>{if(!["image/jpeg","image/jpg","image/png","image/webp"].includes(h.type)){y.push(`${h.name} (format tidak didukung)`);return}h.size>d?y.push(`${h.name} (melebihi 20MB)`):g.push(h)}),y.length>0&&alert(`File berikut tidak valid:
${y.join(`
`)}`),w.value.push(...g),T.value&&(T.value.value="")}},O=r=>{w.value.splice(r,1)},q=r=>{const e=M.value[r];S.value.push(e),M.value.splice(r,1)},G=r=>URL.createObjectURL(r),H=r=>{if(r===0)return"0 Bytes";const e=1024,s=["Bytes","KB","MB","GB"],d=Math.floor(Math.log(r)/Math.log(e));return Math.round(r/Math.pow(e,d)*100)/100+" "+s[d]},z=r=>{const e=r.target;a.description=e.innerHTML||""},J=()=>{let r=!0;return Object.keys(o).forEach(e=>{o[e]=""}),!a.title||a.title.trim()===""?(o.title="Nama kegiatan wajib diisi",r=!1):a.title.length>100&&(o.title="Nama kegiatan maksimal 100 karakter",r=!1),(!a.number_of_recipients||a.number_of_recipients<=0)&&(o.number_of_recipients="Total penerima manfaat wajib diisi dan harus lebih dari 0",r=!1),a.postal_code&&!/^[0-9]+$/.test(a.postal_code)&&(o.postal_code="Kode pos harus berupa angka",r=!1),!a.address||a.address.trim()===""?(o.address="Alamat wajib diisi",r=!1):a.address.length>1e3&&(o.address="Alamat maksimal 1000 karakter",r=!1),a.activity_date||(o.activity_date="Tanggal kegiatan wajib diisi",r=!1),a.status||(o.status="Status wajib diisi",r=!1),(!a.description||a.description.trim()==="")&&(o.description="Deskripsi wajib diisi",r=!1),r},X=async()=>{if(x.value&&_.params.id){const r=_.params.id;f.value=!0;try{const s=await(await fetch(`/admin/api/landing-kegiatan/${r}`,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin"})).json();if(s.success&&s.data){const d=s.data;if(a.title=d.title||"",a.number_of_recipients=d.number_of_recipients||0,a.village=d.village||"",a.district=d.district||"",a.city=d.city||"",a.province=d.province||"",a.postal_code=d.postal_code||"",a.address=d.address||"",a.activity_date=d.activity_date||"",a.status=d.status||"",a.description=d.description||"",d.images)try{const g=JSON.parse(d.images);Array.isArray(g)&&(M.value=g)}catch(g){console.error("Error parsing images:",g)}}else alert(s.message||"Gagal memuat data"),j.push("/company/landing-kegiatan")}catch(e){console.error("Error loading data:",e),alert("Terjadi kesalahan saat memuat data"),j.push("/company/landing-kegiatan")}finally{f.value=!1}}},F=()=>{j.push("/company/landing-kegiatan")},W=async()=>{if(J()){f.value=!0;try{const r=new FormData;r.append("title",a.title),r.append("number_of_recipients",a.number_of_recipients.toString()),r.append("village",a.village||""),r.append("district",a.district||""),r.append("city",a.city||""),r.append("province",a.province||""),r.append("postal_code",a.postal_code||""),r.append("address",a.address),r.append("activity_date",a.activity_date),r.append("status",a.status),r.append("description",a.description),w.value.forEach((c,U)=>{r.append(`images[${U}]`,c)}),S.value.length>0&&r.append("images_to_delete",JSON.stringify(S.value));let s=(()=>{var c;return((c=document.querySelector('meta[name="csrf-token"]'))==null?void 0:c.getAttribute("content"))||""})();if(!s)try{const c=await fetch("/admin/api/csrf-token",{credentials:"same-origin"});c.ok&&(s=(await c.json()).csrf_token||s)}catch{}s&&r.append("_token",s);const d=x.value?`/admin/api/landing-kegiatan/${_.params.id}`:"/admin/api/landing-kegiatan",g=x.value?"PUT":"POST",y=g==="PUT"?"POST":g;g==="PUT"&&r.append("_method","PUT");const p=await(await fetch(d,{method:y,headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json",...s?{"X-CSRF-TOKEN":s}:{}},credentials:"same-origin",body:r})).json();p.success?(alert(x.value?"Kegiatan berhasil diupdate":"Kegiatan berhasil ditambahkan"),j.push("/company/landing-kegiatan")):(p.errors&&Object.keys(p.errors).forEach(c=>{o.hasOwnProperty(c)&&(o[c]=Array.isArray(p.errors[c])?p.errors[c][0]:p.errors[c])}),alert(p.message||"Gagal menyimpan data"))}catch(r){console.error("Error saving:",r),alert("Terjadi kesalahan saat menyimpan data")}finally{f.value=!1}}};return ee(()=>{X()}),(r,e)=>(n(),te(de,null,{default:ae(()=>[C(ne,{pageTitle:V.value},null,8,["pageTitle"]),t("div",le,[t("div",ce,[t("h3",ge,i(V.value),1),t("button",{onClick:F,class:"flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03]"}," Batal ")]),t("form",{onSubmit:re(W,["prevent"]),class:"flex flex-col"},[t("div",ue,[t("div",pe,[e[11]||(e[11]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[v(" Nama Kegiatan "),t("span",{class:"text-red-500"},"*")],-1)),m(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>a.title=s),placeholder:"Masukkan nama kegiatan",maxlength:"100",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[b,a.title]]),t("p",me,i(a.title.length)+"/100 karakter ",1),o.title?(n(),l("p",be,i(o.title),1)):u("",!0)]),t("div",ke,[e[12]||(e[12]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[v(" Total Penerima Manfaat "),t("span",{class:"text-red-500"},"*")],-1)),m(t("input",{type:"number","onUpdate:modelValue":e[1]||(e[1]=s=>a.number_of_recipients=s),placeholder:"Masukkan total penerima manfaat",min:"1",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[b,a.number_of_recipients,void 0,{number:!0}]]),a.number_of_recipients?(n(),l("p",xe,i(L(a.number_of_recipients))+" penerima ",1)):u("",!0),o.number_of_recipients?(n(),l("p",fe,i(o.number_of_recipients),1)):u("",!0)]),t("div",ye,[e[13]||(e[13]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[v(" Tanggal Kegiatan "),t("span",{class:"text-red-500"},"*")],-1)),C(se(oe),{modelValue:a.activity_date,"onUpdate:modelValue":e[2]||(e[2]=s=>a.activity_date=s),config:E,class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",placeholder:"Pilih tanggal kegiatan"},null,8,["modelValue"]),o.activity_date?(n(),l("p",he,i(o.activity_date),1)):u("",!0)]),t("div",ve,[e[14]||(e[14]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Provinsi ",-1)),m(t("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=s=>a.province=s),placeholder:"Masukkan provinsi",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[b,a.province]])]),t("div",_e,[e[15]||(e[15]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kota ",-1)),m(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=s=>a.city=s),placeholder:"Masukkan kota",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[b,a.city]])]),t("div",we,[e[16]||(e[16]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kecamatan ",-1)),m(t("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=s=>a.district=s),placeholder:"Masukkan kecamatan",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[b,a.district]])]),t("div",Me,[e[17]||(e[17]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kelurahan ",-1)),m(t("input",{type:"text","onUpdate:modelValue":e[6]||(e[6]=s=>a.village=s),placeholder:"Masukkan kelurahan",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[b,a.village]])]),t("div",je,[e[18]||(e[18]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kode Pos ",-1)),m(t("input",{type:"text","onUpdate:modelValue":e[7]||(e[7]=s=>a.postal_code=s),placeholder:"Masukkan kode pos",pattern:"[0-9]*",onInput:N,class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,544),[[b,a.postal_code]]),o.postal_code?(n(),l("p",Te,i(o.postal_code),1)):u("",!0)]),t("div",Se,[e[19]||(e[19]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[v(" Alamat "),t("span",{class:"text-red-500"},"*")],-1)),m(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=s=>a.address=s),placeholder:"Masukkan alamat lengkap",maxlength:"1000",rows:"3",required:"",class:"dark:bg-dark-900 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[b,a.address]]),t("p",Ce,i(a.address.length)+"/1000 karakter ",1),o.address?(n(),l("p",Pe,i(o.address),1)):u("",!0)]),t("div",Ve,[e[20]||(e[20]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[v(" Status "),t("span",{class:"text-red-500"},"*")],-1)),C(ie,{modelValue:a.status,"onUpdate:modelValue":e[9]||(e[9]=s=>a.status=s),options:R,placeholder:"Pilih Status","search-input":P.value,"onUpdate:searchInput":e[10]||(e[10]=s=>P.value=s)},null,8,["modelValue","search-input"]),o.status?(n(),l("p",Fe,i(o.status),1)):u("",!0)]),t("div",Ue,[e[24]||(e[24]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Gambar Program ",-1)),t("div",Be,[t("div",null,[t("input",{ref_key:"fileInputRef",ref:T,type:"file",multiple:"",accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:D,class:"dark:bg-dark-900 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus:border-brand-800"},null,544),e[21]||(e[21]=t("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," Format: JPG, PNG, WebP. Maksimal 20MB per file. ",-1))]),w.value.length>0||M.value.length>0?(n(),l("div",Ie,[(n(!0),l($,null,K(M.value,(s,d)=>(n(),l("div",{key:`existing-${d}`,class:"relative group"},[t("img",{src:`/storage/${s}`,alt:`Image ${d+1}`,class:"h-32 w-full rounded-lg object-cover border border-gray-300 dark:border-gray-700"},null,8,$e),t("button",{type:"button",onClick:g=>q(d),class:"absolute top-2 right-2 flex items-center justify-center w-6 h-6 rounded-full bg-red-500 text-white opacity-0 group-hover:opacity-100 transition-opacity"},[...e[22]||(e[22]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M18 6L6 18M6 6l12 12"})],-1)])],8,Ke)]))),128)),(n(!0),l($,null,K(w.value,(s,d)=>(n(),l("div",{key:`new-${d}`,class:"relative group"},[t("img",{src:G(s),alt:s.name,class:"h-32 w-full rounded-lg object-cover border border-gray-300 dark:border-gray-700"},null,8,Re),t("button",{type:"button",onClick:g=>O(d),class:"absolute top-2 right-2 flex items-center justify-center w-6 h-6 rounded-full bg-red-500 text-white opacity-0 group-hover:opacity-100 transition-opacity"},[...e[23]||(e[23]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M18 6L6 18M6 6l12 12"})],-1)])],8,Ae),t("p",Ee,i(s.name),1),t("p",Le,i(H(s.size)),1)]))),128))])):u("",!0)]),o.images?(n(),l("p",Ne,i(o.images),1)):u("",!0)]),t("div",De,[e[25]||(e[25]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[v(" Deskripsi "),t("span",{class:"text-red-500"},"*")],-1)),t("div",Oe,[t("div",{ref_key:"editorRef",ref:A,contenteditable:"true",innerHTML:a.description,onInput:z,class:"dark:bg-dark-900 min-h-[200px] w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",style:{"white-space":"pre-wrap"}},null,40,qe),a.description?u("",!0):(n(),l("p",Ge," Masukkan deskripsi kegiatan... "))]),o.description?(n(),l("p",He,i(o.description),1)):u("",!0)])]),t("div",ze,[t("button",{onClick:F,type:"button",class:"flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] sm:w-auto"}," Batal "),t("button",{type:"submit",disabled:f.value,class:"flex w-full justify-center rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600 disabled:opacity-50 disabled:cursor-not-allowed sm:w-auto"},i(f.value?"Menyimpan...":x.value?"Simpan Perubahan":"Simpan"),9,Je)])],32)])]),_:1}))}});export{at as default};
