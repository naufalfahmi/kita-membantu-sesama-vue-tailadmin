import{d as x,H as w,I as v,L as _,A as u,e as T,f as j,g as S,o as C,w as P,a as e,t as h,q as R,k as E,m as F,v as M}from"./admin-axaASgxu.js";import{_ as q}from"./AdminLayout.vue_vue_type_script_setup_true_lang-wyAusURk.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const N={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},X={class:"mb-6 flex items-center justify-between"},B={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},G={class:"grid grid-cols-1 gap-x-6 gap-y-5 lg:grid-cols-2"},O={class:"lg:col-span-1"},A={class:"flex items-center gap-3 mt-6 lg:justify-end"},D={type:"submit",class:"flex w-full justify-center rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600 sm:w-auto"},K=x({__name:"PangkatForm",setup(V){const i=w(),c=v(),r=_(),n=u(()=>i.params.id!==void 0&&i.params.id!=="new"),k=u(()=>n.value?"Edit Pangkat":"Tambah Pangkat"),d=T({nama:""}),m=async()=>{var t;try{const a=(t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content");if(a)return a;const s=await fetch("/admin/api/csrf-token",{method:"GET",credentials:"same-origin"});if(!s.ok)throw new Error("Failed to fetch CSRF token");return(await s.json()).csrf_token||""}catch(a){return console.error("Failed to get CSRF token",a),""}},b=async()=>{if(n.value&&i.params.id){const t=i.params.id;try{const a=await m(),o=await(await fetch(`/admin/api/pangkat/${t}`,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Accept:"application/json","X-CSRF-TOKEN":a},credentials:"same-origin"})).json();if(o.success&&o.data){const p=o.data;d.nama=p.nama||""}else r.error("Gagal memuat data pangkat"),c.push("/administrasi/pangkat")}catch(a){console.error("Error loading pangkat:",a),r.error("Terjadi kesalahan saat memuat data"),c.push("/administrasi/pangkat")}}},g=()=>{c.push("/administrasi/pangkat")},f=async()=>{if(!d.nama){r.error("Nama Pangkat wajib diisi");return}try{const t=await m();if(!t){r.error("Gagal mendapatkan CSRF token. Silakan refresh halaman.");return}const a={nama:d.nama},s=n.value?`/admin/api/pangkat/${i.params.id}`:"/admin/api/pangkat",o=n.value?"PUT":"POST",l=await(await fetch(s,{method:o,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Accept:"application/json","X-CSRF-TOKEN":t},credentials:"same-origin",body:JSON.stringify(a)})).json();if(l.success)r.success(n.value?"Pangkat berhasil diupdate":"Pangkat berhasil ditambahkan"),c.push("/administrasi/pangkat");else if(l.errors){const y=Object.values(l.errors).flat().join(", ");r.error(`Validasi gagal: ${y}`)}else r.error(l.message||"Gagal menyimpan data")}catch(t){console.error("Error saving:",t),r.error("Terjadi kesalahan saat menyimpan data")}};return j(async()=>{await b()}),(t,a)=>(C(),S(q,null,{default:P(()=>[e("div",N,[e("div",X,[e("h3",B,h(k.value),1),e("button",{onClick:g,class:"flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03]"}," Batal ")]),e("form",{onSubmit:R(f,["prevent"]),class:"flex flex-col"},[e("div",G,[e("div",O,[a[1]||(a[1]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[F(" Nama Pangkat "),e("span",{class:"text-red-500"},"*")],-1)),E(e("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=s=>d.nama=s),placeholder:"Masukkan nama pangkat",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[M,d.nama]])])]),e("div",A,[e("button",{onClick:g,type:"button",class:"flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] sm:w-auto"}," Batal "),e("button",D,h(n.value?"Simpan Perubahan":"Simpan"),1)])],32)])]),_:1}))}});export{K as default};
