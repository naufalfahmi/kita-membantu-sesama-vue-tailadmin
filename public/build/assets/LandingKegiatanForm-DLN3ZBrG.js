import{d as Q,r as k,H as Z,I as ee,A as I,L as te,a as $,o as ae,c as re,b as n,w as se,e as P,f as t,t as i,p as oe,i as m,j as l,g as u,l as _,v as b,u as de,F as K,k as L}from"./admin-DIRzPgYS.js";import{C as ne}from"./component-BCiyr74j.js";import{_ as ie}from"./AdminLayout.vue_vue_type_script_setup_true_lang-CWOKtzRo.js";import{_ as le}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-C4MnS40B.js";import{S as ce}from"./SearchableSelect-D5MHE2YQ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ge={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},ue={class:"mb-6 flex items-center justify-between"},pe={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},me={class:"grid grid-cols-1 gap-x-6 gap-y-5 lg:grid-cols-2"},be={class:"lg:col-span-2"},ke={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},xe={key:0,class:"mt-1 text-xs text-red-500"},fe={class:"lg:col-span-1"},ye={key:0,class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},he={key:1,class:"mt-1 text-xs text-red-500"},ve={class:"lg:col-span-1"},_e={key:0,class:"mt-1 text-xs text-red-500"},we={class:"lg:col-span-1"},Me={class:"lg:col-span-1"},je={class:"lg:col-span-1"},Te={class:"lg:col-span-1"},Se={class:"lg:col-span-1"},Ce={key:0,class:"mt-1 text-xs text-red-500"},Pe={class:"lg:col-span-2"},Ve={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},Fe={key:0,class:"mt-1 text-xs text-red-500"},Ue={class:"lg:col-span-1"},Be={key:0,class:"mt-1 text-xs text-red-500"},Ie={class:"lg:col-span-2"},$e={class:"space-y-4"},Ke={key:0,class:"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4"},Le=["src","alt"],Re=["onClick"],Ae=["src","alt"],Ee=["onClick"],Ne={class:"mt-1 text-xs text-gray-500 dark:text-gray-400 truncate"},De={class:"text-xs text-gray-400 dark:text-gray-500"},Oe={key:0,class:"mt-1 text-xs text-red-500"},qe={class:"lg:col-span-2"},Ge={class:"relative"},He=["innerHTML"],ze={key:0,class:"absolute top-2.5 left-4 text-sm text-gray-400 pointer-events-none"},Je={key:0,class:"mt-1 text-xs text-red-500"},Xe={class:"flex items-center gap-3 mt-6 lg:justify-end"},We=["disabled"],st=Q({__name:"LandingKegiatanForm",setup(Ye){const R=[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"}],V=k(""),w=Z(),T=ee(),S=k(null),A=k(null),x=I(()=>w.params.id!==void 0&&w.params.id!=="new"),F=I(()=>x.value?"Edit Landing Kegiatan":"Tambah Landing Kegiatan"),f=k(!1),y=te(),E={dateFormat:"Y-m-d",locale:{firstDayOfWeek:1}},a=$({title:"",number_of_recipients:0,village:"",district:"",city:"",province:"",postal_code:"",address:"",activity_date:"",status:"",description:""}),o=$({title:"",number_of_recipients:"",postal_code:"",address:"",activity_date:"",status:"",description:"",images:""}),M=k([]),j=k([]),C=k([]),N=r=>new Intl.NumberFormat("id-ID").format(r),D=r=>{const e=r.target;a.postal_code=e.value.replace(/[^0-9]/g,"")},O=r=>{const e=r.target;if(e.files){const s=Array.from(e.files),d=20*1024*1024,g=[],h=[];s.forEach(v=>{if(!["image/jpeg","image/jpg","image/png","image/webp"].includes(v.type)){h.push(`${v.name} (format tidak didukung)`);return}v.size>d?h.push(`${v.name} (melebihi 20MB)`):g.push(v)}),h.length>0&&y.error(`File berikut tidak valid:
${h.join(`
`)}`),M.value.push(...g),S.value&&(S.value.value="")}},q=r=>{M.value.splice(r,1)},G=r=>{const e=j.value[r];C.value.push(e),j.value.splice(r,1)},H=r=>URL.createObjectURL(r),z=r=>{if(r===0)return"0 Bytes";const e=1024,s=["Bytes","KB","MB","GB"],d=Math.floor(Math.log(r)/Math.log(e));return Math.round(r/Math.pow(e,d)*100)/100+" "+s[d]},J=r=>{const e=r.target;a.description=e.innerHTML||""},X=()=>{let r=!0;return Object.keys(o).forEach(e=>{o[e]=""}),!a.title||a.title.trim()===""?(o.title="Nama kegiatan wajib diisi",r=!1):a.title.length>100&&(o.title="Nama kegiatan maksimal 100 karakter",r=!1),(!a.number_of_recipients||a.number_of_recipients<=0)&&(o.number_of_recipients="Total penerima manfaat wajib diisi dan harus lebih dari 0",r=!1),a.postal_code&&!/^[0-9]+$/.test(a.postal_code)&&(o.postal_code="Kode pos harus berupa angka",r=!1),!a.address||a.address.trim()===""?(o.address="Alamat wajib diisi",r=!1):a.address.length>1e3&&(o.address="Alamat maksimal 1000 karakter",r=!1),a.activity_date||(o.activity_date="Tanggal kegiatan wajib diisi",r=!1),a.status||(o.status="Status wajib diisi",r=!1),(!a.description||a.description.trim()==="")&&(o.description="Deskripsi wajib diisi",r=!1),r},W=async()=>{if(x.value&&w.params.id){const r=w.params.id;f.value=!0;try{const s=await(await fetch(`/admin/api/landing-kegiatan/${r}`,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin"})).json();if(s.success&&s.data){const d=s.data;if(a.title=d.title||"",a.number_of_recipients=d.number_of_recipients||0,a.village=d.village||"",a.district=d.district||"",a.city=d.city||"",a.province=d.province||"",a.postal_code=d.postal_code||"",a.address=d.address||"",a.activity_date=d.activity_date||"",a.status=d.status||"",a.description=d.description||"",d.images)try{const g=JSON.parse(d.images);Array.isArray(g)&&(j.value=g)}catch(g){console.error("Error parsing images:",g)}}else y.error(s.message||"Gagal memuat data"),T.push("/company/landing-kegiatan")}catch(e){console.error("Error loading data:",e),y.error("Terjadi kesalahan saat memuat data"),T.push("/company/landing-kegiatan")}finally{f.value=!1}}},U=()=>{T.push("/company/landing-kegiatan")},Y=async()=>{if(X()){f.value=!0;try{const r=new FormData;r.append("title",a.title),r.append("number_of_recipients",a.number_of_recipients.toString()),r.append("village",a.village||""),r.append("district",a.district||""),r.append("city",a.city||""),r.append("province",a.province||""),r.append("postal_code",a.postal_code||""),r.append("address",a.address),r.append("activity_date",a.activity_date),r.append("status",a.status),r.append("description",a.description),M.value.forEach((c,B)=>{r.append(`images[${B}]`,c)}),C.value.length>0&&r.append("images_to_delete",JSON.stringify(C.value));let s=(()=>{var c;return((c=document.querySelector('meta[name="csrf-token"]'))==null?void 0:c.getAttribute("content"))||""})();if(!s)try{const c=await fetch("/admin/api/csrf-token",{credentials:"same-origin"});c.ok&&(s=(await c.json()).csrf_token||s)}catch{}s&&r.append("_token",s);const d=x.value?`/admin/api/landing-kegiatan/${w.params.id}`:"/admin/api/landing-kegiatan",g=x.value?"PUT":"POST",h=g==="PUT"?"POST":g;g==="PUT"&&r.append("_method","PUT");const p=await(await fetch(d,{method:h,headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json",...s?{"X-CSRF-TOKEN":s}:{}},credentials:"same-origin",body:r})).json();p.success?(y.success(x.value?"Kegiatan berhasil diupdate":"Kegiatan berhasil ditambahkan"),T.push("/company/landing-kegiatan")):(p.errors&&Object.keys(p.errors).forEach(c=>{o.hasOwnProperty(c)&&(o[c]=Array.isArray(p.errors[c])?p.errors[c][0]:p.errors[c])}),y.error(p.message||"Gagal menyimpan data"))}catch(r){console.error("Error saving:",r),y.error("Terjadi kesalahan saat menyimpan data")}finally{f.value=!1}}};return ae(()=>{W()}),(r,e)=>(n(),re(ie,null,{default:se(()=>[P(le,{pageTitle:F.value},null,8,["pageTitle"]),t("div",ge,[t("div",ue,[t("h3",pe,i(F.value),1),t("button",{onClick:U,class:"flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03]"}," Batal ")]),t("form",{onSubmit:oe(Y,["prevent"]),class:"flex flex-col"},[t("div",me,[t("div",be,[e[11]||(e[11]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[_(" Nama Kegiatan "),t("span",{class:"text-red-500"},"*")],-1)),m(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>a.title=s),placeholder:"Masukkan nama kegiatan",maxlength:"100",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[b,a.title]]),t("p",ke,i(a.title.length)+"/100 karakter ",1),o.title?(n(),l("p",xe,i(o.title),1)):u("",!0)]),t("div",fe,[e[12]||(e[12]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[_(" Total Penerima Manfaat "),t("span",{class:"text-red-500"},"*")],-1)),m(t("input",{type:"number","onUpdate:modelValue":e[1]||(e[1]=s=>a.number_of_recipients=s),placeholder:"Masukkan total penerima manfaat",min:"1",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[b,a.number_of_recipients,void 0,{number:!0}]]),a.number_of_recipients?(n(),l("p",ye,i(N(a.number_of_recipients))+" penerima ",1)):u("",!0),o.number_of_recipients?(n(),l("p",he,i(o.number_of_recipients),1)):u("",!0)]),t("div",ve,[e[13]||(e[13]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[_(" Tanggal Kegiatan "),t("span",{class:"text-red-500"},"*")],-1)),P(de(ne),{modelValue:a.activity_date,"onUpdate:modelValue":e[2]||(e[2]=s=>a.activity_date=s),config:E,class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",placeholder:"Pilih tanggal kegiatan"},null,8,["modelValue"]),o.activity_date?(n(),l("p",_e,i(o.activity_date),1)):u("",!0)]),t("div",we,[e[14]||(e[14]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Provinsi ",-1)),m(t("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=s=>a.province=s),placeholder:"Masukkan provinsi",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[b,a.province]])]),t("div",Me,[e[15]||(e[15]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kota ",-1)),m(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=s=>a.city=s),placeholder:"Masukkan kota",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[b,a.city]])]),t("div",je,[e[16]||(e[16]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kecamatan ",-1)),m(t("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=s=>a.district=s),placeholder:"Masukkan kecamatan",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[b,a.district]])]),t("div",Te,[e[17]||(e[17]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kelurahan ",-1)),m(t("input",{type:"text","onUpdate:modelValue":e[6]||(e[6]=s=>a.village=s),placeholder:"Masukkan kelurahan",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[b,a.village]])]),t("div",Se,[e[18]||(e[18]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kode Pos ",-1)),m(t("input",{type:"text","onUpdate:modelValue":e[7]||(e[7]=s=>a.postal_code=s),placeholder:"Masukkan kode pos",pattern:"[0-9]*",onInput:D,class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,544),[[b,a.postal_code]]),o.postal_code?(n(),l("p",Ce,i(o.postal_code),1)):u("",!0)]),t("div",Pe,[e[19]||(e[19]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[_(" Alamat "),t("span",{class:"text-red-500"},"*")],-1)),m(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=s=>a.address=s),placeholder:"Masukkan alamat lengkap",maxlength:"1000",rows:"3",required:"",class:"dark:bg-dark-900 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[b,a.address]]),t("p",Ve,i(a.address.length)+"/1000 karakter ",1),o.address?(n(),l("p",Fe,i(o.address),1)):u("",!0)]),t("div",Ue,[e[20]||(e[20]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[_(" Status "),t("span",{class:"text-red-500"},"*")],-1)),P(ce,{modelValue:a.status,"onUpdate:modelValue":e[9]||(e[9]=s=>a.status=s),options:R,placeholder:"Pilih Status","search-input":V.value,"onUpdate:searchInput":e[10]||(e[10]=s=>V.value=s)},null,8,["modelValue","search-input"]),o.status?(n(),l("p",Be,i(o.status),1)):u("",!0)]),t("div",Ie,[e[24]||(e[24]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Gambar Program ",-1)),t("div",$e,[t("div",null,[t("input",{ref_key:"fileInputRef",ref:S,type:"file",multiple:"",accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:O,class:"dark:bg-dark-900 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus:border-brand-800"},null,544),e[21]||(e[21]=t("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," Format: JPG, PNG, WebP. Maksimal 20MB per file. ",-1))]),M.value.length>0||j.value.length>0?(n(),l("div",Ke,[(n(!0),l(K,null,L(j.value,(s,d)=>(n(),l("div",{key:`existing-${d}`,class:"relative group"},[t("img",{src:`/storage/${s}`,alt:`Image ${d+1}`,class:"h-32 w-full rounded-lg object-cover border border-gray-300 dark:border-gray-700"},null,8,Le),t("button",{type:"button",onClick:g=>G(d),class:"absolute top-2 right-2 flex items-center justify-center w-6 h-6 rounded-full bg-red-500 text-white opacity-0 group-hover:opacity-100 transition-opacity"},[...e[22]||(e[22]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M18 6L6 18M6 6l12 12"})],-1)])],8,Re)]))),128)),(n(!0),l(K,null,L(M.value,(s,d)=>(n(),l("div",{key:`new-${d}`,class:"relative group"},[t("img",{src:H(s),alt:s.name,class:"h-32 w-full rounded-lg object-cover border border-gray-300 dark:border-gray-700"},null,8,Ae),t("button",{type:"button",onClick:g=>q(d),class:"absolute top-2 right-2 flex items-center justify-center w-6 h-6 rounded-full bg-red-500 text-white opacity-0 group-hover:opacity-100 transition-opacity"},[...e[23]||(e[23]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M18 6L6 18M6 6l12 12"})],-1)])],8,Ee),t("p",Ne,i(s.name),1),t("p",De,i(z(s.size)),1)]))),128))])):u("",!0)]),o.images?(n(),l("p",Oe,i(o.images),1)):u("",!0)]),t("div",qe,[e[25]||(e[25]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[_(" Deskripsi "),t("span",{class:"text-red-500"},"*")],-1)),t("div",Ge,[t("div",{ref_key:"editorRef",ref:A,contenteditable:"true",innerHTML:a.description,onInput:J,class:"dark:bg-dark-900 min-h-[200px] w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",style:{"white-space":"pre-wrap"}},null,40,He),a.description?u("",!0):(n(),l("p",ze," Masukkan deskripsi kegiatan... "))]),o.description?(n(),l("p",Je,i(o.description),1)):u("",!0)])]),t("div",Xe,[t("button",{onClick:U,type:"button",class:"flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] sm:w-auto"}," Batal "),t("button",{type:"submit",disabled:f.value,class:"flex w-full justify-center rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600 disabled:opacity-50 disabled:cursor-not-allowed sm:w-auto"},i(f.value?"Menyimpan...":x.value?"Simpan Perubahan":"Simpan"),9,We)])],32)])]),_:1}))}});export{st as default};
