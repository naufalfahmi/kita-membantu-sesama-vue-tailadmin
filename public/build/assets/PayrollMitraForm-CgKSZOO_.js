import{d as J,H as D,I as F,L as G,A as o,b as n,f as q,P as E,g as I,o as $,w as A,a as t,t as w,q as H,j,m as p,k as _,v as P}from"./admin-BxxhZ4af.js";import{_ as K}from"./AdminLayout.vue_vue_type_script_setup_true_lang-DRw1DB75.js";import{S}from"./SearchableSelect-BgAGHaiG.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const L={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},X={class:"mb-6 flex items-center justify-between"},z={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},Q={class:"mb-6 grid grid-cols-1 gap-4 lg:grid-cols-2"},W=["value"],Y={class:"flex items-center gap-3 mt-6 lg:justify-end"},Z=["disabled"],oa=J({__name:"PayrollMitraForm",setup(aa){const i=D(),g=F(),l=G(),{fetchUser:M}=E(),d=o(()=>i.params.id!==void 0&&i.params.id!=="new"),N=o(()=>d.value?"Edit Payroll Mitra":"Tambah Payroll Mitra"),u=n(!1),c=n([]),b=n([]),y=n(""),v=n(""),T=o(()=>c.value.map(s=>({value:s.id,label:s.nama}))),V=o(()=>b.value.map(s=>({value:s.id,label:s.nama_program}))),r=n({mitra_id:"",program_id:"",nama_mitra:"",jumlah:0,persentase:0,total:0}),x=o(()=>{const s=Number(r.value.jumlah)||0,a=Number(r.value.persentase)||0;return Number(s*a/100)}),f=o({get(){return(Number(r.value.persentase)||0).toFixed(0)},set(s){const a=String(s).replace(/%/g,"").replace(/,/g,"").trim(),e=parseFloat(a);r.value.persentase=isNaN(e)?0:e}}),R=async()=>{try{const[s,a]=await Promise.all([fetch("/admin/api/mitra?per_page=1000",{credentials:"same-origin"}),fetch("/admin/api/program?per_page=1000",{credentials:"same-origin"})]),e=await s.json(),m=await a.json();c.value=e.success?e.data:[],b.value=m.success?m.data:[]}catch{}},U=async s=>{try{const e=await(await fetch(`/admin/api/mitra-payroll/${s}`,{credentials:"same-origin"})).json();e.success?(Object.assign(r.value,e.data),e.data.mitra&&e.data.mitra.id&&(r.value.mitra_id=e.data.mitra.id),e.data.program&&e.data.program.id&&(r.value.program_id=e.data.program.id)):l.error("Gagal memuat data")}catch{l.error("Gagal memuat data")}},O=async()=>{if(!r.value.jumlah||!r.value.persentase){l.error("Jumlah dan persentase wajib diisi");return}u.value=!0;try{if(r.value.mitra_id){const k=c.value.find(B=>B.id===r.value.mitra_id);r.value.nama_mitra=k?k.nama:""}r.value.total=x.value;const s=d.value?`/admin/api/mitra-payroll/${i.params.id}`:"/admin/api/mitra-payroll",a=d.value?"PUT":"POST",m=(await(await fetch("/admin/api/csrf-token",{credentials:"same-origin"})).json()).csrf_token,h=await(await fetch(s,{method:a,headers:{"Content-Type":"application/json","X-CSRF-TOKEN":m},credentials:"same-origin",body:JSON.stringify(r.value)})).json();h.success?(l.success("Berhasil"),g.push("/user-kepegawaian/payroll-mitra")):l.error(h.message||"Gagal menyimpan")}catch{l.error("Gagal menyimpan")}finally{u.value=!1}},C=()=>g.push("/user-kepegawaian/payroll-mitra");return q(async()=>{await M(),await R(),d.value&&i.params.id&&await U(i.params.id)}),(s,a)=>($(),I(K,null,{default:A(()=>[t("div",L,[t("div",X,[t("h3",z,w(N.value),1)]),t("form",{onSubmit:H(O,["prevent"]),class:"flex flex-col"},[t("div",Q,[t("div",null,[a[6]||(a[6]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[p("Pilih Mitra "),t("span",{class:"text-red-500"},"*")],-1)),j(S,{modelValue:r.value.mitra_id,"onUpdate:modelValue":a[0]||(a[0]=e=>r.value.mitra_id=e),options:T.value,placeholder:"Pilih Mitra","search-input":y.value,"onUpdate:searchInput":a[1]||(a[1]=e=>y.value=e)},null,8,["modelValue","options","search-input"])]),t("div",null,[a[7]||(a[7]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[p("Pilih Program "),t("span",{class:"text-red-500"},"*")],-1)),j(S,{modelValue:r.value.program_id,"onUpdate:modelValue":a[2]||(a[2]=e=>r.value.program_id=e),options:V.value,placeholder:"Pilih Program","search-input":v.value,"onUpdate:searchInput":a[3]||(a[3]=e=>v.value=e)},null,8,["modelValue","options","search-input"])]),t("div",null,[a[8]||(a[8]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[p("Jumlah "),t("span",{class:"text-red-500"},"*")],-1)),_(t("input",{type:"number","onUpdate:modelValue":a[4]||(a[4]=e=>r.value.jumlah=e),placeholder:"Masukkan jumlah",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90"},null,512),[[P,r.value.jumlah,void 0,{number:!0}]])]),t("div",null,[a[9]||(a[9]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[p("Persentase (%) "),t("span",{class:"text-red-500"},"*")],-1)),_(t("input",{type:"text","onUpdate:modelValue":a[5]||(a[5]=e=>f.value=e),placeholder:"Masukkan persentase",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90"},null,512),[[P,f.value]])]),t("div",null,[a[10]||(a[10]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"Total",-1)),t("input",{type:"number",value:x.value,readonly:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400"},null,8,W),a[11]||(a[11]=t("p",{class:"text-xs text-gray-500 mt-1"},"Total dihitung otomatis: jumlah Ã— persentase / 100",-1))])]),t("div",Y,[t("button",{onClick:C,type:"button",class:"flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 sm:w-auto"},"Batal"),t("button",{type:"submit",disabled:u.value,class:"flex items-center gap-2 rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600 sm:w-auto"},w(u.value?"Menyimpan...":"Simpan"),9,Z)])],32)])]),_:1}))}});export{oa as default};
