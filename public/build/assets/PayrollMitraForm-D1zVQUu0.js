import{d as Z,H as aa,I as ea,L as ta,A as u,b as p,B as ra,f as sa,P as la,g as oa,o as j,w as na,a as t,t as v,q as ia,j as P,m as x,u as ua,k as I,v as U,c as T,i as da,n as ma}from"./admin-BGttm7We.js";import{_ as pa}from"./AdminLayout.vue_vue_type_script_setup_true_lang-G9rMIkPq.js";import{S as $}from"./SearchableSelect-CJIVA8fp.js";import{C as ca}from"./component-D0_cnRpY.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ga={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},ya={class:"mb-6 flex items-center justify-between"},va={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},ba={class:"mb-6 grid grid-cols-1 gap-4 lg:grid-cols-2"},fa={class:"relative"},xa={class:"absolute text-gray-500 -translate-y-1/2 pointer-events-none right-4 top-1/2 dark:text-gray-400 text-sm"},ha={class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},ka=["readonly"],_a={key:0,class:"text-xs text-gray-500 mt-1 dark:text-gray-400"},wa={class:"relative"},Na=["value"],ja={class:"absolute text-gray-500 -translate-y-1/2 pointer-events-none right-4 top-1/2 dark:text-gray-400 text-sm"},Sa={class:"text-xs text-gray-500 mt-1 dark:text-gray-400"},Pa={key:0},Ta={key:1},Va={class:"flex items-center gap-3 mt-6 lg:justify-end"},Ra=["disabled"],B="fee_mitra",Ua=Z({__name:"PayrollMitraForm",setup(Fa){const b=aa(),V=ea(),g=ta(),{fetchUser:E,user:y}=la(),h=u(()=>b.params.id!==void 0&&b.params.id!=="new"),O=u(()=>h.value?"Edit Payroll Mitra":"Tambah Payroll Mitra"),k=p(!1),S=p([]),R=p([]),F=p(""),C=p(""),G=u(()=>S.value.map(e=>({value:e.id,label:e.nama}))),J=u(()=>R.value.map(e=>({value:e.id,label:e.nama_program}))),L=new Date().toISOString().split("T")[0],s=p({mitra_id:"",program_id:"",nama_mitra:"",jumlah:0,persentase:0,total:0,payroll_date:L}),d=p({type:"percentage",value:null,key:null}),q=u(()=>d.value.type==="nominal"?"Nominal Fee Mitra":"Persentase (%)"),_=u(()=>d.value.type==="nominal"),H=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",maximumFractionDigits:0}).format(e??0),K=e=>e==null||Number.isNaN(e)?"0%":Number.isInteger(e)?`${e}%`:`${Number(e).toFixed(2).replace(/\.00$/,"")}%`,M=u(()=>{const e=d.value.value;return e==null?"":d.value.type==="nominal"?`Fee Mitra ditetapkan sebagai nominal: ${H(e)}`:`Persentase default dari program: ${K(e)}`}),w=u(()=>{const e=Number(s.value.jumlah)||0,a=Number(s.value.persentase)||0;return _.value&&d.value.value!==null?Number(d.value.value):Number(e*a/100)}),A=u({get(){return(Number(s.value.persentase)||0).toFixed(0)},set(e){const a=String(e).replace(/%/g,"").replace(/,/g,"").trim(),r=parseFloat(a);s.value.persentase=isNaN(r)?0:r}}),f=p(!1),D=async(e,a={})=>{const{applyToForm:r=!0}=a;if(d.value={type:"percentage",value:null,key:null},!!e)try{const m=await fetch(`/admin/api/program/${e}`,{credentials:"same-origin"});if(!m.ok)return;const c=await m.json();if(!c.success||!c.data)return;const o=Array.isArray(c.data.shares)?c.data.shares:[];let l=o.find(W=>String(W.program_share_type_key)===B);!l&&o.length>0&&(l=o[0]);const n=l==null?void 0:l.value,i=n!=null&&!Number.isNaN(Number(n))?Number(n):null,N=(l==null?void 0:l.type)||"percentage";d.value={type:N,value:i,key:(l==null?void 0:l.program_share_type_key)??B},r&&i!==null&&(s.value.persentase=i)}catch(m){console.error("loadProgramShare:",m)}};ra(()=>s.value.program_id,async e=>{if(f.value){f.value=!1;return}s.value.jumlah="",await D(e)});const Y=async()=>{try{const e=(()=>{if(!y.value)return!1;const n=y.value.roles||(y.value.role?[y.value.role]:[]);return Array.isArray(n)&&n.some(i=>{const N=typeof i=="string"?i:i==null?void 0:i.name;return typeof N=="string"&&N.trim().toLowerCase()==="admin cabang"})})(),r=!!(y.value&&y.value.is_admin)&&!e?"/admin/api/mitra?per_page=1000":"/admin/api/mitra?per_page=1000&only_assigned=1",[m,c]=await Promise.all([fetch(r,{credentials:"same-origin"}),fetch("/admin/api/program?per_page=1000",{credentials:"same-origin"})]),o=await m.json(),l=await c.json();S.value=o.success?o.data:[],R.value=l.success?l.data:[]}catch{}},z=async e=>{try{const r=await(await fetch(`/admin/api/mitra-payroll/${e}`,{credentials:"same-origin"})).json();r.success?(f.value=!0,Object.assign(s.value,r.data),f.value=!1,r.data.mitra&&r.data.mitra.id&&(s.value.mitra_id=r.data.mitra.id),r.data.program&&r.data.program.id&&(f.value=!0,s.value.program_id=r.data.program.id),await D(r.data.program_id??null,{applyToForm:!1})):g.error("Gagal memuat data")}catch{g.error("Gagal memuat data")}},X=async()=>{if(!s.value.jumlah||!s.value.persentase){g.error("Jumlah dan persentase wajib diisi");return}k.value=!0;try{if(s.value.mitra_id){const l=S.value.find(n=>n.id===s.value.mitra_id);s.value.nama_mitra=l?l.nama:""}s.value.total=w.value;const e=h.value?`/admin/api/mitra-payroll/${b.params.id}`:"/admin/api/mitra-payroll",a=h.value?"PUT":"POST",m=(await(await fetch("/admin/api/csrf-token",{credentials:"same-origin"})).json()).csrf_token,o=await(await fetch(e,{method:a,headers:{"Content-Type":"application/json","X-CSRF-TOKEN":m},credentials:"same-origin",body:JSON.stringify(s.value)})).json();o.success?(g.success("Berhasil"),V.push("/user-kepegawaian/payroll-mitra")):g.error(o.message||"Gagal menyimpan")}catch{g.error("Gagal menyimpan")}finally{k.value=!1}},Q=()=>V.push("/user-kepegawaian/payroll-mitra");return sa(async()=>{await E(),await Y(),h.value&&b.params.id&&await z(b.params.id)}),(e,a)=>(j(),oa(pa,null,{default:na(()=>[t("div",ga,[t("div",ya,[t("h3",va,v(O.value),1)]),t("form",{onSubmit:ia(X,["prevent"]),class:"flex flex-col"},[t("div",ba,[t("div",null,[a[7]||(a[7]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[x("Pilih Mitra "),t("span",{class:"text-red-500"},"*")],-1)),P($,{modelValue:s.value.mitra_id,"onUpdate:modelValue":a[0]||(a[0]=r=>s.value.mitra_id=r),options:G.value,placeholder:"Pilih Mitra","search-input":F.value,"onUpdate:searchInput":a[1]||(a[1]=r=>F.value=r)},null,8,["modelValue","options","search-input"])]),t("div",null,[a[8]||(a[8]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[x("Pilih Program "),t("span",{class:"text-red-500"},"*")],-1)),P($,{modelValue:s.value.program_id,"onUpdate:modelValue":a[2]||(a[2]=r=>s.value.program_id=r),options:J.value,placeholder:"Pilih Program","search-input":C.value,"onUpdate:searchInput":a[3]||(a[3]=r=>C.value=r)},null,8,["modelValue","options","search-input"])]),t("div",null,[a[9]||(a[9]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[x("Tanggal Payroll "),t("span",{class:"text-red-500"},"*")],-1)),P(ua(ca),{modelValue:s.value.payroll_date,"onUpdate:modelValue":a[4]||(a[4]=r=>s.value.payroll_date=r),config:{dateFormat:"Y-m-d"},class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90"},null,8,["modelValue"])]),t("div",null,[a[10]||(a[10]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[x("Jumlah "),t("span",{class:"text-red-500"},"*")],-1)),t("div",fa,[I(t("input",{type:"number","onUpdate:modelValue":a[5]||(a[5]=r=>s.value.jumlah=r),placeholder:"Masukkan jumlah",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 pr-24 text-sm text-gray-800 placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90"},null,512),[[U,s.value.jumlah,void 0,{number:!0}]]),t("span",xa," Rp "+v(s.value.jumlah?Number(s.value.jumlah).toLocaleString("id-ID"):"0"),1)])]),t("div",null,[t("label",ha,[x(v(q.value)+" ",1),a[11]||(a[11]=t("span",{class:"text-red-500"},"*",-1))]),I(t("input",{type:"text","onUpdate:modelValue":a[6]||(a[6]=r=>A.value=r),placeholder:"Masukkan persentase",required:"",readonly:_.value,class:ma(["dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90",_.value?"cursor-not-allowed bg-gray-100/70 dark:bg-gray-900/70":""])},null,10,ka),[[U,A.value]]),M.value?(j(),T("p",_a,v(M.value),1)):da("",!0)]),t("div",null,[a[12]||(a[12]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"Total",-1)),t("div",wa,[t("input",{type:"number",value:w.value,readonly:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 pr-24 text-sm text-gray-800 placeholder:text-gray-400"},null,8,Na),t("span",ja," Rp "+v(w.value?Number(w.value).toLocaleString("id-ID"):"0"),1)]),t("p",Sa,[_.value?(j(),T("span",Pa,"Total mengikuti nominal fee mitra dari konfigurasi program.")):(j(),T("span",Ta,"Total dihitung otomatis: jumlah × persentase / 100"))])])]),t("div",Va,[t("button",{onClick:Q,type:"button",class:"flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 sm:w-auto"},"Batal"),t("button",{type:"submit",disabled:k.value,class:"flex items-center gap-2 rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600 sm:w-auto"},v(k.value?"Menyimpan...":"Simpan"),9,Ra)])],32)])]),_:1}))}});export{Ua as default};
