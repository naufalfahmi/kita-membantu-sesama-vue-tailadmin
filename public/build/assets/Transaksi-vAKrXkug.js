import{d as ha,H as ka,I as ba,M as xa,b as l,A as f,O as wa,f as ya,g as Ca,o as F,w as _a,a as r,j as w,c as I,t as Sa,i as Va,m as Y,k as Da,v as Ta,u as J}from"./admin-7mBPYjB2.js";import{A as Fa}from"./ag-theme-alpine-3wciFC-a.js";import{C as ja}from"./component-CAvs2LIs.js";import{u as E,w as Aa}from"./xlsx-3SA47z_C.js";import{_ as Ha}from"./AdminLayout.vue_vue_type_script_setup_true_lang-CA657W7_.js";import{_ as Ia}from"./ConfirmModal.vue_vue_type_script_setup_true_lang-B_wKx3lk.js";import{S as j}from"./SearchableSelect-T8unDIIO.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Ea={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},La={class:"mb-6 flex items-center justify-between"},Na={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},Ma={class:"flex items-center gap-3"},Oa={class:"mb-6 rounded-lg border border-gray-200 bg-white p-4 dark:border-gray-800 dark:bg-white/[0.03]"},Ra={class:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4"},Pa={class:"flex-1"},Ua={class:"flex-1"},Ba={class:"relative"},$a={class:"flex-1"},Ka={class:"flex-1"},Ga={class:"flex-1"},Za={class:"flex-1"},za={key:0,class:"flex items-center justify-center py-12"},Ya={key:1,class:"ag-theme-alpine dark:ag-theme-alpine-dark",style:{width:"100%"}},ne=ha({__name:"Transaksi",setup(Ja){const X=ka(),L=ba(),y=xa(),q=l(String(X.meta.title||"Transaksi")),{fetchUser:Q,hasPermission:V,isAdmin:D}=wa(),W=f(()=>D()||V("create transaksi")),aa=f(()=>D()||V("update transaksi")),ea=f(()=>D()||V("delete transaksi"));f(()=>D()||V("view transaksi"));const N=l(null),A=l(!1),M=l([]),v=l(""),s=l([]),h=l(""),k=l(""),b=l(""),x=l(""),T=l(!1),S=l(null);let H;const O=l([]),R=l([]),P=l([]),U=l([]),B=l(""),$=l(""),K=l(""),G=l(""),ta=f(()=>[{value:"",label:"Semua Donatur"},...O.value.map(a=>({value:a.id,label:a.nama||"-"}))]),ra=f(()=>[{value:"",label:"Semua Program"},...R.value.map(a=>({value:a.id,label:a.nama_program||"-"}))]),na=f(()=>[{value:"",label:"Semua Fundraiser"},...P.value.map(a=>({value:String(a.id),label:a.name||"-"}))]),oa=f(()=>[{value:"",label:"Semua Kantor Cabang"},...U.value.map(a=>({value:a.id,label:a.nama||"-"}))]),sa={mode:"range",dateFormat:"Y-m-d",altInput:!0,altFormat:"d/m/Y",wrap:!1},la=[{headerName:"Kode",field:"kode",sortable:!0,width:160,valueFormatter:a=>a.value||"-"},{headerName:"Donatur",field:"donatur",sortable:!0,flex:1,valueFormatter:a=>a.value||"-"},{headerName:"Kantor Cabang",field:"kantor_cabang",sortable:!0,flex:1,valueFormatter:a=>a.value||"-"},{headerName:"Fundraiser",field:"fundraiser",sortable:!0,flex:1,valueFormatter:a=>a.value||"-"},{headerName:"Program",field:"program",sortable:!0,flex:1,valueFormatter:a=>a.value||"-"},{headerName:"Nominal",field:"nominal_formatted",sortable:!0,flex:1},{headerName:"Tanggal",field:"tanggal_transaksi",sortable:!0,width:150,valueFormatter:a=>a.value?new Date(a.value).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric"}):"-"},{headerName:"Actions",field:"actions",sortable:!1,filter:!1,width:120,cellRenderer:a=>{const e=document.createElement("div");e.className="flex items-center gap-3";const t=document.createElement("button");t.className="flex items-center justify-center w-8 h-8 rounded-lg text-brand-500 hover:bg-brand-50 dark:hover:bg-brand-500/10 transition-colors",t.innerHTML=`
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
        </svg>
      `,t.onclick=()=>ga(a.data.id);const n=document.createElement("button");return n.className="flex items-center justify-center w-8 h-8 rounded-lg text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 transition-colors",n.innerHTML=`
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M3 6h18"></path>
          <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
          <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
          <line x1="10" y1="11" x2="10" y2="17"></line>
          <line x1="14" y1="11" x2="14" y2="17"></line>
        </svg>
      `,n.onclick=()=>pa(a.data.id),aa.value&&e.appendChild(t),ea.value&&e.appendChild(n),e}}],ia={resizable:!0,sortable:!0,filter:!1},da=async()=>{var a,e,t,n;try{const[u,c,d,C]=await Promise.all([fetch("/admin/api/kantor-cabang?per_page=1000",{credentials:"same-origin"}),fetch("/admin/api/donatur?per_page=1000",{credentials:"same-origin"}),fetch("/admin/api/program?per_page=1000",{credentials:"same-origin"}),fetch("/admin/api/karyawan?per_page=1000",{credentials:"same-origin"})]);if(u.ok){const o=await u.json();o.success&&(U.value=Array.isArray(o.data)?o.data:((a=o.data)==null?void 0:a.data)||[])}if(c.ok){const o=await c.json();o.success&&(O.value=Array.isArray(o.data)?o.data:((e=o.data)==null?void 0:e.data)||[])}if(d.ok){const o=await d.json();o.success&&(R.value=Array.isArray(o.data)?o.data:((t=o.data)==null?void 0:t.data)||[])}if(C.ok){const o=await C.json();o.success&&(P.value=Array.isArray(o.data)?o.data:((n=o.data)==null?void 0:n.data)||[])}}catch(u){console.error("Error fetching filter options:",u)}},p=async()=>{A.value=!0;try{const a=new URLSearchParams;if(a.append("per_page","100"),v.value&&a.append("search",v.value),Array.isArray(s.value)&&s.value.length===2){const[n,u]=s.value,c=d=>d instanceof Date?d.toISOString().slice(0,10):String(d);a.append("tanggal_from",c(n)),a.append("tanggal_to",c(u))}else s.value&&a.append("tanggal",String(s.value));h.value&&a.append("donatur_id",h.value),k.value&&a.append("program_id",k.value),x.value&&a.append("kantor_cabang_id",x.value),b.value&&a.append("fundraiser_id",b.value);const e=await fetch(`/admin/api/transaksi?${a.toString()}`,{credentials:"same-origin"});if(!e.ok)throw new Error("Failed to fetch transaksi");const t=await e.json();t.success&&(M.value=(t.data||[]).map(n=>{var u,c,d,C;return{id:n.id,kode:n.kode,donatur:((u=n.donatur)==null?void 0:u.nama)||null,kantor_cabang:((c=n.kantor_cabang)==null?void 0:c.nama)||null,fundraiser:((d=n.fundraiser)==null?void 0:d.nama)||null,program:((C=n.program)==null?void 0:C.nama)||null,nominal:n.nominal,nominal_formatted:n.nominal_formatted,tanggal_transaksi:n.tanggal_transaksi,keterangan:n.keterangan}}))}catch{y.error("Gagal memuat data transaksi")}finally{A.value=!1}},Z=()=>{H&&clearTimeout(H),H=setTimeout(()=>{p()},300)},ua=()=>{v.value="",s.value=[],h.value="",k.value="",x.value="",b.value="",p()},ca=()=>{L.push("/keuangan/transaksi/new")},ga=a=>{L.push(`/keuangan/transaksi/${a}/edit`)},pa=a=>{S.value=a,T.value=!0},ma=async()=>{if(S.value)try{const a=await fetch("/admin/api/csrf-token",{credentials:"same-origin"});if(!a.ok)throw new Error("Failed to fetch CSRF token");const e=await a.json(),n=await(await fetch(`/admin/api/transaksi/${S.value}`,{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":e.csrf_token},credentials:"same-origin"})).json();n.success?(y.success(n.message||"Transaksi berhasil dihapus"),p()):y.error(n.message||"Gagal menghapus transaksi")}catch{y.error("Gagal menghapus transaksi")}finally{T.value=!1,S.value=null}},fa=()=>{T.value=!1,S.value=null},va=async()=>{try{const a=new URLSearchParams;if(a.append("per_page","1000"),v.value&&a.append("search",v.value),Array.isArray(s.value)&&s.value.length===2){const[i,_]=s.value,m=g=>g instanceof Date?g.toISOString().slice(0,10):String(g);a.append("tanggal_from",m(i)),a.append("tanggal_to",m(_))}else s.value&&a.append("tanggal",String(s.value));h.value&&a.append("donatur_id",h.value),k.value&&a.append("program_id",k.value),x.value&&a.append("kantor_cabang_id",x.value),b.value&&a.append("fundraiser_id",b.value);const e=await fetch(`/admin/api/transaksi?${a.toString()}`,{credentials:"same-origin"});if(!e.ok)throw new Error("Failed to fetch transaksi for export");const t=await e.json();if(!t.success)throw new Error(t.message||"Failed to fetch transaksi for export");const n=(t.data||[]).map(i=>{var _,m,g,z;return{Kode:i.kode||"-",Donatur:((_=i.donatur)==null?void 0:_.nama)||"-","Kantor Cabang":((m=i.kantor_cabang)==null?void 0:m.nama)||"-",Fundraiser:((g=i.fundraiser)==null?void 0:g.name)||"-",Program:((z=i.program)==null?void 0:z.nama_program)||"-",Nominal:i.nominal_formatted,Tanggal:i.tanggal_transaksi?new Date(i.tanggal_transaksi).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"}):"-",Keterangan:i.keterangan||"-"}}),u=E.json_to_sheet(n),c=E.book_new();E.book_append_sheet(c,u,"Transaksi");let d="";if(Array.isArray(s.value)&&s.value.length===2){const[i,_]=s.value,m=g=>g instanceof Date?g.toISOString().slice(0,10):String(g);d=`_${m(i)}_to_${m(_)}`}else s.value&&(d=`_${s.value instanceof Date?s.value.toISOString().slice(0,10):String(s.value)}`);const o=`Transaksi${d}_${new Date().toISOString().split("T")[0]}.xlsx`;Aa(c,o),y.success("Export Excel berhasil")}catch(a){console.error(a),y.error("Gagal mengekspor data")}};return ya(async()=>{var a;await Q(),await da(),await p();try{const e=(a=N.value)==null?void 0:a.api;e&&typeof e.refreshCells=="function"&&e.refreshCells({force:!0})}catch{}}),(a,e)=>(F(),Ca(Ha,null,{default:_a(()=>[r("div",Ea,[r("div",La,[r("h3",Na,Sa(q.value),1),r("div",Ma,[r("button",{onClick:va,class:"flex items-center gap-2 rounded-lg bg-green-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-green-600"},[...e[10]||(e[10]=[r("svg",{class:"fill-current",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[r("path",{d:"M10.8333 3.33333V9.16667H16.6667L10.8333 3.33333ZM4.16667 2.5H11.6667L17.5 8.33333V15.8333C17.5 16.2754 17.3244 16.6993 17.0118 17.0118C16.6993 17.3244 16.2754 17.5 15.8333 17.5H4.16667C3.72464 17.5 3.30072 17.3244 2.98816 17.0118C2.67559 16.6993 2.5 16.2754 2.5 15.8333V4.16667C2.5 3.72464 2.67559 3.30072 2.98816 2.98816C3.30072 2.67559 3.72464 2.5 4.16667 2.5Z",fill:"currentColor"})],-1),Y(" Export Excel ",-1)])]),W.value?(F(),I("button",{key:0,onClick:ca,class:"flex items-center gap-2 rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600"},[...e[11]||(e[11]=[r("svg",{class:"fill-current",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[r("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M10 3.33333C10.4602 3.33333 10.8333 3.70643 10.8333 4.16667V9.16667H15.8333C16.2936 9.16667 16.6667 9.53976 16.6667 10C16.6667 10.4602 16.2936 10.8333 15.8333 10.8333H10.8333V15.8333C10.8333 16.2936 10.4602 16.6667 10 16.6667C9.53976 16.6667 9.16667 16.2936 9.16667 15.8333V10.8333H4.16667C3.70643 10.8333 3.33333 10.4602 3.33333 10C3.33333 9.53976 3.70643 9.16667 4.16667 9.16667H9.16667V4.16667C9.16667 3.70643 9.53976 3.33333 10 3.33333Z",fill:"currentColor"})],-1),Y(" Tambah Transaksi ",-1)])])):Va("",!0)])]),r("div",Oa,[r("div",Ra,[r("div",Pa,[e[12]||(e[12]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Cari ",-1)),Da(r("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=t=>v.value=t),placeholder:"Cari kode, keterangan...",onInput:Z,class:"h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,544),[[Ta,v.value]])]),r("div",Ua,[e[14]||(e[14]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Rentang Tanggal ",-1)),r("div",Ba,[w(J(ja),{modelValue:s.value,"onUpdate:modelValue":e[1]||(e[1]=t=>s.value=t),config:sa,onOnChange:Z,class:"h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 pr-11 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",placeholder:"Pilih rentang tanggal"},null,8,["modelValue"]),e[13]||(e[13]=r("span",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400 pointer-events-none"},[r("svg",{class:"fill-current",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[r("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M6.66659 1.5415C7.0808 1.5415 7.41658 1.87729 7.41658 2.2915V2.99984H12.5833V2.2915C12.5833 1.87729 12.919 1.5415 13.3333 1.5415C13.7475 1.5415 14.0833 1.87729 14.0833 2.2915V2.99984L15.4166 2.99984C16.5212 2.99984 17.4166 3.89527 17.4166 4.99984V7.49984V15.8332C17.4166 16.9377 16.5212 17.8332 15.4166 17.8332H4.58325C3.47868 17.8332 2.58325 16.9377 2.58325 15.8332V7.49984V4.99984C2.58325 3.89527 3.47868 2.99984 4.58325 2.99984L5.91659 2.99984V2.2915C5.91659 1.87729 6.25237 1.5415 6.66659 1.5415ZM6.66659 4.49984H4.58325C4.30711 4.49984 4.08325 4.7237 4.08325 4.99984V6.74984H15.9166V4.99984C15.9166 4.7237 15.6927 4.49984 15.4166 4.49984H13.3333H6.66659ZM15.9166 8.24984H4.08325V15.8332C4.08325 16.1093 4.30711 16.3332 4.58325 16.3332H15.4166C15.6927 16.3332 15.9166 16.1093 15.9166 15.8332V8.24984Z",fill:"currentColor"})])],-1))])]),r("div",$a,[e[15]||(e[15]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Donatur ",-1)),w(j,{modelValue:h.value,"onUpdate:modelValue":[e[2]||(e[2]=t=>h.value=t),p],options:ta.value,placeholder:"Semua Donatur","search-input":B.value,"onUpdate:searchInput":e[3]||(e[3]=t=>B.value=t)},null,8,["modelValue","options","search-input"])]),r("div",Ka,[e[16]||(e[16]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Program ",-1)),w(j,{modelValue:k.value,"onUpdate:modelValue":[e[4]||(e[4]=t=>k.value=t),p],options:ra.value,placeholder:"Semua Program","search-input":$.value,"onUpdate:searchInput":e[5]||(e[5]=t=>$.value=t)},null,8,["modelValue","options","search-input"])]),r("div",Ga,[e[17]||(e[17]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kantor Cabang ",-1)),w(j,{modelValue:x.value,"onUpdate:modelValue":[e[6]||(e[6]=t=>x.value=t),p],options:oa.value,placeholder:"Semua Kantor Cabang","search-input":G.value,"onUpdate:searchInput":e[7]||(e[7]=t=>G.value=t)},null,8,["modelValue","options","search-input"])]),r("div",Za,[e[18]||(e[18]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Fundraiser ",-1)),w(j,{modelValue:b.value,"onUpdate:modelValue":[e[8]||(e[8]=t=>b.value=t),p],options:na.value,placeholder:"Semua Fundraiser","search-input":K.value,"onUpdate:searchInput":e[9]||(e[9]=t=>K.value=t)},null,8,["modelValue","options","search-input"])]),r("div",{class:"flex items-end"},[r("button",{onClick:ua,class:"h-11 w-full rounded-lg border border-gray-300 bg-white px-6 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03]"}," Reset Filter ")])])]),A.value?(F(),I("div",za,[...e[19]||(e[19]=[r("div",{class:"h-8 w-8 animate-spin rounded-full border-4 border-brand-500 border-t-transparent"},null,-1),r("span",{class:"ml-3 text-gray-600 dark:text-gray-400"},"Memuat data...",-1)])])):(F(),I("div",Ya,[w(J(Fa),{ref_key:"agGridRef",ref:N,class:"ag-theme-alpine",style:{width:"100%"},columnDefs:la,rowData:M.value,defaultColDef:ia,pagination:!0,paginationPageSize:20,theme:"legacy",animateRows:!0,suppressHorizontalScroll:!0,domLayout:"autoHeight"},null,8,["rowData"])]))]),w(Ia,{isOpen:T.value,title:"Hapus Transaksi",message:"Apakah Anda yakin ingin menghapus transaksi ini? Tindakan ini tidak dapat dibatalkan.",confirmText:"Hapus",confirmButtonClass:"bg-red-500 hover:bg-red-600",onConfirm:ma,onCancel:fa},null,8,["isOpen"])]),_:1}))}});export{ne as default};
