import{d as J,H as Y,I as Z,A as q,M as ee,b as y,e as B,f as te,Q as T,y as ae,g as re,o as g,w as se,a as t,t as f,q as ne,k as oe,m as w,n as L,v as ie,c as p,j as H,i as _,F as R,l as F}from"./admin-BHeq5BTW.js";import{_ as le}from"./AdminLayout.vue_vue_type_script_setup_true_lang-D9BT1bO0.js";import{S as P}from"./SearchableSelect-CCUB5FsD.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const de={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},ce={class:"mb-6 flex items-center justify-between"},ue={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},me={class:"grid grid-cols-1 gap-x-6 gap-y-5 lg:grid-cols-2"},ge={class:"lg:col-span-2"},pe={class:"mt-1 flex items-center justify-between"},he={key:0,class:"text-xs text-red-500"},be={key:1,class:"text-xs text-gray-500 dark:text-gray-400"},fe={class:"text-xs text-gray-500 dark:text-gray-400"},ke={class:"lg:col-span-1"},ye={key:0,class:"mt-1 block text-xs text-red-500"},ve={class:"lg:col-span-1"},xe={class:"lg:col-span-2"},we={class:"space-y-4"},_e={class:"relative"},Me=["disabled"],je={class:"text-center"},Te={key:0,class:"mt-1 text-xs text-red-500"},Le={key:0,class:"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5"},Ee=["src","alt"],Se=["onClick"],Ie=["src","alt"],Ce=["onClick"],qe={class:"absolute bottom-0 left-0 right-0 bg-black/50 px-2 py-1"},Be={class:"truncate text-xs text-white"},He={class:"text-xs text-gray-300"},Re={class:"lg:col-span-2"},Fe={key:0,class:"mt-1 block text-xs text-red-500"},Pe={class:"flex items-center gap-3 mt-6 lg:justify-end"},Ve={type:"submit",class:"flex w-full justify-center rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600 sm:w-auto"},Ne=J({__name:"LandingProgramForm",setup(Ue){const v=Y(),E=Z(),x=q(()=>v.params.id!==void 0&&v.params.id!=="new"),V=q(()=>x.value?"Edit Landing Program":"Tambah Landing Program"),b=ee(),U=[{value:"active",label:"Aktif"},{value:"inactive",label:"Tidak Aktif"}],$=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],S=y(""),I=y(""),M=y(null),d=y([]),k=y([]),j=y(null);let c=null;const n=B({name:"",status:"",highlight:"",description:""}),l=B({name:"",status:"",description:""}),A=async()=>{if(j.value)try{window.Quill||await new Promise((e,r)=>{if(document.querySelector('script[src*="quill"]')){const i=setInterval(()=>{window.Quill&&(clearInterval(i),e())},100);return}const a=document.createElement("script");a.src="https://cdn.quilljs.com/1.3.6/quill.js",a.onload=()=>e(),a.onerror=()=>r(new Error("Failed to load Quill")),document.head.appendChild(a);const m=document.createElement("link");m.rel="stylesheet",m.href="https://cdn.quilljs.com/1.3.6/quill.snow.css",document.head.appendChild(m)}),await T();const s=window.Quill;c=new s(j.value,{theme:"snow",modules:{toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline","strike"],[{list:"ordered"},{list:"bullet"}],[{align:[]}],["link","image"],["clean"]]},placeholder:"Masukkan deskripsi program..."}),n.description&&(c.root.innerHTML=n.description),c.on("text-change",()=>{n.description=c.root.innerHTML}),n.description=c.root.innerHTML}catch(s){console.error("Error initializing Quill:",s)}},z=s=>{if(!s)return"";try{const e=document.createElement("div");return e.innerHTML=s,e.querySelectorAll("script").forEach(i=>i.remove()),e.querySelectorAll("*").forEach(i=>{Array.from(i.attributes).forEach(o=>{(o.name.startsWith("on")||o.name==="javascript:")&&i.removeAttribute(o.name)})}),e.querySelectorAll("iframe").forEach(i=>i.remove()),e.innerHTML}catch(e){console.error("Error sanitizing HTML:",e);const r=document.createElement("div");return r.textContent=s,r.innerHTML}},D=()=>{n.name.length>100&&(n.name=n.name.substring(0,100)),n.name.trim()&&(l.name="")},N=s=>{const e=s.target;if(e.files){const r=Array.from(e.files),a=5-(d.value.length+k.value.length);r.length>a&&(b.warning(`Maksimal 5 gambar. Anda sudah memiliki ${d.value.length+k.value.length} gambar. Hanya ${a} gambar yang akan ditambahkan.`),r.splice(a));const m=20*1024*1024,i=[],o=[];r.forEach(u=>{if(!u.type.startsWith("image/")){o.push(`${u.name} (bukan file gambar)`);return}if(u.size>m){o.push(`${u.name} (melebihi 20MB)`);return}const h=URL.createObjectURL(u);i.push(Object.assign(u,{preview:h}))}),o.length>0&&b.error(`File berikut tidak valid:
${o.join(`
`)}`),d.value.push(...i),M.value&&(M.value.value="")}},O=s=>{URL.revokeObjectURL(d.value[s].preview),d.value.splice(s,1)},Q=s=>{k.value.splice(s,1)},G=s=>{if(s===0)return"0 Bytes";const e=1024,r=["Bytes","KB","MB","GB"],a=Math.floor(Math.log(s)/Math.log(e));return Math.round(s/Math.pow(e,a)*100)/100+" "+r[a]},W=()=>{var r;let s=!0;l.name="",l.status="",l.description="",!n.name||!n.name.trim()?(l.name="Nama program wajib diisi",s=!1):n.name.length>100&&(l.name="Nama program maksimal 100 karakter",s=!1),n.status||(l.status="Status wajib dipilih",s=!1);let e="";if(c)e=c.getText().trim();else{const a=document.createElement("div");a.innerHTML=n.description||"",e=((r=a.textContent)==null?void 0:r.trim())||""}return e||(l.description="Deskripsi wajib diisi",s=!1),s},K=async()=>{if(x.value&&v.params.id){const s=v.params.id;try{const r=await(await fetch(`/admin/api/landing-program/${s}`,{headers:{"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"})).json();if(r.success&&r.data){const a=r.data;if(n.name=a.name||"",n.status=a.is_active?"active":"inactive",n.highlight=a.is_highlight?"yes":"no",n.description=a.description||"",a.image_url){const m=a.image_url.startsWith("http")?a.image_url:`/storage/${a.image_url}`;k.value=[{url:m,name:a.name}]}}}catch(e){console.error("Failed to load landing program",e)}}},C=()=>{d.value.forEach(s=>{URL.revokeObjectURL(s.preview)}),E.push("/company/landing-program")},X=async()=>{var s;if(W())try{let e=n.description;c&&(e=c.root.innerHTML,n.description=e);const r=z(e),a=new FormData;if(a.append("name",n.name.trim()),a.append("status",n.status),n.highlight){const o=n.highlight==="yes"?"1":"0";a.append("is_highlight",o)}a.append("description",r),d.value.length>0&&a.append("image",d.value[0]);let i=((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"))||"";if(!i)try{const u=await(await fetch("/admin/api/csrf-token")).json();i=(u==null?void 0:u.token)||""}catch{}i&&a.append("_token",i);try{const o={};if(i&&(o["X-CSRF-TOKEN"]=i),x.value){a.append("_method","PUT");const h=await(await fetch(`/admin/api/landing-program/${v.params.id}`,{method:"POST",headers:o,body:a,credentials:"same-origin"})).json();if(h.success)b.success("Landing program berhasil diupdate");else throw b.error(h.message||"Validation failed"),new Error(h.message||"Validation failed")}else{const h=await(await fetch("/admin/api/landing-program",{method:"POST",headers:o,body:a,credentials:"same-origin"})).json();if(h.success)b.success("Landing program berhasil dibuat");else throw b.error(h.message||"Validation failed"),new Error(h.message||"Validation failed")}}catch(o){console.error("Save error:",o),b.error("Terjadi kesalahan saat menyimpan data: "+(o.message||""));return}E.push("/company/landing-program")}catch(e){console.error("Error saving:",e),b.error("Terjadi kesalahan saat menyimpan data")}};return te(async()=>{await K(),await T(),await A(),await T(),c&&n.description&&(c.root.innerHTML=n.description)}),ae(()=>{d.value.forEach(s=>{URL.revokeObjectURL(s.preview)}),c&&(c=null)}),(s,e)=>(g(),re(le,null,{default:se(()=>[t("div",de,[t("div",ce,[t("h3",ue,f(V.value),1),t("button",{onClick:C,class:"flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03]"}," Batal ")]),t("form",{onSubmit:ne(X,["prevent"]),class:"flex flex-col"},[t("div",me,[t("div",ge,[e[5]||(e[5]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[w(" Nama Program "),t("span",{class:"text-red-500"},"*")],-1)),oe(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=r=>n.name=r),onInput:D,placeholder:"Masukkan nama program",required:"",maxlength:"100",class:L(["dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",{"border-red-300 dark:border-red-500":l.name}])},null,34),[[ie,n.name]]),t("div",pe,[l.name?(g(),p("span",he,f(l.name),1)):(g(),p("span",be)),t("span",fe,f(n.name.length)+"/100 karakter ",1)])]),t("div",ke,[e[6]||(e[6]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[w(" Status "),t("span",{class:"text-red-500"},"*")],-1)),H(P,{modelValue:n.status,"onUpdate:modelValue":e[1]||(e[1]=r=>n.status=r),options:U,placeholder:"Pilih status",searchInput:S.value,"onUpdate:searchInput":e[2]||(e[2]=r=>S.value=r)},null,8,["modelValue","searchInput"]),l.status?(g(),p("span",ye,f(l.status),1)):_("",!0)]),t("div",ve,[e[7]||(e[7]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Highlight ",-1)),H(P,{modelValue:n.highlight,"onUpdate:modelValue":e[3]||(e[3]=r=>n.highlight=r),options:$,placeholder:"Pilih highlight",searchInput:I.value,"onUpdate:searchInput":e[4]||(e[4]=r=>I.value=r)},null,8,["modelValue","searchInput"])]),t("div",xe,[e[13]||(e[13]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Gambar Program ",-1)),t("div",we,[t("div",_e,[t("input",{type:"file",ref_key:"fileInputRef",ref:M,onChange:N,multiple:"",accept:"image/*",class:"hidden",id:"image-upload",disabled:d.value.length>=5},null,40,Me),t("label",{for:"image-upload",class:L(["flex cursor-pointer items-center justify-center rounded-lg border-2 border-dashed border-gray-300 bg-gray-50 px-6 py-8 text-center transition-colors hover:border-brand-300 hover:bg-gray-100 dark:border-gray-700 dark:bg-gray-900/50 dark:hover:border-brand-500",{"opacity-50 cursor-not-allowed":d.value.length>=5}])},[t("div",je,[e[8]||(e[8]=t("svg",{class:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1)),e[9]||(e[9]=t("p",{class:"mt-2 text-sm text-gray-600 dark:text-gray-400"},[t("span",{class:"font-medium text-brand-500"},"Klik untuk upload"),w(" atau drag and drop ")],-1)),e[10]||(e[10]=t("p",{class:"text-xs text-gray-500 dark:text-gray-500"}," PNG, JPG, GIF, WEBP hingga 20MB (Maksimal 5 gambar) ",-1)),d.value.length>=5?(g(),p("p",Te," Maksimal 5 gambar sudah tercapai ")):_("",!0)])],2)]),d.value.length>0||k.value.length>0?(g(),p("div",Le,[(g(!0),p(R,null,F(k.value,(r,a)=>(g(),p("div",{key:`existing-${a}`,class:"group relative aspect-square overflow-hidden rounded-lg border border-gray-200 bg-gray-100 dark:border-gray-700 dark:bg-gray-800"},[t("img",{src:r.url,alt:r.name||`Image ${a+1}`,class:"h-full w-full object-cover"},null,8,Ee),t("button",{type:"button",onClick:m=>Q(a),class:"absolute right-2 top-2 rounded-lg bg-red-500 p-1.5 text-white opacity-0 transition-opacity hover:bg-red-600 group-hover:opacity-100"},[...e[11]||(e[11]=[t("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Se)]))),128)),(g(!0),p(R,null,F(d.value,(r,a)=>(g(),p("div",{key:`new-${a}`,class:"group relative aspect-square overflow-hidden rounded-lg border border-gray-200 bg-gray-100 dark:border-gray-700 dark:bg-gray-800"},[t("img",{src:r.preview,alt:r.name,class:"h-full w-full object-cover"},null,8,Ie),t("button",{type:"button",onClick:m=>O(a),class:"absolute right-2 top-2 rounded-lg bg-red-500 p-1.5 text-white opacity-0 transition-opacity hover:bg-red-600 group-hover:opacity-100"},[...e[12]||(e[12]=[t("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Ce),t("div",qe,[t("p",Be,f(r.name),1),t("p",He,f(G(r.size)),1)])]))),128))])):_("",!0)])]),t("div",Re,[e[14]||(e[14]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[w(" Deskripsi "),t("span",{class:"text-red-500"},"*")],-1)),t("div",{ref_key:"quillEditorRef",ref:j,class:L(["min-h-[180px] rounded-lg border border-gray-300 dark:border-gray-700",{"border-red-300 dark:border-red-500":l.description}])},null,2),l.description?(g(),p("span",Fe,f(l.description),1)):_("",!0),e[15]||(e[15]=t("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," Gunakan editor untuk memformat deskripsi program. Konten akan disanitasi untuk keamanan. ",-1))])]),e[16]||(e[16]=t("div",{class:"mt-16 flex items-center gap-3 lg:justify-end"},null,-1)),t("div",Pe,[t("button",{onClick:C,type:"button",class:"flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] sm:w-auto"}," Batal "),t("button",Ve,f(x.value?"Simpan Perubahan":"Simpan"),1)])],32)])]),_:1}))}});export{Ne as default};
