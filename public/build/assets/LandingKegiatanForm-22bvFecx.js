import{g as W,r as x,H as X,I as J,A as P,i as F,o as Y,c as Q,a as i,w as Z,f as T,b as t,t as l,p as ee,j as p,d as c,e as u,l as f,v as m,u as te,F as B,k as I}from"./admin-QSIG3_Xp.js";import{C as ae}from"./component-DLWPZjOq.js";import{_ as re}from"./AdminLayout.vue_vue_type_script_setup_true_lang-ClXNRnQF.js";import{_ as se}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-TxfeJzKj.js";import{S as oe}from"./SearchableSelect-Dj99WeEx.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const de={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},ne={class:"mb-6 flex items-center justify-between"},ie={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},le={class:"grid grid-cols-1 gap-x-6 gap-y-5 lg:grid-cols-2"},ce={class:"lg:col-span-2"},ge={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},ue={key:0,class:"mt-1 text-xs text-red-500"},pe={class:"lg:col-span-1"},me={key:0,class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},be={key:1,class:"mt-1 text-xs text-red-500"},xe={class:"lg:col-span-1"},ye={key:0,class:"mt-1 text-xs text-red-500"},ke={class:"lg:col-span-1"},fe={class:"lg:col-span-1"},he={class:"lg:col-span-1"},ve={class:"lg:col-span-1"},_e={class:"lg:col-span-1"},we={key:0,class:"mt-1 text-xs text-red-500"},Me={class:"lg:col-span-2"},je={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},Te={key:0,class:"mt-1 text-xs text-red-500"},Se={class:"lg:col-span-1"},Ve={key:0,class:"mt-1 text-xs text-red-500"},Ce={class:"lg:col-span-2"},Pe={class:"space-y-4"},Fe={key:0,class:"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4"},Be=["src","alt"],Ie=["onClick"],$e=["src","alt"],Ue=["onClick"],Ke={class:"mt-1 text-xs text-gray-500 dark:text-gray-400 truncate"},Le={class:"text-xs text-gray-400 dark:text-gray-500"},Ae={key:0,class:"mt-1 text-xs text-red-500"},De={class:"lg:col-span-2"},Ee={class:"relative"},Ne=["innerHTML"],Re={key:0,class:"absolute top-2.5 left-4 text-sm text-gray-400 pointer-events-none"},Oe={key:0,class:"mt-1 text-xs text-red-500"},qe={class:"flex items-center gap-3 mt-6 lg:justify-end"},Ge=["disabled"],et=W({__name:"LandingKegiatanForm",setup(He){const $=[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"}],S=x(""),h=X(),w=J(),M=x(null),U=x(null),y=P(()=>h.params.id!==void 0&&h.params.id!=="new"),V=P(()=>y.value?"Edit Landing Kegiatan":"Tambah Landing Kegiatan"),k=x(!1),K={dateFormat:"Y-m-d",locale:{firstDayOfWeek:1}},a=F({title:"",number_of_recipients:0,village:"",district:"",city:"",province:"",postal_code:"",address:"",activity_date:"",status:"",description:""}),o=F({title:"",number_of_recipients:"",postal_code:"",address:"",activity_date:"",status:"",description:"",images:""}),v=x([]),_=x([]),j=x([]),L=r=>new Intl.NumberFormat("id-ID").format(r),A=r=>{const e=r.target;a.postal_code=e.value.replace(/[^0-9]/g,"")},D=r=>{const e=r.target;if(e.files){const s=Array.from(e.files),d=20*1024*1024,n=[],g=[];s.forEach(b=>{if(!["image/jpeg","image/jpg","image/png","image/webp"].includes(b.type)){g.push(`${b.name} (format tidak didukung)`);return}b.size>d?g.push(`${b.name} (melebihi 20MB)`):n.push(b)}),g.length>0&&alert(`File berikut tidak valid:
${g.join(`
`)}`),v.value.push(...n),M.value&&(M.value.value="")}},E=r=>{v.value.splice(r,1)},N=r=>{const e=_.value[r];j.value.push(e),_.value.splice(r,1)},R=r=>URL.createObjectURL(r),O=r=>{if(r===0)return"0 Bytes";const e=1024,s=["Bytes","KB","MB","GB"],d=Math.floor(Math.log(r)/Math.log(e));return Math.round(r/Math.pow(e,d)*100)/100+" "+s[d]},q=r=>{const e=r.target;a.description=e.innerHTML||""},G=()=>{let r=!0;return Object.keys(o).forEach(e=>{o[e]=""}),!a.title||a.title.trim()===""?(o.title="Nama kegiatan wajib diisi",r=!1):a.title.length>100&&(o.title="Nama kegiatan maksimal 100 karakter",r=!1),(!a.number_of_recipients||a.number_of_recipients<=0)&&(o.number_of_recipients="Total penerima manfaat wajib diisi dan harus lebih dari 0",r=!1),a.postal_code&&!/^[0-9]+$/.test(a.postal_code)&&(o.postal_code="Kode pos harus berupa angka",r=!1),!a.address||a.address.trim()===""?(o.address="Alamat wajib diisi",r=!1):a.address.length>1e3&&(o.address="Alamat maksimal 1000 karakter",r=!1),a.activity_date||(o.activity_date="Tanggal kegiatan wajib diisi",r=!1),a.status||(o.status="Status wajib diisi",r=!1),(!a.description||a.description.trim()==="")&&(o.description="Deskripsi wajib diisi",r=!1),r},H=async()=>{if(y.value&&h.params.id){const r=h.params.id;k.value=!0;try{const s=await(await fetch(`/admin/api/landing-kegiatan/${r}`,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin"})).json();if(s.success&&s.data){const d=s.data;if(a.title=d.title||"",a.number_of_recipients=d.number_of_recipients||0,a.village=d.village||"",a.district=d.district||"",a.city=d.city||"",a.province=d.province||"",a.postal_code=d.postal_code||"",a.address=d.address||"",a.activity_date=d.activity_date||"",a.status=d.status||"",a.description=d.description||"",d.images)try{const n=JSON.parse(d.images);Array.isArray(n)&&(_.value=n)}catch(n){console.error("Error parsing images:",n)}}else alert(s.message||"Gagal memuat data"),w.push("/company/landing-kegiatan")}catch(e){console.error("Error loading data:",e),alert("Terjadi kesalahan saat memuat data"),w.push("/company/landing-kegiatan")}finally{k.value=!1}}},C=()=>{w.push("/company/landing-kegiatan")},z=async()=>{if(G()){k.value=!0;try{const r=new FormData;r.append("title",a.title),r.append("number_of_recipients",a.number_of_recipients.toString()),r.append("village",a.village||""),r.append("district",a.district||""),r.append("city",a.city||""),r.append("province",a.province||""),r.append("postal_code",a.postal_code||""),r.append("address",a.address),r.append("activity_date",a.activity_date),r.append("status",a.status),r.append("description",a.description),v.value.forEach((g,b)=>{r.append(`images[${b}]`,g)}),j.value.length>0&&r.append("images_to_delete",JSON.stringify(j.value));const e=y.value?`/admin/api/landing-kegiatan/${h.params.id}`:"/admin/api/landing-kegiatan",s=y.value?"PUT":"POST",n=await(await fetch(e,{method:s,headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin",body:r})).json();n.success?(alert(y.value?"Kegiatan berhasil diupdate":"Kegiatan berhasil ditambahkan"),w.push("/company/landing-kegiatan")):(n.errors&&Object.keys(n.errors).forEach(g=>{o.hasOwnProperty(g)&&(o[g]=Array.isArray(n.errors[g])?n.errors[g][0]:n.errors[g])}),alert(n.message||"Gagal menyimpan data"))}catch(r){console.error("Error saving:",r),alert("Terjadi kesalahan saat menyimpan data")}finally{k.value=!1}}};return Y(()=>{H()}),(r,e)=>(i(),Q(re,null,{default:Z(()=>[T(se,{pageTitle:V.value},null,8,["pageTitle"]),t("div",de,[t("div",ne,[t("h3",ie,l(V.value),1),t("button",{onClick:C,class:"flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03]"}," Batal ")]),t("form",{onSubmit:ee(z,["prevent"]),class:"flex flex-col"},[t("div",le,[t("div",ce,[e[11]||(e[11]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[f(" Nama Kegiatan "),t("span",{class:"text-red-500"},"*")],-1)),p(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>a.title=s),placeholder:"Masukkan nama kegiatan",maxlength:"100",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[m,a.title]]),t("p",ge,l(a.title.length)+"/100 karakter ",1),o.title?(i(),c("p",ue,l(o.title),1)):u("",!0)]),t("div",pe,[e[12]||(e[12]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[f(" Total Penerima Manfaat "),t("span",{class:"text-red-500"},"*")],-1)),p(t("input",{type:"number","onUpdate:modelValue":e[1]||(e[1]=s=>a.number_of_recipients=s),placeholder:"Masukkan total penerima manfaat",min:"1",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[m,a.number_of_recipients,void 0,{number:!0}]]),a.number_of_recipients?(i(),c("p",me,l(L(a.number_of_recipients))+" penerima ",1)):u("",!0),o.number_of_recipients?(i(),c("p",be,l(o.number_of_recipients),1)):u("",!0)]),t("div",xe,[e[13]||(e[13]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[f(" Tanggal Kegiatan "),t("span",{class:"text-red-500"},"*")],-1)),T(te(ae),{modelValue:a.activity_date,"onUpdate:modelValue":e[2]||(e[2]=s=>a.activity_date=s),config:K,class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",placeholder:"Pilih tanggal kegiatan"},null,8,["modelValue"]),o.activity_date?(i(),c("p",ye,l(o.activity_date),1)):u("",!0)]),t("div",ke,[e[14]||(e[14]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Provinsi ",-1)),p(t("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=s=>a.province=s),placeholder:"Masukkan provinsi",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[m,a.province]])]),t("div",fe,[e[15]||(e[15]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kota ",-1)),p(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=s=>a.city=s),placeholder:"Masukkan kota",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[m,a.city]])]),t("div",he,[e[16]||(e[16]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kecamatan ",-1)),p(t("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=s=>a.district=s),placeholder:"Masukkan kecamatan",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[m,a.district]])]),t("div",ve,[e[17]||(e[17]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kelurahan ",-1)),p(t("input",{type:"text","onUpdate:modelValue":e[6]||(e[6]=s=>a.village=s),placeholder:"Masukkan kelurahan",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[m,a.village]])]),t("div",_e,[e[18]||(e[18]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kode Pos ",-1)),p(t("input",{type:"text","onUpdate:modelValue":e[7]||(e[7]=s=>a.postal_code=s),placeholder:"Masukkan kode pos",pattern:"[0-9]*",onInput:A,class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,544),[[m,a.postal_code]]),o.postal_code?(i(),c("p",we,l(o.postal_code),1)):u("",!0)]),t("div",Me,[e[19]||(e[19]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[f(" Alamat "),t("span",{class:"text-red-500"},"*")],-1)),p(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=s=>a.address=s),placeholder:"Masukkan alamat lengkap",maxlength:"1000",rows:"3",required:"",class:"dark:bg-dark-900 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[m,a.address]]),t("p",je,l(a.address.length)+"/1000 karakter ",1),o.address?(i(),c("p",Te,l(o.address),1)):u("",!0)]),t("div",Se,[e[20]||(e[20]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[f(" Status "),t("span",{class:"text-red-500"},"*")],-1)),T(oe,{modelValue:a.status,"onUpdate:modelValue":e[9]||(e[9]=s=>a.status=s),options:$,placeholder:"Pilih Status","search-input":S.value,"onUpdate:searchInput":e[10]||(e[10]=s=>S.value=s)},null,8,["modelValue","search-input"]),o.status?(i(),c("p",Ve,l(o.status),1)):u("",!0)]),t("div",Ce,[e[24]||(e[24]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Gambar Program ",-1)),t("div",Pe,[t("div",null,[t("input",{ref_key:"fileInputRef",ref:M,type:"file",multiple:"",accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:D,class:"dark:bg-dark-900 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus:border-brand-800"},null,544),e[21]||(e[21]=t("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," Format: JPG, PNG, WebP. Maksimal 20MB per file. ",-1))]),v.value.length>0||_.value.length>0?(i(),c("div",Fe,[(i(!0),c(B,null,I(_.value,(s,d)=>(i(),c("div",{key:`existing-${d}`,class:"relative group"},[t("img",{src:`/storage/${s}`,alt:`Image ${d+1}`,class:"h-32 w-full rounded-lg object-cover border border-gray-300 dark:border-gray-700"},null,8,Be),t("button",{type:"button",onClick:n=>N(d),class:"absolute top-2 right-2 flex items-center justify-center w-6 h-6 rounded-full bg-red-500 text-white opacity-0 group-hover:opacity-100 transition-opacity"},[...e[22]||(e[22]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M18 6L6 18M6 6l12 12"})],-1)])],8,Ie)]))),128)),(i(!0),c(B,null,I(v.value,(s,d)=>(i(),c("div",{key:`new-${d}`,class:"relative group"},[t("img",{src:R(s),alt:s.name,class:"h-32 w-full rounded-lg object-cover border border-gray-300 dark:border-gray-700"},null,8,$e),t("button",{type:"button",onClick:n=>E(d),class:"absolute top-2 right-2 flex items-center justify-center w-6 h-6 rounded-full bg-red-500 text-white opacity-0 group-hover:opacity-100 transition-opacity"},[...e[23]||(e[23]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M18 6L6 18M6 6l12 12"})],-1)])],8,Ue),t("p",Ke,l(s.name),1),t("p",Le,l(O(s.size)),1)]))),128))])):u("",!0)]),o.images?(i(),c("p",Ae,l(o.images),1)):u("",!0)]),t("div",De,[e[25]||(e[25]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[f(" Deskripsi "),t("span",{class:"text-red-500"},"*")],-1)),t("div",Ee,[t("div",{ref_key:"editorRef",ref:U,contenteditable:"true",innerHTML:a.description,onInput:q,class:"dark:bg-dark-900 min-h-[200px] w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",style:{"white-space":"pre-wrap"}},null,40,Ne),a.description?u("",!0):(i(),c("p",Re," Masukkan deskripsi kegiatan... "))]),o.description?(i(),c("p",Oe,l(o.description),1)):u("",!0)])]),t("div",qe,[t("button",{onClick:C,type:"button",class:"flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] sm:w-auto"}," Batal "),t("button",{type:"submit",disabled:k.value,class:"flex w-full justify-center rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600 disabled:opacity-50 disabled:cursor-not-allowed sm:w-auto"},l(k.value?"Menyimpan...":y.value?"Simpan Perubahan":"Simpan"),9,Ge)])],32)])]),_:1}))}});export{et as default};
