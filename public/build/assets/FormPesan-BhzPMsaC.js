import{d as T,H as V,I as C,M,A as R,b as u,e as f,f as $,g as q,o as l,w as H,a as r,t as d,q as I,j as U,c as n,i as B,m as g,k as y,n as k,v}from"./admin-CIALJdJ2.js";import{_ as N}from"./AdminLayout.vue_vue_type_script_setup_true_lang-Bg2foaBZ.js";import{S as D}from"./SearchableSelect-TJ43mfLB.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const A={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},F={class:"mb-6 flex items-center justify-between"},G={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},L={class:"grid grid-cols-1 gap-x-6 gap-y-5 lg:grid-cols-2"},W={class:"lg:col-span-1"},X={key:0,class:"mt-1 text-xs text-red-500"},O={class:"lg:col-span-1"},z={key:0,class:"mt-1 text-xs text-red-500"},J={key:1,class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},K={class:"lg:col-span-2"},Y={key:0,class:"mt-1 text-xs text-red-500"},Z={key:1,class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},Q={class:"flex items-center gap-3 mt-6 lg:justify-end"},ee=["disabled"],te={key:0},ae={key:1},ne=T({__name:"FormPesan",setup(se){const _=V();C();const p=M(),w=R(()=>_.meta.title||"Form Pesan"),c=u([]),b=u(""),m=u(!1),a=f({receiver_id:"",title:"",message:""}),s=f({receiver_id:"",title:"",message:""}),x=t=>{s[t]=""},j=t=>{b.value=t},S=async(t="")=>{try{const e=await fetch(`/admin/api/users${t?`?search=${encodeURIComponent(t)}`:""}`,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin"});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const i=await e.json();i.success&&i.data&&(c.value=i.data.map(o=>({value:String(o.id),label:o.name||`${o.first_name} ${o.last_name}`||o.email||`User #${o.id}`})))}catch(e){console.error("Error fetching users:",e),c.value.length===0&&(c.value=[{value:"1",label:"Ahmad Hidayat"},{value:"2",label:"Siti Nurhaliza"},{value:"3",label:"Budi Santoso"},{value:"4",label:"Dewi Lestari"},{value:"5",label:"Eko Prasetyo"},{value:"6",label:"Fitri Handayani"},{value:"7",label:"Guntur Wibowo"},{value:"8",label:"Hesti Rahayu"},{value:"9",label:"Indra Wijaya"},{value:"10",label:"Joko Susilo"}])}},P=()=>{let t=!0;return s.receiver_id="",s.title="",s.message="",a.receiver_id||(s.receiver_id="Penerima pesan wajib diisi",t=!1),!a.title||a.title.trim()===""?(s.title="Subjek wajib diisi",t=!1):a.title.length>100&&(s.title="Subjek tidak boleh lebih dari 100 karakter",t=!1),!a.message||a.message.trim()===""?(s.message="Pesan wajib diisi",t=!1):a.message.length>1e3&&(s.message="Pesan tidak boleh lebih dari 1000 karakter",t=!1),t},h=()=>{a.receiver_id="",a.title="",a.message="",Object.keys(s).forEach(t=>{s[t]=""})},E=async()=>{if(P()){m.value=!0;try{const t={receiver_id:a.receiver_id,title:a.title.trim(),message:a.message.trim()},e=await fetch("/admin/api/messages",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin",body:JSON.stringify(t)});if(!e.ok){const o=await e.json();throw new Error(o.message||"Gagal mengirim pesan")}const i=await e.json();if(i.success)p.success("Pesan berhasil dikirim"),h();else throw new Error(i.message||"Gagal mengirim pesan")}catch(t){console.error("Error sending message:",t),p.error(t instanceof Error?t.message:"Terjadi kesalahan saat mengirim pesan")}finally{m.value=!1}}};return $(()=>{S()}),(t,e)=>(l(),q(N,null,{default:H(()=>[r("div",A,[r("div",F,[r("h3",G,d(w.value),1)]),r("form",{onSubmit:I(E,["prevent"]),class:"flex flex-col"},[r("div",L,[r("div",W,[e[5]||(e[5]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[g(" Penerima Pesan "),r("span",{class:"text-red-500"},"*")],-1)),U(D,{modelValue:a.receiver_id,"onUpdate:modelValue":e[0]||(e[0]=i=>a.receiver_id=i),options:c.value,placeholder:"Pilih atau cari penerima pesan","search-input":b.value,"onUpdate:searchInput":j},null,8,["modelValue","options","search-input"]),s.receiver_id?(l(),n("p",X,d(s.receiver_id),1)):B("",!0)]),r("div",O,[e[6]||(e[6]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[g(" Subjek "),r("span",{class:"text-red-500"},"*")],-1)),y(r("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=i=>a.title=i),placeholder:"Masukkan subjek pesan",maxlength:"100",required:"",class:k(["dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",{"border-red-500":s.title}]),onInput:e[2]||(e[2]=i=>x("title"))},null,34),[[v,a.title]]),s.title?(l(),n("p",z,d(s.title),1)):(l(),n("p",J,d(a.title.length)+"/100 karakter ",1))]),r("div",K,[e[7]||(e[7]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[g(" Pesan "),r("span",{class:"text-red-500"},"*")],-1)),y(r("textarea",{"onUpdate:modelValue":e[3]||(e[3]=i=>a.message=i),placeholder:"Masukkan isi pesan",maxlength:"1000",rows:"6",required:"",class:k(["dark:bg-dark-900 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",{"border-red-500":s.message}]),onInput:e[4]||(e[4]=i=>x("message"))},null,34),[[v,a.message]]),s.message?(l(),n("p",Y,d(s.message),1)):(l(),n("p",Z,d(a.message.length)+"/1000 karakter ",1))])]),r("div",Q,[r("button",{onClick:h,type:"button",class:"flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] sm:w-auto"}," Batal "),r("button",{type:"submit",disabled:m.value,class:"flex w-full justify-center rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600 disabled:opacity-50 disabled:cursor-not-allowed sm:w-auto"},[m.value?(l(),n("span",te,"Mengirim...")):(l(),n("span",ae,"Kirim Pesan"))],8,ee)])],32)])]),_:1}))}});export{ne as default};
