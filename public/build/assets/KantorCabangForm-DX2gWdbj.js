import{d as R,H as A,I as P,V as U,r as V,A as v,a as N,B as q,o as X,L as T,N as B,c as G,b as C,w as I,e as H,f as r,t as j,p as $,i as g,j as O,g as D,n as z,v as c,l as J}from"./admin-CQgzRBJW.js";import{_ as W}from"./AdminLayout.vue_vue_type_script_setup_true_lang-CX1nMTLy.js";import{_ as Y}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-BDFWjfrB.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Z={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},Q={class:"mb-6 flex items-center justify-between"},aa={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},ea={class:"grid grid-cols-1 gap-x-6 gap-y-5 lg:grid-cols-2"},ta={class:"lg:col-span-1"},ra=["readonly","disabled"],oa={key:0,class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},na={class:"lg:col-span-1"},sa={class:"lg:col-span-1"},da={class:"lg:col-span-1"},la={class:"lg:col-span-1"},ia={class:"lg:col-span-1"},ua={class:"lg:col-span-1"},ga={class:"lg:col-span-2"},ca={class:"lg:col-span-2"},pa={class:"mt-3 grid grid-cols-1 gap-4 lg:grid-cols-2"},ma={class:"flex items-center gap-3 mt-6 lg:justify-end"},ka={type:"submit",class:"flex w-full justify-center rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600 sm:w-auto"},wa=R({__name:"KantorCabangForm",setup(ba){const m=A(),k=P(),p=U(),b=V(null);let i=null,u=null,y=!1;const l=v(()=>m.params.id!==void 0&&m.params.id!=="new"),f=v(()=>l.value?"Edit Kantor Cabang":"Tambah Kantor Cabang"),a=N({kode:"",nama:"",kelurahan:"",kecamatan:"",kota:"",provinsi:"",kode_pos:"",alamat:"",latitude:"",longitude:""}),K=async()=>{if(b.value)try{window.maplibregl||await new Promise((o,e)=>{if(document.querySelector('script[src*="maplibre-gl"]')){const n=setInterval(()=>{window.maplibregl&&(clearInterval(n),o())},100);return}const t=document.createElement("script");t.src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js",t.onload=()=>o(),t.onerror=()=>e(new Error("Failed to load MapTiler")),document.head.appendChild(t);const s=document.createElement("link");s.rel="stylesheet",s.href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css",document.head.appendChild(s)}),M()}catch(o){console.error("Error loading MapTiler:",o)}},M=()=>{if(!b.value||!window.maplibregl)return;const o=a.longitude?parseFloat(a.longitude):106.8451,e=a.latitude?parseFloat(a.latitude):-6.2088;i=new window.maplibregl.Map({container:b.value,style:"https://api.maptiler.com/maps/streets-v2/style.json?key=M3H6Ho6JJ93ZPH10DnYt",center:[o,e],zoom:a.latitude&&a.longitude?15:13}),i.on("load",()=>{u=new window.maplibregl.Marker({draggable:!0}).setLngLat([o,e]).addTo(i),u.on("dragend",()=>{const t=u.getLngLat();a.longitude=t.lng.toFixed(6),a.latitude=t.lat.toFixed(6)}),i.on("click",t=>{const{lng:s,lat:n}=t.lngLat;u.setLngLat([s,n]),a.longitude=s.toFixed(6),a.latitude=n.toFixed(6)})})},F=async o=>{if(!o||o.trim()==="")return null;try{const e=encodeURIComponent(o+", Indonesia"),t=await fetch(`https://nominatim.openstreetmap.org/search?q=${e}&format=json&limit=1&addressdetails=1`,{headers:{"User-Agent":"KMS-Application/1.0"}});if(!t.ok)throw new Error("Geocoding request failed");const s=await t.json();return s&&s.length>0?{lat:parseFloat(s[0].lat),lng:parseFloat(s[0].lon)}:null}catch(e){return console.error("Error geocoding address:",e),null}},L=(o,e)=>{!i||!u||(u.setLngLat([e,o]),a.latitude=o.toFixed(6),a.longitude=e.toFixed(6),i.flyTo({center:[e,o],zoom:15,duration:1e3}))};q(()=>[a.alamat,a.kelurahan,a.kecamatan,a.kota,a.provinsi],async(o,e)=>{if(y||!i||!u||!o[0]&&!o[1]&&!o[2]&&!o[3]&&!o[4])return;const t=[];a.alamat&&t.push(a.alamat),a.kelurahan&&t.push(a.kelurahan),a.kecamatan&&t.push(a.kecamatan),a.kota&&t.push(a.kota),a.provinsi&&t.push(a.provinsi);const s=t.join(", ");if(!(s.trim()===""||(await new Promise(d=>setTimeout(d,500)),[a.alamat,a.kelurahan,a.kecamatan,a.kota,a.provinsi].filter(Boolean).join(", ")!==s))){y=!0;try{const d=await F(s);d&&L(d.lat,d.lng)}catch(d){console.error("Error updating map from address:",d)}finally{y=!1}}},{deep:!0});const h=async()=>{var o;try{const e=(o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content");if(e)return e;const t=await fetch("/admin/api/csrf-token",{method:"GET",credentials:"same-origin"});if(!t.ok)throw new Error(`Failed to get CSRF token: ${t.status}`);return(await t.json()).csrf_token||""}catch(e){return console.error("Failed to get CSRF token:",e),""}},E=async()=>{if(!l.value)try{const o=await h(),t=await(await fetch("/admin/api/kantor-cabang-next-kode",{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Accept:"application/json","X-CSRF-TOKEN":o},credentials:"same-origin"})).json();t.success&&t.data&&(a.kode=t.data.kode||"")}catch(o){console.error("Error loading next kode:",o)}},S=async()=>{if(l.value&&m.params.id){const o=m.params.id;try{const e=await h(),s=await(await fetch(`/admin/api/kantor-cabang/${o}`,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Accept:"application/json","X-CSRF-TOKEN":e},credentials:"same-origin"})).json();if(s.success&&s.data){const n=s.data;if(a.kode=n.kode||"",a.nama=n.nama||"",a.kelurahan=n.kelurahan||"",a.kecamatan=n.kecamatan||"",a.kota=n.kota||"",a.provinsi=n.provinsi||"",a.kode_pos=n.kode_pos||"",a.alamat=n.alamat||"",a.latitude=n.latitude?String(n.latitude):"",a.longitude=n.longitude?String(n.longitude):"",n.latitude&&n.longitude&&(await T(),i&&u)){const d=parseFloat(n.latitude),x=parseFloat(n.longitude);u.setLngLat([x,d]),i.flyTo({center:[x,d],zoom:15,duration:1e3})}}else p.error("Gagal memuat data kantor cabang"),k.push("/administrasi/kantor-cabang")}catch(e){console.error("Error loading data:",e),p.error("Terjadi kesalahan saat memuat data"),k.push("/administrasi/kantor-cabang")}}},w=()=>{k.push("/administrasi/kantor-cabang")},_=async()=>{if(!a.nama){p.error("Nama Kantor Cabang wajib diisi");return}try{const o=await h();if(!o){p.error("Gagal mendapatkan CSRF token. Silakan refresh halaman.");return}const e={nama:a.nama,kelurahan:a.kelurahan||null,kecamatan:a.kecamatan||null,kota:a.kota||null,provinsi:a.provinsi||null,kode_pos:a.kode_pos||null,alamat:a.alamat||null,latitude:a.latitude?parseFloat(a.latitude):null,longitude:a.longitude?parseFloat(a.longitude):null};l.value&&a.kode&&(e.kode=a.kode);const t=l.value?`/admin/api/kantor-cabang/${m.params.id}`:"/admin/api/kantor-cabang",s=l.value?"PUT":"POST",d=await(await fetch(t,{method:s,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Accept:"application/json","X-CSRF-TOKEN":o},credentials:"same-origin",body:JSON.stringify(e)})).json();if(d.success)p.success(l.value?"Kantor cabang berhasil diupdate":"Kantor cabang berhasil ditambahkan"),k.push("/administrasi/kantor-cabang");else if(d.errors){const x=Object.values(d.errors).flat().join(", ");p.error(`Validasi gagal: ${x}`)}else p.error(d.message||"Gagal menyimpan data")}catch(o){console.error("Error saving:",o),p.error("Terjadi kesalahan saat menyimpan data")}};return X(async()=>{l.value?await S():await E(),await T(),K()}),B(()=>{i&&(i.remove(),i=null),u=null}),(o,e)=>(C(),G(W,null,{default:I(()=>[H(Y,{pageTitle:f.value},null,8,["pageTitle"]),r("div",Z,[r("div",Q,[r("h3",aa,j(f.value),1),r("button",{onClick:w,class:"flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03]"}," Batal ")]),r("form",{onSubmit:$(_,["prevent"]),class:"flex flex-col"},[r("div",ea,[r("div",ta,[e[10]||(e[10]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kode Kantor Cabang ",-1)),g(r("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=t=>a.kode=t),placeholder:"Kode akan di-generate otomatis",readonly:!l.value,disabled:!l.value,class:z(["dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-800 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",{"cursor-not-allowed opacity-60":!l.value}])},null,10,ra),[[c,a.kode]]),l.value?D("",!0):(C(),O("p",oa," Kode akan di-generate otomatis "))]),r("div",na,[e[11]||(e[11]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[J(" Nama Kantor Cabang "),r("span",{class:"text-red-500"},"*")],-1)),g(r("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=t=>a.nama=t),placeholder:"Masukkan nama kantor cabang",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[c,a.nama]])]),r("div",sa,[e[12]||(e[12]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kelurahan ",-1)),g(r("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=t=>a.kelurahan=t),placeholder:"Masukkan kelurahan",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[c,a.kelurahan]])]),r("div",da,[e[13]||(e[13]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kecamatan ",-1)),g(r("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=t=>a.kecamatan=t),placeholder:"Masukkan kecamatan",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[c,a.kecamatan]])]),r("div",la,[e[14]||(e[14]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kota ",-1)),g(r("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=t=>a.kota=t),placeholder:"Masukkan kota",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[c,a.kota]])]),r("div",ia,[e[15]||(e[15]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Provinsi ",-1)),g(r("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=t=>a.provinsi=t),placeholder:"Masukkan provinsi",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[c,a.provinsi]])]),r("div",ua,[e[16]||(e[16]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kode Pos ",-1)),g(r("input",{type:"text","onUpdate:modelValue":e[6]||(e[6]=t=>a.kode_pos=t),placeholder:"Masukkan kode pos",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[c,a.kode_pos]])]),r("div",ga,[e[17]||(e[17]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Alamat ",-1)),g(r("textarea",{"onUpdate:modelValue":e[7]||(e[7]=t=>a.alamat=t),placeholder:"Masukkan alamat lengkap",rows:"3",class:"dark:bg-dark-900 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[c,a.alamat]])]),r("div",ca,[e[20]||(e[20]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Pilih Lokasi di Peta ",-1)),r("div",{ref_key:"mapContainer",ref:b,class:"w-full rounded-lg border border-gray-300 dark:border-gray-700",style:{height:"400px"}},null,512),r("div",pa,[r("div",null,[e[18]||(e[18]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Latitude ",-1)),g(r("input",{type:"text","onUpdate:modelValue":e[8]||(e[8]=t=>a.latitude=t),placeholder:"Koordinat latitude",readonly:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 dark:border-gray-700 dark:bg-gray-800 dark:text-white/90 dark:placeholder:text-white/30"},null,512),[[c,a.latitude]])]),r("div",null,[e[19]||(e[19]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Longitude ",-1)),g(r("input",{type:"text","onUpdate:modelValue":e[9]||(e[9]=t=>a.longitude=t),placeholder:"Koordinat longitude",readonly:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 dark:border-gray-700 dark:bg-gray-800 dark:text-white/90 dark:placeholder:text-white/30"},null,512),[[c,a.longitude]])])]),e[21]||(e[21]=r("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," Klik pada peta untuk memilih lokasi atau drag marker untuk memperbarui koordinat. Titik di peta akan otomatis diperbarui saat Anda mengisi Kelurahan, Kecamatan, Kota, atau Provinsi. ",-1))])]),r("div",ma,[r("button",{onClick:w,type:"button",class:"flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] sm:w-auto"}," Batal "),r("button",ka,j(l.value?"Simpan Perubahan":"Simpan"),1)])],32)])]),_:1}))}});export{wa as default};
