import{d as ae,H as re,I as se,A as M,M as ne,Q as oe,b as x,e as U,f as ie,V as E,y as le,g as de,o as c,w as ce,a as t,t as f,q as ue,k as me,m as j,n as S,v as ge,c as m,j as V,i as k,F,l as A}from"./admin-CT5My_mW.js";import{_ as pe}from"./AdminLayout.vue_vue_type_script_setup_true_lang-CDNBll6s.js";import{S as $}from"./SearchableSelect-q_h7RwSr.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const he={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},be={class:"mb-6 flex items-center justify-between"},fe={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},ke={class:"grid grid-cols-1 gap-x-6 gap-y-5 lg:grid-cols-2"},ve={class:"lg:col-span-2"},ye={class:"mt-1 flex items-center justify-between"},xe={key:0,class:"text-xs text-red-500"},we={key:1,class:"text-xs text-gray-500 dark:text-gray-400"},_e={class:"text-xs text-gray-500 dark:text-gray-400"},Me={class:"lg:col-span-1"},je={key:0,class:"mt-1 block text-xs text-red-500"},Te={class:"lg:col-span-1"},Le={class:"lg:col-span-2"},Ee={class:"space-y-4"},Se={class:"relative"},Ce=["disabled"],Ie={class:"text-center"},qe={key:0,class:"mt-1 text-xs text-red-500"},Be={key:0,class:"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5"},He=["src","alt"],Pe=["onClick"],Re=["src","alt"],Ue=["onClick"],Ve={class:"absolute bottom-0 left-0 right-0 bg-black/50 px-2 py-1"},Fe={class:"truncate text-xs text-white"},Ae={class:"text-xs text-gray-300"},$e={class:"lg:col-span-2"},ze={key:0,class:"mt-1 block text-xs text-red-500"},De={class:"flex items-center gap-3 mt-6 lg:justify-end"},Ne={key:0,type:"submit",class:"flex w-full justify-center rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600 sm:w-auto"},Xe=ae({__name:"LandingProgramForm",setup(Oe){const w=re(),C=se(),v=M(()=>w.params.id!==void 0&&w.params.id!=="new"),z=M(()=>v.value?"Edit Landing Program":"Tambah Landing Program"),h=ne(),{fetchUser:D,hasPermission:I,isAdmin:q}=oe();D();const B=M(()=>q()||I("create landing program")),_=M(()=>q()||I("update landing program")),N=[{value:"active",label:"Aktif"},{value:"inactive",label:"Tidak Aktif"}],O=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],H=x(""),P=x(""),T=x(null),d=x([]),y=x([]),L=x(null);let u=null;const n=U({name:"",status:"",highlight:"",description:""}),l=U({name:"",status:"",description:""}),Q=async()=>{if(L.value)try{window.Quill||await new Promise((e,r)=>{if(document.querySelector('script[src*="quill"]')){const i=setInterval(()=>{window.Quill&&(clearInterval(i),e())},100);return}const a=document.createElement("script");a.src="https://cdn.quilljs.com/1.3.6/quill.js",a.onload=()=>e(),a.onerror=()=>r(new Error("Failed to load Quill")),document.head.appendChild(a);const p=document.createElement("link");p.rel="stylesheet",p.href="https://cdn.quilljs.com/1.3.6/quill.snow.css",document.head.appendChild(p)}),await E();const s=window.Quill;u=new s(L.value,{theme:"snow",modules:{toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline","strike"],[{list:"ordered"},{list:"bullet"}],[{align:[]}],["link","image"],["clean"]]},placeholder:"Masukkan deskripsi program..."}),n.description&&(u.root.innerHTML=n.description),u.on("text-change",()=>{n.description=u.root.innerHTML}),n.description=u.root.innerHTML}catch(s){console.error("Error initializing Quill:",s)}},G=s=>{if(!s)return"";try{const e=document.createElement("div");return e.innerHTML=s,e.querySelectorAll("script").forEach(i=>i.remove()),e.querySelectorAll("*").forEach(i=>{Array.from(i.attributes).forEach(o=>{(o.name.startsWith("on")||o.name==="javascript:")&&i.removeAttribute(o.name)})}),e.querySelectorAll("iframe").forEach(i=>i.remove()),e.innerHTML}catch(e){console.error("Error sanitizing HTML:",e);const r=document.createElement("div");return r.textContent=s,r.innerHTML}},W=()=>{n.name.length>100&&(n.name=n.name.substring(0,100)),n.name.trim()&&(l.name="")},K=s=>{const e=s.target;if(e.files){const r=Array.from(e.files),a=5-(d.value.length+y.value.length);r.length>a&&(h.warning(`Maksimal 5 gambar. Anda sudah memiliki ${d.value.length+y.value.length} gambar. Hanya ${a} gambar yang akan ditambahkan.`),r.splice(a));const p=20*1024*1024,i=[],o=[];r.forEach(g=>{if(!g.type.startsWith("image/")){o.push(`${g.name} (bukan file gambar)`);return}if(g.size>p){o.push(`${g.name} (melebihi 20MB)`);return}const b=URL.createObjectURL(g);i.push(Object.assign(g,{preview:b}))}),o.length>0&&h.error(`File berikut tidak valid:
${o.join(`
`)}`),d.value.push(...i),T.value&&(T.value.value="")}},X=s=>{URL.revokeObjectURL(d.value[s].preview),d.value.splice(s,1)},J=s=>{y.value.splice(s,1)},Y=s=>{if(s===0)return"0 Bytes";const e=1024,r=["Bytes","KB","MB","GB"],a=Math.floor(Math.log(s)/Math.log(e));return Math.round(s/Math.pow(e,a)*100)/100+" "+r[a]},Z=()=>{var r;let s=!0;l.name="",l.status="",l.description="",!n.name||!n.name.trim()?(l.name="Nama program wajib diisi",s=!1):n.name.length>100&&(l.name="Nama program maksimal 100 karakter",s=!1),n.status||(l.status="Status wajib dipilih",s=!1);let e="";if(u)e=u.getText().trim();else{const a=document.createElement("div");a.innerHTML=n.description||"",e=((r=a.textContent)==null?void 0:r.trim())||""}return e||(l.description="Deskripsi wajib diisi",s=!1),s},ee=async()=>{if(v.value&&w.params.id){const s=w.params.id;try{const r=await(await fetch(`/admin/api/landing-program/${s}`,{headers:{"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"})).json();if(r.success&&r.data){const a=r.data;if(n.name=a.name||"",n.status=a.is_active?"active":"inactive",n.highlight=a.is_highlight?"yes":"no",n.description=a.description||"",a.image_url){const p=a.image_url.startsWith("http")?a.image_url:`/storage/${a.image_url}`;y.value=[{url:p,name:a.name}]}}}catch(e){console.error("Failed to load landing program",e)}}},R=()=>{d.value.forEach(s=>{URL.revokeObjectURL(s.preview)}),C.push("/company/landing-program")},te=async()=>{var s;if(Z()){if(v.value?!_.value:!B.value){h.error("Anda tidak memiliki izin untuk melakukan tindakan ini");return}try{let e=n.description;u&&(e=u.root.innerHTML,n.description=e);const r=G(e),a=new FormData;if(a.append("name",n.name.trim()),a.append("status",n.status),n.highlight){const o=n.highlight==="yes"?"1":"0";a.append("is_highlight",o)}a.append("description",r),d.value.length>0&&a.append("image",d.value[0]);let i=((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"))||"";if(!i)try{const g=await(await fetch("/admin/api/csrf-token")).json();i=(g==null?void 0:g.token)||""}catch{}i&&a.append("_token",i);try{const o={};if(i&&(o["X-CSRF-TOKEN"]=i),v.value){a.append("_method","PUT");const b=await(await fetch(`/admin/api/landing-program/${w.params.id}`,{method:"POST",headers:o,body:a,credentials:"same-origin"})).json();if(b.success)h.success("Landing program berhasil diupdate");else throw h.error(b.message||"Validation failed"),new Error(b.message||"Validation failed")}else{const b=await(await fetch("/admin/api/landing-program",{method:"POST",headers:o,body:a,credentials:"same-origin"})).json();if(b.success)h.success("Landing program berhasil dibuat");else throw h.error(b.message||"Validation failed"),new Error(b.message||"Validation failed")}}catch(o){console.error("Save error:",o),h.error("Terjadi kesalahan saat menyimpan data: "+(o.message||""));return}C.push("/company/landing-program")}catch(e){console.error("Error saving:",e),h.error("Terjadi kesalahan saat menyimpan data")}}};return ie(async()=>{await ee(),await E(),await Q(),await E(),u&&n.description&&(u.root.innerHTML=n.description)}),le(()=>{d.value.forEach(s=>{URL.revokeObjectURL(s.preview)}),u&&(u=null)}),(s,e)=>(c(),de(pe,null,{default:ce(()=>[t("div",he,[t("div",be,[t("h3",fe,f(z.value),1),t("button",{onClick:R,class:"flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03]"}," Batal ")]),t("form",{onSubmit:ue(te,["prevent"]),class:"flex flex-col"},[t("div",ke,[t("div",ve,[e[5]||(e[5]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[j(" Nama Program "),t("span",{class:"text-red-500"},"*")],-1)),me(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=r=>n.name=r),onInput:W,placeholder:"Masukkan nama program",required:"",maxlength:"100",class:S(["dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",{"border-red-300 dark:border-red-500":l.name}])},null,34),[[ge,n.name]]),t("div",ye,[l.name?(c(),m("span",xe,f(l.name),1)):(c(),m("span",we)),t("span",_e,f(n.name.length)+"/100 karakter ",1)])]),t("div",Me,[e[6]||(e[6]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[j(" Status "),t("span",{class:"text-red-500"},"*")],-1)),V($,{modelValue:n.status,"onUpdate:modelValue":e[1]||(e[1]=r=>n.status=r),options:N,placeholder:"Pilih status",searchInput:H.value,"onUpdate:searchInput":e[2]||(e[2]=r=>H.value=r)},null,8,["modelValue","searchInput"]),l.status?(c(),m("span",je,f(l.status),1)):k("",!0)]),t("div",Te,[e[7]||(e[7]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Highlight ",-1)),V($,{modelValue:n.highlight,"onUpdate:modelValue":e[3]||(e[3]=r=>n.highlight=r),options:O,placeholder:"Pilih highlight",searchInput:P.value,"onUpdate:searchInput":e[4]||(e[4]=r=>P.value=r)},null,8,["modelValue","searchInput"])]),t("div",Le,[e[13]||(e[13]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Gambar Program ",-1)),t("div",Ee,[t("div",Se,[t("input",{type:"file",ref_key:"fileInputRef",ref:T,onChange:K,multiple:"",accept:"image/*",class:"hidden",id:"image-upload",disabled:d.value.length>=5},null,40,Ce),t("label",{for:"image-upload",class:S(["flex cursor-pointer items-center justify-center rounded-lg border-2 border-dashed border-gray-300 bg-gray-50 px-6 py-8 text-center transition-colors hover:border-brand-300 hover:bg-gray-100 dark:border-gray-700 dark:bg-gray-900/50 dark:hover:border-brand-500",{"opacity-50 cursor-not-allowed":d.value.length>=5}])},[t("div",Ie,[e[8]||(e[8]=t("svg",{class:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1)),e[9]||(e[9]=t("p",{class:"mt-2 text-sm text-gray-600 dark:text-gray-400"},[t("span",{class:"font-medium text-brand-500"},"Klik untuk upload"),j(" atau drag and drop ")],-1)),e[10]||(e[10]=t("p",{class:"text-xs text-gray-500 dark:text-gray-500"}," PNG, JPG, GIF, WEBP hingga 20MB (Maksimal 5 gambar) ",-1)),d.value.length>=5?(c(),m("p",qe," Maksimal 5 gambar sudah tercapai ")):k("",!0)])],2)]),d.value.length>0||y.value.length>0?(c(),m("div",Be,[(c(!0),m(F,null,A(y.value,(r,a)=>(c(),m("div",{key:`existing-${a}`,class:"group relative aspect-square overflow-hidden rounded-lg border border-gray-200 bg-gray-100 dark:border-gray-700 dark:bg-gray-800"},[t("img",{src:r.url,alt:r.name||`Image ${a+1}`,class:"h-full w-full object-cover"},null,8,He),_.value?(c(),m("button",{key:0,type:"button",onClick:p=>J(a),class:"absolute right-2 top-2 rounded-lg bg-red-500 p-1.5 text-white opacity-0 transition-opacity hover:bg-red-600 group-hover:opacity-100"},[...e[11]||(e[11]=[t("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Pe)):k("",!0)]))),128)),(c(!0),m(F,null,A(d.value,(r,a)=>(c(),m("div",{key:`new-${a}`,class:"group relative aspect-square overflow-hidden rounded-lg border border-gray-200 bg-gray-100 dark:border-gray-700 dark:bg-gray-800"},[t("img",{src:r.preview,alt:r.name,class:"h-full w-full object-cover"},null,8,Re),_.value?(c(),m("button",{key:0,type:"button",onClick:p=>X(a),class:"absolute right-2 top-2 rounded-lg bg-red-500 p-1.5 text-white opacity-0 transition-opacity hover:bg-red-600 group-hover:opacity-100"},[...e[12]||(e[12]=[t("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Ue)):k("",!0),t("div",Ve,[t("p",Fe,f(r.name),1),t("p",Ae,f(Y(r.size)),1)])]))),128))])):k("",!0)])]),t("div",$e,[e[14]||(e[14]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[j(" Deskripsi "),t("span",{class:"text-red-500"},"*")],-1)),t("div",{ref_key:"quillEditorRef",ref:L,class:S(["min-h-[180px] rounded-lg border border-gray-300 dark:border-gray-700",{"border-red-300 dark:border-red-500":l.description}])},null,2),l.description?(c(),m("span",ze,f(l.description),1)):k("",!0),e[15]||(e[15]=t("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," Gunakan editor untuk memformat deskripsi program. Konten akan disanitasi untuk keamanan. ",-1))])]),e[16]||(e[16]=t("div",{class:"mt-16 flex items-center gap-3 lg:justify-end"},null,-1)),t("div",De,[t("button",{onClick:R,type:"button",class:"flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] sm:w-auto"}," Batal "),(v.value?_.value:B.value)?(c(),m("button",Ne,f(v.value?"Simpan Perubahan":"Simpan"),1)):k("",!0)])],32)])]),_:1}))}});export{Xe as default};
