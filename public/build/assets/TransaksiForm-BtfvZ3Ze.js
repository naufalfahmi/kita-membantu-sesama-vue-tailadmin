import{d as B,H as P,I as R,L as K,b as l,A as k,e as O,f as L,g as G,o as I,w as J,a as r,t as T,q as $,j as b,m as g,k as V,v as S,u as z,c as H,i as X}from"./admin-CG83aEo_.js";import{C as Y}from"./component-B0HpOWPj.js";import{_ as q}from"./AdminLayout.vue_vue_type_script_setup_true_lang-Dn6tk0Of.js";import{S as _}from"./SearchableSelect-DxOsoMfa.js";import{A as Z}from"./AsyncSearchableSelect-DOJ3K4GB.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Q={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},W={class:"mb-6 flex items-center justify-between"},aa={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},ea={class:"grid grid-cols-1 gap-x-6 gap-y-5 lg:grid-cols-2"},ra={class:"relative"},ta={class:"lg:col-span-2"},na={class:"flex items-center gap-3 mt-6 lg:justify-end"},oa=["disabled"],sa=["disabled"],ia={key:0,class:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},ba=B({__name:"TransaksiForm",setup(la){const m=P(),y=R(),s=K(),d=l(null),f=k(()=>{var a,e,o;const n=(o=(e=(a=d.value)==null?void 0:a.role)==null?void 0:e.name)==null?void 0:o.toLowerCase();return n==="fundrising"||n==="fundraising"}),u=k(()=>m.params.id!==void 0&&m.params.id!=="new"),D=k(()=>u.value?"Edit Transaksi":"Tambah Transaksi"),x=l(!1),c=l(!1),N={dateFormat:"Y-m-d",altInput:!0,altFormat:"d/m/Y",allowInput:!1},h=l([]),w=l([]),v=l(""),C=l(""),t=O({branchId:"",nominal:null,donorId:"",programId:"",transactionDate:"",notes:""}),E=async()=>{try{const n=await fetch("/admin/api/user",{credentials:"same-origin"});if(n.ok){const a=await n.json();a.success&&a.user&&(d.value=a.user)}}catch(n){console.error("Error fetching current user:",n)}},U=async()=>{try{const[n,a]=await Promise.all([fetch("/admin/api/kantor-cabang?per_page=100",{credentials:"same-origin"}),fetch("/admin/api/program?per_page=100",{credentials:"same-origin"})]);if(n.ok){const e=await n.json(),o=e.success&&e.data?Array.isArray(e.data)?e.data:e.data.data||[]:[];h.value=o.map(i=>({value:i.id,label:i.nama}))}if(a.ok){const e=await a.json(),o=e.success&&e.data?Array.isArray(e.data)?e.data:e.data.data||[]:[];w.value=o.map(i=>({value:i.id,label:i.nama_program}))}}catch(n){console.error("Error fetching options:",n),s.error("Gagal memuat data opsi")}},A=async()=>{if(u.value&&m.params.id){x.value=!0;try{const n=m.params.id,a=await fetch(`/admin/api/transaksi/${n}`,{credentials:"same-origin"});if(!a.ok)throw new Error("Failed to fetch transaksi");const e=await a.json();if(e.success&&e.data){const o=e.data;t.branchId=o.kantor_cabang_id||"",t.nominal=o.nominal,t.donorId=o.donatur_id||"",t.programId=o.program_id||"",t.transactionDate=o.tanggal_transaksi||"",t.notes=o.keterangan||""}}catch(n){console.error("Error loading transaksi:",n),s.error("Gagal memuat data transaksi")}finally{x.value=!1}}},j=()=>{y.push("/keuangan/transaksi")},M=async()=>{var n;if(!t.branchId){s.warning("Kantor Cabang wajib diisi");return}if(!t.nominal||t.nominal<=0){s.warning("Nominal wajib diisi");return}if(!t.donorId){s.warning("Donatur wajib diisi");return}if(!t.programId){s.warning("Program wajib diisi");return}if(!t.transactionDate){s.warning("Tanggal transaksi wajib diisi");return}c.value=!0;try{const a=await fetch("/admin/api/csrf-token",{credentials:"same-origin"});if(!a.ok)throw new Error("Failed to fetch CSRF token");const e=await a.json(),o={kantor_cabang_id:t.branchId,nominal:t.nominal,donatur_id:t.donorId,program_id:t.programId,tanggal_transaksi:t.transactionDate,keterangan:t.notes||null};f.value&&((n=d.value)!=null&&n.id)&&(o.fundraiser_id=d.value.id);let i;u.value?i=await fetch(`/admin/api/transaksi/${m.params.id}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":e.csrf_token},credentials:"same-origin",body:JSON.stringify(o)}):i=await fetch("/admin/api/transaksi",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":e.csrf_token},credentials:"same-origin",body:JSON.stringify(o)});const p=await i.json();if(p.success)s.success(p.message||(u.value?"Transaksi berhasil diupdate":"Transaksi berhasil ditambahkan")),y.push("/keuangan/transaksi");else if(p.errors){const F=Object.values(p.errors).flat().join(", ");s.error(F)}else s.error(p.message||"Gagal menyimpan transaksi")}catch(a){console.error("Error saving:",a),s.error("Terjadi kesalahan saat menyimpan data")}finally{c.value=!1}};return L(async()=>{var n,a;await E(),await U(),await A(),f.value&&!u.value&&(a=(n=d.value)==null?void 0:n.kantor_cabang)!=null&&a.id&&(t.branchId=String(d.value.kantor_cabang.id))}),(n,a)=>(I(),G(q,null,{default:J(()=>[r("div",Q,[r("div",W,[r("h3",aa,T(D.value),1),r("button",{onClick:j,class:"flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03]"}," Batal ")]),r("form",{onSubmit:$(M,["prevent"]),class:"flex flex-col"},[r("div",ea,[r("div",null,[a[8]||(a[8]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[g(" Kantor Cabang "),r("span",{class:"text-red-500"},"*")],-1)),b(_,{modelValue:t.branchId,"onUpdate:modelValue":a[0]||(a[0]=e=>t.branchId=e),options:h.value,placeholder:"Kantor Cabang","search-input":v.value,"onUpdate:searchInput":a[1]||(a[1]=e=>v.value=e),disabled:f.value},null,8,["modelValue","options","search-input","disabled"])]),r("div",null,[a[9]||(a[9]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[g(" Nominal "),r("span",{class:"text-red-500"},"*")],-1)),V(r("input",{type:"number","onUpdate:modelValue":a[2]||(a[2]=e=>t.nominal=e),placeholder:"Nominal",min:"0",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[S,t.nominal,void 0,{number:!0}]])]),r("div",null,[a[10]||(a[10]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[g(" Donatur "),r("span",{class:"text-red-500"},"*")],-1)),b(Z,{modelValue:t.donorId,"onUpdate:modelValue":a[3]||(a[3]=e=>t.donorId=e),"fetch-url":"/admin/api/donatur",placeholder:"Donatur"},null,8,["modelValue"])]),r("div",null,[a[11]||(a[11]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[g(" Program "),r("span",{class:"text-red-500"},"*")],-1)),b(_,{modelValue:t.programId,"onUpdate:modelValue":a[4]||(a[4]=e=>t.programId=e),options:w.value,placeholder:"Program","search-input":C.value,"onUpdate:searchInput":a[5]||(a[5]=e=>C.value=e)},null,8,["modelValue","options","search-input"])]),r("div",null,[a[13]||(a[13]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[g(" Tanggal Transaksi "),r("span",{class:"text-red-500"},"*")],-1)),r("div",ra,[b(z(Y),{modelValue:t.transactionDate,"onUpdate:modelValue":a[6]||(a[6]=e=>t.transactionDate=e),config:N,class:"dark:bg-dark-900 h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 pr-11 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",placeholder:"Tanggal Transaksi"},null,8,["modelValue"]),a[12]||(a[12]=r("span",{class:"absolute text-gray-500 -translate-y-1/2 pointer-events-none right-3 top-1/2 dark:text-gray-400"},[r("svg",{class:"fill-current",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[r("path",{d:"M10 18.3333C14.6024 18.3333 18.3333 14.6024 18.3333 9.99999C18.3333 5.39762 14.6024 1.66666 10 1.66666C5.39763 1.66666 1.66667 5.39762 1.66667 9.99999C1.66667 14.6024 5.39763 18.3333 10 18.3333Z",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),r("path",{d:"M10 5V10L13.3333 11.6667",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})])],-1))])]),r("div",ta,[a[14]||(a[14]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Keterangan ",-1)),V(r("textarea",{"onUpdate:modelValue":a[7]||(a[7]=e=>t.notes=e),placeholder:"Keterangan",maxlength:"1000",rows:"4",class:"dark:bg-dark-900 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[S,t.notes]]),a[15]||(a[15]=r("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," Maksimal 1000 karakter. ",-1))])]),r("div",na,[r("button",{onClick:j,type:"button",disabled:c.value,class:"flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed"}," Batal ",8,oa),r("button",{type:"submit",disabled:c.value,class:"flex w-full justify-center items-center gap-2 rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed"},[c.value?(I(),H("svg",ia,[...a[16]||(a[16]=[r("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),r("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):X("",!0),g(" "+T(c.value?"Menyimpan...":u.value?"Simpan Perubahan":"Simpan"),1)],8,sa)])],32)])]),_:1}))}});export{ba as default};
