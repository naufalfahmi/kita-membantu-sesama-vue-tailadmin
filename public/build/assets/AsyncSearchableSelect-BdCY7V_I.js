import{d as J,A as w,P as K,b as i,f as Q,y as W,B as X,c,o as d,a as v,j as Y,i as b,n as S,t as P,w as Z,k as ee,v as ae,q as te,F as le,l as re,z as ne,U as se}from"./admin-BGttm7We.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ue={key:0,class:"ml-2 text-sm text-gray-500"},ie={key:0,class:"absolute z-50 w-full mt-1 bg-white rounded-lg shadow-lg border border-gray-200 dark:bg-gray-900 dark:border-gray-700 max-h-60 overflow-hidden"},ce={class:"p-2 border-b border-gray-200 dark:border-gray-700"},de={key:0,class:"px-2 border-b bg-gray-50 dark:bg-gray-800"},ve=["onClick"],fe={key:0,class:"px-4 py-2 text-sm text-gray-500 dark:text-gray-400"},ge={key:1,class:"px-4 py-2 text-sm text-gray-500 dark:text-gray-400"},pe={key:2,class:"px-4 py-2 text-xs text-gray-400"},he=J({__name:"AsyncSearchableSelect",props:{modelValue:{},fetchUrl:{},perPage:{default:20},placeholder:{default:"Pilih..."},disabled:{type:Boolean,default:!1},includeAll:{type:Boolean,default:!1},allLabel:{default:"Semua"},allValue:{default:""}},emits:["update:modelValue","update:search-input","fetched"],setup(h,{emit:z}){function E(e,t=300){let a=null;const n=(...r)=>{a&&clearTimeout(a),a=setTimeout(()=>{e(...r)},t)};return n.cancel=()=>{a&&(clearTimeout(a),a=null)},n}const l=h,f=z,{isAdmin:M,fetchUser:$,user:g}=K(),R=w(()=>{const e=g.value&&g.value.role||null,t=e?e.name&&String(e.name)||String(e):"",a=String(t||"").trim().toLowerCase();return a==="fundrising"||a==="fundraising"||a==="fundraiser"}),D=w(()=>{const e=g.value&&g.value.role||null,t=e?e.name&&String(e.name)||String(e):"",a=String(t||"").trim().toLowerCase();return a.includes("direktur")&&(a.includes("fund")||a.includes("fundr"))}),s=i(!1),y=i(!1),o=i([]),k=i(1),m=i(null),u=i(""),T=i(null),_=i(null),V=i(null),F=w(()=>m.value===null?!0:k.value<(m.value||0)),A=w(()=>{if(l.includeAll&&String(l.modelValue)===String(l.allValue))return l.allLabel||"";const e=o.value.find(t=>t.value===l.modelValue);return e?e.label:""}),C=async(e="",t=1)=>{if(l.fetchUrl){y.value=!0;try{const a=new URLSearchParams;e&&a.append("search",e),a.append("per_page",String(l.perPage)),a.append("page",String(t)),l.fetchUrl&&l.fetchUrl.includes("/admin/api/donatur")&&!M()&&!D.value&&(a.append("only_assigned","1"),R.value&&g.value&&g.value.id&&a.append("pic",String(g.value.id)));const n=await fetch(`${l.fetchUrl}?${a.toString()}`,{credentials:"same-origin"});if(!n.ok)throw new Error("Failed to fetch");const r=await n.json();if(r.success){const B=(Array.isArray(r.data)?r.data:r.data&&r.data.data||[]).map(p=>({value:p.id,label:p.nama||p.name||p.kode||p.label||""}));if(t===1)o.value=B;else{const p=new Set(o.value.map(x=>x.value));B.forEach(x=>{p.has(x.value)||o.value.push(x)})}r.pagination?m.value=r.pagination.last_page:r.data&&r.data.last_page?m.value=r.data.last_page:m.value=B.length<l.perPage?t:null,k.value=t}}catch(a){console.error("AsyncSelect fetch error:",a)}finally{y.value=!1}}},I=async e=>{if(!(!l.fetchUrl||!e))try{const t=await fetch(`${l.fetchUrl}/${e}`,{credentials:"same-origin"});if(!t.ok)throw new Error("Failed to fetch by id");const a=await t.json();if(a.success&&a.data){const n=a.data,r={value:n.id,label:n.nama||n.name||n.kode||""};o.value.find(U=>U.value===r.value)||o.value.unshift(r);try{f("fetched",n)}catch{}}}catch{}},L=E(async e=>{k.value=1,m.value=null,await C(e,1)},300),O=e=>{const t=e.target;u.value=t.value,f("update:search-input",t.value),L(t.value)},N=()=>{s.value=!s.value,s.value?se(()=>{var e;(e=T.value)==null||e.focus(),C(u.value||"",1)}):(u.value="",f("update:search-input",""))},H=e=>{f("update:modelValue",e.value),u.value="",f("update:search-input",""),s.value=!1},q=()=>{f("update:modelValue",l.allValue||""),u.value="",f("update:search-input",""),s.value=!1},G=()=>{if(!V.value||y.value||!F.value)return;const e=V.value;e.scrollTop+e.clientHeight>=e.scrollHeight-30&&C(u.value||"",k.value+1)},j=e=>{_.value&&!_.value.contains(e.target)&&(s.value=!1,u.value="",f("update:search-input",""))};return Q(()=>{document.addEventListener("click",j),l.modelValue&&I(l.modelValue),(async()=>{try{await $()}catch{}})()}),W(()=>{document.removeEventListener("click",j),L.cancel&&L.cancel()}),X(()=>l.modelValue,e=>{e&&I(e)}),(e,t)=>(d(),c("div",{ref_key:"selectRef",ref:_,class:S(["relative bg-transparent",s.value?"z-50":"z-10"])},[v("div",{onClick:t[0]||(t[0]=a=>!h.disabled&&N()),class:S(["dark:bg-dark-900 h-11 w-full flex items-center rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 pr-11 text-sm text-gray-800 shadow-theme-xs focus-within:border-brand-300 focus-within:outline-hidden focus-within:ring-3 focus-within:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus-within:border-brand-800",{"border-brand-300":s.value,"cursor-pointer hover:border-brand-300":!h.disabled,"cursor-not-allowed bg-gray-100 dark:bg-gray-800 opacity-75":h.disabled}])},[v("span",{class:S({"text-gray-800 dark:text-white/90":A.value,"text-gray-400":!A.value})},P(A.value||h.placeholder),3),y.value&&!s.value?(d(),c("span",ue," (memuat...) ")):b("",!0)],2),t[3]||(t[3]=v("span",{class:"absolute z-30 text-gray-500 -translate-y-1/2 pointer-events-none right-4 top-1/2 dark:text-gray-400"},[v("svg",{class:"stroke-current",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[v("path",{d:"M4.79175 7.396L10.0001 12.6043L15.2084 7.396",stroke:"","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),Y(ne,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:Z(()=>[s.value?(d(),c("div",ie,[v("div",ce,[ee(v("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=a=>u.value=a),onInput:O,placeholder:"Cari...",class:"w-full h-9 rounded-lg border border-gray-300 bg-transparent px-3 py-1.5 text-sm text-gray-800 dark:border-gray-700 dark:bg-gray-800 dark:text-white/90",onClick:t[2]||(t[2]=te(()=>{},["stop"])),ref_key:"searchInputRef",ref:T},null,544),[[ae,u.value]])]),l.includeAll?(d(),c("div",de,[v("button",{type:"button",onClick:q,class:"w-full text-left text-sm px-4 py-2 text-gray-700 hover:bg-gray-100 dark:text-white/90 dark:hover:bg-gray-800"},P(l.allLabel),1)])):b("",!0),v("div",{ref_key:"listContainer",ref:V,class:"overflow-y-auto max-h-48 custom-scrollbar",onScrollPassive:G},[(d(!0),c(le,null,re(o.value,a=>(d(),c("button",{key:a.value,type:"button",onClick:n=>H(a),class:S(["w-full px-4 py-2 text-left text-sm text-gray-800 hover:bg-gray-100 dark:text-white/90 dark:hover:bg-gray-800 transition-colors",{"bg-gray-100 dark:bg-gray-800":h.modelValue===a.value}])},P(a.label),11,ve))),128)),o.value.length===0&&!y.value?(d(),c("div",fe," Tidak ada data ditemukan ")):b("",!0),y.value?(d(),c("div",ge,"Memuat...")):b("",!0),!F.value&&o.value.length>0?(d(),c("div",pe,"Tidak ada lagi")):b("",!0)],544)])):b("",!0)]),_:1})],2))}}),be=oe(he,[["__scopeId","data-v-71875c94"]]);export{be as A};
