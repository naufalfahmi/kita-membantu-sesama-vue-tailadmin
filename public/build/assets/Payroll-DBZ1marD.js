import{d as V,A as O,Q as E,I as L,M as F,b as s,f as $,B as C,g as j,o as m,w as q,a as n,i as y,t as N,c as T,k as J,v as U,j as A,u as Y,S as z}from"./admin-pVdsOlNe.js";import{_ as H}from"./AdminLayout.vue_vue_type_script_setup_true_lang-CVGmD6MT.js";import{_ as X}from"./ConfirmModal.vue_vue_type_script_setup_true_lang-DFkxfZpn.js";import{S as I}from"./SearchableSelect-BNYAgy-g.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const K={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},Q={class:"mb-6 flex items-center justify-between"},W={class:"flex items-center gap-3"},Z={key:1,class:"inline-flex items-center rounded-full bg-yellow-100 px-3 py-1 text-sm font-medium text-yellow-800"},ee={class:"mb-6 rounded-lg border border-gray-200 bg-white p-4 dark:border-gray-800 dark:bg-white/[0.03]"},te={class:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4"},ae={class:"flex-1"},ne={class:"flex-1"},re={class:"ag-theme-alpine dark:ag-theme-alpine-dark",style:{width:"100%","min-height":"400px"}},se="Rekap Gaji (Payroll)",me=V({__name:"Payroll",setup(oe){const{hasPermission:d,isAdmin:w}=E(),c=O(()=>w()||d("generate payroll")||d("create payroll")),b=L(),x=F(),v=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"],l=s(new Date().getFullYear()),i=s("");let o=null;const P=[{label:"Semua Bulan",value:""},...v.map((t,e)=>({label:t,value:String(e+1)}))],g=s(!1),p=s(new Date().getMonth()+1),h=s(new Date().getFullYear()),k=s([]),u=s(0),G=[{headerName:"Periode",field:"periode",flex:1},{headerName:"Pending",field:"pending_count",width:120,cellStyle:{textAlign:"center"},cellRenderer:t=>{const e=document.createElement("span");return e.className="text-sm font-medium text-gray-700",e.textContent=String(t.value||0),e}},{headerName:"Locked",field:"locked_count",width:120,cellStyle:{textAlign:"center"},cellRenderer:t=>{const e=document.createElement("span");return e.className="text-sm font-medium text-gray-700",e.textContent=String(t.value||0),e}},{headerName:"Transferred",field:"transferred_count",width:140,cellStyle:{textAlign:"center"},cellRenderer:t=>{const e=document.createElement("span");return e.className="text-sm font-medium text-gray-700",e.textContent=String(t.value||0),e}},{headerName:"Generated At",field:"generated_at",width:200},{headerName:"Actions",field:"actions",width:160,cellStyle:{display:"flex",justifyContent:"center",alignItems:"center"},cellRenderer:t=>{const e=document.createElement("div");e.className="flex items-center justify-center gap-3";const a=document.createElement("button");return a.className="flex items-center justify-center w-8 h-8 rounded-lg text-brand-500 hover:bg-brand-50",a.setAttribute("title","Lihat"),a.setAttribute("aria-label","Lihat"),a.innerHTML=`
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path d="M1.5 12s4-7.5 10.5-7.5S22.5 12 22.5 12s-4 7.5-10.5 7.5S1.5 12 1.5 12z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    `,a.onclick=()=>b.push(`/operasional/payroll/${t.data.id}`),e.appendChild(a),e}}],M={resizable:!0,sortable:!0},f=async()=>{const t=new URLSearchParams;l.value&&t.append("year",String(l.value)),i.value&&t.append("month",String(i.value));const a=await(await fetch(`/admin/api/operasional/payroll/periods?${t.toString()}`,{credentials:"same-origin"})).json();k.value=(a.data||[]).map(r=>({id:r.id,periode:`${v[(r.month||1)-1]} ${r.year}`,status:r.status,pending_count:r.pending_count||0,locked_count:r.locked_count||0,transferred_count:r.transferred_count||0,generated_at:r.generated_at}))},_=async()=>{try{const t=new URLSearchParams;t.append("year",String(h.value)),t.append("month",String(p.value));const a=await(await fetch(`/admin/api/operasional/payroll/periods/missing-count?${t.toString()}`,{credentials:"same-origin"})).json();a.success&&(u.value=a.missing||0)}catch{u.value=0}};$(async()=>{if((d("view payroll")||d("view remunerasi"))&&!w()&&!c.value){b.push("/operasional/payroll/mine");return}await f(),await _()}),C([l,i],()=>{o&&clearTimeout(o),o=setTimeout(()=>{f()},450)}),C([h,p],()=>{o&&clearTimeout(o),o=setTimeout(()=>{_()},300)});const R=()=>{g.value=!0},S=()=>{g.value=!1},B=async()=>{var r;const t=(r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content");return t||(await(await fetch("/admin/api/csrf-token",{credentials:"same-origin"})).json()).csrf_token||""},D=async()=>{try{const t=await B();if(!(await(await fetch("/admin/api/operasional/payroll/periods/generate",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({year:h.value,month:p.value}),credentials:"same-origin"})).json()).success)throw new Error("Failed");x.success("Periode payroll berhasil digenerate"),S(),f()}catch{x.error("Gagal generate periode")}};return(t,e)=>(m(),j(H,null,{default:q(()=>[n("div",K,[n("div",Q,[n("h3",{class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},N(se)),n("div",W,[c.value?(m(),T("button",{key:0,onClick:R,class:"flex items-center gap-2 rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600"},"Generate Periode")):y("",!0),c.value&&u.value>0?(m(),T("span",Z,"+"+N(u.value)+" belum",1)):y("",!0)])]),n("div",ee,[n("div",te,[n("div",ae,[e[2]||(e[2]=n("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"Filter Tahun",-1)),J(n("input",{type:"number","onUpdate:modelValue":e[0]||(e[0]=a=>l.value=a),placeholder:"Tahun...",class:"h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800"},null,512),[[U,l.value]])]),n("div",ne,[e[3]||(e[3]=n("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"Filter Bulan",-1)),A(I,{modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=a=>i.value=a),options:P,placeholder:"Semua Bulan"},null,8,["modelValue"])])])]),n("div",re,[A(Y(z),{class:"ag-theme-alpine",style:{width:"100%"},columnDefs:G,rowData:k.value,defaultColDef:M,pagination:!0,paginationPageSize:20,animateRows:!0,domLayout:"autoHeight"},null,8,["rowData"])]),c.value?(m(),j(X,{key:0,isOpen:g.value,title:"Generate Periode",message:"Generate payroll untuk bulan & tahun yang dipilih. Semua karyawan aktif akan dibuatkan record.",confirmText:"Generate",confirmButtonClass:"bg-brand-500 hover:bg-brand-600",onConfirm:D,onCancel:S},null,8,["isOpen"])):y("",!0)])]),_:1}))}});export{me as default};
