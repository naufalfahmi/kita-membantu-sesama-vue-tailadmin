import{d as G,b as P,H,I as L,M as z,A as _,e as F,B as K,f as W,g as Q,o as p,w as Y,a,t as f,q as T,k as h,m as Z,v as b,c as u,i as ee,j as V,F as M,l as A,n as ae}from"./admin-vgMIEOZL.js";import{_ as te}from"./AdminLayout.vue_vue_type_script_setup_true_lang-D8z2X4zx.js";import{S as C}from"./SearchableSelect-CBVEn16G.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const re={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},se={class:"mb-6 flex items-center justify-between"},oe={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},ne={class:"grid grid-cols-1 gap-x-6 gap-y-5 lg:grid-cols-2"},le={class:"lg:col-span-1"},de={class:"lg:col-span-1"},ie={class:"flex items-center gap-2"},pe={class:"flex-1"},ue={class:"lg:col-span-1"},me={class:"lg:col-span-2"},ce={class:"overflow-x-auto mt-2"},ge={class:"w-full table-auto border border-gray-200 dark:border-gray-800 rounded-md"},ye={class:"px-4 py-3 text-sm text-gray-700 dark:text-gray-400"},he={class:"px-4 py-3"},be=["onUpdate:modelValue","placeholder"],xe={class:"px-4 py-3"},ke={class:"px-4 py-3"},_e={class:"flex items-center gap-2"},fe=["onUpdate:modelValue"],ve={key:0,class:"text-sm text-gray-600 dark:text-gray-400"},we={key:1,class:"text-sm text-gray-600 dark:text-gray-400"},je={class:"px-4 py-3 text-sm text-gray-700 dark:text-gray-400"},Pe=["onUpdate:modelValue"],Te={class:"px-4 py-3"},Ve={class:"px-4 py-3"},Ce={class:"flex items-center gap-2"},Re=["onUpdate:modelValue"],Se={key:0,class:"text-sm text-gray-600 dark:text-gray-400"},Ue={key:1,class:"text-sm text-gray-600 dark:text-gray-400"},Ne=["onClick"],Fe={class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},Me={class:"flex items-center gap-3 mt-6 lg:justify-end"},Ae={type:"submit",class:"flex w-full justify-center rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600 sm:w-auto"},Be={class:"fixed right-6 bottom-6 z-50"},Oe=["title"],Ee={class:"text-lg font-semibold"},Xe=G({__name:"ProgramForm",setup($e){P("");const x=H(),v=L(),m=z(),g=_(()=>x.params.id!==void 0&&x.params.id!=="new"),B=_(()=>g.value?"Edit Program":"Tambah Program"),r=F({nama_program:"",tipe_id:"",tipe_pembagian_marketing:"",jumlah_persentase:null,orders:null,shares:{},customRows:[]}),k=P([]),R=P([]),O=async()=>{try{const s=await fetch("/admin/api/tipe-program?per_page=500",{credentials:"same-origin"});if(!s.ok)return;const t=await s.json();t.success&&Array.isArray(t.data)&&(R.value=t.data.map(e=>({value:e.id,label:e.name})))}catch(s){console.error("Failed to load tipe program options:",s)}},c=F({}),S=[{value:"percentage",label:"Persentase"},{value:"nominal",label:"Nominal"}],y=_(()=>{let s=0;for(const t of Object.keys(r.shares)){const e=r.shares[t];e&&e.type==="percentage"&&e.value!==null&&!Number.isNaN(e.value)&&(s+=Number(e.value))}return s>0?parseFloat(s.toFixed(2)):0});K(()=>y.value,s=>{r.jumlah_persentase=s},{immediate:!0});const E=_(()=>{const s=Number(y.value||0);return Number.isInteger(s)?`${s}%`:s.toFixed(2)+"%"}),$=_(()=>Number(y.value||0)>100?"bg-red-500 hover:bg-red-600":"bg-brand-500 hover:bg-brand-600"),q=async()=>{try{const s=await fetch("/admin/api/program-share-types",{credentials:"same-origin"});if(!s.ok)return;const t=await s.json();if(t.success&&Array.isArray(t.data)){k.value=t.data.slice().sort((e,l)=>{const d=e.orders??0,i=l.orders??0;return d-i});for(const e of k.value)r.shares[e.key]||(r.shares[e.key]={type:e.default_type||"percentage",value:null,alias:e.alias||null}),c[e.key]===void 0&&(c[e.key]="");Array.isArray(r.customRows)||(r.customRows=[])}}catch(s){console.error("Failed to load program share types:",s)}},U=async()=>{var s;try{const t=(s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content");if(t)return t;const e=await fetch("/admin/api/csrf-token",{method:"GET",credentials:"same-origin"});if(!e.ok)throw new Error(`Failed to get CSRF token: ${e.status}`);return(await e.json()).csrf_token||""}catch(t){return console.error("Failed to get CSRF token:",t),""}},D=()=>{const s=`custom_${Date.now()}`;r.customRows.push({key:s,name:"",type:"percentage",value:null}),c[s]=""},I=s=>{r.customRows.splice(s,1)},J=async()=>{var s,t;if(g.value&&x.params.id){const e=x.params.id;try{const l=await U(),i=await(await fetch(`/admin/api/program/${e}`,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Accept:"application/json","X-CSRF-TOKEN":l},credentials:"same-origin"})).json();if(i.success&&i.data){const o=i.data;if(r.nama_program=o.nama_program||"",r.tipe_pembagian_marketing=o.tipe_pembagian_marketing||"",r.jumlah_persentase=o.jumlah_persentase?parseFloat(o.jumlah_persentase):null,r.orders=o.orders!==void 0&&o.orders!==null?Number(o.orders):null,r.tipe_id=((s=o.tipe)==null?void 0:s.id)??"",Array.isArray(o.shares)){r.customRows=[];for(const n of o.shares){const j=n.program_share_type_key||(n.program_share_type_id?(t=k.value.find(w=>w.id===n.program_share_type_id))==null?void 0:t.key:null);if(j&&r.shares[j]!==void 0)r.shares[j]={type:n.type||"percentage",value:n.value!==null?parseFloat(n.value):null,alias:n.alias||null};else{const w=n.program_share_type_key||`custom_${Date.now()}_${Math.floor(Math.random()*1e3)}`;r.customRows.push({key:w,name:n.name||"",type:n.type||"percentage",value:n.value!==null?parseFloat(n.value):null}),c[w]=""}}}}else m.error("Gagal memuat data program"),v.push("/administrasi/program")}catch(l){console.error("Error loading data:",l),m.error("Terjadi kesalahan saat memuat data"),v.push("/administrasi/program")}}},N=()=>{v.push("/administrasi/program")},X=async()=>{if(!r.nama_program){m.error("Nama Program wajib diisi");return}try{const s=await U();if(!s){m.error("Gagal mendapatkan CSRF token. Silakan refresh halaman.");return}const t={nama_program:r.nama_program,tipe_id:r.tipe_id||null,tipe_pembagian_marketing:r.tipe_pembagian_marketing||null,jumlah_persentase:y.value||null,orders:r.orders!==null?r.orders:null,shares:[]};for(const o of k.value){const n=r.shares[o.key];t.shares.push({program_share_type_key:o.key,program_share_type_id:o.id,name:o.name,type:(n==null?void 0:n.type)||o.default_type||"percentage",value:(n==null?void 0:n.value)!==void 0?(n==null?void 0:n.value)??null:null,alias:(n==null?void 0:n.alias)||null,orders:o.orders??null})}for(const o of r.customRows)t.shares.push({program_share_type_key:o.key,program_share_type_id:null,name:o.name||null,type:o.type||"percentage",value:o.value!==void 0?o.value??null:null,is_custom:!0});const e=g.value?`/admin/api/program/${x.params.id}`:"/admin/api/program",l=g.value?"PUT":"POST",i=await(await fetch(e,{method:l,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Accept:"application/json","X-CSRF-TOKEN":s},credentials:"same-origin",body:JSON.stringify(t)})).json();if(i.success)m.success(g.value?"Program berhasil diupdate":"Program berhasil ditambahkan"),v.push("/administrasi/program");else if(i.errors){const o=Object.values(i.errors).flat().join(", ");m.error(`Validasi gagal: ${o}`)}else m.error(i.message||"Gagal menyimpan data")}catch(s){console.error("Error saving:",s),m.error("Terjadi kesalahan saat menyimpan data")}};return W(async()=>{await q(),await O(),await J()}),(s,t)=>(p(),Q(te,null,{default:Y(()=>[a("div",re,[a("div",se,[a("h3",oe,f(B.value),1),a("button",{onClick:N,class:"flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03]"}," Batal ")]),a("form",{onSubmit:T(X,["prevent"]),class:"flex flex-col"},[a("div",ne,[a("div",le,[t[4]||(t[4]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[Z(" Nama Program "),a("span",{class:"text-red-500"},"*")],-1)),h(a("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>r.nama_program=e),placeholder:"Masukkan nama program",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[b,r.nama_program]])]),a("div",de,[t[6]||(t[6]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"Tipe Program",-1)),a("div",ie,[a("div",pe,[V(C,{modelValue:r.tipe_id,"onUpdate:modelValue":t[1]||(t[1]=e=>r.tipe_id=e),options:R.value,placeholder:"Pilih tipe program (opsional)"},null,8,["modelValue","options"])]),r.tipe_id?(p(),u("button",{key:0,type:"button",onClick:t[2]||(t[2]=T(e=>r.tipe_id="",["prevent"])),title:"Hapus pilihan tipe program",class:"h-11 w-11 flex items-center justify-center rounded-lg border border-gray-300 bg-white text-sm text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700"},[...t[5]||(t[5]=[a("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[a("path",{d:"M18 6L6 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),a("path",{d:"M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])):ee("",!0)])]),a("div",ue,[t[7]||(t[7]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"Urutan (orders)",-1)),h(a("input",{type:"number","onUpdate:modelValue":t[3]||(t[3]=e=>r.orders=e),placeholder:"Urutan",class:"h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 focus:border-brand-300"},null,512),[[b,r.orders,void 0,{number:!0}]])]),a("div",me,[t[9]||(t[9]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Pembagian (DP, OPS 1, OPS 2, Program, Fee Mitra, Bonus, Championship) ",-1)),a("div",ce,[a("table",ge,[t[8]||(t[8]=a("thead",{class:"bg-gray-50 dark:bg-gray-900"},[a("tr",null,[a("th",{class:"text-left px-4 py-2 text-sm text-gray-600 dark:text-gray-300"},"Nama"),a("th",{class:"text-left px-4 py-2 text-sm text-gray-600 dark:text-gray-300"},"Alias (Tipe Pengajuan)"),a("th",{class:"text-left px-4 py-2 text-sm text-gray-600 dark:text-gray-300"},"Tipe"),a("th",{class:"text-left px-4 py-2 text-sm text-gray-600 dark:text-gray-300"},"Nilai")])],-1)),a("tbody",null,[(p(!0),u(M,null,A(k.value,e=>(p(),u("tr",{key:e.key,class:"border-t border-gray-100 dark:border-gray-800"},[a("td",ye,f(e.name),1),a("td",he,[h(a("input",{type:"text","onUpdate:modelValue":l=>r.shares[e.key].alias=l,placeholder:e.alias||"Masukkan alias",class:"h-10 w-full rounded-lg border border-gray-300 px-3 text-sm dark:bg-gray-900 dark:border-gray-700 dark:text-gray-300"},null,8,be),[[b,r.shares[e.key].alias]])]),a("td",xe,[V(C,{modelValue:r.shares[e.key].type,"onUpdate:modelValue":l=>r.shares[e.key].type=l,options:S,placeholder:"Pilih Tipe","search-input":c[e.key],"onUpdate:searchInput":l=>c[e.key]=l},null,8,["modelValue","onUpdate:modelValue","search-input","onUpdate:searchInput"])]),a("td",ke,[a("div",_e,[h(a("input",{type:"number","onUpdate:modelValue":l=>r.shares[e.key].value=l,placeholder:"0",min:"0",step:"0.01",class:"h-10 w-full rounded-lg border border-gray-300 px-3 text-sm dark:bg-gray-900"},null,8,fe),[[b,r.shares[e.key].value,void 0,{number:!0}]]),r.shares[e.key].type==="percentage"?(p(),u("span",ve,"%")):(p(),u("span",we,"Rp"))])])]))),128)),(p(!0),u(M,null,A(r.customRows,(e,l)=>(p(),u("tr",{key:e.key,class:"border-t border-gray-100 dark:border-gray-800"},[a("td",je,[h(a("input",{"onUpdate:modelValue":d=>e.name=d,placeholder:"Nama",class:"h-10 w-full rounded-lg border border-gray-300 px-3 text-sm"},null,8,Pe),[[b,e.name]])]),a("td",Te,[V(C,{modelValue:e.type,"onUpdate:modelValue":d=>e.type=d,options:S,placeholder:"Pilih Tipe","search-input":c[e.key],"onUpdate:searchInput":d=>c[e.key]=d},null,8,["modelValue","onUpdate:modelValue","search-input","onUpdate:searchInput"])]),a("td",Ve,[a("div",Ce,[h(a("input",{type:"number","onUpdate:modelValue":d=>e.value=d,placeholder:"0",min:"0",step:"0.01",class:"h-10 w-full rounded-lg border border-gray-300 px-3 text-sm dark:bg-gray-900"},null,8,Re),[[b,e.value,void 0,{number:!0}]]),e.type==="percentage"?(p(),u("span",Se,"%")):(p(),u("span",Ue,"Rp")),a("button",{type:"button",onClick:T(()=>I(l),["prevent"]),class:"text-red-500 ml-2"},"Hapus",8,Ne)])])]))),128))])])]),a("p",Fe,'Jumlah Persentase (hanya menghitung yang tipe "Persentase"): '+f(y.value),1)])]),a("div",Me,[a("div",{class:"flex-1 lg:flex lg:items-center lg:justify-start"},[a("button",{type:"button",onClick:D,class:"flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03]"}," Tambah Baris ")]),a("button",{onClick:N,type:"button",class:"flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] sm:w-auto"}," Batal "),a("button",Ae,f(g.value?"Simpan Perubahan":"Simpan"),1)])],32)]),a("div",Be,[a("button",{title:y.value>100?"Jumlah persentase melebihi 100%":"Jumlah persentase",class:ae(["flex items-center gap-3 px-4 py-3 rounded-lg text-white shadow-lg",$.value])},[t[10]||(t[10]=a("span",{class:"text-sm"},"Jumlah Persentase",-1)),a("span",Ee,f(E.value),1)],10,Oe)])]),_:1}))}});export{Xe as default};
