import{d as U,H as R,I as B,V as F,A as T,r as d,a as P,o as K,c as O,b as V,w as L,e as p,f as t,t as S,p as $,l as g,i as _,v as D,u as G,j as J,g as z}from"./admin-CQgzRBJW.js";import{C as H}from"./component-BjUQ6N89.js";import{_ as X}from"./AdminLayout.vue_vue_type_script_setup_true_lang-CX1nMTLy.js";import{_ as Y}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-BDFWjfrB.js";import{S as b}from"./SearchableSelect-BRvrjiio.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Z={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},q={class:"mb-6 flex items-center justify-between"},Q={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},W={class:"grid grid-cols-1 gap-x-6 gap-y-5 lg:grid-cols-2"},aa={class:"relative"},ta={class:"lg:col-span-2"},ea={class:"flex items-center gap-3 mt-6 lg:justify-end"},ra=["disabled"],na=["disabled"],oa={key:0,class:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},ca=U({__name:"TransaksiForm",setup(sa){const m=R(),k=B(),s=F(),c=T(()=>m.params.id!==void 0&&m.params.id!=="new"),f=T(()=>c.value?"Edit Transaksi":"Tambah Transaksi"),y=d(!1),u=d(!1),A={dateFormat:"Y-m-d",altInput:!0,altFormat:"d/m/Y",allowInput:!1},x=d([]),h=d([]),w=d([]),v=d(""),j=d(""),C=d(""),e=P({branchId:"",nominal:null,donorId:"",programId:"",transactionDate:"",notes:""}),N=async()=>{try{const[o,a,n]=await Promise.all([fetch("/admin/api/kantor-cabang?per_page=100",{credentials:"same-origin"}),fetch("/admin/api/donatur?per_page=100",{credentials:"same-origin"}),fetch("/admin/api/program?per_page=100",{credentials:"same-origin"})]);if(o.ok){const r=await o.json(),l=r.success&&r.data?Array.isArray(r.data)?r.data:r.data.data||[]:[];x.value=l.map(i=>({value:i.id,label:i.nama}))}if(a.ok){const r=await a.json(),l=r.success&&r.data?Array.isArray(r.data)?r.data:r.data.data||[]:[];h.value=l.map(i=>({value:i.id,label:i.nama}))}if(n.ok){const r=await n.json(),l=r.success&&r.data?Array.isArray(r.data)?r.data:r.data.data||[]:[];w.value=l.map(i=>({value:i.id,label:i.nama_program}))}}catch(o){console.error("Error fetching options:",o),s.error("Gagal memuat data opsi")}},E=async()=>{if(c.value&&m.params.id){y.value=!0;try{const o=m.params.id,a=await fetch(`/admin/api/transaksi/${o}`,{credentials:"same-origin"});if(!a.ok)throw new Error("Failed to fetch transaksi");const n=await a.json();if(n.success&&n.data){const r=n.data;e.branchId=r.kantor_cabang_id||"",e.nominal=r.nominal,e.donorId=r.donatur_id||"",e.programId=r.program_id||"",e.transactionDate=r.tanggal_transaksi||"",e.notes=r.keterangan||""}}catch(o){console.error("Error loading transaksi:",o),s.error("Gagal memuat data transaksi")}finally{y.value=!1}}},I=()=>{k.push("/keuangan/transaksi")},M=async()=>{if(!e.branchId){s.warning("Kantor Cabang wajib diisi");return}if(!e.nominal||e.nominal<=0){s.warning("Nominal wajib diisi");return}if(!e.donorId){s.warning("Donatur wajib diisi");return}if(!e.programId){s.warning("Program wajib diisi");return}if(!e.transactionDate){s.warning("Tanggal transaksi wajib diisi");return}u.value=!0;try{const o=await fetch("/admin/api/csrf-token",{credentials:"same-origin"});if(!o.ok)throw new Error("Failed to fetch CSRF token");const a=await o.json(),n={kantor_cabang_id:e.branchId,nominal:e.nominal,donatur_id:e.donorId,program_id:e.programId,tanggal_transaksi:e.transactionDate,keterangan:e.notes||null};let r;c.value?r=await fetch(`/admin/api/transaksi/${m.params.id}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":a.csrf_token},credentials:"same-origin",body:JSON.stringify(n)}):r=await fetch("/admin/api/transaksi",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":a.csrf_token},credentials:"same-origin",body:JSON.stringify(n)});const l=await r.json();if(l.success)s.success(l.message||(c.value?"Transaksi berhasil diupdate":"Transaksi berhasil ditambahkan")),k.push("/keuangan/transaksi");else if(l.errors){const i=Object.values(l.errors).flat().join(", ");s.error(i)}else s.error(l.message||"Gagal menyimpan transaksi")}catch(o){console.error("Error saving:",o),s.error("Terjadi kesalahan saat menyimpan data")}finally{u.value=!1}};return K(async()=>{await N(),await E()}),(o,a)=>(V(),O(X,null,{default:L(()=>[p(Y,{pageTitle:f.value},null,8,["pageTitle"]),t("div",Z,[t("div",q,[t("h3",Q,S(f.value),1),t("button",{onClick:I,class:"flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03]"}," Batal ")]),t("form",{onSubmit:$(M,["prevent"]),class:"flex flex-col"},[t("div",W,[t("div",null,[a[9]||(a[9]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[g(" Kantor Cabang "),t("span",{class:"text-red-500"},"*")],-1)),p(b,{modelValue:e.branchId,"onUpdate:modelValue":a[0]||(a[0]=n=>e.branchId=n),options:x.value,placeholder:"Kantor Cabang","search-input":v.value,"onUpdate:searchInput":a[1]||(a[1]=n=>v.value=n)},null,8,["modelValue","options","search-input"])]),t("div",null,[a[10]||(a[10]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[g(" Nominal "),t("span",{class:"text-red-500"},"*")],-1)),_(t("input",{type:"number","onUpdate:modelValue":a[2]||(a[2]=n=>e.nominal=n),placeholder:"Nominal",min:"0",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[D,e.nominal,void 0,{number:!0}]])]),t("div",null,[a[11]||(a[11]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[g(" Donatur "),t("span",{class:"text-red-500"},"*")],-1)),p(b,{modelValue:e.donorId,"onUpdate:modelValue":a[3]||(a[3]=n=>e.donorId=n),options:h.value,placeholder:"Donatur","search-input":j.value,"onUpdate:searchInput":a[4]||(a[4]=n=>j.value=n)},null,8,["modelValue","options","search-input"])]),t("div",null,[a[12]||(a[12]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[g(" Program "),t("span",{class:"text-red-500"},"*")],-1)),p(b,{modelValue:e.programId,"onUpdate:modelValue":a[5]||(a[5]=n=>e.programId=n),options:w.value,placeholder:"Program","search-input":C.value,"onUpdate:searchInput":a[6]||(a[6]=n=>C.value=n)},null,8,["modelValue","options","search-input"])]),t("div",null,[a[14]||(a[14]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[g(" Tanggal Transaksi "),t("span",{class:"text-red-500"},"*")],-1)),t("div",aa,[p(G(H),{modelValue:e.transactionDate,"onUpdate:modelValue":a[7]||(a[7]=n=>e.transactionDate=n),config:A,class:"dark:bg-dark-900 h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 pr-11 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",placeholder:"Tanggal Transaksi"},null,8,["modelValue"]),a[13]||(a[13]=t("span",{class:"absolute text-gray-500 -translate-y-1/2 pointer-events-none right-3 top-1/2 dark:text-gray-400"},[t("svg",{class:"fill-current",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M10 18.3333C14.6024 18.3333 18.3333 14.6024 18.3333 9.99999C18.3333 5.39762 14.6024 1.66666 10 1.66666C5.39763 1.66666 1.66667 5.39762 1.66667 9.99999C1.66667 14.6024 5.39763 18.3333 10 18.3333Z",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),t("path",{d:"M10 5V10L13.3333 11.6667",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})])],-1))])]),t("div",ta,[a[15]||(a[15]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Keterangan ",-1)),_(t("textarea",{"onUpdate:modelValue":a[8]||(a[8]=n=>e.notes=n),placeholder:"Keterangan",maxlength:"1000",rows:"4",class:"dark:bg-dark-900 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[D,e.notes]]),a[16]||(a[16]=t("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," Maksimal 1000 karakter. ",-1))])]),t("div",ea,[t("button",{onClick:I,type:"button",disabled:u.value,class:"flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed"}," Batal ",8,ra),t("button",{type:"submit",disabled:u.value,class:"flex w-full justify-center items-center gap-2 rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed"},[u.value?(V(),J("svg",oa,[...a[17]||(a[17]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):z("",!0),g(" "+S(u.value?"Menyimpan...":c.value?"Simpan Perubahan":"Simpan"),1)],8,na)])],32)])]),_:1}))}});export{ca as default};
