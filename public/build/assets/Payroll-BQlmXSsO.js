import{d as G,A as R,P as B,I as D,L as M,b as o,f as V,B as O,g as w,o as g,w as E,a as n,i as v,t as L,c as F,k as $,v as q,j as k,u as J,Q as Y}from"./admin-DjHSnzD-.js";import{_ as z}from"./AdminLayout.vue_vue_type_script_setup_true_lang-C5pXoctL.js";import{_ as H}from"./ConfirmModal.vue_vue_type_script_setup_true_lang-Cj1EG-f-.js";import{S as U}from"./SearchableSelect-C7lWwq6w.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const X={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},I={class:"mb-6 flex items-center justify-between"},K={class:"flex items-center gap-3"},Q={class:"mb-6 rounded-lg border border-gray-200 bg-white p-4 dark:border-gray-800 dark:bg-white/[0.03]"},W={class:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4"},Z={class:"flex-1"},ee={class:"flex-1"},te={class:"ag-theme-alpine dark:ag-theme-alpine-dark",style:{width:"100%","min-height":"400px"}},ae="Rekap Gaji (Payroll)",de=G({__name:"Payroll",setup(ne){const{hasPermission:i,isAdmin:p}=B(),d=R(()=>p()||i("generate payroll")||i("create payroll")),h=D(),f=M(),y=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"],s=o(new Date().getFullYear()),l=o("");let c=null;const _=[{label:"Semua Bulan",value:""},...y.map((t,e)=>({label:t,value:String(e+1)}))],u=o(!1),S=o(new Date().getMonth()+1),C=o(new Date().getFullYear()),b=o([]),j=[{headerName:"Periode",field:"periode",flex:1},{headerName:"Pending",field:"pending_count",width:120,cellStyle:{textAlign:"center"},cellRenderer:t=>{const e=document.createElement("span");return e.className="text-sm font-medium text-gray-700",e.textContent=String(t.value||0),e}},{headerName:"Locked",field:"locked_count",width:120,cellStyle:{textAlign:"center"},cellRenderer:t=>{const e=document.createElement("span");return e.className="text-sm font-medium text-gray-700",e.textContent=String(t.value||0),e}},{headerName:"Transferred",field:"transferred_count",width:140,cellStyle:{textAlign:"center"},cellRenderer:t=>{const e=document.createElement("span");return e.className="text-sm font-medium text-gray-700",e.textContent=String(t.value||0),e}},{headerName:"Generated At",field:"generated_at",width:200},{headerName:"Actions",field:"actions",width:160,cellStyle:{display:"flex",justifyContent:"center",alignItems:"center"},cellRenderer:t=>{const e=document.createElement("div");e.className="flex items-center justify-center gap-3";const a=document.createElement("button");return a.className="flex items-center justify-center w-8 h-8 rounded-lg text-brand-500 hover:bg-brand-50",a.setAttribute("title","Lihat"),a.setAttribute("aria-label","Lihat"),a.innerHTML=`
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path d="M1.5 12s4-7.5 10.5-7.5S22.5 12 22.5 12s-4 7.5-10.5 7.5S1.5 12 1.5 12z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    `,a.onclick=()=>h.push(`/operasional/payroll/${t.data.id}`),e.appendChild(a),e}}],N={resizable:!0,sortable:!0},m=async()=>{const t=new URLSearchParams;s.value&&t.append("year",String(s.value)),l.value&&t.append("month",String(l.value));const a=await(await fetch(`/admin/api/operasional/payroll/periods?${t.toString()}`,{credentials:"same-origin"})).json();b.value=(a.data||[]).map(r=>({id:r.id,periode:`${y[(r.month||1)-1]} ${r.year}`,status:r.status,pending_count:r.pending_count||0,locked_count:r.locked_count||0,transferred_count:r.transferred_count||0,generated_at:r.generated_at}))};V(async()=>{if((i("view payroll")||i("view remunerasi"))&&!p()&&!d.value){h.push("/operasional/payroll/mine");return}await m()}),O([s,l],()=>{c&&clearTimeout(c),c=setTimeout(()=>{m()},450)});const T=()=>{u.value=!0},x=()=>{u.value=!1},A=async()=>{var r;const t=(r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content");return t||(await(await fetch("/admin/api/csrf-token",{credentials:"same-origin"})).json()).csrf_token||""},P=async()=>{try{const t=await A();if(!(await(await fetch("/admin/api/operasional/payroll/periods/generate",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({year:C.value,month:S.value}),credentials:"same-origin"})).json()).success)throw new Error("Failed");f.success("Periode payroll berhasil digenerate"),x(),m()}catch{f.error("Gagal generate periode")}};return(t,e)=>(g(),w(z,null,{default:E(()=>[n("div",X,[n("div",I,[n("h3",{class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},L(ae)),n("div",K,[d.value?(g(),F("button",{key:0,onClick:T,class:"flex items-center gap-2 rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600"},"Generate Periode")):v("",!0)])]),n("div",Q,[n("div",W,[n("div",Z,[e[2]||(e[2]=n("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"Filter Tahun",-1)),$(n("input",{type:"number","onUpdate:modelValue":e[0]||(e[0]=a=>s.value=a),placeholder:"Tahun...",class:"h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800"},null,512),[[q,s.value]])]),n("div",ee,[e[3]||(e[3]=n("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"Filter Bulan",-1)),k(U,{modelValue:l.value,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value=a),options:_,placeholder:"Semua Bulan"},null,8,["modelValue"])])])]),n("div",te,[k(J(Y),{class:"ag-theme-alpine",style:{width:"100%"},columnDefs:j,rowData:b.value,defaultColDef:N,pagination:!0,paginationPageSize:20,animateRows:!0,domLayout:"autoHeight"},null,8,["rowData"])]),d.value?(g(),w(H,{key:0,isOpen:u.value,title:"Generate Periode",message:"Generate payroll untuk bulan & tahun yang dipilih. Semua karyawan aktif akan dibuatkan record.",confirmText:"Generate",confirmButtonClass:"bg-brand-500 hover:bg-brand-600",onConfirm:P,onCancel:x},null,8,["isOpen"])):v("",!0)])]),_:1}))}});export{de as default};
