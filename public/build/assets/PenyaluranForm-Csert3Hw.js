import{d as T,H as D,I as N,A as I,b,e as z,L as G,f as $,g as S,o as m,w as X,a as r,t as j,q as H,m as x,k as l,v as i,c as f,u as h,F as P,i as O,l as W}from"./admin-DjHSnzD-.js";import{_ as J}from"./AdminLayout.vue_vue_type_script_setup_true_lang-C5pXoctL.js";import{S as Q}from"./SearchableSelect-C7lWwq6w.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Y={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},Z={class:"mb-6 flex items-center justify-between"},aa={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},ea={class:"grid grid-cols-1 gap-x-6 gap-y-5 lg:grid-cols-2"},ra={class:"lg:col-span-1"},ta={class:"relative"},na={class:"lg:col-span-1"},oa={class:"lg:col-span-1"},sa={class:"lg:col-span-1"},da={class:"lg:col-span-1"},la={class:"lg:col-span-1"},ia={class:"lg:col-span-1"},ua={class:"lg:col-span-1"},ga={class:"lg:col-span-2"},pa={class:"lg:col-span-2"},ca={class:"lg:col-span-1"},ba=["value"],ma={class:"lg:col-span-2"},ya={class:"space-y-4"},ka={class:"relative"},xa={key:0,class:"space-y-2"},ha={class:"flex items-center gap-3"},fa={class:"text-sm font-medium text-gray-800 dark:text-white/90"},wa={class:"text-xs text-gray-500 dark:text-gray-400"},va=["onClick"],Sa=T({__name:"PenyaluranForm",setup(ja){const p=D(),w=N(),y=I(()=>p.params.id!==void 0&&p.params.id!=="new"),V=I(()=>y.value?"Edit Penyaluran":"Buat Penyaluran"),M=b([]),F=async()=>{try{const o=await fetch("/admin/api/kantor-cabang?per_page=1000",{credentials:"same-origin"});if(!o.ok)return;const a=await o.json(),s=a.success&&a.data?Array.isArray(a.data)?a.data:a.data.data||[]:[];M.value=s.map(n=>({value:n.id,label:n.nama}))}catch(o){console.error("Failed to fetch kantor cabang options",o)}};b("");const C=b(""),c=b(null),B=async()=>{var o,a,s;try{const n=await fetch("/admin/api/user",{credentials:"same-origin"});if(n.ok){const d=await n.json();d.success&&d.user&&(c.value=d.user,(a=(o=c.value)==null?void 0:o.kantor_cabang)!=null&&a.id&&(e.branchId=String(c.value.kantor_cabang.id)),(s=c.value)!=null&&s.is_admin&&await F())}}catch(n){console.error("Failed to fetch current user",n)}},v=b(null),k=b([]),e=z({amount:"",program:"",pic:"",village:"",district:"",city:"",province:"",postalCode:"",address:"",report:"",branchId:"",pengajuanId:""}),U=o=>{let s=o.target.value.replace(/[^\d.,]/g,"");s=s.replace(/,/g,".");const n=s.split(".");n.length>2&&(s=n[0]+"."+n.slice(1).join("")),e.amount=s},E=o=>{const a=o.target;if(a.files){const s=Array.from(a.files),n=20*1024*1024,d=[],t=[];s.forEach(u=>{u.size>n?t.push(u.name):d.push(u)}),t.length>0&&alert(`File berikut melebihi 20MB: ${t.join(", ")}`),k.value.push(...d),v.value&&(v.value.value="")}},K=o=>{k.value.splice(o,1)},q=o=>{if(o===0)return"0 Bytes";const a=1024,s=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(o)/Math.log(a));return Math.round(o/Math.pow(a,n)*100)/100+" "+s[n]},A=async()=>{var o,a;if(y.value&&p.params.id){const s=p.params.id;try{const n=await fetch(`/admin/api/penyaluran/${s}`,{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest"}});if(!n.ok)throw new Error("Failed to fetch penyaluran");const d=await n.json();if(!d.success||!d.data){console.error("Penyaluran tidak ditemukan");return}const t=d.data;e.amount=t.amount!=null?String(t.amount):e.amount,e.program=t.program_name||t.pengajuan&&(((o=t.pengajuan.program)==null?void 0:o.nama_program)||((a=t.pengajuan.program)==null?void 0:a.nama))||e.program,e.pic=t.pic||(t.pengajuan&&t.pengajuan.fundraiser?t.pengajuan.fundraiser.name:e.pic),e.village=t.village||t.kelurahan||e.village,e.district=t.district||t.kecamatan||e.district,e.city=t.city||t.kota||e.city,e.province=t.province||e.province,e.postalCode=t.postal_code||e.postalCode,e.address=t.address||e.address,e.report=t.report||e.report,e.branchId=t.kantor_cabang_id||t.kantor_cabang&&t.kantor_cabang.id||e.branchId,e.pengajuanId=t.pengajuan_dana_id||e.pengajuanId}catch(n){console.error("Error loading penyaluran",n)}}},_=()=>{w.push("/keuangan/penyaluran")},g=G(),L=async()=>{var o;if(!e.amount){g.error("Nominal wajib diisi");return}if(!e.program){g.error("Program wajib diisi");return}if(!e.pic){g.error("PIC wajib diisi");return}if(!e.branchId){g.error("Kantor Cabang wajib diisi");return}try{const a=new FormData;a.append("amount",String(e.amount||"0")),e.pengajuanId&&a.append("pengajuan_dana_id",String(e.pengajuanId)),a.append("program_name",e.program||""),a.append("pic",e.pic||""),a.append("village",e.village||""),a.append("district",e.district||""),a.append("city",e.city||""),a.append("province",e.province||""),a.append("postal_code",e.postalCode||""),a.append("address",e.address||""),a.append("report",e.report||""),a.append("kantor_cabang_id",e.branchId||""),k.value.forEach(u=>{a.append("images[]",u)});const s=((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||"",n=y.value?`/admin/api/penyaluran/${p.params.id}`:"/admin/api/penyaluran";y.value&&a.append("_method","PUT");const t=await(await fetch(n,{method:"POST",body:a,credentials:"same-origin",headers:{"X-CSRF-TOKEN":s}})).json();if(!t.success)g.error(t.message||"Gagal menyimpan penyaluran");else{g.success(y.value?"Penyaluran berhasil diupdate":"Penyaluran berhasil dibuat");try{await w.push("/keuangan/penyaluran"),window.dispatchEvent(new CustomEvent("penyaluran:changed"));return}catch{w.push("/keuangan/penyaluran");try{window.dispatchEvent(new CustomEvent("penyaluran:changed"))}catch{}}}}catch(a){console.error("Error saving:",a),g.error("Terjadi kesalahan saat menyimpan data")}};return $(async()=>{await B();const o=p.query.pengajuan_id;if(o)try{const s=await(await fetch(`/admin/api/pengajuan-dana/${o}`,{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest"}})).json();if(s.success&&s.data){const n=s.data;e.pengajuanId=String(o),e.program=n.program&&(n.program.nama||n.program.nama_program)||e.program,e.pic=n.fundraiser?n.fundraiser.name:e.pic,e.amount=n.amount||e.amount,e.report=n.purpose||e.report}}catch(a){console.error("Failed to load pengajuan",a)}A()}),(o,a)=>(m(),S(J,null,{default:X(()=>{var s,n,d;return[r("div",Y,[r("div",Z,[r("h3",aa,j(V.value),1),r("button",{onClick:_,class:"flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03]"}," Kembali ")]),r("form",{onSubmit:H(L,["prevent"]),class:"flex flex-col"},[r("div",ea,[r("div",ra,[a[14]||(a[14]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[x(" Nominal "),r("span",{class:"text-red-500"},"*")],-1)),r("div",ta,[a[13]||(a[13]=r("span",{class:"absolute left-4 top-1/2 -translate-y-1/2 text-sm text-gray-500 dark:text-gray-400"}," Rp ",-1)),l(r("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=t=>e.amount=t),onInput:U,placeholder:"Masukkan nominal penyaluran",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 pl-12 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,544),[[i,e.amount]])])]),r("div",na,[a[15]||(a[15]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[x(" Program "),r("span",{class:"text-red-500"},"*")],-1)),l(r("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=t=>e.program=t),placeholder:"Masukkan nama program atau tahapannya",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[i,e.program]])]),r("div",oa,[a[16]||(a[16]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[x(" PIC "),r("span",{class:"text-red-500"},"*")],-1)),l(r("input",{type:"text","onUpdate:modelValue":a[2]||(a[2]=t=>e.pic=t),placeholder:"Masukkan penanggung jawab penyaluran",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[i,e.pic]])]),r("div",sa,[a[17]||(a[17]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kelurahan ",-1)),l(r("input",{type:"text","onUpdate:modelValue":a[3]||(a[3]=t=>e.village=t),placeholder:"Masukkan kelurahan",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[i,e.village]])]),r("div",da,[a[18]||(a[18]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kecamatan ",-1)),l(r("input",{type:"text","onUpdate:modelValue":a[4]||(a[4]=t=>e.district=t),placeholder:"Masukkan kecamatan",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[i,e.district]])]),r("div",la,[a[19]||(a[19]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kota ",-1)),l(r("input",{type:"text","onUpdate:modelValue":a[5]||(a[5]=t=>e.city=t),placeholder:"Masukkan kota",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[i,e.city]])]),r("div",ia,[a[20]||(a[20]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Provinsi ",-1)),l(r("input",{type:"text","onUpdate:modelValue":a[6]||(a[6]=t=>e.province=t),placeholder:"Masukkan provinsi",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[i,e.province]])]),r("div",ua,[a[21]||(a[21]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Kode Pos ",-1)),l(r("input",{type:"text","onUpdate:modelValue":a[7]||(a[7]=t=>e.postalCode=t),placeholder:"Masukkan kode pos",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[i,e.postalCode]])]),r("div",ga,[a[22]||(a[22]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Alamat ",-1)),l(r("textarea",{"onUpdate:modelValue":a[8]||(a[8]=t=>e.address=t),placeholder:"Masukkan detail alamat lengkap",rows:"3",class:"dark:bg-dark-900 h-auto w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[i,e.address]])]),r("div",pa,[a[23]||(a[23]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Laporan ",-1)),l(r("textarea",{"onUpdate:modelValue":a[9]||(a[9]=t=>e.report=t),placeholder:"Masukkan catatan laporan hasil penyaluran",rows:"4",class:"dark:bg-dark-900 h-auto w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[i,e.report]])]),r("div",ca,[a[24]||(a[24]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[x(" Kantor Cabang "),r("span",{class:"text-red-500"},"*")],-1)),(s=h(c))!=null&&s.is_admin?(m(),S(Q,{key:0,modelValue:e.branchId,"onUpdate:modelValue":a[10]||(a[10]=t=>e.branchId=t),options:M.value,placeholder:"Pilih atau cari kantor cabang","search-input":h(C),"onUpdate:searchInput":a[11]||(a[11]=t=>C.value=t)},null,8,["modelValue","options","search-input"])):(m(),f(P,{key:1},[r("input",{type:"text",value:((d=(n=h(c))==null?void 0:n.kantor_cabang)==null?void 0:d.nama)||"",placeholder:"Kantor cabang Anda",readonly:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:outline-none dark:border-gray-700 dark:bg-gray-900/50 dark:text-white/90"},null,8,ba),l(r("input",{type:"hidden","onUpdate:modelValue":a[12]||(a[12]=t=>e.branchId=t)},null,512),[[i,e.branchId]])],64))]),r("div",ma,[a[28]||(a[28]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Gambar Dokumentasi ",-1)),r("div",ya,[r("div",ka,[r("input",{type:"file",ref_key:"fileInputRef",ref:v,onChange:E,multiple:"",accept:"image/*",class:"hidden",id:"image-upload"},null,544),a[25]||(a[25]=r("label",{for:"image-upload",class:"flex cursor-pointer items-center justify-center rounded-lg border-2 border-dashed border-gray-300 bg-gray-50 px-6 py-8 text-center transition-colors hover:border-brand-300 hover:bg-gray-100 dark:border-gray-700 dark:bg-gray-900/50 dark:hover:border-brand-500"},[r("div",{class:"text-center"},[r("svg",{class:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})]),r("p",{class:"mt-2 text-sm text-gray-600 dark:text-gray-400"},[r("span",{class:"font-medium text-brand-500"},"Klik untuk upload"),x(" atau drag and drop ")]),r("p",{class:"text-xs text-gray-500 dark:text-gray-500"}," PNG, JPG, GIF hingga 20MB (Multiple files) ")])],-1))]),h(k).length>0?(m(),f("div",xa,[(m(!0),f(P,null,W(h(k),(t,u)=>(m(),f("div",{key:u,class:"flex items-center justify-between rounded-lg border border-gray-200 bg-white p-3 dark:border-gray-700 dark:bg-gray-900/50"},[r("div",ha,[a[26]||(a[26]=r("div",{class:"flex h-10 w-10 items-center justify-center rounded bg-gray-100 dark:bg-gray-800"},[r("svg",{class:"h-6 w-6 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1)),r("div",null,[r("p",fa,j(t.name),1),r("p",wa,j(q(t.size)),1)])]),r("button",{type:"button",onClick:R=>K(u),class:"rounded-lg p-1 text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10"},[...a[27]||(a[27]=[r("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,va)]))),128))])):O("",!0)])])]),r("div",{class:"flex items-center gap-3 mt-6 lg:justify-end"},[r("button",{onClick:_,type:"button",class:"flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] sm:w-auto"}," Kembali "),a[29]||(a[29]=r("button",{type:"submit",class:"flex w-full justify-center rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600 sm:w-auto"}," Buat ",-1))])],32)])]}),_:1}))}});export{Sa as default};
