import{d as W,H as Z,I as aa,L as ea,A as n,b as u,B as ta,f as ra,P as sa,g as la,o as _,w as oa,a as t,t as c,q as na,j,m as b,u as ia,k as D,v as I,c as S,i as ua,n as da}from"./admin-CkEpN98t.js";import{_ as ma}from"./AdminLayout.vue_vue_type_script_setup_true_lang-D_tk7--C.js";import{S as U}from"./SearchableSelect-CjBjfcqU.js";import{C as pa}from"./component-D916T80D.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ca={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},ga={class:"mb-6 flex items-center justify-between"},ya={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},va={class:"mb-6 grid grid-cols-1 gap-4 lg:grid-cols-2"},ba={class:"relative"},fa={class:"absolute text-gray-500 -translate-y-1/2 pointer-events-none right-4 top-1/2 dark:text-gray-400 text-sm"},xa={class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},ha=["readonly"],ka={key:0,class:"text-xs text-gray-500 mt-1 dark:text-gray-400"},_a={class:"relative"},wa=["value"],Na={class:"absolute text-gray-500 -translate-y-1/2 pointer-events-none right-4 top-1/2 dark:text-gray-400 text-sm"},ja={class:"text-xs text-gray-500 mt-1 dark:text-gray-400"},Sa={key:0},Pa={key:1},Ta={class:"flex items-center gap-3 mt-6 lg:justify-end"},Va=["disabled"],$="fee_mitra",Ua=W({__name:"PayrollMitraForm",setup(Fa){const g=Z(),P=aa(),d=ea(),{fetchUser:E}=sa(),f=n(()=>g.params.id!==void 0&&g.params.id!=="new"),O=n(()=>f.value?"Edit Payroll Mitra":"Tambah Payroll Mitra"),x=u(!1),w=u([]),T=u([]),V=u(""),F=u(""),B=n(()=>w.value.map(e=>({value:e.id,label:e.nama}))),A=n(()=>T.value.map(e=>({value:e.id,label:e.nama_program}))),J=new Date().toISOString().split("T")[0],s=u({mitra_id:"",program_id:"",nama_mitra:"",jumlah:0,persentase:0,total:0,payroll_date:J}),i=u({type:"percentage",value:null,key:null}),G=n(()=>i.value.type==="nominal"?"Nominal Fee Mitra":"Persentase (%)"),h=n(()=>i.value.type==="nominal"),L=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",maximumFractionDigits:0}).format(e??0),q=e=>e==null||Number.isNaN(e)?"0%":Number.isInteger(e)?`${e}%`:`${Number(e).toFixed(2).replace(/\.00$/,"")}%`,R=n(()=>{const e=i.value.value;return e==null?"":i.value.type==="nominal"?`Fee Mitra ditetapkan sebagai nominal: ${L(e)}`:`Persentase default dari program: ${q(e)}`}),k=n(()=>{const e=Number(s.value.jumlah)||0,a=Number(s.value.persentase)||0;return h.value&&i.value.value!==null?Number(i.value.value):Number(e*a/100)}),M=n({get(){return(Number(s.value.persentase)||0).toFixed(0)},set(e){const a=String(e).replace(/%/g,"").replace(/,/g,"").trim(),r=parseFloat(a);s.value.persentase=isNaN(r)?0:r}}),y=u(!1),C=async(e,a={})=>{const{applyToForm:r=!0}=a;if(i.value={type:"percentage",value:null,key:null},!!e)try{const o=await fetch(`/admin/api/program/${e}`,{credentials:"same-origin"});if(!o.ok)return;const v=await o.json();if(!v.success||!v.data)return;const m=Array.isArray(v.data.shares)?v.data.shares:[];let l=m.find(Q=>String(Q.program_share_type_key)===$);!l&&m.length>0&&(l=m[0]);const p=l==null?void 0:l.value,N=p!=null&&!Number.isNaN(Number(p))?Number(p):null,X=(l==null?void 0:l.type)||"percentage";i.value={type:X,value:N,key:(l==null?void 0:l.program_share_type_key)??$},r&&N!==null&&(s.value.persentase=N)}catch(o){console.error("loadProgramShare:",o)}};ta(()=>s.value.program_id,async e=>{if(y.value){y.value=!1;return}s.value.jumlah="",await C(e)});const H=async()=>{try{const[e,a]=await Promise.all([fetch("/admin/api/mitra?per_page=1000",{credentials:"same-origin"}),fetch("/admin/api/program?per_page=1000",{credentials:"same-origin"})]),r=await e.json(),o=await a.json();w.value=r.success?r.data:[],T.value=o.success?o.data:[]}catch{}},K=async e=>{try{const r=await(await fetch(`/admin/api/mitra-payroll/${e}`,{credentials:"same-origin"})).json();r.success?(y.value=!0,Object.assign(s.value,r.data),y.value=!1,r.data.mitra&&r.data.mitra.id&&(s.value.mitra_id=r.data.mitra.id),r.data.program&&r.data.program.id&&(y.value=!0,s.value.program_id=r.data.program.id),await C(r.data.program_id??null,{applyToForm:!1})):d.error("Gagal memuat data")}catch{d.error("Gagal memuat data")}},Y=async()=>{if(!s.value.jumlah||!s.value.persentase){d.error("Jumlah dan persentase wajib diisi");return}x.value=!0;try{if(s.value.mitra_id){const l=w.value.find(p=>p.id===s.value.mitra_id);s.value.nama_mitra=l?l.nama:""}s.value.total=k.value;const e=f.value?`/admin/api/mitra-payroll/${g.params.id}`:"/admin/api/mitra-payroll",a=f.value?"PUT":"POST",o=(await(await fetch("/admin/api/csrf-token",{credentials:"same-origin"})).json()).csrf_token,m=await(await fetch(e,{method:a,headers:{"Content-Type":"application/json","X-CSRF-TOKEN":o},credentials:"same-origin",body:JSON.stringify(s.value)})).json();m.success?(d.success("Berhasil"),P.push("/user-kepegawaian/payroll-mitra")):d.error(m.message||"Gagal menyimpan")}catch{d.error("Gagal menyimpan")}finally{x.value=!1}},z=()=>P.push("/user-kepegawaian/payroll-mitra");return ra(async()=>{await E(),await H(),f.value&&g.params.id&&await K(g.params.id)}),(e,a)=>(_(),la(ma,null,{default:oa(()=>[t("div",ca,[t("div",ga,[t("h3",ya,c(O.value),1)]),t("form",{onSubmit:na(Y,["prevent"]),class:"flex flex-col"},[t("div",va,[t("div",null,[a[7]||(a[7]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[b("Pilih Mitra "),t("span",{class:"text-red-500"},"*")],-1)),j(U,{modelValue:s.value.mitra_id,"onUpdate:modelValue":a[0]||(a[0]=r=>s.value.mitra_id=r),options:B.value,placeholder:"Pilih Mitra","search-input":V.value,"onUpdate:searchInput":a[1]||(a[1]=r=>V.value=r)},null,8,["modelValue","options","search-input"])]),t("div",null,[a[8]||(a[8]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[b("Pilih Program "),t("span",{class:"text-red-500"},"*")],-1)),j(U,{modelValue:s.value.program_id,"onUpdate:modelValue":a[2]||(a[2]=r=>s.value.program_id=r),options:A.value,placeholder:"Pilih Program","search-input":F.value,"onUpdate:searchInput":a[3]||(a[3]=r=>F.value=r)},null,8,["modelValue","options","search-input"])]),t("div",null,[a[9]||(a[9]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[b("Tanggal Payroll "),t("span",{class:"text-red-500"},"*")],-1)),j(ia(pa),{modelValue:s.value.payroll_date,"onUpdate:modelValue":a[4]||(a[4]=r=>s.value.payroll_date=r),config:{dateFormat:"Y-m-d"},class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90"},null,8,["modelValue"])]),t("div",null,[a[10]||(a[10]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[b("Jumlah "),t("span",{class:"text-red-500"},"*")],-1)),t("div",ba,[D(t("input",{type:"number","onUpdate:modelValue":a[5]||(a[5]=r=>s.value.jumlah=r),placeholder:"Masukkan jumlah",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 pr-24 text-sm text-gray-800 placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90"},null,512),[[I,s.value.jumlah,void 0,{number:!0}]]),t("span",fa," Rp "+c(s.value.jumlah?Number(s.value.jumlah).toLocaleString("id-ID"):"0"),1)])]),t("div",null,[t("label",xa,[b(c(G.value)+" ",1),a[11]||(a[11]=t("span",{class:"text-red-500"},"*",-1))]),D(t("input",{type:"text","onUpdate:modelValue":a[6]||(a[6]=r=>M.value=r),placeholder:"Masukkan persentase",required:"",readonly:h.value,class:da(["dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90",h.value?"cursor-not-allowed bg-gray-100/70 dark:bg-gray-900/70":""])},null,10,ha),[[I,M.value]]),R.value?(_(),S("p",ka,c(R.value),1)):ua("",!0)]),t("div",null,[a[12]||(a[12]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"Total",-1)),t("div",_a,[t("input",{type:"number",value:k.value,readonly:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 pr-24 text-sm text-gray-800 placeholder:text-gray-400"},null,8,wa),t("span",Na," Rp "+c(k.value?Number(k.value).toLocaleString("id-ID"):"0"),1)]),t("p",ja,[h.value?(_(),S("span",Sa,"Total mengikuti nominal fee mitra dari konfigurasi program.")):(_(),S("span",Pa,"Total dihitung otomatis: jumlah × persentase / 100"))])])]),t("div",Ta,[t("button",{onClick:z,type:"button",class:"flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 sm:w-auto"},"Batal"),t("button",{type:"submit",disabled:x.value,class:"flex items-center gap-2 rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600 sm:w-auto"},c(x.value?"Menyimpan...":"Simpan"),9,Va)])],32)])]),_:1}))}});export{Ua as default};
