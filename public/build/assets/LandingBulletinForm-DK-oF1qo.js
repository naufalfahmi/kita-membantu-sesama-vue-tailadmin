import{d as Z,b as w,H as ee,I as te,A as C,M as ae,Q as re,e as E,f as le,g as se,o as i,w as ne,a as e,t as c,q as ie,k as A,c as d,i as u,m as M,v as N,j as q,u as oe}from"./admin-DMZYkn2X.js";import{C as de}from"./component-wVFuFvWJ.js";import{_ as ue}from"./AdminLayout.vue_vue_type_script_setup_true_lang-CLsIF66K.js";import{S as ce}from"./SearchableSelect-BwCMsJcp.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ge={class:"min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12"},pe={class:"mb-6 flex items-center justify-between"},me={class:"font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl"},be={class:"grid grid-cols-1 gap-x-6 gap-y-5 lg:grid-cols-2"},fe={class:"lg:col-span-2"},he={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},ye={key:0,class:"mt-1 text-xs text-red-500"},xe={class:"lg:col-span-2"},ke={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},ve={key:0,class:"mt-1 text-xs text-red-500"},_e={class:"lg:col-span-1"},we={key:0,class:"mt-1 text-xs text-red-500"},Ce={class:"lg:col-span-1"},Be={key:0,class:"mt-1 text-xs text-red-500"},Me={class:"lg:col-span-2"},je={class:"space-y-4"},Se=["disabled"],Te={key:0,class:"space-y-2"},Pe={key:0,class:"space-y-3"},Ue={class:"flex items-center gap-3 rounded-lg border border-gray-300 bg-gray-50 p-4 dark:border-gray-700 dark:bg-gray-800"},Fe={class:"flex-1 min-w-0"},Le={class:"text-sm font-medium text-gray-800 dark:text-white/90 truncate"},Re={class:"text-xs text-gray-500 dark:text-gray-400"},De={class:"flex items-center gap-2"},Oe=["href"],Ve={key:0,class:"rounded-lg border border-gray-300 bg-gray-50 dark:border-gray-700 dark:bg-gray-800 overflow-hidden"},ze={class:"p-2",style:{height:"600px"}},Ee=["src"],Ae={key:1,class:"space-y-3"},Ne={class:"flex items-center gap-3 rounded-lg border border-gray-300 bg-gray-50 p-4 dark:border-gray-700 dark:bg-gray-800"},qe={class:"flex-1 min-w-0"},He={class:"text-sm font-medium text-gray-800 dark:text-white/90 truncate"},Xe={class:"text-xs text-gray-500 dark:text-gray-400"},Ie={key:0,class:"rounded-lg border border-gray-300 bg-gray-50 dark:border-gray-700 dark:bg-gray-800 overflow-hidden"},We={class:"p-2",style:{height:"600px"}},$e=["src"],Ge={key:0,class:"mt-1 text-xs text-red-500"},Ke={class:"flex items-center gap-3 mt-6 lg:justify-end"},Je=["disabled"],rt=Z({__name:"LandingBulletinForm",setup(Qe){const H=[{value:"true",label:"Published (Tampil di Landing)"},{value:"false",label:"Draft (Tidak Tampil)"}],F=w(""),v=ee(),B=te(),f=w(null),j=C(()=>String(v.query.view||"")==="1"),h=C(()=>v.params.id!==void 0&&v.params.id!=="new"),X=C(()=>h.value?"Edit Landing Bulletin":"Tambah Landing Bulletin"),_=w(!1),x=ae(),{fetchUser:I,hasPermission:L,isAdmin:R}=re();I();const D=C(()=>R()||L("create landing bulletin")),S=C(()=>R()||L("update landing bulletin")),W={dateFormat:"Y-m-d",locale:{firstDayOfWeek:1}},a=E({name:"",slug:"",bulletin_date:"",is_published:!0}),O=C({get:()=>a.is_published?"true":"false",set:r=>{a.is_published=r==="true"}}),s=E({name:"",slug:"",bulletin_date:"",file:"",is_published:""}),g=w(null),b=w(""),o=w(null),T=()=>{if(!a.name)return"";const r=a.name.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"");return(!h.value||!a.slug)&&(a.slug=r),r},V=r=>{if(r===0)return"0 Bytes";const t=1024,l=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(r)/Math.log(t));return Math.round(r/Math.pow(t,n)*100)/100+" "+l[n]},$=r=>{var l;const t=r.target;if(t.files&&t.files.length>0){const n=t.files[0],m=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],k=[".pdf",".doc",".docx"],P="."+((l=n.name.split(".").pop())==null?void 0:l.toLowerCase());if(!m.includes(n.type)&&!k.includes(P)){s.file="Format file tidak didukung. Hanya PDF, DOC, dan DOCX yang diizinkan.",f.value&&(f.value.value="");return}const y=20*1024*1024;if(n.size>y){s.file="Ukuran file melebihi 20MB. Mohon pilih file yang lebih kecil.",f.value&&(f.value.value="");return}s.file="",g.value=n,o.value=null,n.type==="application/pdf"?b.value=URL.createObjectURL(n):b.value="",f.value&&(f.value.value="")}},G=()=>{b.value&&URL.revokeObjectURL(b.value),g.value=null,b.value="",f.value&&(f.value.value=""),s.file=""},K=()=>{o.value=null,s.file=""},J=()=>{let r=!0;if(Object.keys(s).forEach(t=>{s[t]=""}),!a.name||a.name.trim()===""?(s.name="Nama bulletin wajib diisi",r=!1):a.name.length>100&&(s.name="Nama bulletin maksimal 100 karakter",r=!1),!a.bulletin_date)s.bulletin_date="Tanggal bulletin wajib diisi",r=!1;else{const t=new Date(a.bulletin_date);isNaN(t.getTime())&&(s.bulletin_date="Format tanggal tidak valid",r=!1)}return!g.value&&!o.value&&(s.file="File bulletin wajib diupload",r=!1),!a.slug&&a.name&&T(),r},Q=async()=>{if(h.value&&v.params.id){const r=v.params.id;_.value=!0;try{const t=await fetch(`/admin/api/landing-bulletin/${r}`,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin"});if(t.status===404){x.error("Bulletin tidak ditemukan"),B.push("/company/landing-bulletin");return}const l=await t.json();if(l.success&&l.data){const n=l.data;if(a.name=n.name||"",a.slug=n.slug||"",a.bulletin_date=n.date||n.bulletin_date||"",!a.slug&&a.name&&T(),a.is_published=n.is_published!==void 0?n.is_published:!0,n.file){const m=n.file_url||n.file,k=m&&String(m).startsWith("http")?m:m?`/storage/${m}`:null,P=typeof k=="string"&&k.toLowerCase().endsWith(".pdf")||n.file_type==="application/pdf";o.value={name:n.file_name||"File Bulletin",url:k,size:n.file_size||void 0,isPdf:P}}}else x.error(l.message||"Gagal memuat data"),B.push("/company/landing-bulletin")}catch(t){console.error("Error loading data:",t),x.error("Terjadi kesalahan saat memuat data"),B.push("/company/landing-bulletin")}finally{_.value=!1}}else a.is_published=!0},z=()=>{b.value&&URL.revokeObjectURL(b.value),B.push("/company/landing-bulletin")},Y=async()=>{if(J()){if(h.value?!S.value:!D.value){x.error("Anda tidak memiliki izin untuk melakukan tindakan ini");return}_.value=!0;try{const r=new FormData;!a.slug&&a.name&&(a.slug=T()),r.append("name",a.name),r.append("slug",a.slug||""),r.append("date",a.bulletin_date),r.append("is_published",a.is_published?"1":"0"),g.value&&r.append("file",g.value);let l=(()=>{var p;return((p=document.querySelector('meta[name="csrf-token"]'))==null?void 0:p.getAttribute("content"))||""})();if(!l)try{const p=await fetch("/admin/api/csrf-token",{credentials:"same-origin"});p.ok&&(l=(await p.json()).csrf_token||l)}catch{}l&&r.append("_token",l);const n=h.value?`/admin/api/landing-bulletin/${v.params.id}`:"/admin/api/landing-bulletin",m=h.value?"PUT":"POST",k=m==="PUT"?"POST":m;m==="PUT"&&r.append("_method","PUT");const y=await(await fetch(n,{method:k,headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json",...l?{"X-CSRF-TOKEN":l}:{}},credentials:"same-origin",body:r})).json();y.success?(b.value&&URL.revokeObjectURL(b.value),x.success(h.value?"Bulletin berhasil diupdate":"Bulletin berhasil ditambahkan"),B.push("/company/landing-bulletin")):(y.errors&&Object.keys(y.errors).forEach(p=>{const U=p==="date"?"bulletin_date":p;s.hasOwnProperty(U)&&(s[U]=Array.isArray(y.errors[p])?y.errors[p][0]:y.errors[p])}),x.error(y.message||"Gagal menyimpan data"))}catch(r){console.error("Error saving:",r),x.error("Terjadi kesalahan saat menyimpan data")}finally{_.value=!1}}};return le(()=>{Q()}),(r,t)=>(i(),se(ue,null,{default:ne(()=>[e("div",ge,[e("div",pe,[e("h3",me,c(X.value),1),e("button",{onClick:z,class:"flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03]"}," Batal ")]),e("form",{onSubmit:ie(Y,["prevent"]),class:"flex flex-col"},[e("div",be,[e("div",fe,[t[5]||(t[5]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[M(" Nama Bulletin "),e("span",{class:"text-red-500"},"*")],-1)),A(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=l=>a.name=l),onInput:T,placeholder:"Masukkan nama bulletin",maxlength:"100",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,544),[[N,a.name]]),e("p",he,c(a.name.length)+"/100 karakter ",1),s.name?(i(),d("p",ye,c(s.name),1)):u("",!0)]),e("div",xe,[t[6]||(t[6]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[M(" Slug (URL) "),e("span",{class:"text-xs text-gray-500"},"(Otomatis di-generate dari nama bulletin)")],-1)),A(e("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=l=>a.slug=l),placeholder:"Slug akan otomatis dibuat dari nama bulletin",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-2.5 text-sm text-gray-600 shadow-theme-xs placeholder:text-gray-400 cursor-not-allowed dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400",readonly:""},null,512),[[N,a.slug]]),e("p",ke," URL-friendly: "+c(a.slug||"akan dibuat otomatis"),1),s.slug?(i(),d("p",ve,c(s.slug),1)):u("",!0)]),e("div",_e,[t[7]||(t[7]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[M(" Tanggal Bulletin "),e("span",{class:"text-red-500"},"*")],-1)),q(oe(de),{modelValue:a.bulletin_date,"onUpdate:modelValue":t[2]||(t[2]=l=>a.bulletin_date=l),config:W,class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",placeholder:"Pilih tanggal bulletin"},null,8,["modelValue"]),s.bulletin_date?(i(),d("p",we,c(s.bulletin_date),1)):u("",!0)]),e("div",Ce,[t[8]||(t[8]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"}," Status Publish ",-1)),q(ce,{modelValue:O.value,"onUpdate:modelValue":t[3]||(t[3]=l=>O.value=l),options:H,placeholder:"Pilih Status","search-input":F.value,"onUpdate:searchInput":t[4]||(t[4]=l=>F.value=l)},null,8,["modelValue","search-input"]),t[9]||(t[9]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," Kontrol apakah bulletin ditampilkan di halaman landing ",-1)),s.is_published?(i(),d("p",Be,c(s.is_published),1)):u("",!0)]),e("div",Me,[t[18]||(t[18]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[M(" File Bulletin "),e("span",{class:"text-red-500"},"*")],-1)),e("div",je,[e("div",null,[e("input",{ref_key:"fileInputRef",ref:f,disabled:j.value,type:"file",accept:".pdf,.doc,.docx",onChange:$,class:"dark:bg-dark-900 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus:border-brand-800"},null,40,Se),t[10]||(t[10]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," Format: PDF, DOC, DOCX. Maksimal 20MB. Hanya 1 file per bulletin. ",-1))]),g.value||o.value?(i(),d("div",Te,[o.value&&!g.value?(i(),d("div",Pe,[e("div",Ue,[t[13]||(t[13]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-10 w-10 text-brand-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})])],-1)),e("div",Fe,[e("p",Le,c(o.value.name||"File Bulletin"),1),e("p",Re,c(o.value.size?V(o.value.size):""),1)]),e("div",De,[o.value.url?(i(),d("a",{key:0,href:o.value.url,target:"_blank",class:"flex items-center gap-1 rounded-lg bg-brand-500 px-3 py-1.5 text-xs font-medium text-white hover:bg-brand-600"},[...t[11]||(t[11]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1),M(" Lihat ",-1)])],8,Oe)):u("",!0),S.value&&!j.value?(i(),d("button",{key:1,type:"button",onClick:K,class:"flex items-center justify-center w-8 h-8 rounded-lg text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 transition-colors"},[...t[12]||(t[12]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M18 6L6 18M6 6l12 12"})],-1)])])):u("",!0)])]),o.value.isPdf&&o.value.url?(i(),d("div",Ve,[t[14]||(t[14]=e("div",{class:"bg-gray-100 dark:bg-gray-900 px-4 py-2 border-b border-gray-300 dark:border-gray-700"},[e("p",{class:"text-sm font-medium text-gray-700 dark:text-gray-400"},"Preview PDF")],-1)),e("div",ze,[e("iframe",{src:o.value.url,class:"w-full h-full border-0 rounded",type:"application/pdf"},null,8,Ee)])])):u("",!0)])):u("",!0),g.value?(i(),d("div",Ae,[e("div",Ne,[t[16]||(t[16]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-10 w-10 text-brand-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})])],-1)),e("div",qe,[e("p",He,c(g.value.name),1),e("p",Xe,c(V(g.value.size)),1)]),S.value&&!j.value?(i(),d("button",{key:0,type:"button",onClick:G,class:"flex items-center justify-center w-8 h-8 rounded-lg text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 transition-colors"},[...t[15]||(t[15]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M18 6L6 18M6 6l12 12"})],-1)])])):u("",!0)]),g.value&&g.value.type==="application/pdf"?(i(),d("div",Ie,[t[17]||(t[17]=e("div",{class:"bg-gray-100 dark:bg-gray-900 px-4 py-2 border-b border-gray-300 dark:border-gray-700"},[e("p",{class:"text-sm font-medium text-gray-700 dark:text-gray-400"},"Preview PDF")],-1)),e("div",We,[e("iframe",{src:b.value,class:"w-full h-full border-0 rounded",type:"application/pdf"},null,8,$e)])])):u("",!0)])):u("",!0)])):u("",!0)]),s.file?(i(),d("p",Ge,c(s.file),1)):u("",!0)])]),e("div",Ke,[e("button",{onClick:z,type:"button",class:"flex w-full justify-center rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] sm:w-auto"}," Batal "),(h.value?S.value:D.value)&&!j.value?(i(),d("button",{key:0,type:"submit",disabled:_.value,class:"flex w-full justify-center rounded-lg bg-brand-500 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-600 disabled:opacity-50 disabled:cursor-not-allowed sm:w-auto"},c(_.value?"Menyimpan...":h.value?"Simpan Perubahan":"Simpan"),9,Je)):u("",!0)])],32)])]),_:1}))}});export{rt as default};
